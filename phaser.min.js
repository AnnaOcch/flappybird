(function(){var a=this;var b=b||{};b.WEBGL_RENDERER=0;b.CANVAS_RENDERER=1;b.VERSION="v2.2.8";b._UID=0;if(typeof(Float32Array)!="undefined"){b.Float32Array=Float32Array;b.Uint16Array=Uint16Array;b.Uint32Array=Uint32Array;b.ArrayBuffer=ArrayBuffer}else{b.Float32Array=Array;b.Uint16Array=Array}b.PI_2=Math.PI*2;b.RAD_TO_DEG=180/Math.PI;b.DEG_TO_RAD=Math.PI/180;b.RETINA_PREFIX="@2x";b.defaultRenderOptions={view:null,transparent:false,antialias:false,preserveDrawingBuffer:false,resolution:1,clearBeforeRender:true,autoResize:false};b.DisplayObject=function(){this.position=new b.Point(0,0);this.scale=new b.Point(1,1);this.transformCallback=null;this.transformCallbackContext=null;this.pivot=new b.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this.worldTransform=new b.Matrix();this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new b.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};b.DisplayObject.prototype.constructor=b.DisplayObject;b.DisplayObject.prototype.destroy=function(){if(this.children){var c=this.children.length;while(c--){this.children[c].destroy()}this.children=[]}this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.renderable=false;this._destroyCachedSprite()};Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var c=this;do{if(!c.visible){return false}c=c.parent}while(c);return true}});Object.defineProperty(b.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(c){if(this._mask){this._mask.isMask=false}this._mask=c;if(this._mask){this._mask.isMask=true}}});Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(f){if(f){var e=[];for(var d=0;d<f.length;d++){var g=f[d].passes;for(var c=0;c<g.length;c++){e.push(g[c])}}this._filterBlock={target:this,filterPasses:e}}this._filters=f}});Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(c){if(this._cacheAsBitmap===c){return}if(c){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=c}});b.DisplayObject.prototype.updateTransform=function(){if(!this.parent){return}var j=this.parent.worldTransform;var g=this.worldTransform;var i,f,l,k,h,e;if(this.rotation%b.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}i=this._cr*this.scale.x;f=this._sr*this.scale.x;l=-this._sr*this.scale.y;k=this._cr*this.scale.y;h=this.position.x;e=this.position.y;if(this.pivot.x||this.pivot.y){h-=this.pivot.x*i+this.pivot.y*l;e-=this.pivot.x*f+this.pivot.y*k}g.a=i*j.a+f*j.c;g.b=i*j.b+f*j.d;g.c=l*j.a+k*j.c;g.d=l*j.b+k*j.d;g.tx=h*j.a+e*j.c+j.tx;g.ty=h*j.b+e*j.d+j.ty}else{i=this.scale.x;k=this.scale.y;h=this.position.x-this.pivot.x*i;e=this.position.y-this.pivot.y*k;g.a=i*j.a;g.b=i*j.b;g.c=k*j.c;g.d=k*j.d;g.tx=h*j.a+e*j.c+j.tx;g.ty=h*j.b+e*j.d+j.ty}this.worldAlpha=this.alpha*this.parent.worldAlpha;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,g,j)}};b.DisplayObject.prototype.displayObjectUpdateTransform=b.DisplayObject.prototype.updateTransform;b.DisplayObject.prototype.getBounds=function(c){c=c;return b.EmptyRectangle};b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)};b.DisplayObject.prototype.setStageReference=function(c){this.stage=c};b.DisplayObject.prototype.preUpdate=function(){};b.DisplayObject.prototype.generateTexture=function(d,e,g){var f=this.getLocalBounds();var c=new b.RenderTexture(f.width|0,f.height|0,g,e,d);b.DisplayObject._tempMatrix.tx=-f.x;b.DisplayObject._tempMatrix.ty=-f.y;c.render(this,b.DisplayObject._tempMatrix);return c};b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};b.DisplayObject.prototype.toGlobal=function(c){this.displayObjectUpdateTransform();return this.worldTransform.apply(c)};b.DisplayObject.prototype.toLocal=function(c,d){if(d){c=d.toGlobal(c)}this.displayObjectUpdateTransform();return this.worldTransform.applyInverse(c)};b.DisplayObject.prototype._renderCachedSprite=function(c){this._cachedSprite.worldAlpha=this.worldAlpha;if(c.gl){b.Sprite.prototype._renderWebGL.call(this._cachedSprite,c)}else{b.Sprite.prototype._renderCanvas.call(this._cachedSprite,c)}};b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=false;var e=this.getLocalBounds();if(!this._cachedSprite){var c=new b.RenderTexture(e.width|0,e.height|0);this._cachedSprite=new b.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(e.width|0,e.height|0)}var d=this._filters;this._filters=null;this._cachedSprite.filters=d;b.DisplayObject._tempMatrix.tx=-e.x;b.DisplayObject._tempMatrix.ty=-e.y;this._cachedSprite.texture.render(this,b.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(e.x/e.width);this._cachedSprite.anchor.y=-(e.y/e.height);this._filters=d;this._cacheAsBitmap=true};b.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null};b.DisplayObject.prototype._renderWebGL=function(c){c=c};b.DisplayObject.prototype._renderCanvas=function(c){c=c};Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(c){this.position.x=c}});Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(c){this.position.y=c}});b.DisplayObjectContainer=function(){b.DisplayObject.call(this);this.children=[]};b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype);b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer;Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(d){var c=this.getLocalBounds().width;if(c!==0){this.scale.x=d/c}else{this.scale.x=1}this._width=d}});Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(d){var c=this.getLocalBounds().height;if(c!==0){this.scale.y=d/c}else{this.scale.y=1}this._height=d}});b.DisplayObjectContainer.prototype.addChild=function(c){return this.addChildAt(c,this.children.length)};b.DisplayObjectContainer.prototype.addChildAt=function(d,c){if(c>=0&&c<=this.children.length){if(d.parent){d.parent.removeChild(d)}d.parent=this;this.children.splice(c,0,d);if(this.stage){d.setStageReference(this.stage)}return d}else{throw new Error(d+"addChildAt: The index "+c+" supplied is out of bounds "+this.children.length)}};b.DisplayObjectContainer.prototype.swapChildren=function(f,c){if(f===c){return}var e=this.getChildIndex(f);var d=this.getChildIndex(c);if(e<0||d<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[e]=c;this.children[d]=f};b.DisplayObjectContainer.prototype.getChildIndex=function(d){var c=this.children.indexOf(d);if(c===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return c};b.DisplayObjectContainer.prototype.setChildIndex=function(e,d){if(d<0||d>=this.children.length){throw new Error("The supplied index is out of bounds")}var c=this.getChildIndex(e);this.children.splice(c,1);this.children.splice(d,0,e)};b.DisplayObjectContainer.prototype.getChildAt=function(c){if(c<0||c>=this.children.length){throw new Error("getChildAt: Supplied index "+c+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[c]};b.DisplayObjectContainer.prototype.removeChild=function(d){var c=this.children.indexOf(d);if(c===-1){return}return this.removeChildAt(c)};b.DisplayObjectContainer.prototype.removeChildAt=function(c){var d=this.getChildAt(c);if(this.stage){d.removeStageReference()}d.parent=undefined;this.children.splice(c,1);return d};b.DisplayObjectContainer.prototype.removeChildren=function(g,h){var f=g||0;var c=typeof h==="number"?h:this.children.length;var d=c-f;if(d>0&&d<=c){var j=this.children.splice(f,d);for(var e=0;e<j.length;e++){var k=j[e];if(this.stage){k.removeStageReference()}k.parent=undefined}return j}else{if(d===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}}};b.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var d=0,c=this.children.length;d<c;d++){this.children[d].updateTransform()}};b.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=b.DisplayObjectContainer.prototype.updateTransform;b.DisplayObjectContainer.prototype.getBounds=function(){if(this.children.length===0){return b.EmptyRectangle}var k=Infinity;var h=Infinity;var e=-Infinity;var d=-Infinity;var l;var p;var o;var f=false;for(var n=0,m=this.children.length;n<m;n++){var g=this.children[n];if(!g.visible){continue}f=true;l=this.children[n].getBounds();k=k<l.x?k:l.x;h=h<l.y?h:l.y;p=l.width+l.x;o=l.height+l.y;e=e>p?e:p;d=d>o?d:o}if(!f){return b.EmptyRectangle}var c=this._bounds;c.x=k;c.y=h;c.width=e-k;c.height=d-h;return c};b.DisplayObjectContainer.prototype.getLocalBounds=function(){var c=this.worldTransform;this.worldTransform=b.identityMatrix;for(var e=0,d=this.children.length;e<d;e++){this.children[e].updateTransform()}var f=this.getBounds();this.worldTransform=c;return f};b.DisplayObjectContainer.prototype.setStageReference=function(c){this.stage=c;for(var d=0;d<this.children.length;d++){this.children[d].setStageReference(c)}};b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var c=0;c<this.children.length;c++){this.children[c].removeStageReference()}this.stage=null};b.DisplayObjectContainer.prototype._renderWebGL=function(d){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}var c;if(this._mask||this._filters){if(this._filters){d.spriteBatch.flush();d.filterManager.pushFilter(this._filterBlock)}if(this._mask){d.spriteBatch.stop();d.maskManager.pushMask(this.mask,d);d.spriteBatch.start()}for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop();if(this._mask){d.maskManager.popMask(this._mask,d)}if(this._filters){d.filterManager.popFilter()}d.spriteBatch.start()}else{for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}}};b.DisplayObjectContainer.prototype._renderCanvas=function(d){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}if(this._mask){d.maskManager.pushMask(this._mask,d)}for(var c=0;c<this.children.length;c++){this.children[c]._renderCanvas(d)}if(this._mask){d.maskManager.popMask(d)}};b.Sprite=function(c){b.DisplayObjectContainer.call(this);this.anchor=new b.Point();this.texture=c||b.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.shader=null;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Sprite.prototype.constructor=b.Sprite;Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(c){this.scale.x=c/this.texture.frame.width;this._width=c}});Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(c){this.scale.y=c/this.texture.frame.height;this._height=c}});b.Sprite.prototype.setTexture=function(c){this.texture=c;this.cachedTint=16777215};b.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};b.Sprite.prototype.getBounds=function(r){var o=this.texture.frame.width;var n=this.texture.frame.height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=r||this.worldTransform;var D=p.a;var B=p.b;var z=p.c;var x=p.d;var E=p.tx;var C=p.ty;var y=-Infinity;var v=-Infinity;var A=Infinity;var w=Infinity;if(B===0&&z===0){if(D<0){D*=-1}if(x<0){x*=-1}A=D*l+E;y=D*m+E;w=x*j+C;v=x*k+C}else{var u=D*l+z*j+E;var h=x*j+B*l+C;var t=D*m+z*j+E;var g=x*j+B*m+C;var s=D*m+z*k+E;var f=x*k+B*m+C;var q=D*l+z*k+E;var e=x*k+B*l+C;A=u<A?u:A;A=t<A?t:A;A=s<A?s:A;A=q<A?q:A;w=h<w?h:w;w=g<w?g:w;w=f<w?f:w;w=e<w?e:w;y=u>y?u:y;y=t>y?t:y;y=s>y?s:y;y=q>y?q:y;v=h>v?h:v;v=g>v?g:v;v=f>v?f:v;v=e>v?e:v}var i=this._bounds;i.x=A;i.width=y-A;i.y=w;i.height=v-w;this._currentBounds=i;return i};b.Sprite.prototype._renderWebGL=function(f){if(!this.visible||this.alpha<=0||!this.renderable){return}var e,d;if(this._mask||this._filters){var c=f.spriteBatch;if(this._filters){c.flush();f.filterManager.pushFilter(this._filterBlock)}if(this._mask){c.stop();f.maskManager.pushMask(this.mask,f);c.start()}c.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(f)}c.stop();if(this._mask){f.maskManager.popMask(this._mask,f)}if(this._filters){f.filterManager.popFilter()}c.start()}else{f.spriteBatch.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(f)}}};b.Sprite.prototype._renderCanvas=function(g){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0){return}if(this.blendMode!==g.currentBlendMode){g.currentBlendMode=this.blendMode;g.context.globalCompositeOperation=b.blendModesCanvas[g.currentBlendMode]}if(this._mask){g.maskManager.pushMask(this._mask,g)}if(this.texture.valid){var e=this.texture.baseTexture.resolution/g.resolution;g.context.globalAlpha=this.worldAlpha;if(g.smoothProperty&&g.scaleMode!==this.texture.baseTexture.scaleMode){g.scaleMode=this.texture.baseTexture.scaleMode;g.context[g.smoothProperty]=(g.scaleMode===b.scaleModes.LINEAR)}var d=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var c=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(g.roundPixels){g.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,(this.worldTransform.tx*g.resolution)|0,(this.worldTransform.ty*g.resolution)|0);d=d|0;c=c|0}else{g.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*g.resolution,this.worldTransform.ty*g.resolution)}if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)}g.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,d/e,c/e,this.texture.crop.width/e,this.texture.crop.height/e)}else{g.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,d/e,c/e,this.texture.crop.width/e,this.texture.crop.height/e)}}for(var f=0;f<this.children.length;f++){this.children[f]._renderCanvas(g)}if(this._mask){g.maskManager.popMask(g)}};b.Sprite.fromFrame=function(d){var c=b.TextureCache[d];if(!c){throw new Error('The frameId "'+d+'" does not exist in the texture cache'+this)}return new b.Sprite(c)};b.Sprite.fromImage=function(d,c,e){var f=b.Texture.fromImage(d,c,e);return new b.Sprite(f)};b.SpriteBatch=function(c){b.DisplayObjectContainer.call(this);this.textureThing=c;this.ready=false};b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype);b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.SpriteBatch.prototype.initWebGL=function(c){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(c);this.ready=true};b.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};b.SpriteBatch.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.initWebGL(c.gl)}if(this.fastSpriteBatch.gl!==c.gl){this.fastSpriteBatch.setContext(c.gl)}c.spriteBatch.stop();c.shaderManager.setShader(c.shaderManager.fastShader);this.fastSpriteBatch.begin(this,c);this.fastSpriteBatch.render(this);c.spriteBatch.start()};b.SpriteBatch.prototype._renderCanvas=function(l){if(!this.visible||this.alpha<=0||!this.children.length){return}var c=l.context;c.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var f=this.worldTransform;var k=true;for(var g=0;g<this.children.length;g++){var d=this.children[g];if(!d.visible){continue}var j=d.texture;var e=j.frame;c.globalAlpha=this.worldAlpha*d.alpha;if(d.rotation%(Math.PI*2)===0){if(k){c.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty);k=false}c.drawImage(j.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width*d.scale.x)+d.position.x+0.5)|0,((d.anchor.y)*(-e.height*d.scale.y)+d.position.y+0.5)|0,e.width*d.scale.x,e.height*d.scale.y)}else{if(!k){k=true}d.displayObjectUpdateTransform();var h=d.worldTransform;if(l.roundPixels){c.setTransform(h.a,h.b,h.c,h.d,h.tx|0,h.ty|0)}else{c.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty)}c.drawImage(j.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width)+0.5)|0,((d.anchor.y)*(-e.height)+0.5)|0,e.width,e.height)}}};b.Text=function(d,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;b.Sprite.call(this,b.Texture.fromCanvas(this.canvas));this.setText(d);this.setStyle(c)};b.Text.prototype=Object.create(b.Sprite.prototype);b.Text.prototype.constructor=b.Text;Object.defineProperty(b.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(c){this.scale.x=c/this.texture.frame.width;this._width=c}});Object.defineProperty(b.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(c){this.scale.y=c/this.texture.frame.height;this._height=c}});b.Text.prototype.setStyle=function(c){c=c||{};c.font=c.font||"bold 20pt Arial";c.fill=c.fill||"black";c.align=c.align||"left";c.stroke=c.stroke||"black";c.strokeThickness=c.strokeThickness||0;c.wordWrap=c.wordWrap||false;c.wordWrapWidth=c.wordWrapWidth||100;c.dropShadow=c.dropShadow||false;c.dropShadowAngle=c.dropShadowAngle||Math.PI/6;c.dropShadowDistance=c.dropShadowDistance||4;c.dropShadowColor=c.dropShadowColor||"black";this.style=c;this.dirty=true};b.Text.prototype.setText=function(c){this.text=c.toString()||" ";this.dirty=true};b.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var j=this.text;if(this.style.wordWrap){j=this.wordWrap(this.text)}var p=j.split(/(?:\r\n|\r|\n)/);var h=[];var q=0;var e=this.determineFontProperties(this.style.font);for(var k=0;k<p.length;k++){var l=this.context.measureText(p[k]).width;h[k]=l;q=Math.max(q,l)}var f=q+this.style.strokeThickness;if(this.style.dropShadow){f+=this.style.dropShadowDistance}this.canvas.width=(f+this.context.lineWidth)*this.resolution;var n=e.fontSize+this.style.strokeThickness;var o=n*p.length;if(this.style.dropShadow){o+=this.style.dropShadowDistance}this.canvas.height=o*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="alphabetic";var g;var d;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var m=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance;var c=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(k=0;k<p.length;k++){g=this.style.strokeThickness/2;d=(this.style.strokeThickness/2+k*n)+e.ascent;if(this.style.align==="right"){g+=q-h[k]}else{if(this.style.align==="center"){g+=(q-h[k])/2}}if(this.style.fill){this.context.fillText(p[k],g+m,d+c)}}}this.context.fillStyle=this.style.fill;for(k=0;k<p.length;k++){g=this.style.strokeThickness/2;d=(this.style.strokeThickness/2+k*n)+e.ascent;if(this.style.align==="right"){g+=q-h[k]}else{if(this.style.align==="center"){g+=(q-h[k])/2}}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(p[k],g,d)}if(this.style.fill){this.context.fillText(p[k],g,d)}}this.updateTexture()};b.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};b.Text.prototype._renderWebGL=function(c){if(this.dirty){this.resolution=c.resolution;this.updateText();this.dirty=false}b.Sprite.prototype._renderWebGL.call(this,c)};b.Text.prototype._renderCanvas=function(c){if(this.dirty){this.resolution=c.resolution;this.updateText();this.dirty=false}b.Sprite.prototype._renderCanvas.call(this,c)};b.Text.prototype.determineFontProperties=function(h){var m=b.Text.fontPropertiesCache[h];if(!m){m={};var e=b.Text.fontPropertiesCanvas;var d=b.Text.fontPropertiesContext;d.font=h;var c=Math.ceil(d.measureText("|MÉq").width);var l=Math.ceil(d.measureText("|MÉq").width);var q=2*l;l=l*1.4|0;e.width=c;e.height=q;d.fillStyle="#f00";d.fillRect(0,0,c,q);d.font=h;d.textBaseline="alphabetic";d.fillStyle="#000";d.fillText("|MÉq",0,l);var n=d.getImageData(0,0,c,q).data;var f=n.length;var r=c*4;var k,g;var p=0;var o=false;for(k=0;k<l;k++){for(g=0;g<r;g+=4){if(n[p+g]!==255){o=true;break}}if(!o){p+=r}else{break}}m.ascent=l-k;p=f-r;o=false;for(k=q;k>l;k--){for(g=0;g<r;g+=4){if(n[p+g]!==255){o=true;break}}if(!o){p-=r}else{break}}m.descent=k-l;m.descent+=6;m.fontSize=m.ascent+m.descent;b.Text.fontPropertiesCache[h]=m}return m};b.Text.prototype.wordWrap=function(h){var m="";var l=h.split("\n");for(var e=0;e<l.length;e++){var d=this.style.wordWrapWidth;var g=l[e].split(" ");for(var c=0;c<g.length;c++){var k=this.context.measureText(g[c]).width;var f=k+this.context.measureText(" ").width;if(c===0||f>d){if(c>0){m+="\n"}m+=g[c];d=this.style.wordWrapWidth-k}else{d-=f;m+=" "+g[c]}}if(e<l.length-1){m+="\n"}}return m};b.Text.prototype.getBounds=function(c){if(this.dirty){this.updateText();this.dirty=false}return b.Sprite.prototype.getBounds.call(this,c)};b.Text.prototype.destroy=function(c){this.context=null;this.canvas=null;this.texture.destroy(c===undefined?true:c)};b.Text.fontPropertiesCache={};b.Text.fontPropertiesCanvas=document.createElement("canvas");b.Text.fontPropertiesContext=b.Text.fontPropertiesCanvas.getContext("2d");b.BitmapText=function(d,c){b.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this.maxWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(d);this.setStyle(c);this.updateText();this.dirty=false};b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setText=function(c){this.text=c||" ";this.dirty=true};b.BitmapText.prototype.setStyle=function(d){d=d||{};d.align=d.align||"left";this.style=d;var c=d.font.split(" ");this.fontName=c[c.length-1];this.fontSize=c.length>=2?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size;this.dirty=true;this.tint=d.tint};b.BitmapText.prototype.updateText=function(){var v=b.BitmapText.fonts[this.fontName];var j=new b.Point();var k=null;var q=[];var r=0;var y=[];var p=0;var w=this.fontSize/v.size;var l=0;for(var t=0;t<this.text.length;t++){var e=this.text.charCodeAt(t);l=/(\s)/.test(this.text.charAt(t))?t:l;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(t))){y.push(j.x);r=Math.max(r,j.x);p++;j.x=0;j.y+=v.lineHeight;k=null;continue}if(l!==-1&&this.maxWidth>0&&j.x*w>this.maxWidth){q.splice(l,t-l);t=l;l=-1;y.push(lastLineWidth);r=Math.max(r,lastLineWidth);p++;j.x=0;j.y+=v.lineHeight;k=null;continue}var d=v.chars[e];if(!d){continue}if(k&&d.kerning[k]){j.x+=d.kerning[k]}q.push({texture:d.texture,line:p,charCode:e,position:new b.Point(j.x+d.xOffset,j.y+d.yOffset)});j.x+=d.xAdvance;k=e}y.push(j.x);r=Math.max(r,j.x);var s=[];for(t=0;t<=p;t++){var x=0;if(this.style.align==="right"){x=r-y[t]}else{if(this.style.align==="center"){x=(r-y[t])/2}}s.push(x)}var f=this.children.length;var g=q.length;var m=this.tint||16777215;this.textWidth=r*w;this.textHeight=(j.y+v.lineHeight)*w;var o=this.textWidth*this.anchor.x;var n=this.textHeight*this.anchor.y;for(t=0;t<g;t++){var u=t<f?this.children[t]:this._pool.pop();if(u){u.setTexture(q[t].texture)}else{u=new b.Sprite(q[t].texture)}u.position.x=((q[t].position.x+s[q[t].line])*w)-o;u.position.y=(q[t].position.y*w)-n;u.scale.x=u.scale.y=w;u.tint=m;if(!u.parent){this.addChild(u)}}while(this.children.length>g){var h=this.getChildAt(this.children.length-1);this._pool.push(h);this.removeChild(h)}};b.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.BitmapText.fonts={};b.Stage=function(c){b.DisplayObjectContainer.call(this);this.worldTransform=new b.Matrix();this.stage=this;this.setBackgroundColor(c)};b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var c=0;c<this.children.length;c++){this.children[c].updateTransform()}};b.Stage.prototype.setBackgroundColor=function(c){this.backgroundColor=c||0;this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);var d=this.backgroundColor.toString(16);d="000000".substr(0,6-d.length)+d;this.backgroundColorString="#"+d};b.hex2rgb=function(c){return[(c>>16&255)/255,(c>>8&255)/255,(c&255)/255]};b.rgb2hex=function(c){return((c[0]*255<<16)+(c[1]*255<<8)+c[2]*255)};b.canUseNewCanvasBlendModes=function(){if(typeof document==="undefined"){return false}var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var h="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var c=new Image();c.src=d+"AP804Oa6"+h;var i=new Image();i.src=d+"/wCKxvRF"+h;var e=document.createElement("canvas");e.width=6;e.height=1;var f=e.getContext("2d");f.globalCompositeOperation="multiply";f.drawImage(c,0,0);f.drawImage(i,2,0);var g=f.getImageData(2,0,1,1).data;return(g[0]===255&&g[1]===0&&g[2]===0)};b.getNextPowerOfTwo=function(d){if(d>0&&(d&(d-1))===0){return d}else{var c=1;while(c<d){c<<=1}return c}};b.isPowerOfTwo=function(d,c){return(d>0&&(d&(d-1))===0&&c>0&&(c&(c-1))===0)};b.PolyK={};b.PolyK.Triangulate=function(k){var y=true;var l=k.length>>1;if(l<3){return[]}var v=[];var h=[];for(var t=0;t<l;t++){h.push(t)}t=0;var q=l;while(q>3){var r=h[(t+0)%q];var o=h[(t+1)%q];var m=h[(t+2)%q];var g=k[2*r],e=k[2*r+1];var w=k[2*o],u=k[2*o+1];var d=k[2*m],c=k[2*m+1];var f=false;if(b.PolyK._convex(g,e,w,u,d,c,y)){f=true;for(var s=0;s<q;s++){var x=h[s];if(x===r||x===o||x===m){continue}if(b.PolyK._PointInTriangle(k[2*x],k[2*x+1],g,e,w,u,d,c)){f=false;break}}}if(f){v.push(r,o,m);h.splice((t+1)%q,1);q--;t=0}else{if(t++>3*q){if(y){v=[];h=[];for(t=0;t<l;t++){h.push(t)}t=0;q=l;y=false}else{return null}}}}v.push(h[0],h[1],h[2]);return v};b.PolyK._PointInTriangle=function(q,p,m,l,z,y,i,g){var f=i-m;var e=g-l;var k=z-m;var j=y-l;var x=q-m;var t=p-l;var w=f*f+e*e;var s=f*k+e*j;var r=f*x+e*t;var d=k*k+j*j;var c=k*x+j*t;var h=1/(w*d-s*s);var o=(d*r-s*c)*h;var n=(w*c-s*r)*h;return(o>=0)&&(n>=0)&&(o+n<1)};b.PolyK._convex=function(f,e,h,g,c,i,d){return((e-g)*(c-h)+(h-f)*(i-g)>=0)===d};b.initDefaultShaders=function(){};b.CompileVertexShader=function(d,c){return b._CompileShader(d,c,d.VERTEX_SHADER)};b.CompileFragmentShader=function(d,c){return b._CompileShader(d,c,d.FRAGMENT_SHADER)};b._CompileShader=function(g,f,e){var d=f.join("\n");var c=g.createShader(e);g.shaderSource(c,d);g.compileShader(c);if(!g.getShaderParameter(c,g.COMPILE_STATUS)){window.console.log(g.getShaderInfoLog(c));return null}return c};b.compileProgram=function(g,c,e){var d=b.CompileFragmentShader(g,e);var f=b.CompileVertexShader(g,c);var h=g.createProgram();g.attachShader(h,f);g.attachShader(h,d);g.linkProgram(h);if(!g.getProgramParameter(h,g.LINK_STATUS)){window.console.log("Could not initialise shaders")}return h};b.PixiShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};b.PixiShader.prototype.constructor=b.PixiShader;b.PixiShader.prototype.init=function(){var e=this.gl;var c=b.compileProgram(e,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(c);this.uSampler=e.getUniformLocation(c,"uSampler");this.projectionVector=e.getUniformLocation(c,"projectionVector");this.offsetVector=e.getUniformLocation(c,"offsetVector");this.dimensions=e.getUniformLocation(c,"dimensions");this.aVertexPosition=e.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=e.getAttribLocation(c,"aTextureCoord");this.colorAttribute=e.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms){this.uniforms[d].uniformLocation=e.getUniformLocation(c,d)}this.initUniforms();this.program=c};b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var f=this.gl;var c;for(var d in this.uniforms){c=this.uniforms[d];var e=c.type;if(e==="sampler2D"){c._init=false;if(c.value!==null){this.initSampler2D(c)}}else{if(e==="mat2"||e==="mat3"||e==="mat4"){c.glMatrix=true;c.glValueLength=1;if(e==="mat2"){c.glFunc=f.uniformMatrix2fv}else{if(e==="mat3"){c.glFunc=f.uniformMatrix3fv}else{if(e==="mat4"){c.glFunc=f.uniformMatrix4fv}}}}else{c.glFunc=f["uniform"+e];if(e==="2f"||e==="2i"){c.glValueLength=2}else{if(e==="3f"||e==="3i"){c.glValueLength=3}else{if(e==="4f"||e==="4i"){c.glValueLength=4}else{c.glValueLength=1}}}}}}};b.PixiShader.prototype.initSampler2D=function(e){if(!e.value||!e.value.baseTexture||!e.value.baseTexture.hasLoaded){return}var j=this.gl;j.activeTexture(j["TEXTURE"+this.textureCount]);j.bindTexture(j.TEXTURE_2D,e.value.baseTexture._glTextures[j.id]);if(e.textureData){var h=e.textureData;var l=(h.magFilter)?h.magFilter:j.LINEAR;var d=(h.minFilter)?h.minFilter:j.LINEAR;var i=(h.wrapS)?h.wrapS:j.CLAMP_TO_EDGE;var g=(h.wrapT)?h.wrapT:j.CLAMP_TO_EDGE;var k=(h.luminance)?j.LUMINANCE:j.RGBA;if(h.repeat){i=j.REPEAT;g=j.REPEAT}j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,!!h.flipY);if(h.width){var c=(h.width)?h.width:512;var m=(h.height)?h.height:2;var f=(h.border)?h.border:0;j.texImage2D(j.TEXTURE_2D,0,k,c,m,f,k,j.UNSIGNED_BYTE,null)}else{j.texImage2D(j.TEXTURE_2D,0,k,j.RGBA,j.UNSIGNED_BYTE,e.value.baseTexture.source)}j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,l);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,d);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,i);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,g)}j.uniform1i(e.uniformLocation,this.textureCount);e._init=true;this.textureCount++};b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var c;var e=this.gl;for(var d in this.uniforms){c=this.uniforms[d];if(c.glValueLength===1){if(c.glMatrix===true){c.glFunc.call(e,c.uniformLocation,c.transpose,c.value)}else{c.glFunc.call(e,c.uniformLocation,c.value)}}else{if(c.glValueLength===2){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y)}else{if(c.glValueLength===3){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z)}else{if(c.glValueLength===4){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z,c.value.w)}else{if(c.type==="sampler2D"){if(c._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(c.value.baseTexture._dirty[e.id]){b.instances[e.id].updateTexture(c.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,c.value.baseTexture._glTextures[e.id])}e.uniform1i(c.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(c)}}}}}}}};b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];b.PixiFastShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};b.PixiFastShader.prototype.constructor=b.PixiFastShader;b.PixiFastShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.dimensions=d.getUniformLocation(c,"dimensions");this.uMatrix=d.getUniformLocation(c,"uMatrix");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aPositionCoord=d.getAttribLocation(c,"aPositionCoord");this.aScale=d.getAttribLocation(c,"aScale");this.aRotation=d.getAttribLocation(c,"aRotation");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.colorAttribute=d.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=c};b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.StripShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};b.StripShader.prototype.constructor=b.StripShader;b.StripShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.colorAttribute=d.getAttribLocation(c,"aColor");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.PrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};b.PrimitiveShader.prototype.constructor=b.PrimitiveShader;b.PrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.colorAttribute=d.getAttribLocation(c,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.ComplexPrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};b.ComplexPrimitiveShader.prototype.constructor=b.ComplexPrimitiveShader;b.ComplexPrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.color=d.getUniformLocation(c,"color");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.WebGLGraphics=function(){};b.WebGLGraphics.renderGraphics=function(k,l){var e=l.gl;var h=l.projection,c=l.offset,g=l.shaderManager.primitiveShader,f;if(k.dirty){b.WebGLGraphics.updateGraphics(k,e)}var j=k._webGL[e.id];for(var d=0;d<j.data.length;d++){if(j.data[d].mode===1){f=j.data[d];l.stencilManager.pushStencil(k,f,l);e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);l.stencilManager.popStencil(k,f,l)}else{f=j.data[d];l.shaderManager.setShader(g);g=l.shaderManager.primitiveShader;e.uniformMatrix3fv(g.translationMatrix,false,k.worldTransform.toArray(true));e.uniform1f(g.flipY,1);e.uniform2f(g.projectionVector,h.x,-h.y);e.uniform2f(g.offsetVector,-c.x,-c.y);e.uniform3fv(g.tintColor,b.hex2rgb(k.tint));e.uniform1f(g.alpha,k.worldAlpha);e.bindBuffer(e.ARRAY_BUFFER,f.buffer);e.vertexAttribPointer(g.aVertexPosition,2,e.FLOAT,false,4*6,0);e.vertexAttribPointer(g.colorAttribute,4,e.FLOAT,false,4*6,2*4);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.indexBuffer);e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0)}}};b.WebGLGraphics.updateGraphics=function(c,j){var g=c._webGL[j.id];if(!g){g=c._webGL[j.id]={lastIndex:0,data:[],gl:j}}c.dirty=false;var d;if(c.clearDirty){c.clearDirty=false;for(d=0;d<g.data.length;d++){var k=g.data[d];k.reset();b.WebGLGraphics.graphicsDataPool.push(k)}g.data=[];g.lastIndex=0}var h;for(d=g.lastIndex;d<c.graphicsData.length;d++){var f=c.graphicsData[d];if(f.type===b.Graphics.POLY){f.points=f.shape.points.slice();if(f.shape.closed){if(f.points[0]!==f.points[f.points.length-2]||f.points[1]!==f.points[f.points.length-1]){f.points.push(f.points[0],f.points[1])}}if(f.fill){if(f.points.length>=6){if(f.points.length<6*2){h=b.WebGLGraphics.switchMode(g,0);var e=b.WebGLGraphics.buildPoly(f,h);if(!e){h=b.WebGLGraphics.switchMode(g,1);b.WebGLGraphics.buildComplexPoly(f,h)}}else{h=b.WebGLGraphics.switchMode(g,1);b.WebGLGraphics.buildComplexPoly(f,h)}}}if(f.lineWidth>0){h=b.WebGLGraphics.switchMode(g,0);b.WebGLGraphics.buildLine(f,h)}}else{h=b.WebGLGraphics.switchMode(g,0);if(f.type===b.Graphics.RECT){b.WebGLGraphics.buildRectangle(f,h)}else{if(f.type===b.Graphics.CIRC||f.type===b.Graphics.ELIP){b.WebGLGraphics.buildCircle(f,h)}else{if(f.type===b.Graphics.RREC){b.WebGLGraphics.buildRoundedRectangle(f,h)}}}}g.lastIndex++}for(d=0;d<g.data.length;d++){h=g.data[d];if(h.dirty){h.upload()}}};b.WebGLGraphics.switchMode=function(d,c){var e;if(!d.data.length){e=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(d.gl);e.mode=c;d.data.push(e)}else{e=d.data[d.data.length-1];if(e.mode!==c||c===1){e=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(d.gl);e.mode=c;d.data.push(e)}}e.dirty=true;return e};b.WebGLGraphics.buildRectangle=function(t,i){var f=t.shape;var o=f.x;var n=f.y;var d=f.width;var s=f.height;if(t.fill){var h=b.hex2rgb(t.fillColor);var e=t.fillAlpha;var c=h[0]*e;var j=h[1]*e;var m=h[2]*e;var p=i.points;var q=i.indices;var l=p.length/6;p.push(o,n);p.push(c,j,m,e);p.push(o+d,n);p.push(c,j,m,e);p.push(o,n+s);p.push(c,j,m,e);p.push(o+d,n+s);p.push(c,j,m,e);q.push(l,l,l+1,l+2,l+3,l+3)}if(t.lineWidth){var k=t.points;t.points=[o,n,o+d,n,o+d,n+s,o,n+s,o,n];b.WebGLGraphics.buildLine(t,i);t.points=k}};b.WebGLGraphics.buildRoundedRectangle=function(m,A){var c=m.shape;var l=c.x;var k=c.y;var q=c.width;var p=c.height;var e=c.radius;var n=[];n.push(l,k+e);n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l,k+p-e,l,k+p,l+e,k+p));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+q-e,k+p,l+q,k+p,l+q,k+p-e));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+q,k+e,l+q,k,l+q-e,k));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+e,k,l,k,l,k+e));if(m.fill){var t=b.hex2rgb(m.fillColor);var f=m.fillAlpha;var o=t[0]*f;var v=t[1]*f;var w=t[2]*f;var z=A.points;var h=A.indices;var d=z.length/6;var s=b.PolyK.Triangulate(n);var u=0;for(u=0;u<s.length;u+=3){h.push(s[u]+d);h.push(s[u]+d);h.push(s[u+1]+d);h.push(s[u+2]+d);h.push(s[u+2]+d)}for(u=0;u<n.length;u++){z.push(n[u],n[++u],o,v,w,f)}}if(m.lineWidth){var j=m.points;m.points=n;b.WebGLGraphics.buildLine(m,A);m.points=j}};b.WebGLGraphics.quadraticBezierCurve=function(s,o,q,k,t,p){var d,l,v,h,r,m,e=20,u=[];function c(n,j,i){var w=j-n;return n+(w*i)}var f=0;for(var g=0;g<=e;g++){f=g/e;d=c(s,q,f);l=c(o,k,f);v=c(q,t,f);h=c(k,p,f);r=c(d,v,f);m=c(l,h,f);u.push(r,m)}return u};b.WebGLGraphics.buildCircle=function(k,z){var t=k.shape;var j=t.x;var h=t.y;var o;var n;if(k.type===b.Graphics.CIRC){o=t.radius;n=t.radius}else{o=t.width;n=t.height}var l=40;var u=(Math.PI*2)/l;var q=0;if(k.fill){var p=b.hex2rgb(k.fillColor);var d=k.fillAlpha;var m=p[0]*d;var s=p[1]*d;var v=p[2]*d;var w=z.points;var e=z.indices;var c=w.length/6;e.push(c);for(q=0;q<l+1;q++){w.push(j,h,m,s,v,d);w.push(j+Math.sin(u*q)*o,h+Math.cos(u*q)*n,m,s,v,d);e.push(c++,c++)}e.push(c-1)}if(k.lineWidth){var f=k.points;k.points=[];for(q=0;q<l+1;q++){k.points.push(j+Math.sin(u*q)*o,h+Math.cos(u*q)*n)}b.WebGLGraphics.buildLine(k,z);k.points=f}};b.WebGLGraphics.buildLine=function(S,C){var O=0;var F=S.points;if(F.length===0){return}if(S.lineWidth%2){for(O=0;O<F.length;O++){F[O]+=0.5}}var t=new b.Point(F[0],F[1]);var l=new b.Point(F[F.length-2],F[F.length-1]);if(t.x===l.x&&t.y===l.y){F=F.slice();F.pop();F.pop();l=new b.Point(F[F.length-2],F[F.length-1]);var v=l.x+(t.x-l.x)*0.5;var s=l.y+(t.y-l.y)*0.5;F.unshift(v,s);F.push(v,s)}var P=C.points;var j=C.indices;var u=F.length/2;var q=F.length;var R=P.length/6;var c=S.lineWidth/2;var E=b.hex2rgb(S.lineColor);var N=S.lineAlpha;var K=E[0]*N;var Q=E[1]*N;var T=E[2]*N;var p,o,H,G,z,y,h,f;var J,I,x,w,e,d;var M,D,n,L,B,m;var U,A,k;H=F[0];G=F[1];z=F[2];y=F[3];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;P.push(H-J,G-I,K,Q,T,N);P.push(H+J,G+I,K,Q,T,N);for(O=1;O<u-1;O++){H=F[(O-1)*2];G=F[(O-1)*2+1];z=F[(O)*2];y=F[(O)*2+1];h=F[(O+1)*2];f=F[(O+1)*2+1];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;x=-(y-f);w=z-h;k=Math.sqrt(x*x+w*w);x/=k;w/=k;x*=c;w*=c;M=(-I+G)-(-I+y);D=(-J+z)-(-J+H);n=(-J+H)*(-I+y)-(-J+z)*(-I+G);L=(-w+f)-(-w+y);B=(-x+z)-(-x+h);m=(-x+h)*(-w+y)-(-x+z)*(-w+f);U=M*B-L*D;if(Math.abs(U)<0.1){U+=10.1;P.push(z-J,y-I,K,Q,T,N);P.push(z+J,y+I,K,Q,T,N);continue}p=(D*m-B*n)/U;o=(L*n-M*m)/U;A=(p-z)*(p-z)+(o-y)+(o-y);if(A>140*140){e=J-x;d=I-w;k=Math.sqrt(e*e+d*d);e/=k;d/=k;e*=c;d*=c;P.push(z-e,y-d);P.push(K,Q,T,N);P.push(z+e,y+d);P.push(K,Q,T,N);P.push(z-e,y-d);P.push(K,Q,T,N);q++}else{P.push(p,o);P.push(K,Q,T,N);P.push(z-(p-z),y-(o-y));P.push(K,Q,T,N)}}H=F[(u-2)*2];G=F[(u-2)*2+1];z=F[(u-1)*2];y=F[(u-1)*2+1];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;P.push(z-J,y-I);P.push(K,Q,T,N);P.push(z+J,y+I);P.push(K,Q,T,N);j.push(R);for(O=0;O<q;O++){j.push(R++)}j.push(R-1)};b.WebGLGraphics.buildComplexPoly=function(o,j){var m=o.points.slice();if(m.length<6){return}var n=j.indices;j.points=m;j.alpha=o.fillAlpha;j.color=b.hex2rgb(o.fillColor);var g=Infinity;var d=-Infinity;var f=Infinity;var c=-Infinity;var l,k;for(var h=0;h<m.length;h+=2){l=m[h];k=m[h+1];g=l<g?l:g;d=l>d?l:d;f=k<f?k:f;c=k>c?k:c}m.push(g,f,d,f,d,c,g,c);var e=m.length/2;for(h=0;h<e;h++){n.push(h)}};b.WebGLGraphics.buildPoly=function(s,k){var p=s.points;if(p.length<6){return}var o=k.points;var q=k.indices;var d=p.length/2;var h=b.hex2rgb(s.fillColor);var f=s.fillAlpha;var c=h[0]*f;var l=h[1]*f;var n=h[2]*f;var e=b.PolyK.Triangulate(p);if(!e){return false}var m=o.length/6;var j=0;for(j=0;j<e.length;j+=3){q.push(e[j]+m);q.push(e[j]+m);q.push(e[j+1]+m);q.push(e[j+2]+m);q.push(e[j+2]+m)}for(j=0;j<d;j++){o.push(p[j*2],p[j*2+1],c,l,n,f)}return true};b.WebGLGraphics.graphicsDataPool=[];b.WebGLGraphicsData=function(c){this.gl=c;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=c.createBuffer();this.indexBuffer=c.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};b.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};b.WebGLGraphicsData.prototype.upload=function(){var c=this.gl;this.glPoints=new b.Float32Array(this.points);c.bindBuffer(c.ARRAY_BUFFER,this.buffer);c.bufferData(c.ARRAY_BUFFER,this.glPoints,c.STATIC_DRAW);this.glIndicies=new b.Uint16Array(this.indices);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.glIndicies,c.STATIC_DRAW);this.dirty=false};b.glContexts=[];b.instances=[];b.WebGLRenderer=function(f,c,d){if(d){for(var e in b.defaultRenderOptions){if(typeof d[e]==="undefined"){d[e]=b.defaultRenderOptions[e]}}}else{d=b.defaultRenderOptions}if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.WEBGL_RENDERER;this.resolution=d.resolution;this.transparent=d.transparent;this.autoResize=d.autoResize||false;this.preserveDrawingBuffer=d.preserveDrawingBuffer;this.clearBeforeRender=d.clearBeforeRender;this.width=f||800;this.height=c||600;this.view=d.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,false);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,false);this._contextOptions={alpha:this.transparent,antialias:d.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:d.preserveDrawingBuffer};this.projection=new b.Point();this.offset=new b.Point(0,0);this.shaderManager=new b.WebGLShaderManager();this.spriteBatch=new b.WebGLSpriteBatch();this.maskManager=new b.WebGLMaskManager();this.filterManager=new b.WebGLFilterManager();this.stencilManager=new b.WebGLStencilManager();this.blendModeManager=new b.WebGLBlendModeManager();this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};b.WebGLRenderer.prototype.constructor=b.WebGLRenderer;b.WebGLRenderer.prototype.initContext=function(){var c=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=c;if(!c){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=c.id=b.WebGLRenderer.glContextId++;b.glContexts[this.glContextId]=c;b.instances[this.glContextId]=this;c.disable(c.DEPTH_TEST);c.disable(c.CULL_FACE);c.enable(c.BLEND);this.shaderManager.setContext(c);this.spriteBatch.setContext(c);this.maskManager.setContext(c);this.filterManager.setContext(c);this.blendModeManager.setContext(c);this.stencilManager.setContext(c);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};b.WebGLRenderer.prototype.render=function(c){if(this.contextLost){return}if(this.__stage!==c){this.__stage=c}c.updateTransform();var d=this.gl;d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,null);if(this.clearBeforeRender){if(this.transparent){d.clearColor(0,0,0,0)}else{d.clearColor(c.backgroundColorSplit[0],c.backgroundColorSplit[1],c.backgroundColorSplit[2],1)}d.clear(d.COLOR_BUFFER_BIT)}this.renderDisplayObject(c,this.projection)};b.WebGLRenderer.prototype.renderDisplayObject=function(e,c,d){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=d?-1:1;this.renderSession.projection=c;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,d);e._renderWebGL(this.renderSession);this.spriteBatch.end()};b.WebGLRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};b.WebGLRenderer.prototype.updateTexture=function(c){if(!c.hasLoaded){return}var d=this.gl;if(!c._glTextures[d.id]){c._glTextures[d.id]=d.createTexture()}d.bindTexture(d.TEXTURE_2D,c._glTextures[d.id]);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.premultipliedAlpha);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c.source);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST);if(c.mipmap&&b.isPowerOfTwo(c.width,c.height)){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR_MIPMAP_LINEAR:d.NEAREST_MIPMAP_NEAREST);d.generateMipmap(d.TEXTURE_2D)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST)}if(!c._powerOf2){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT)}c._dirty[d.id]=false;return c._glTextures[d.id]};b.WebGLRenderer.prototype.handleContextLost=function(c){c.preventDefault();this.contextLost=true};b.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var c in b.TextureCache){var d=b.TextureCache[c].baseTexture;d._glTextures=[]}this.contextLost=false};b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);b.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;b.instances[this.glContextId]=null;b.WebGLRenderer.glContextId--};b.WebGLRenderer.prototype.mapBlendModes=function(){var c=this.gl;if(!b.blendModesWebGL){b.blendModesWebGL=[];b.blendModesWebGL[b.blendModes.NORMAL]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.ADD]=[c.SRC_ALPHA,c.DST_ALPHA];b.blendModesWebGL[b.blendModes.MULTIPLY]=[c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SCREEN]=[c.SRC_ALPHA,c.ONE];b.blendModesWebGL[b.blendModes.OVERLAY]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.DARKEN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.LIGHTEN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR_BURN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.DIFFERENCE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.EXCLUSION]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.HUE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SATURATION]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.LUMINOSITY]=[c.ONE,c.ONE_MINUS_SRC_ALPHA]}};b.WebGLRenderer.glContextId=0;b.WebGLBlendModeManager=function(){this.currentBlendMode=99999};b.WebGLBlendModeManager.prototype.constructor=b.WebGLBlendModeManager;b.WebGLBlendModeManager.prototype.setContext=function(c){this.gl=c};b.WebGLBlendModeManager.prototype.setBlendMode=function(c){if(this.currentBlendMode===c){return false}this.currentBlendMode=c;var d=b.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(d[0],d[1]);return true};b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};b.WebGLMaskManager=function(){};b.WebGLMaskManager.prototype.constructor=b.WebGLMaskManager;b.WebGLMaskManager.prototype.setContext=function(c){this.gl=c};b.WebGLMaskManager.prototype.pushMask=function(d,c){var e=c.gl;if(d.dirty){b.WebGLGraphics.updateGraphics(d,e)}if(!d._webGL[e.id].data.length){return}c.stencilManager.pushStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.popMask=function(d,c){var e=this.gl;c.stencilManager.popStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.destroy=function(){this.gl=null};b.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};b.WebGLStencilManager.prototype.setContext=function(c){this.gl=c};b.WebGLStencilManager.prototype.pushStencil=function(c,f,d){var e=this.gl;this.bindGraphics(c,f,d);if(this.stencilStack.length===0){e.enable(e.STENCIL_TEST);e.clear(e.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(f);var g=this.count;e.colorMask(false,false,false,false);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);if(f.mode===1){e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP);this.count++};b.WebGLStencilManager.prototype.bindGraphics=function(d,i,f){this._currentGraphics=d;var h=this.gl;var c=f.projection,g=f.offset,e;if(i.mode===1){e=f.shaderManager.complexPrimitiveShader;f.shaderManager.setShader(e);h.uniform1f(e.flipY,f.flipY);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform3fv(e.color,i.color);h.uniform1f(e.alpha,d.worldAlpha*i.alpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*2,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}else{e=f.shaderManager.primitiveShader;f.shaderManager.setShader(e);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform1f(e.flipY,f.flipY);h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform1f(e.alpha,d.worldAlpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*6,0);h.vertexAttribPointer(e.colorAttribute,4,h.FLOAT,false,4*6,2*4);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}};b.WebGLStencilManager.prototype.popStencil=function(c,f,d){var e=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){e.disable(e.STENCIL_TEST)}else{var g=this.count;this.bindGraphics(c,f,d);e.colorMask(false,false,false,false);if(f.mode===1){this.reverse=!this.reverse;if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};b.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};b.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var c=0;c<this.maxAttibs;c++){this.attribState[c]=false}this.stack=[]};b.WebGLShaderManager.prototype.constructor=b.WebGLShaderManager;b.WebGLShaderManager.prototype.setContext=function(c){this.gl=c;this.primitiveShader=new b.PrimitiveShader(c);this.complexPrimitiveShader=new b.ComplexPrimitiveShader(c);this.defaultShader=new b.PixiShader(c);this.fastShader=new b.PixiFastShader(c);this.stripShader=new b.StripShader(c);this.setShader(this.defaultShader)};b.WebGLShaderManager.prototype.setAttribs=function(f){var d;for(d=0;d<this.tempAttribState.length;d++){this.tempAttribState[d]=false}for(d=0;d<f.length;d++){var c=f[d];this.tempAttribState[c]=true}var e=this.gl;for(d=0;d<this.attribState.length;d++){if(this.attribState[d]!==this.tempAttribState[d]){this.attribState[d]=this.tempAttribState[d];if(this.tempAttribState[d]){e.enableVertexAttribArray(d)}else{e.disableVertexAttribArray(d)}}}};b.WebGLShaderManager.prototype.setShader=function(c){if(this._currentId===c._UID){return false}this._currentId=c._UID;this.currentShader=c;this.gl.useProgram(c.program);this.setAttribs(c.attributes);return true};b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};b.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2000;var c=this.size*4*4*this.vertSize;var f=this.size*6;this.vertices=new b.ArrayBuffer(c);this.positions=new b.Float32Array(this.vertices);this.colors=new b.Uint32Array(this.vertices);this.indices=new b.Uint16Array(f);this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new b.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};b.WebGLSpriteBatch.prototype.setContext=function(d){this.gl=d;this.vertexBuffer=d.createBuffer();this.indexBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);this.currentBlendMode=99999;var c=new b.PixiShader(d);c.fragmentSrc=this.defaultShader.fragmentSrc;c.uniforms={};c.init();this.defaultShader.shaders[d.id]=c};b.WebGLSpriteBatch.prototype.begin=function(c){this.renderSession=c;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};b.WebGLSpriteBatch.prototype.end=function(){this.flush()};b.WebGLSpriteBatch.prototype.render=function(q){var p=q.texture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=p.baseTexture}var m=p._uvs;if(!m){return}var f=q.anchor.x;var e=q.anchor.y;var o,n,k,j;if(p.trim){var t=p.trim;n=t.x-f*t.width;o=n+p.crop.width;j=t.y-e*t.height;k=j+p.crop.height}else{o=(p.frame.width)*(1-f);n=(p.frame.width)*-f;k=p.frame.height*(1-e);j=p.frame.height*-e}var g=this.currentBatchSize*4*this.vertSize;var r=p.baseTexture.resolution;var s=q.worldTransform;var z=s.a/r;var x=s.b/r;var v=s.c/r;var u=s.d/r;var y=s.tx;var w=s.ty;var l=this.colors;var i=this.positions;if(this.renderSession.roundPixels){i[g]=z*n+v*j+y|0;i[g+1]=u*j+x*n+w|0;i[g+5]=z*o+v*j+y|0;i[g+6]=u*j+x*o+w|0;i[g+10]=z*o+v*k+y|0;i[g+11]=u*k+x*o+w|0;i[g+15]=z*n+v*k+y|0;i[g+16]=u*k+x*n+w|0}else{i[g]=z*n+v*j+y;i[g+1]=u*j+x*n+w;i[g+5]=z*o+v*j+y;i[g+6]=u*j+x*o+w;i[g+10]=z*o+v*k+y;i[g+11]=u*k+x*o+w;i[g+15]=z*n+v*k+y;i[g+16]=u*k+x*n+w}i[g+2]=m.x0;i[g+3]=m.y0;i[g+7]=m.x1;i[g+8]=m.y1;i[g+12]=m.x2;i[g+13]=m.y2;i[g+17]=m.x3;i[g+18]=m.y3;var h=q.tint;l[g+4]=l[g+9]=l[g+14]=l[g+19]=(h>>16)+(h&65280)+((h&255)<<16)+(q.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=q};b.WebGLSpriteBatch.prototype.renderTilingSprite=function(f){var q=f.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=q.baseTexture}if(!f._uvs){f._uvs=new b.TextureUvs()}var n=f._uvs;f.tilePosition.x%=q.baseTexture.width*f.tileScaleOffset.x;f.tilePosition.y%=q.baseTexture.height*f.tileScaleOffset.y;var x=f.tilePosition.x/(q.baseTexture.width*f.tileScaleOffset.x);var w=f.tilePosition.y/(q.baseTexture.height*f.tileScaleOffset.y);var D=(f.width/q.baseTexture.width)/(f.tileScale.x*f.tileScaleOffset.x);var A=(f.height/q.baseTexture.height)/(f.tileScale.y*f.tileScaleOffset.y);n.x0=0-x;n.y0=0-w;n.x1=(1*D)-x;n.y1=0-w;n.x2=(1*D)-x;n.y2=(1*A)-w;n.x3=0-x;n.y3=(1*A)-w;var i=f.tint;var v=(i>>16)+(i&65280)+((i&255)<<16)+(f.alpha*255<<24);var k=this.positions;var m=this.colors;var s=f.width;var r=f.height;var g=f.anchor.x;var e=f.anchor.y;var p=s*(1-g);var o=s*-g;var l=r*(1-e);var j=r*-e;var h=this.currentBatchSize*4*this.vertSize;var t=q.baseTexture.resolution;var u=f.worldTransform;var F=u.a/t;var C=u.b/t;var z=u.c/t;var y=u.d/t;var E=u.tx;var B=u.ty;k[h++]=F*o+z*j+E;k[h++]=y*j+C*o+B;k[h++]=n.x0;k[h++]=n.y0;m[h++]=v;k[h++]=(F*p+z*j+E);k[h++]=y*j+C*p+B;k[h++]=n.x1;k[h++]=n.y1;m[h++]=v;k[h++]=F*p+z*l+E;k[h++]=y*l+C*p+B;k[h++]=n.x2;k[h++]=n.y2;m[h++]=v;k[h++]=F*o+z*l+E;k[h++]=y*l+C*o+B;k[h++]=n.x3;k[h++]=n.y3;m[h++]=v;this.sprites[this.currentBatchSize++]=f};b.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var s=this.gl;var c;if(this.dirty){this.dirty=false;s.activeTexture(s.TEXTURE0);s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c=this.defaultShader.shaders[s.id];var n=this.vertSize*4;s.vertexAttribPointer(c.aVertexPosition,2,s.FLOAT,false,n,0);s.vertexAttribPointer(c.aTextureCoord,2,s.FLOAT,false,n,2*4);s.vertexAttribPointer(c.colorAttribute,4,s.UNSIGNED_BYTE,true,n,4*4)}if(this.currentBatchSize>(this.size*0.5)){s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices)}else{var k=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,k)}var q,v,h;var o=0;var g=0;var u=null;var l=this.renderSession.blendModeManager.currentBlendMode;var d=null;var f=false;var e=false;var m;for(var t=0,r=this.currentBatchSize;t<r;t++){m=this.sprites[t];q=m.texture.baseTexture;v=m.blendMode;h=m.shader||this.defaultShader;f=l!==v;e=d!==h;if(u!==q||f||e){this.renderBatch(u,o,g);g=t;o=0;u=q;if(f){l=v;this.renderSession.blendModeManager.setBlendMode(l)}if(e){d=h;c=d.shaders[s.id];if(!c){c=new b.PixiShader(s);c.fragmentSrc=d.fragmentSrc;c.uniforms=d.uniforms;c.init();d.shaders[s.id]=c}this.renderSession.shaderManager.setShader(c);if(c.dirty){c.syncUniforms()}var w=this.renderSession.projection;s.uniform2f(c.projectionVector,w.x,w.y);var p=this.renderSession.offset;s.uniform2f(c.offsetVector,p.x,p.y)}}o++}this.renderBatch(u,o,g);this.currentBatchSize=0};b.WebGLSpriteBatch.prototype.renderBatch=function(d,c,f){if(c===0){return}var e=this.gl;if(d._dirty[e.id]){this.renderSession.renderer.updateTexture(d)}else{e.bindTexture(e.TEXTURE_2D,d._glTextures[e.id])}e.drawElements(e.TRIANGLES,c*6,e.UNSIGNED_SHORT,f*6*2);this.renderSession.drawCount++};b.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};b.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};b.WebGLFastSpriteBatch=function(g){this.vertSize=10;this.maxSize=6000;this.size=this.maxSize;var c=this.size*4*this.vertSize;var f=this.maxSize*6;this.vertices=new b.Float32Array(c);this.indices=new b.Uint16Array(f);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(g)};b.WebGLFastSpriteBatch.prototype.constructor=b.WebGLFastSpriteBatch;b.WebGLFastSpriteBatch.prototype.setContext=function(c){this.gl=c;this.vertexBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertices,c.DYNAMIC_DRAW)};b.WebGLFastSpriteBatch.prototype.begin=function(c,d){this.renderSession=d;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=c.worldTransform.toArray(true);this.start()};b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.render=function(c){var g=c.children;var f=g[0];if(!f.texture._uvs){return}this.currentBaseTexture=f.texture.baseTexture;if(f.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(f.blendMode)}for(var e=0,d=g.length;e<d;e++){this.renderSprite(g[e])}this.flush()};b.WebGLFastSpriteBatch.prototype.renderSprite=function(l){if(!l.visible){return}if(l.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=l.texture.baseTexture;if(!l.texture._uvs){return}}var e,i=this.vertices,c,m,g,f,k,j,h;e=l.texture._uvs;c=l.texture.frame.width;m=l.texture.frame.height;if(l.texture.trim){var d=l.texture.trim;f=d.x-l.anchor.x*d.width;g=f+l.texture.crop.width;j=d.y-l.anchor.y*d.height;k=j+l.texture.crop.height}else{g=(l.texture.frame.width)*(1-l.anchor.x);f=(l.texture.frame.width)*-l.anchor.x;k=l.texture.frame.height*(1-l.anchor.y);j=l.texture.frame.height*-l.anchor.y}h=this.currentBatchSize*4*this.vertSize;i[h++]=f;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x0;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x1;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x2;i[h++]=e.y2;i[h++]=l.alpha;i[h++]=f;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x3;i[h++]=e.y3;i[h++]=l.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};b.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var d=this.gl;if(!this.currentBaseTexture._glTextures[d.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,d)}d.bindTexture(d.TEXTURE_2D,this.currentBaseTexture._glTextures[d.id]);if(this.currentBatchSize>(this.size*0.5)){d.bufferSubData(d.ARRAY_BUFFER,0,this.vertices)}else{var c=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);d.bufferSubData(d.ARRAY_BUFFER,0,c)}d.drawElements(d.TRIANGLES,this.currentBatchSize*6,d.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,c.x,c.y);e.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var d=this.vertSize*4;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,false,d,0);e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,false,d,2*4);e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,false,d,4*4);e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,false,d,6*4);e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,false,d,7*4);e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,false,d,9*4)};b.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};b.WebGLFilterManager.prototype.constructor=b.WebGLFilterManager;b.WebGLFilterManager.prototype.setContext=function(c){this.gl=c;this.texturePool=[];this.initShaderBuffers()};b.WebGLFilterManager.prototype.begin=function(e,d){this.renderSession=e;this.defaultShader=e.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=c.x*2;this.height=-c.y*2;this.buffer=d};b.WebGLFilterManager.prototype.pushFilter=function(d){var j=this.gl;var c=this.renderSession.projection;var i=this.renderSession.offset;d._filterArea=d.target.filterArea||d.target.getBounds();this.filterStack.push(d);var e=d.filterPasses[0];this.offsetX+=d._filterArea.x;this.offsetY+=d._filterArea.y;var f=this.texturePool.pop();if(!f){f=new b.FilterTexture(this.gl,this.width,this.height)}else{f.resize(this.width,this.height)}j.bindTexture(j.TEXTURE_2D,f.texture);var g=d._filterArea;var h=e.padding;g.x-=h;g.y-=h;g.width+=h*2;g.height+=h*2;if(g.x<0){g.x=0}if(g.width>this.width){g.width=this.width}if(g.y<0){g.y=0}if(g.height>this.height){g.height=this.height}j.bindFramebuffer(j.FRAMEBUFFER,f.frameBuffer);j.viewport(0,0,g.width,g.height);c.x=g.width/2;c.y=-g.height/2;i.x=-g.x;i.y=-g.y;j.colorMask(true,true,true,true);j.clearColor(0,0,0,0);j.clear(j.COLOR_BUFFER_BIT);d._glFilterTexture=f};b.WebGLFilterManager.prototype.popFilter=function(){var p=this.gl;var m=this.filterStack.pop();var v=m._filterArea;var k=m._glFilterTexture;var w=this.renderSession.projection;var f=this.renderSession.offset;if(m.filterPasses.length>1){p.viewport(0,0,v.width,v.height);p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=v.height;this.vertexArray[2]=v.width;this.vertexArray[3]=v.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=v.width;this.vertexArray[7]=0;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);var r=k;var d=this.texturePool.pop();if(!d){d=new b.FilterTexture(this.gl,this.width,this.height)}d.resize(this.width,this.height);p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.clear(p.COLOR_BUFFER_BIT);p.disable(p.BLEND);for(var q=0;q<m.filterPasses.length-1;q++){var e=m.filterPasses[q];p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,r.texture);this.applyFilterPass(e,v,v.width,v.height);var u=r;r=d;d=u}p.enable(p.BLEND);k=r;this.texturePool.push(d)}var j=m.filterPasses[m.filterPasses.length-1];this.offsetX-=v.x;this.offsetY-=v.y;var n=this.width;var l=this.height;var t=0;var s=0;var o=this.buffer;if(this.filterStack.length===0){p.colorMask(true,true,true,true)}else{var c=this.filterStack[this.filterStack.length-1];v=c._filterArea;n=v.width;l=v.height;t=v.x;s=v.y;o=c._glFilterTexture.frameBuffer}w.x=n/2;w.y=-l/2;f.x=t;f.y=s;v=m._filterArea;var h=v.x-t;var g=v.y-s;p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=h;this.vertexArray[1]=g+v.height;this.vertexArray[2]=h+v.width;this.vertexArray[3]=g+v.height;this.vertexArray[4]=h;this.vertexArray[5]=g;this.vertexArray[6]=h+v.width;this.vertexArray[7]=g;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);p.viewport(0,0,n*this.renderSession.resolution,l*this.renderSession.resolution);p.bindFramebuffer(p.FRAMEBUFFER,o);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,k.texture);this.applyFilterPass(j,v,n,l);this.texturePool.push(k);m._glFilterTexture=null};b.WebGLFilterManager.prototype.applyFilterPass=function(e,g,d,c){var h=this.gl;var f=e.shaders[h.id];if(!f){f=new b.PixiShader(h);f.fragmentSrc=e.fragmentSrc;f.uniforms=e.uniforms;f.init();e.shaders[h.id]=f}this.renderSession.shaderManager.setShader(f);h.uniform2f(f.projectionVector,d/2,-c/2);h.uniform2f(f.offsetVector,0,0);if(e.uniforms.dimensions){e.uniforms.dimensions.value[0]=this.width;e.uniforms.dimensions.value[1]=this.height;e.uniforms.dimensions.value[2]=this.vertexArray[0];e.uniforms.dimensions.value[3]=this.vertexArray[5]}f.syncUniforms();h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.vertexAttribPointer(f.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.uvBuffer);h.vertexAttribPointer(f.aTextureCoord,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.colorBuffer);h.vertexAttribPointer(f.colorAttribute,2,h.FLOAT,false,0,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0);this.renderSession.drawCount++};b.WebGLFilterManager.prototype.initShaderBuffers=function(){var c=this.gl;this.vertexBuffer=c.createBuffer();this.uvBuffer=c.createBuffer();this.colorBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();this.vertexArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertexArray,c.STATIC_DRAW);this.uvArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.bufferData(c.ARRAY_BUFFER,this.uvArray,c.STATIC_DRAW);this.colorArray=new b.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.bufferData(c.ARRAY_BUFFER,this.colorArray,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),c.STATIC_DRAW)};b.WebGLFilterManager.prototype.destroy=function(){var d=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var c=0;c<this.texturePool.length;c++){this.texturePool[c].destroy()}this.texturePool=null;d.deleteBuffer(this.vertexBuffer);d.deleteBuffer(this.uvBuffer);d.deleteBuffer(this.colorBuffer);d.deleteBuffer(this.indexBuffer)};b.FilterTexture=function(f,e,c,d){this.gl=f;this.frameBuffer=f.createFramebuffer();this.texture=f.createTexture();d=d||b.scaleModes.DEFAULT;f.bindTexture(f.TEXTURE_2D,this.texture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.texture,0);this.renderBuffer=f.createRenderbuffer();f.bindRenderbuffer(f.RENDERBUFFER,this.renderBuffer);f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,this.renderBuffer);this.resize(e,c)};b.FilterTexture.prototype.constructor=b.FilterTexture;b.FilterTexture.prototype.clear=function(){var c=this.gl;c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT)};b.FilterTexture.prototype.resize=function(d,c){if(this.width===d&&this.height===c){return}this.width=d;this.height=c;var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.texture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d,c,0,e.RGBA,e.UNSIGNED_BYTE,null);e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,d,c)};b.FilterTexture.prototype.destroy=function(){var c=this.gl;c.deleteFramebuffer(this.frameBuffer);c.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};b.CanvasBuffer=function(d,c){this.width=d;this.height=c;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=d;this.canvas.height=c};b.CanvasBuffer.prototype.constructor=b.CanvasBuffer;b.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};b.CanvasBuffer.prototype.resize=function(d,c){this.width=this.canvas.width=d;this.height=this.canvas.height=c};b.CanvasMaskManager=function(){};b.CanvasMaskManager.prototype.constructor=b.CanvasMaskManager;b.CanvasMaskManager.prototype.pushMask=function(h,g){var f=g.context;f.save();var c=h.alpha;var e=h.worldTransform;var d=g.resolution;f.setTransform(e.a*d,e.b*d,e.c*d,e.d*d,e.tx*d,e.ty*d);b.CanvasGraphics.renderGraphicsMask(h,f);f.clip();h.worldAlpha=c};b.CanvasMaskManager.prototype.popMask=function(c){c.context.restore()};b.CanvasTinter=function(){};b.CanvasTinter.getTintedTexture=function(f,c){var g=f.texture;var d=b.CanvasTinter.canvas||document.createElement("canvas");b.CanvasTinter.tintMethod(g,c,d);if(b.CanvasTinter.convertTintToImage){var e=new Image();e.src=d.toDataURL()}else{b.CanvasTinter.canvas=null}return d};b.CanvasTinter.tintWithMultiply=function(g,c,d){var e=d.getContext("2d");var f=g.crop;d.width=f.width;d.height=f.height;e.fillStyle="#"+("00000"+(c|0).toString(16)).substr(-6);e.fillRect(0,0,f.width,f.height);e.globalCompositeOperation="multiply";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);e.globalCompositeOperation="destination-atop";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithOverlay=function(g,c,d){var e=d.getContext("2d");var f=g.crop;d.width=f.width;d.height=f.height;e.globalCompositeOperation="copy";e.fillStyle="#"+("00000"+(c|0).toString(16)).substr(-6);e.fillRect(0,0,f.width,f.height);e.globalCompositeOperation="destination-atop";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithPerPixel=function(o,k,f){var e=f.getContext("2d");var m=o.crop;f.width=m.width;f.height=m.height;e.globalCompositeOperation="copy";e.drawImage(o.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);var d=b.hex2rgb(k);var c=d[0],n=d[1],p=d[2];var q=e.getImageData(0,0,m.width,m.height);var h=q.data;for(var l=0;l<h.length;l+=4){h[l+0]*=c;h[l+1]*=n;h[l+2]*=p;if(!b.CanvasTinter.canHandleAlpha){var j=h[l+3];h[l+0]/=255/j;h[l+1]/=255/j;h[l+2]/=255/j}}e.putImageData(q,0,0)};b.CanvasTinter.roundColor=function(c){var d=b.CanvasTinter.cacheStepsPerColorChannel;var e=b.hex2rgb(c);e[0]=Math.min(255,(e[0]/d)*d);e[1]=Math.min(255,(e[1]/d)*d);e[2]=Math.min(255,(e[2]/d)*d);return b.rgb2hex(e)};b.CanvasTinter.checkInverseAlpha=function(){var d=new b.CanvasBuffer(2,1);d.context.fillStyle="rgba(10, 20, 30, 0.5)";d.context.fillRect(0,0,1,1);var e=d.context.getImageData(0,0,1,1);d.context.putImageData(e,1,0);var c=d.context.getImageData(1,0,1,1);return(c.data[0]===e.data[0]&&c.data[1]===e.data[1]&&c.data[2]===e.data[2]&&c.data[3]===e.data[3])};b.CanvasTinter.cacheStepsPerColorChannel=8;b.CanvasTinter.convertTintToImage=false;b.CanvasTinter.canHandleAlpha=b.CanvasTinter.checkInverseAlpha();b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes();b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel;b.CanvasRenderer=function(f,c,d){if(d){for(var e in b.defaultRenderOptions){if(typeof d[e]==="undefined"){d[e]=b.defaultRenderOptions[e]}}}else{d=b.defaultRenderOptions}if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.CANVAS_RENDERER;this.resolution=d.resolution;this.clearBeforeRender=d.clearBeforeRender;this.transparent=d.transparent;this.autoResize=d.autoResize||false;this.width=f||800;this.height=c||600;this.width*=this.resolution;this.height*=this.resolution;this.view=d.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new b.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:false};this.mapBlendModes();this.resize(f,c);if("imageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="imageSmoothingEnabled"}else{if("webkitImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="webkitImageSmoothingEnabled"}else{if("mozImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="mozImageSmoothingEnabled"}else{if("oImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="oImageSmoothingEnabled"}else{if("msImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="msImageSmoothingEnabled"}}}}}};b.CanvasRenderer.prototype.constructor=b.CanvasRenderer;b.CanvasRenderer.prototype.render=function(c){c.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=b.blendModes.NORMAL;this.context.globalCompositeOperation=b.blendModesCanvas[b.blendModes.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{this.context.fillStyle=c.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(c)};b.CanvasRenderer.prototype.destroy=function(c){if(typeof c==="undefined"){c=true}if(c&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};b.CanvasRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};b.CanvasRenderer.prototype.renderDisplayObject=function(d,c){this.renderSession.context=c||this.context;this.renderSession.resolution=this.resolution;d._renderCanvas(this.renderSession)};b.CanvasRenderer.prototype.mapBlendModes=function(){if(!b.blendModesCanvas){b.blendModesCanvas=[];if(b.canUseNewCanvasBlendModes()){b.blendModesCanvas[b.blendModes.NORMAL]="source-over";b.blendModesCanvas[b.blendModes.ADD]="lighter";b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply";b.blendModesCanvas[b.blendModes.SCREEN]="screen";b.blendModesCanvas[b.blendModes.OVERLAY]="overlay";b.blendModesCanvas[b.blendModes.DARKEN]="darken";b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten";b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge";b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn";b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light";b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light";b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference";b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion";b.blendModesCanvas[b.blendModes.HUE]="hue";b.blendModesCanvas[b.blendModes.SATURATION]="saturation";b.blendModesCanvas[b.blendModes.COLOR]="color";b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"}else{b.blendModesCanvas[b.blendModes.NORMAL]="source-over";b.blendModesCanvas[b.blendModes.ADD]="lighter";b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over";b.blendModesCanvas[b.blendModes.SCREEN]="source-over";b.blendModesCanvas[b.blendModes.OVERLAY]="source-over";b.blendModesCanvas[b.blendModes.DARKEN]="source-over";b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over";b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over";b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over";b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over";b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over";b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over";b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over";b.blendModesCanvas[b.blendModes.HUE]="source-over";b.blendModesCanvas[b.blendModes.SATURATION]="source-over";b.blendModesCanvas[b.blendModes.COLOR]="source-over";b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over"}}};b.CanvasGraphics=function(){};b.CanvasGraphics.renderGraphics=function(G,f){var B=G.worldAlpha;if(G.dirty){this.updateGraphicsTint(G);G.dirty=false}for(var E=0;E<G.graphicsData.length;E++){var I=G.graphicsData[E];var e=I.shape;var n=I._fillTint;var d=I._lineTint;f.lineWidth=I.lineWidth;if(I.type===b.Graphics.POLY){f.beginPath();var D=e.points;f.moveTo(D[0],D[1]);for(var C=1;C<D.length/2;C++){f.lineTo(D[C*2],D[C*2+1])}if(e.closed){f.lineTo(D[0],D[1])}if(D[0]===D[D.length-2]&&D[1]===D[D.length-1]){f.closePath()}if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.RECT){if(I.fillColor||I.fillColor===0){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fillRect(e.x,e.y,e.width,e.height)}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.strokeRect(e.x,e.y,e.width,e.height)}}else{if(I.type===b.Graphics.CIRC){f.beginPath();f.arc(e.x,e.y,e.radius,0,2*Math.PI);f.closePath();if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.ELIP){var s=e.width*2;var F=e.height*2;var r=e.x-s/2;var q=e.y-F/2;f.beginPath();var t=0.5522848,m=(s/2)*t,k=(F/2)*t,A=r+s,c=q+F,u=r+s/2,H=q+F/2;f.moveTo(r,H);f.bezierCurveTo(r,H-k,u-m,q,u,q);f.bezierCurveTo(u+m,q,A,H-k,A,H);f.bezierCurveTo(A,H+k,u+m,c,u,c);f.bezierCurveTo(u-m,c,r,H+k,r,H);f.closePath();if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.RREC){var o=e.x;var l=e.y;var z=e.width;var v=e.height;var g=e.radius;var p=Math.min(z,v)/2|0;g=g>p?p:g;f.beginPath();f.moveTo(o,l+g);f.lineTo(o,l+v-g);f.quadraticCurveTo(o,l+v,o+g,l+v);f.lineTo(o+z-g,l+v);f.quadraticCurveTo(o+z,l+v,o+z,l+v-g);f.lineTo(o+z,l+g);f.quadraticCurveTo(o+z,l,o+z-g,l);f.lineTo(o+g,l);f.quadraticCurveTo(o,l,o,l+g);f.closePath();if(I.fillColor||I.fillColor===0){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}}}}}}};b.CanvasGraphics.renderGraphicsMask=function(E,e){var C=E.graphicsData.length;if(C===0){return}e.beginPath();for(var B=0;B<C;B++){var G=E.graphicsData[B];var d=G.shape;if(G.type===b.Graphics.POLY){var A=d.points;e.moveTo(A[0],A[1]);for(var z=1;z<A.length/2;z++){e.lineTo(A[z*2],A[z*2+1])}if(A[0]===A[A.length-2]&&A[1]===A[A.length-1]){e.closePath()}}else{if(G.type===b.Graphics.RECT){e.rect(d.x,d.y,d.width,d.height);e.closePath()}else{if(G.type===b.Graphics.CIRC){e.arc(d.x,d.y,d.radius,0,2*Math.PI);e.closePath()}else{if(G.type===b.Graphics.ELIP){var q=d.width*2;var D=d.height*2;var p=d.x-q/2;var o=d.y-D/2;var r=0.5522848,l=(q/2)*r,g=(D/2)*r,v=p+q,c=o+D,s=p+q/2,F=o+D/2;e.moveTo(p,F);e.bezierCurveTo(p,F-g,s-l,o,s,o);e.bezierCurveTo(s+l,o,v,F-g,v,F);e.bezierCurveTo(v,F+g,s+l,c,s,c);e.bezierCurveTo(s-l,c,p,F+g,p,F);e.closePath()}else{if(G.type===b.Graphics.RREC){var m=d.x;var k=d.y;var u=d.width;var t=d.height;var f=d.radius;var n=Math.min(u,t)/2|0;f=f>n?n:f;e.moveTo(m,k+f);e.lineTo(m,k+t-f);e.quadraticCurveTo(m,k+t,m+f,k+t);e.lineTo(m+u-f,k+t);e.quadraticCurveTo(m+u,k+t,m+u,k+t-f);e.lineTo(m+u,k+f);e.quadraticCurveTo(m+u,k,m+u-f,k);e.lineTo(m+f,k);e.quadraticCurveTo(m,k,m,k+f);e.closePath()}}}}}}};b.CanvasGraphics.updateGraphicsTint=function(e){if(e.tint===16777215){return}var d=(e.tint>>16&255)/255;var c=(e.tint>>8&255)/255;var h=(e.tint&255)/255;for(var f=0;f<e.graphicsData.length;f++){var g=e.graphicsData[f];var k=g.fillColor|0;var j=g.lineColor|0;g._fillTint=(((k>>16&255)/255*d*255<<16)+((k>>8&255)/255*c*255<<8)+(k&255)/255*h*255);g._lineTint=(((j>>16&255)/255*d*255<<16)+((j>>8&255)/255*c*255<<8)+(j&255)/255*h*255)}};b.Graphics=function(){b.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new b.Rectangle(0,0,1,1);this.dirty=true;this.webGLDirty=false;this.cachedSpriteDirty=false};b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Graphics.prototype.constructor=b.Graphics;b.Graphics.prototype.lineStyle=function(c,d,e){this.lineWidth=c||0;this.lineColor=d||0;this.lineAlpha=(e===undefined)?1:e;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new b.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};b.Graphics.prototype.moveTo=function(c,d){this.drawShape(new b.Polygon([c,d]));return this};b.Graphics.prototype.lineTo=function(c,d){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(c,d);this.dirty=true;return this};b.Graphics.prototype.quadraticCurveTo=function(m,g,p,l){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var c,h,d=20,q=this.currentPath.shape.points;if(q.length===0){this.moveTo(0,0)}var o=q[q.length-2];var k=q[q.length-1];var e=0;for(var f=1;f<=d;++f){e=f/d;c=o+((m-o)*e);h=k+((g-k)*e);q.push(c+(((m+((p-m)*e))-c)*e),h+(((g+((l-g)*e))-h)*e))}this.dirty=true;return this};b.Graphics.prototype.bezierCurveTo=function(s,o,r,h,u,q){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var f=20,d,e,c,m,l,v=this.currentPath.shape.points;var t=v[v.length-2];var p=v[v.length-1];var g=0;for(var k=1;k<=f;++k){g=k/f;d=(1-g);e=d*d;c=e*d;m=g*g;l=m*g;v.push(c*t+3*e*g*s+3*d*m*r+l*u,c*p+3*e*g*o+3*d*m*h+l*q)}this.dirty=true;return this};b.Graphics.prototype.arcTo=function(y,i,x,g,j){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(y,i)}}else{this.moveTo(y,i)}var v=this.currentPath.shape.points,q=v[v.length-2],o=v[v.length-1],D=o-i,l=q-y,C=g-i,k=x-y,w=Math.abs(D*k-l*C);if(w<1e-8||j===0){if(v[v.length-2]!==y||v[v.length-1]!==i){v.push(y,i)}}else{var B=D*D+l*l,s=C*C+k*k,d=D*C+l*k,n=j*Math.sqrt(B)/w,m=j*Math.sqrt(s)/w,e=n*d/B,c=m*d/s,h=n*k+m*l,f=n*C+m*D,r=l*(m+e),p=D*(m+e),A=k*(n+c),z=C*(n+c),u=Math.atan2(p-f,r-h),t=Math.atan2(z-f,A-h);this.arc(h+y,f+i,j,u,t,l*C>k*D)}this.dirty=true;return this};b.Graphics.prototype.arc=function(f,e,g,r,p,d){if(r===p){return this}if(typeof d==="undefined"){d=false}if(!d&&p<=r){p+=Math.PI*2}else{if(d&&r<=p){r+=Math.PI*2}}var l=d?(r-p)*-1:(p-r);var o=Math.ceil(Math.abs(l)/(Math.PI*2))*40;if(l===0){return this}var y=f+Math.cos(r)*g;var w=e+Math.sin(r)*g;if(d&&this.filling){this.moveTo(f,e)}else{this.moveTo(y,w)}var v=this.currentPath.shape.points;var h=l/(o*2);var n=h*2;var q=Math.cos(h);var t=Math.sin(h);var A=o-1;var j=(A%1)/A;for(var u=0;u<=A;u++){var m=u+j*u;var x=((h)+r+(n*m));var z=Math.cos(x);var k=-Math.sin(x);v.push(((q*z)+(t*k))*g+f,((q*-k)+(t*z))*g+e)}this.dirty=true;return this};b.Graphics.prototype.beginFill=function(c,d){this.filling=true;this.fillColor=c||0;this.fillAlpha=(d===undefined)?1:d;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};b.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};b.Graphics.prototype.drawRect=function(d,f,e,c){this.drawShape(new b.Rectangle(d,f,e,c));return this};b.Graphics.prototype.drawRoundedRect=function(e,g,f,d,c){this.drawShape(new b.RoundedRectangle(e,g,f,d,c));return this};b.Graphics.prototype.drawCircle=function(c,e,d){this.drawShape(new b.Circle(c,e,d));return this};b.Graphics.prototype.drawEllipse=function(d,f,e,c){this.drawShape(new b.Ellipse(d,f,e,c));return this};b.Graphics.prototype.drawPolygon=function(e){var d=e;if(!Array.isArray(d)){d=new Array(arguments.length);for(var c=0;c<d.length;++c){d[c]=arguments[c]}}this.drawShape(new Phaser.Polygon(d));return this};b.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];return this};b.Graphics.prototype.generateTexture=function(c,e){c=c||1;var g=this.getBounds();var d=new b.CanvasBuffer(g.width*c,g.height*c);var f=b.Texture.fromCanvas(d.canvas,e);f.baseTexture.resolution=c;d.context.scale(c,c);d.context.translate(-g.x,-g.y);b.CanvasGraphics.renderGraphics(this,d.context);return f};b.Graphics.prototype._renderWebGL=function(d){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;b.Sprite.prototype._renderWebGL.call(this._cachedSprite,d);return}else{d.spriteBatch.stop();d.blendModeManager.setBlendMode(this.blendMode);if(this._mask){d.maskManager.pushMask(this._mask,d)}if(this._filters){d.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==d.spriteBatch.currentBlendMode){d.spriteBatch.currentBlendMode=this.blendMode;var e=b.blendModesWebGL[d.spriteBatch.currentBlendMode];d.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}b.WebGLGraphics.renderGraphics(this,d);if(this.children.length){d.spriteBatch.start();for(var c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop()}if(this._filters){d.filterManager.popFilter()}if(this._mask){d.maskManager.popMask(this.mask,d)}d.drawCount++;d.spriteBatch.start()}};b.Graphics.prototype._renderCanvas=function(g){if(this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;b.Sprite.prototype._renderCanvas.call(this._cachedSprite,g);return}else{var f=g.context;var d=this.worldTransform;if(this.blendMode!==g.currentBlendMode){g.currentBlendMode=this.blendMode;f.globalCompositeOperation=b.blendModesCanvas[g.currentBlendMode]}if(this._mask){g.maskManager.pushMask(this._mask,g)}var c=g.resolution;f.setTransform(d.a*c,d.b*c,d.c*c,d.d*c,d.tx*c,d.ty*c);b.CanvasGraphics.renderGraphics(this,f);for(var e=0;e<this.children.length;e++){this.children[e]._renderCanvas(g)}if(this._mask){g.maskManager.popMask(g)}}};b.Graphics.prototype.getBounds=function(p){if(!this._currentBounds){if(!this.renderable){return b.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var i=this._localBounds;var m=i.x;var l=i.width+i.x;var k=i.y;var j=i.height+i.y;var n=p||this.worldTransform;var B=n.a;var z=n.b;var y=n.c;var w=n.d;var C=n.tx;var A=n.ty;var s=B*l+y*j+C;var h=w*j+z*l+A;var r=B*m+y*j+C;var g=w*j+z*m+A;var q=B*m+y*k+C;var f=w*k+z*m+A;var o=B*l+y*k+C;var e=w*k+z*l+A;var v=s;var t=h;var x=s;var u=h;x=r<x?r:x;x=q<x?q:x;x=o<x?o:x;u=g<u?g:u;u=f<u?f:u;u=e<u?e:u;v=r>v?r:v;v=q>v?q:v;v=o>v?o:v;t=g>t?g:t;t=f>t?f:t;t=e>t?e:t;this._bounds.x=x;this._bounds.width=v-x;this._bounds.y=u;this._bounds.height=t-u;this._currentBounds=this._bounds}return this._currentBounds};b.Graphics.prototype.containsPoint=function(c){this.worldTransform.applyInverse(c,tempPoint);var f=this.graphicsData;for(var d=0;d<f.length;d++){var e=f[d];if(!e.fill){continue}if(e.shape){if(e.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};b.Graphics.prototype.updateLocalBounds=function(){var f=Infinity;var d=-Infinity;var e=Infinity;var c=-Infinity;if(this.graphicsData.length){var o,u,s,q,t,m;for(var l=0;l<this.graphicsData.length;l++){var k=this.graphicsData[l];var p=k.type;var n=k.lineWidth;o=k.shape;if(p===b.Graphics.RECT||p===b.Graphics.RREC){s=o.x-n/2;q=o.y-n/2;t=o.width+n;m=o.height+n;f=s<f?s:f;d=s+t>d?s+t:d;e=q<e?q:e;c=q+m>c?q+m:c}else{if(p===b.Graphics.CIRC){s=o.x;q=o.y;t=o.radius+n/2;m=o.radius+n/2;f=s-t<f?s-t:f;d=s+t>d?s+t:d;e=q-m<e?q-m:e;c=q+m>c?q+m:c}else{if(p===b.Graphics.ELIP){s=o.x;q=o.y;t=o.width+n/2;m=o.height+n/2;f=s-t<f?s-t:f;d=s+t>d?s+t:d;e=q-m<e?q-m:e;c=q+m>c?q+m:c}else{u=o.points;for(var g=0;g<u.length;g++){if(u[g] instanceof Phaser.Point){s=u[g].x;q=u[g].y}else{s=u[g];q=u[g+1];if(g<u.length-1){g++}}f=s-n<f?s-n:f;d=s+n>d?s+n:d;e=q-n<e?q-n:e;c=q+n>c?q+n:c}}}}}}else{f=0;d=0;e=0;c=0}var r=this.boundsPadding;this._localBounds.x=f-r;this._localBounds.width=(d-f)+r*2;this._localBounds.y=e-r;this._localBounds.height=(c-e)+r*2};b.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(!this._cachedSprite){var c=new b.CanvasBuffer(e.width,e.height);var d=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(d);this._cachedSprite.buffer=c;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(e.width,e.height)}this._cachedSprite.anchor.x=-(e.x/e.width);this._cachedSprite.anchor.y=-(e.y/e.height);this._cachedSprite.buffer.context.translate(-e.x,-e.y);this.worldAlpha=1;b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};b.Graphics.prototype.updateCachedSpriteTexture=function(){var e=this._cachedSprite;var d=e.texture;var c=e.buffer.canvas;d.baseTexture.width=c.width;d.baseTexture.height=c.height;d.crop.width=d.frame.width=c.width;d.crop.height=d.frame.height=c.height;e._width=c.width;e._height=c.height;d.baseTexture.dirty()};b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};b.Graphics.prototype.drawShape=function(c){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(c instanceof b.Polygon){c.flatten()}var d=new b.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,c);this.graphicsData.push(d);if(d.type===b.Graphics.POLY){d.shape.closed=this.filling;this.currentPath=d}this.dirty=true;return d};Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(c){this._cacheAsBitmap=c;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite();this.dirty=true}}});b.GraphicsData=function(c,h,e,i,f,g,d){this.lineWidth=c;this.lineColor=h;this.lineAlpha=e;this._lineTint=h;this.fillColor=i;this.fillAlpha=f;this._fillTint=i;this.fill=g;this.shape=d;this.type=d.type};b.GraphicsData.prototype.constructor=b.GraphicsData;b.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};b.Strip=function(c){b.DisplayObjectContainer.call(this);this.texture=c;this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new b.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new b.Float32Array([1,1,1,1]);this.indices=new b.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=b.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=b.Strip.DrawModes.TRIANGLE_STRIP};b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Strip.prototype.constructor=b.Strip;b.Strip.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0){return}c.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(c)}c.shaderManager.setShader(c.shaderManager.stripShader);this._renderStrip(c);c.spriteBatch.start()};b.Strip.prototype._initWebGL=function(c){var d=c.gl;this._vertexBuffer=d.createBuffer();this._indexBuffer=d.createBuffer();this._uvBuffer=d.createBuffer();this._colorBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._uvBuffer);d.bufferData(d.ARRAY_BUFFER,this.uvs,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._colorBuffer);d.bufferData(d.ARRAY_BUFFER,this.colors,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW)};b.Strip.prototype._renderStrip=function(f){var h=f.gl;var c=f.projection,g=f.offset,d=f.shaderManager.stripShader;var e=this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP?h.TRIANGLE_STRIP:h.TRIANGLES;f.blendModeManager.setBlendMode(this.blendMode);h.uniformMatrix3fv(d.translationMatrix,false,this.worldTransform.toArray(true));h.uniform2f(d.projectionVector,c.x,-c.y);h.uniform2f(d.offsetVector,-g.x,-g.y);h.uniform1f(d.alpha,this.worldAlpha);if(!this.dirty){h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferSubData(h.ARRAY_BUFFER,0,this.vertices);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferData(h.ARRAY_BUFFER,this.vertices,h.STATIC_DRAW);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.bufferData(h.ARRAY_BUFFER,this.uvs,h.STATIC_DRAW);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer);h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.indices,h.STATIC_DRAW)}h.drawElements(e,this.indices.length,h.UNSIGNED_SHORT,0)};b.Strip.prototype._renderCanvas=function(e){var d=e.context;var c=this.worldTransform;if(e.roundPixels){d.setTransform(c.a,c.b,c.c,c.d,c.tx|0,c.ty|0)}else{d.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty)}if(this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(d)}else{this._renderCanvasTriangles(d)}};b.Strip.prototype._renderCanvasTriangleStrip=function(g){var d=this.vertices;var f=this.uvs;var h=d.length/2;this.count++;for(var e=0;e<h-2;e++){var c=e*2;this._renderCanvasDrawTriangle(g,d,f,c,(c+2),(c+4))}};b.Strip.prototype._renderCanvasTriangles=function(c){var h=this.vertices;var e=this.uvs;var l=this.indices;var d=l.length;this.count++;for(var f=0;f<d;f+=3){var k=l[f]*2,j=l[f+1]*2,g=l[f+2]*2;this._renderCanvasDrawTriangle(c,h,e,k,j,g)}};b.Strip.prototype._renderCanvasDrawTriangle=function(h,n,x,p,m,l){var e=this.texture.baseTexture.source;var c=this.texture.width;var y=this.texture.height;var J=n[p],I=n[m],G=n[l];var k=n[p+1],j=n[m+1],g=n[l+1];var H=x[p]*c,F=x[m]*c,E=x[l]*c;var i=x[p+1]*y,f=x[m+1]*y,d=x[l+1]*y;if(this.canvasPadding>0){var D=this.canvasPadding/this.worldTransform.a;var C=this.canvasPadding/this.worldTransform.d;var v=(J+I+G)/3;var t=(k+j+g)/3;var B=J-v;var A=k-t;var z=Math.sqrt(B*B+A*A);J=v+(B/z)*(z+D);k=t+(A/z)*(z+C);B=I-v;A=j-t;z=Math.sqrt(B*B+A*A);I=v+(B/z)*(z+D);j=t+(A/z)*(z+C);B=G-v;A=g-t;z=Math.sqrt(B*B+A*A);G=v+(B/z)*(z+D);g=t+(A/z)*(z+C)}h.save();h.beginPath();h.moveTo(J,k);h.lineTo(I,j);h.lineTo(G,g);h.closePath();h.clip();var K=(H*f)+(i*E)+(F*d)-(f*E)-(i*F)-(H*d);var w=(J*f)+(i*G)+(I*d)-(f*G)-(i*I)-(J*d);var u=(H*I)+(J*E)+(F*G)-(I*E)-(J*F)-(H*G);var s=(H*f*G)+(i*I*E)+(J*F*d)-(J*f*E)-(i*F*G)-(H*I*d);var r=(k*f)+(i*g)+(j*d)-(f*g)-(i*j)-(k*d);var q=(H*j)+(k*E)+(F*g)-(j*E)-(k*F)-(H*g);var o=(H*f*g)+(i*j*E)+(k*F*d)-(k*f*E)-(i*F*g)-(H*j*d);h.transform(w/K,r/K,u/K,q/K,s/K,o/K);h.drawImage(e,0,0);h.restore()};b.Strip.prototype.renderStripFlat=function(d){var e=this.context;var l=d.vertices;var g=l.length/2;this.count++;e.beginPath();for(var j=1;j<g-2;j++){var k=j*2;var h=l[k],f=l[k+2],c=l[k+4];var o=l[k+1],n=l[k+3],m=l[k+5];e.moveTo(h,o);e.lineTo(f,n);e.lineTo(c,m)}e.fillStyle="#FF0000";e.fill();e.closePath()};b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};b.Strip.prototype.getBounds=function(o){var m=o||this.worldTransform;var A=m.a;var w=m.b;var u=m.c;var r=m.d;var B=m.tx;var z=m.ty;var t=-Infinity;var q=-Infinity;var v=Infinity;var s=Infinity;var g=this.vertices;for(var p=0,l=g.length;p<l;p+=2){var f=g[p],e=g[p+1];var k=(A*f)+(u*e)+B;var j=(r*e)+(w*f)+z;v=k<v?k:v;s=j<s?j:s;t=k>t?k:t;q=j>q?j:q}if(v===-Infinity||q===Infinity){return b.EmptyRectangle}var h=this._bounds;h.x=v;h.width=t-v;h.y=s;h.height=q-s;this._currentBounds=h;return h};b.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};b.Rope=function(d,c){b.Strip.call(this,d);this.points=c;this.vertices=new b.Float32Array(c.length*4);this.uvs=new b.Float32Array(c.length*4);this.colors=new b.Float32Array(c.length*2);this.indices=new b.Uint16Array(c.length*2);this.refresh()};b.Rope.prototype=Object.create(b.Strip.prototype);b.Rope.prototype.constructor=b.Rope;b.Rope.prototype.refresh=function(){var l=this.points;if(l.length<1){return}var d=this.uvs;var j=l[0];var m=this.indices;var c=this.colors;this.count-=0.2;d[0]=0;d[1]=0;d[2]=0;d[3]=1;c[0]=1;c[1]=1;m[0]=0;m[1]=1;var h=l.length,k,g,f;for(var e=1;e<h;e++){k=l[e];g=e*4;f=e/(h-1);if(e%2){d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}else{d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}g=e*2;c[g]=1;c[g+1]=1;g=e*2;m[g]=g;m[g+1]=g+1;j=k}};b.Rope.prototype.updateTransform=function(){var o=this.points;if(o.length<1){return}var m=o[0];var k;var c={x:0,y:0};this.count-=0.2;var h=this.vertices;var l=o.length,n,g,j,d,f;for(var e=0;e<l;e++){n=o[e];g=e*4;if(e<o.length-1){k=o[e+1]}else{k=n}c.y=-(k.x-m.x);c.x=k.y-m.y;j=(1-(e/(l-1)))*10;if(j>1){j=1}d=Math.sqrt(c.x*c.x+c.y*c.y);f=this.texture.height/2;c.x/=d;c.y/=d;c.x*=f;c.y*=f;h[g]=n.x+c.x;h[g+1]=n.y+c.y;h[g+2]=n.x-c.x;h[g+3]=n.y-c.y;m=n}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.Rope.prototype.setTexture=function(c){this.texture=c};b.TilingSprite=function(e,d,c){b.Sprite.call(this,e);this._width=d||100;this._height=c||100;this.tileScale=new b.Point(1,1);this.tileScaleOffset=new b.Point(1,1);this.tilePosition=new b.Point(0,0);this.renderable=true;this.tint=16777215;this.blendMode=b.blendModes.NORMAL};b.TilingSprite.prototype=Object.create(b.Sprite.prototype);b.TilingSprite.prototype.constructor=b.TilingSprite;Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c}});Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c}});b.TilingSprite.prototype.setTexture=function(c){if(this.texture===c){return}this.texture=c;this.refreshTexture=true;this.cachedTint=16777215};b.TilingSprite.prototype._renderWebGL=function(e){if(this.visible===false||this.alpha===0){return}var d,c;if(this._mask){e.spriteBatch.stop();e.maskManager.pushMask(this.mask,e);e.spriteBatch.start()}if(this._filters){e.spriteBatch.flush();e.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(true);if(this.tilingTexture&&this.tilingTexture.needsUpdate){e.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{e.spriteBatch.renderTilingSprite(this)}for(d=0,c=this.children.length;d<c;d++){this.children[d]._renderWebGL(e)}e.spriteBatch.stop();if(this._filters){e.filterManager.popFilter()}if(this._mask){e.maskManager.popMask(this._mask,e)}e.spriteBatch.start()};b.TilingSprite.prototype._renderCanvas=function(l){if(this.visible===false||this.alpha===0){return}var k=l.context;if(this._mask){l.maskManager.pushMask(this._mask,l)}k.globalAlpha=this.worldAlpha;var g=this.worldTransform;var h,f;var e=l.resolution;k.setTransform(g.a*e,g.b*e,g.c*e,g.d*e,g.tx*e,g.ty*e);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(false);if(this.tilingTexture){this.__tilePattern=k.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}if(this.blendMode!==l.currentBlendMode){l.currentBlendMode=this.blendMode;k.globalCompositeOperation=b.blendModesCanvas[l.currentBlendMode]}var c=this.tilePosition;var d=this.tileScale;c.x%=this.tilingTexture.baseTexture.width;c.y%=this.tilingTexture.baseTexture.height;k.scale(d.x,d.y);k.translate(c.x+(this.anchor.x*-this._width),c.y+(this.anchor.y*-this._height));k.fillStyle=this.__tilePattern;k.fillRect(-c.x,-c.y,this._width/d.x,this._height/d.y);k.scale(1/d.x,1/d.y);k.translate(-c.x+(this.anchor.x*this._width),-c.y+(this.anchor.y*this._height));if(this._mask){l.maskManager.popMask(l)}for(h=0,f=this.children.length;h<f;h++){this.children[h]._renderCanvas(l)}};b.TilingSprite.prototype.getBounds=function(){var o=this._width;var n=this._height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=this.worldTransform;var C=p.a;var A=p.b;var z=p.c;var x=p.d;var D=p.tx;var B=p.ty;var t=C*l+z*j+D;var h=x*j+A*l+B;var s=C*m+z*j+D;var g=x*j+A*m+B;var r=C*m+z*k+D;var f=x*k+A*m+B;var q=C*l+z*k+D;var e=x*k+A*l+B;var w=-Infinity;var u=-Infinity;var y=Infinity;var v=Infinity;y=t<y?t:y;y=s<y?s:y;y=r<y?r:y;y=q<y?q:y;v=h<v?h:v;v=g<v?g:v;v=f<v?f:v;v=e<v?e:v;w=t>w?t:w;w=s>w?s:w;w=r>w?r:w;w=q>w?q:w;u=h>u?h:u;u=g>u?g:u;u=f>u?f:u;u=e>u?e:u;var i=this._bounds;i.x=y;i.width=w-y;i.y=v;i.height=u-v;this._currentBounds=i;return i};b.TilingSprite.prototype.onTextureUpdate=function(){};b.TilingSprite.prototype.generateTilingTexture=function(e){if(!this.texture.baseTexture.hasLoaded){return}var i=this.originalTexture||this.texture;var j=i.frame;var h,d;var c=j.width!==i.baseTexture.width||j.height!==i.baseTexture.height;var g=false;if(!e){if(c){if(i.crop){h=i.crop.width;d=i.crop.height}else{h=j.width;d=j.height}g=true}}else{if(i.crop){h=b.getNextPowerOfTwo(i.crop.width);d=b.getNextPowerOfTwo(i.crop.height)}else{h=b.getNextPowerOfTwo(j.width);d=b.getNextPowerOfTwo(j.height)}g=true}if(g){var f;if(this.tilingTexture&&this.tilingTexture.isTiling){f=this.tilingTexture.canvasBuffer;f.resize(h,d);this.tilingTexture.baseTexture.width=h;this.tilingTexture.baseTexture.height=d;this.tilingTexture.needsUpdate=true}else{f=new b.CanvasBuffer(h,d);this.tilingTexture=b.Texture.fromCanvas(f.canvas);this.tilingTexture.canvasBuffer=f;this.tilingTexture.isTiling=true}f.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,h,d);this.tileScaleOffset.x=j.width/h;this.tileScaleOffset.y=j.height/d}else{if(this.tilingTexture&&this.tilingTexture.isTiling){this.tilingTexture.destroy(true)}this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=i}this.refreshTexture=false;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=true};b.TilingSprite.prototype.destroy=function(){b.Sprite.prototype.destroy.call(this);this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};b.BaseTextureCache={};b.BaseTextureCacheIdGenerator=0;b.BaseTexture=function(d,c){this.resolution=1;this.width=100;this.height=100;this.scaleMode=c||b.scaleModes.DEFAULT;this.hasLoaded=false;this.source=d;this._UID=b._UID++;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!d){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}else{}this.imageUrl=null;this._powerOf2=false};b.BaseTexture.prototype.constructor=b.BaseTexture;b.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete b.BaseTextureCache[this.imageUrl];delete b.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}else{if(this.source&&this.source._pixiId){delete b.BaseTextureCache[this.source._pixiId]}}this.source=null;this.unloadFromGPU()};b.BaseTexture.prototype.updateSourceImage=function(c){this.hasLoaded=false;this.source.src=null;this.source.src=c};b.BaseTexture.prototype.dirty=function(){for(var c=0;c<this._glTextures.length;c++){this._dirty[c]=true}};b.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var d=this._glTextures.length-1;d>=0;d--){var c=this._glTextures[d];var e=b.glContexts[d];if(e&&c){e.deleteTexture(c)}}this._glTextures.length=0;this.dirty()};b.BaseTexture.fromImage=function(d,c,e){var f=b.BaseTextureCache[d];if(c===undefined&&d.indexOf("data:")===-1){c=true}if(!f){var g=new Image();if(c){g.crossOrigin=""}g.src=d;f=new b.BaseTexture(g,e);f.imageUrl=d;b.BaseTextureCache[d]=f;if(d.indexOf(b.RETINA_PREFIX+".")!==-1){f.resolution=2}}return f};b.BaseTexture.fromCanvas=function(c,d){if(!c._pixiId){c._pixiId="canvas_"+b.TextureCacheIdGenerator++}var e=b.BaseTextureCache[c._pixiId];if(!e){e=new b.BaseTexture(c,d);b.BaseTextureCache[c._pixiId]=e}return e};b.TextureCache={};b.FrameCache={};b.TextureSilentFail=false;b.TextureCacheIdGenerator=0;b.Texture=function(e,f,d,c){this.noFrame=false;if(!f){this.noFrame=true;f=new b.Rectangle(0,0,1,1)}if(e instanceof b.Texture){e=e.baseTexture}this.baseTexture=e;this.frame=f;this.trim=c;this.valid=false;this.requiresUpdate=false;this._uvs=null;this.width=0;this.height=0;this.crop=d||new b.Rectangle(0,0,1,1);if(e.hasLoaded){if(this.noFrame){f=new b.Rectangle(0,0,e.width,e.height)}this.setFrame(f)}};b.Texture.prototype.constructor=b.Texture;b.Texture.prototype.onBaseTextureLoaded=function(){var c=this.baseTexture;if(this.noFrame){this.frame=new b.Rectangle(0,0,c.width,c.height)}this.setFrame(this.frame)};b.Texture.prototype.destroy=function(c){if(c){this.baseTexture.destroy()}this.valid=false};b.Texture.prototype.setFrame=function(c){this.noFrame=false;this.frame=c;this.width=c.width;this.height=c.height;this.crop.x=c.x;this.crop.y=c.y;this.crop.width=c.width;this.crop.height=c.height;if(!this.trim&&(c.x+c.width>this.baseTexture.width||c.y+c.height>this.baseTexture.height)){if(!b.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=c&&c.width&&c.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){this._updateUvs()}};b.Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new b.TextureUvs()}var e=this.crop;var c=this.baseTexture.width;var d=this.baseTexture.height;this._uvs.x0=e.x/c;this._uvs.y0=e.y/d;this._uvs.x1=(e.x+e.width)/c;this._uvs.y1=e.y/d;this._uvs.x2=(e.x+e.width)/c;this._uvs.y2=(e.y+e.height)/d;this._uvs.x3=e.x/c;this._uvs.y3=(e.y+e.height)/d};b.Texture.fromImage=function(d,c,e){var f=b.TextureCache[d];if(!f){f=new b.Texture(b.BaseTexture.fromImage(d,c,e));b.TextureCache[d]=f}return f};b.Texture.fromFrame=function(d){var c=b.TextureCache[d];if(!c){throw new Error('The frameId "'+d+'" does not exist in the texture cache ')}return c};b.Texture.fromCanvas=function(c,d){var e=b.BaseTexture.fromCanvas(c,d);return new b.Texture(e)};b.Texture.addTextureToCache=function(c,d){b.TextureCache[d]=c};b.Texture.removeTextureFromCache=function(d){var c=b.TextureCache[d];delete b.TextureCache[d];delete b.BaseTextureCache[d];return c};b.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};b.RenderTexture=function(f,c,g,e,d){this.width=f||100;this.height=c||100;this.resolution=d||1;this.frame=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new b.BaseTexture();this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;b.Texture.call(this,this.baseTexture,new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=g||b.defaultRenderer;if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;this.baseTexture._dirty[h.id]=false;this.textureBuffer=new b.FilterTexture(h,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[h.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new b.Point(this.width*0.5,-this.height*0.5)}else{this.render=this.renderCanvas;this.textureBuffer=new b.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this._updateUvs()};b.RenderTexture.prototype=Object.create(b.Texture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.resize=function(e,c,d){if(e===this.width&&c===this.height){return}this.valid=(e>0&&c>0);this.width=e;this.height=c;this.frame.width=this.crop.width=e*this.resolution;this.frame.height=this.crop.height=c*this.resolution;if(d){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===b.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid){return}this.textureBuffer.resize(this.width,this.height)};b.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===b.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};b.RenderTexture.prototype.renderWebGL=function(l,e,d){if(!this.valid){return}var c=l.worldTransform;c.identity();c.translate(0,this.projection.y*2);if(e){c.append(e)}c.scale(1,-1);l.worldAlpha=1;var h=l.children;for(var g=0,f=h.length;g<f;g++){h[g].updateTransform()}var k=this.renderer.gl;k.viewport(0,0,this.width*this.resolution,this.height*this.resolution);k.bindFramebuffer(k.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(d){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(l,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=true};b.RenderTexture.prototype.renderCanvas=function(k,m,g){if(!this.valid){return}var h=k.worldTransform;h.identity();if(m){h.append(m)}k.worldAlpha=1;var d=k.children;for(var f=0,e=d.length;f<e;f++){d[f].updateTransform()}if(g){this.textureBuffer.clear()}var c=this.textureBuffer.context;var l=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(k,c);this.renderer.resolution=l};b.RenderTexture.prototype.getImage=function(){var c=new Image();c.src=this.getBase64();return c};b.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};b.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;var f=this.textureBuffer.width;var c=this.textureBuffer.height;var d=new Uint8Array(4*f*c);h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer);h.readPixels(0,0,f,c,h.RGBA,h.UNSIGNED_BYTE,d);h.bindFramebuffer(h.FRAMEBUFFER,null);var g=new b.CanvasBuffer(f,c);var e=g.context.getImageData(0,0,f,c);e.data.set(d);g.context.putImageData(e,0,0);return g.canvas}else{return this.textureBuffer.canvas}};b.AbstractFilter=function(d,c){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=c||{};this.fragmentSrc=d||[]};b.AbstractFilter.prototype.constructor=b.AbstractFilter;b.AbstractFilter.prototype.syncUniforms=function(){for(var d=0,c=this.shaders.length;d<c;d++){this.shaders[d].dirty=true}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.PIXI=b}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return a.PIXI=b})())}else{a.PIXI=b}}}).call(this);(function(){var l=this;var g=g||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(!Math.trunc){Math.trunc=function b(p){return p<0?Math.ceil(p):Math.floor(p)}}if(!Function.prototype.bind){Function.prototype.bind=(function(){var p=Array.prototype.slice;return function(q){var t=this,u=p.call(arguments,1);if(typeof t!=="function"){throw new TypeError()}function r(){var v=u.concat(p.call(arguments));t.apply(this instanceof r?this:q,v)}r.prototype=(function s(v){if(v){s.prototype=v}if(!(this instanceof s)){return new s}})(t.prototype);return r}})()}if(!Array.isArray){Array.isArray=function(p){return Object.prototype.toString.call(p)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(r){if(this===void 0||this===null){throw new TypeError()}var u=Object(this);var p=u.length>>>0;if(typeof r!=="function"){throw new TypeError()}var q=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<p;s++){if(s in u){r.call(q,u[s],s,u)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var j=function(p){var q=new Array();window[p]=function(r){if(typeof(r)==="number"){Array.call(this,r);this.length=r;for(var s=0;s<this.length;s++){this[s]=0}}else{Array.call(this,r.length);this.length=r.length;for(var s=0;s<this.length;s++){this[s]=r[s]}}};window[p].prototype=q;window[p].constructor=window[p]};j("Uint32Array");j("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}g.Utils={getProperty:function(u,v){var t=v.split("."),r=t.pop(),p=t.length,q=1,s=t[0];while(q<p&&(u=u[s])){s=t[q];q++}if(u){return u[r]}else{return null}},setProperty:function(v,w,s){var u=w.split("."),r=u.pop(),p=u.length,q=1,t=u[0];while(q<p&&(v=v[t])){t=u[q];q++}if(v){v[r]=s}return v},chanceRoll:function(p){if(typeof p==="undefined"){p=50}return p>0&&(Math.random()*100<=p)},randomChoice:function(q,p){return(Math.random()<0.5)?q:p},transposeArray:function(p){return g.ArrayUtils.transposeMatrix(p)},rotateArray:function(p,q){return g.ArrayUtils.rotateMatrix(p,q)},shuffle:function(p){return g.ArrayUtils.shuffle(p)},parseDimension:function(q,s){var r=0;var p=0;if(typeof q==="string"){if(q.substr(-1)==="%"){r=parseInt(q,10)/100;if(s===0){p=window.innerWidth*r}else{p=window.innerHeight*r}}else{p=parseInt(q,10)}}else{p=q}return p},pad:function(v,p,u,q){if(typeof(p)==="undefined"){var p=0}if(typeof(u)==="undefined"){var u=" "}if(typeof(q)==="undefined"){var q=3}var s=0;if(p+1>=v.length){switch(q){case 1:v=new Array(p+1-v.length).join(u)+v;break;case 3:var r=Math.ceil((s=p-v.length)/2);var t=s-r;v=new Array(t+1).join(u)+v+new Array(r+1).join(u);break;default:v=v+new Array(p+1-v.length).join(u);break}}return v},isPlainObject:function(q){if(typeof(q)!=="object"||q.nodeType||q===q.window){return false}try{if(q.constructor&&!({}).hasOwnProperty.call(q.constructor.prototype,"isPrototypeOf")){return false}}catch(p){return false}return true},extend:function(){var y,r,p,q,v,w,u=arguments[0]||{},t=1,s=arguments.length,x=false;if(typeof u==="boolean"){x=u;u=arguments[1]||{};t=2}if(s===t){u=this;--t}for(;t<s;t++){if((y=arguments[t])!=null){for(r in y){p=u[r];q=y[r];if(u===q){continue}if(x&&q&&(g.Utils.isPlainObject(q)||(v=Array.isArray(q)))){if(v){v=false;w=p&&Array.isArray(p)?p:[]}else{w=p&&g.Utils.isPlainObject(p)?p:{}}u[r]=g.Utils.extend(x,w,q)}else{if(q!==undefined){u[r]=q}}}}}return u},mixinPrototype:function(v,p,t){if(typeof t==="undefined"){t=false}var s=Object.keys(p);for(var r=0;r<s.length;r++){var q=s[r];var u=p[q];if(!t&&(q in v)){continue}else{if(u&&(typeof u.get==="function"||typeof u.set==="function")){if(typeof u.clone==="function"){v[q]=u.clone()}else{Object.defineProperty(v,q,u)}}else{v[q]=u}}}},mixin:function(t,s){if(!t||typeof(t)!=="object"){return s}for(var p in t){var r=t[p];if(r.childNodes||r.cloneNode){continue}var q=typeof(t[p]);if(!t[p]||q!=="object"){s[p]=t[p]}else{if(typeof(s[p])===q){s[p]=g.Utils.mixin(t[p],s[p])}else{s[p]=g.Utils.mixin(t[p],new r.constructor())}}}return s}};g.Circle=function(p,r,q){p=p||0;r=r||0;q=q||0;this.x=p;this.y=r;this._diameter=q;this._radius=0;if(q>0){this._radius=q*0.5}this.type=g.CIRCLE};g.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},getBounds:function(){return new g.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(p,r,q){this.x=p;this.y=r;this._diameter=q;this._radius=q*0.5;return this},copyFrom:function(p){return this.setTo(p.x,p.y,p.diameter)},copyTo:function(p){p.x=this.x;p.y=this.y;p.diameter=this._diameter;return p},distance:function(q,p){var r=g.Math.distance(this.x,this.y,q.x,q.y);return p?Math.round(r):r},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Circle(this.x,this.y,this.diameter)}else{p.setTo(this.x,this.y,this.diameter)}return p},contains:function(p,q){return g.Circle.contains(this,p,q)},circumferencePoint:function(r,q,p){return g.Circle.circumferencePoint(this,r,q,p)},offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};g.Circle.prototype.constructor=g.Circle;Object.defineProperty(g.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(p){if(p>0){this._diameter=p;this._radius=p*0.5}}});Object.defineProperty(g.Circle.prototype,"radius",{get:function(){return this._radius},set:function(p){if(p>0){this._radius=p;this._diameter=p*2}}});Object.defineProperty(g.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(p){if(p>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-p}}});Object.defineProperty(g.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(p){if(p<this.x){this._radius=0;this._diameter=0}else{this.radius=p-this.x}}});Object.defineProperty(g.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(p){if(p>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-p}}});Object.defineProperty(g.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(p){if(p<this.y){this._radius=0;this._diameter=0}else{this.radius=p-this.y}}});Object.defineProperty(g.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(g.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(p){if(p===true){this.setTo(0,0,0)}}});g.Circle.contains=function(r,p,t){if(r.radius>0&&p>=r.left&&p<=r.right&&t>=r.top&&t<=r.bottom){var s=(r.x-p)*(r.x-p);var q=(r.y-t)*(r.y-t);return(s+q)<=(r.radius*r.radius)}else{return false}};g.Circle.equals=function(q,p){return(q.x==p.x&&q.y==p.y&&q.diameter==p.diameter)};g.Circle.intersects=function(q,p){return(g.Math.distance(q.x,q.y,p.x,p.y)<=(q.radius+p.radius))};g.Circle.circumferencePoint=function(p,s,r,q){if(typeof r==="undefined"){r=false}if(typeof q==="undefined"){q=new g.Point()}if(r===true){s=g.Math.degToRad(s)}q.x=p.x+p.radius*Math.cos(s);q.y=p.y+p.radius*Math.sin(s);return q};g.Circle.intersectsRectangle=function(A,q){var u=Math.abs(A.x-q.x-q.halfWidth);var z=q.halfWidth+A.radius;if(u>z){return false}var t=Math.abs(A.y-q.y-q.halfHeight);var x=q.halfHeight+A.radius;if(t>x){return false}if(u<=q.halfWidth||t<=q.halfHeight){return true}var v=u-q.halfWidth;var s=t-q.halfHeight;var y=v*v;var p=s*s;var w=A.radius*A.radius;return y+p<=w};PIXI.Circle=g.Circle;g.Ellipse=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.ELLIPSE};g.Ellipse.prototype={setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},getBounds:function(){return new g.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Ellipse(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p},contains:function(p,q){return g.Ellipse.contains(this,p,q)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};g.Ellipse.prototype.constructor=g.Ellipse;Object.defineProperty(g.Ellipse.prototype,"left",{get:function(){return this.x},set:function(p){this.x=p}});Object.defineProperty(g.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Ellipse.prototype,"top",{get:function(){return this.y},set:function(p){this.y=p}});Object.defineProperty(g.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Ellipse.contains=function(s,q,t){if(s.width<=0||s.height<=0){return false}var r=((q-s.x)/s.width)-0.5;var p=((t-s.y)/s.height)-0.5;r*=r;p*=p;return(r+p<0.25)};PIXI.Ellipse=g.Ellipse;g.Line=function(q,s,p,r){q=q||0;s=s||0;p=p||0;r=r||0;this.start=new g.Point(q,s);this.end=new g.Point(p,r);this.type=g.LINE};g.Line.prototype={setTo:function(q,s,p,r){this.start.setTo(q,s);this.end.setTo(p,r);return this},fromSprite:function(q,r,p){if(typeof p==="undefined"){p=false}if(p){return this.setTo(q.center.x,q.center.y,r.center.x,r.center.y)}return this.setTo(q.x,q.y,r.x,r.y)},fromAngle:function(p,s,r,q){this.start.setTo(p,s);this.end.setTo(p+(Math.cos(r)*q),s+(Math.sin(r)*q));return this},intersects:function(q,r,p){return g.Line.intersectsPoints(this.start,this.end,q.start,q.end,r,p)},reflect:function(p){return g.Line.reflect(this,p)},pointOnLine:function(p,q){return((p-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(q-this.start.y))},pointOnSegment:function(q,u){var r=Math.min(this.start.x,this.end.x);var t=Math.max(this.start.x,this.end.x);var p=Math.min(this.start.y,this.end.y);var s=Math.max(this.start.y,this.end.y);return(this.pointOnLine(q,u)&&(q>=r&&q<=t)&&(u>=p&&u<=s))},coordinatesOnLine:function(u,t){if(typeof u==="undefined"){u=1}if(typeof t==="undefined"){t=[]}var q=Math.round(this.start.x);var z=Math.round(this.start.y);var p=Math.round(this.end.x);var x=Math.round(this.end.y);var B=Math.abs(p-q);var A=Math.abs(x-z);var y=(q<p)?1:-1;var w=(z<x)?1:-1;var r=B-A;t.push([q,z]);var s=1;while(!((q==p)&&(z==x))){var v=r<<1;if(v>-A){r-=A;q+=y}if(v<B){r+=B;z+=w}if(s%u===0){t.push([q,z])}s++}return t},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{p.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return p}};Object.defineProperty(g.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(g.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(g.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalAngle",{get:function(){return g.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});g.Line.intersectsPoints=function(C,A,x,w,y,E){if(typeof y==="undefined"){y=true}if(typeof E==="undefined"){E=new g.Point()}var s=A.y-C.y;var r=w.y-x.y;var B=C.x-A.x;var z=x.x-w.x;var u=(A.x*C.y)-(C.x*A.y);var t=(w.x*x.y)-(x.x*w.y);var v=(s*z)-(r*B);if(v===0){return null}E.x=((B*t)-(z*u))/v;E.y=((r*u)-(s*t))/v;if(y){var D=((w.y-x.y)*(A.x-C.x)-(w.x-x.x)*(A.y-C.y));var q=(((w.x-x.x)*(C.y-x.y))-(w.y-x.y)*(C.x-x.x))/D;var p=(((A.x-C.x)*(C.y-x.y))-((A.y-C.y)*(C.x-x.x)))/D;if(q>=0&&q<=1&&p>=0&&p<=1){return E}else{return null}}return E};g.Line.intersects=function(r,q,s,p){return g.Line.intersectsPoints(r.start,r.end,q.start,q.end,s,p)};g.Line.reflect=function(q,p){return 2*p.normalAngle-3.141592653589793-q.angle};g.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.type=g.MATRIX};g.Matrix.prototype.fromArray=function(p){this.a=p[0];this.b=p[1];this.c=p[3];this.d=p[4];this.tx=p[2];this.ty=p[5]};g.Matrix.prototype.toArray=function(p){if(!this.array){this.array=new PIXI.Float32Array(9)}var q=this.array;if(p){q[0]=this.a;q[1]=this.b;q[2]=0;q[3]=this.c;q[4]=this.d;q[5]=0;q[6]=this.tx;q[7]=this.ty;q[8]=1}else{q[0]=this.a;q[1]=this.c;q[2]=this.tx;q[3]=this.b;q[4]=this.d;q[5]=this.ty;q[6]=0;q[7]=0;q[8]=1}return q};g.Matrix.prototype.apply=function(s,q){q=q||new g.Point();var p=s.x;var r=s.y;q.x=this.a*p+this.c*r+this.tx;q.y=this.b*p+this.d*r+this.ty;return q};g.Matrix.prototype.applyInverse=function(t,q){q=q||new g.Point();var s=1/(this.a*this.d+this.c*-this.b);var p=t.x;var r=t.y;q.x=this.d*s*p+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s;q.y=this.a*s*r+-this.b*s*p+(-this.ty*this.a+this.tx*this.b)*s;return q};g.Matrix.prototype.translate=function(p,q){this.tx+=p;this.ty+=q;return this};g.Matrix.prototype.scale=function(p,q){this.a*=p;this.d*=q;this.c*=p;this.b*=q;this.tx*=p;this.ty*=q;return this};g.Matrix.prototype.rotate=function(u){var t=Math.cos(u);var r=Math.sin(u);var q=this.a;var s=this.c;var p=this.tx;this.a=q*t-this.b*r;this.b=q*r+this.b*t;this.c=s*t-this.d*r;this.d=s*r+this.d*t;this.tx=p*t-this.ty*r;this.ty=p*r+this.ty*t;return this};g.Matrix.prototype.append=function(q){var p=this.a;var r=this.b;var s=this.c;var t=this.d;this.a=q.a*p+q.b*s;this.b=q.a*r+q.b*t;this.c=q.c*p+q.d*s;this.d=q.c*r+q.d*t;this.tx=q.tx*p+q.ty*s+this.tx;this.ty=q.tx*r+q.ty*t+this.ty;return this};g.Matrix.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};g.identityMatrix=new g.Matrix();PIXI.Matrix=g.Matrix;PIXI.identityMatrix=g.identityMatrix;g.Point=function(p,q){p=p||0;q=q||0;this.x=p;this.y=q;this.type=g.POINT};g.Point.prototype={copyFrom:function(p){return this.setTo(p.x,p.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},set:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},add:function(p,q){this.x+=p;this.y+=q;return this},subtract:function(p,q){this.x-=p;this.y-=q;return this},multiply:function(p,q){this.x*=p;this.y*=q;return this},divide:function(p,q){this.x/=p;this.y/=q;return this},clampX:function(q,p){this.x=g.Math.clamp(this.x,q,p);return this},clampY:function(q,p){this.y=g.Math.clamp(this.y,q,p);return this},clamp:function(q,p){this.x=g.Math.clamp(this.x,q,p);this.y=g.Math.clamp(this.y,q,p);return this},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Point(this.x,this.y)}else{p.setTo(this.x,this.y)}return p},copyTo:function(p){p.x=this.x;p.y=this.y;return p},distance:function(q,p){return g.Point.distance(this,q,p)},equals:function(p){return(p.x===this.x&&p.y===this.y)},angle:function(p,q){if(typeof q==="undefined"){q=false}if(q){return g.Math.radToDeg(Math.atan2(p.y-this.y,p.x-this.x))}else{return Math.atan2(p.y-this.y,p.x-this.x)}},rotate:function(p,t,r,q,s){return g.Point.rotate(this,p,t,r,q,s)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(p){return this.normalize().multiply(p,p)},normalize:function(){if(!this.isZero()){var p=this.getMagnitude();this.x/=p;this.y/=p}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(p){return((this.x*p.x)+(this.y*p.y))},cross:function(p){return((this.x*p.y)-(this.y*p.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};g.Point.prototype.constructor=g.Point;g.Point.add=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x+p.x;r.y=q.y+p.y;return r};g.Point.subtract=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x-p.x;r.y=q.y-p.y;return r};g.Point.multiply=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x*p.x;r.y=q.y*p.y;return r};g.Point.divide=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x/p.x;r.y=q.y/p.y;return r};g.Point.equals=function(q,p){return(q.x===p.x&&q.y===p.y)};g.Point.angle=function(q,p){return Math.atan2(q.y-p.y,q.x-p.x)};g.Point.negative=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(-p.x,-p.y)};g.Point.multiplyAdd=function(q,p,t,r){if(typeof r==="undefined"){r=new g.Point()}return r.setTo(q.x+p.x*t,q.y+p.y*t)};g.Point.interpolate=function(q,p,s,r){if(typeof r==="undefined"){r=new g.Point()}return r.setTo(q.x+(p.x-q.x)*s,q.y+(p.y-q.y)*s)};g.Point.perp=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(-p.y,p.x)};g.Point.rperp=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(p.y,-p.x)};g.Point.distance=function(q,p,r){var s=g.Math.distance(q.x,q.y,p.x,p.y);return r?Math.round(s):s};g.Point.project=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}var s=q.dot(p)/p.getMagnitudeSq();if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.projectUnit=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}var s=q.dot(p);if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.normalRightHand=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(p.y*-1,p.x)};g.Point.normalize=function(q,r){if(typeof r==="undefined"){r=new g.Point()}var p=q.getMagnitude();if(p!==0){r.setTo(q.x/p,q.y/p)}return r};g.Point.rotate=function(q,p,v,t,s,u){s=s||false;u=u||null;if(s){t=g.Math.degToRad(t)}if(u===null){u=Math.sqrt(((p-q.x)*(p-q.x))+((v-q.y)*(v-q.y)))}var r=t+Math.atan2(q.y-v,q.x-p);return q.setTo(p+u*Math.cos(r),v+u*Math.sin(r))};g.Point.centroid=function(r,p){if(typeof p==="undefined"){p=new g.Point()}if(Object.prototype.toString.call(r)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var s=r.length;if(s<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(s===1){p.copyFrom(r[0]);return p}for(var q=0;q<s;q++){g.Point.add(p,r[q],p)}p.divide(s,s);return p};g.Point.parse=function(s,q,r){q=q||"x";r=r||"y";var p=new g.Point();if(s[q]){p.x=parseInt(s[q],10)}if(s[r]){p.y=parseInt(s[r],10)}return p};PIXI.Point=g.Point;g.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.type=g.POLYGON};g.Polygon.prototype={toNumberArray:function(p){if(typeof p==="undefined"){p=[]}for(var q=0;q<this._points.length;q++){if(typeof this._points[q]==="number"){p.push(this._points[q]);p.push(this._points[q+1]);q++}else{p.push(this._points[q].x);p.push(this._points[q].y)}}return p},flatten:function(){this._points=this.toNumberArray();return this},clone:function(p){var q=this._points.slice();if(typeof p==="undefined"||p===null){p=new g.Polygon(q)}else{p.setTo(q)}return p},contains:function(w,v){var p=this._points.length;var s=false;for(var u=-1,t=p-1;++u<p;t=u){var r=this._points[u].x;var q=this._points[u].y;var A=this._points[t].x;var z=this._points[t].y;if(((q<=v&&v<z)||(z<=v&&v<q))&&(w<(A-r)*(v-q)/(z-q)+r)){s=!s}}return s},setTo:function(s){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(s)){s=Array.prototype.slice.call(arguments)}var t=Number.MAX_VALUE;for(var r=0,q=s.length;r<q;r++){if(typeof s[r]==="number"){var u=new PIXI.Point(s[r],s[r+1]);r++}else{var u=new PIXI.Point(s[r].x,s[r].y)}this._points.push(u);if(u.y<t){t=u.y}}this.calculateArea(t)}return this},calculateArea:function(t){var v;var u;var q;var s;for(var r=0,p=this._points.length;r<p;r++){v=this._points[r];if(r===p-1){u=this._points[0]}else{u=this._points[r+1]}q=((v.y-t)+(u.y-t))/2;s=v.x-u.x;this.area+=q*s}return this.area}};g.Polygon.prototype.constructor=g.Polygon;Object.defineProperty(g.Polygon.prototype,"points",{get:function(){return this._points},set:function(p){if(p!=null){this.setTo(p)}else{this.setTo()}}});PIXI.Polygon=g.Polygon;g.Rectangle=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.RECTANGLE};g.Rectangle.prototype={offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},scale:function(p,q){if(typeof q==="undefined"){q=p}this.width*=p;this.height*=q;return this},centerOn:function(p,q){this.centerX=p;this.centerY=q;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},inflate:function(q,p){return g.Rectangle.inflate(this,q,p)},size:function(p){return g.Rectangle.size(this,p)},clone:function(p){return g.Rectangle.clone(this,p)},contains:function(p,q){return g.Rectangle.contains(this,p,q)},containsRect:function(p){return g.Rectangle.containsRect(p,this)},equals:function(p){return g.Rectangle.equals(this,p)},intersection:function(p,q){return g.Rectangle.intersection(this,p,q)},intersects:function(p){return g.Rectangle.intersects(this,p)},intersectsRaw:function(t,r,s,q,p){return g.Rectangle.intersectsRaw(this,t,r,s,q,p)},union:function(p,q){return g.Rectangle.union(this,p,q)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(g.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(g.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(g.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<=this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Rectangle.prototype,"bottomRight",{get:function(){return new g.Point(this.right,this.bottom)},set:function(p){this.right=p.x;this.bottom=p.y}});Object.defineProperty(g.Rectangle.prototype,"left",{get:function(){return this.x},set:function(p){if(p>=this.right){this.width=0}else{this.width=this.right-p}this.x=p}});Object.defineProperty(g.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<=this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(g.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(g.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(p){this.x=p-this.halfWidth}});Object.defineProperty(g.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(p){this.y=p-this.halfHeight}});Object.defineProperty(g.Rectangle.prototype,"randomX",{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(g.Rectangle.prototype,"randomY",{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(g.Rectangle.prototype,"top",{get:function(){return this.y},set:function(p){if(p>=this.bottom){this.height=0;this.y=p}else{this.height=(this.bottom-p)}}});Object.defineProperty(g.Rectangle.prototype,"topLeft",{get:function(){return new g.Point(this.x,this.y)},set:function(p){this.x=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"topRight",{get:function(){return new g.Point(this.x+this.width,this.y)},set:function(p){this.right=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Rectangle.prototype.constructor=g.Rectangle;g.Rectangle.inflate=function(q,r,p){q.x-=r;q.width+=2*r;q.y-=p;q.height+=2*p;return q};g.Rectangle.inflatePoint=function(q,p){return g.Rectangle.inflate(q,p.x,p.y)};g.Rectangle.size=function(p,q){if(typeof q==="undefined"||q===null){q=new g.Point(p.width,p.height)}else{q.setTo(p.width,p.height)}return q};g.Rectangle.clone=function(p,q){if(typeof q==="undefined"||q===null){q=new g.Rectangle(p.x,p.y,p.width,p.height)}else{q.setTo(p.x,p.y,p.width,p.height)}return q};g.Rectangle.contains=function(q,p,r){if(q.width<=0||q.height<=0){return false}return(p>=q.x&&p<q.right&&r>=q.y&&r<q.bottom)};g.Rectangle.containsRaw=function(s,r,t,q,p,u){return(p>=s&&p<(s+t)&&u>=r&&u<(r+q))};g.Rectangle.containsPoint=function(q,p){return g.Rectangle.contains(q,p.x,p.y)};g.Rectangle.containsRect=function(q,p){if(q.volume>p.volume){return false}return(q.x>=p.x&&q.y>=p.y&&q.right<p.right&&q.bottom<p.bottom)};g.Rectangle.equals=function(q,p){return(q.x==p.x&&q.y==p.y&&q.width==p.width&&q.height==p.height)};g.Rectangle.sameDimensions=function(q,p){return(q.width===p.width&&q.height===p.height)};g.Rectangle.intersection=function(q,p,r){if(typeof r==="undefined"){r=new g.Rectangle()}if(g.Rectangle.intersects(q,p)){r.x=Math.max(q.x,p.x);r.y=Math.max(q.y,p.y);r.width=Math.min(q.right,p.right)-r.x;r.height=Math.min(q.bottom,p.bottom)-r.y}return r};g.Rectangle.intersects=function(q,p){if(q.width<=0||q.height<=0||p.width<=0||p.height<=0){return false}return !(q.right<p.x||q.bottom<p.y||q.x>p.right||q.y>p.bottom)};g.Rectangle.intersectsRaw=function(p,u,s,t,r,q){if(typeof q==="undefined"){q=0}return !(u>p.right+q||s<p.left-q||t>p.bottom+q||r<p.top-q)};g.Rectangle.union=function(q,p,r){if(typeof r==="undefined"){r=new g.Rectangle()}return r.setTo(Math.min(q.x,p.x),Math.min(q.y,p.y),Math.max(q.right,p.right)-Math.min(q.left,p.left),Math.max(q.bottom,p.bottom)-Math.min(q.top,p.top))};g.Rectangle.aabb=function(s,r){if(typeof r==="undefined"){r=new g.Rectangle()}var u=Number.MIN_VALUE,q=Number.MAX_VALUE,t=Number.MIN_VALUE,p=Number.MAX_VALUE;s.forEach(function(v){if(v.x>u){u=v.x}if(v.x<q){q=v.x}if(v.y>t){t=v.y}if(v.y<p){p=v.y}});r.setTo(q,p,u-q,t-p);return r};PIXI.Rectangle=g.Rectangle;PIXI.EmptyRectangle=new g.Rectangle(0,0,0,0);g.RoundedRectangle=function(r,t,s,q,p){this.x=r||0;this.y=t||0;this.width=s||0;this.height=q||0;this.radius=p||20;this.type=g.ROUNDEDRECTANGLE};g.RoundedRectangle.prototype.clone=function(){return new g.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};g.RoundedRectangle.prototype.contains=function(p,s){if(this.width<=0||this.height<=0){return false}var q=this.x;if(p>=q&&p<=q+this.width){var r=this.y;if(s>=r&&s<=r+this.height){return true}}return false};g.RoundedRectangle.prototype.constructor=g.RoundedRectangle;PIXI.RoundedRectangle=g.RoundedRectangle;g.Camera=function(r,u,q,t,s,p){this.game=r;this.world=r.world;this.id=0;this.view=new g.Rectangle(q,t,s,p);this.screenView=new g.Rectangle(q,t,s,p);this.bounds=new g.Rectangle(q,t,s,p);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this._targetPosition=new g.Point();this._edge=0;this._position=new g.Point()};g.Camera.FOLLOW_LOCKON=0;g.Camera.FOLLOW_PLATFORMER=1;g.Camera.FOLLOW_TOPDOWN=2;g.Camera.FOLLOW_TOPDOWN_TIGHT=3;g.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(t,r){if(typeof r==="undefined"){r=g.Camera.FOLLOW_LOCKON}this.target=t;var s;switch(r){case g.Camera.FOLLOW_PLATFORMER:var p=this.width/8;var q=this.height/3;this.deadzone=new g.Rectangle((this.width-p)/2,(this.height-q)/2-q*0.25,p,q);break;case g.Camera.FOLLOW_TOPDOWN:s=Math.max(this.width,this.height)/4;this.deadzone=new g.Rectangle((this.width-s)/2,(this.height-s)/2,s,s);break;case g.Camera.FOLLOW_TOPDOWN_TIGHT:s=Math.max(this.width,this.height)/8;this.deadzone=new g.Rectangle((this.width-s)/2,(this.height-s)/2,s,s);break;case g.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(p){this.setPosition(Math.round(p.x-this.view.halfWidth),Math.round(p.y-this.view.halfHeight))},focusOnXY:function(p,q){this.setPosition(Math.round(p-this.view.halfWidth),Math.round(q-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);if(this.target.parent){this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d)}if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this._targetPosition.x-this.deadzone.left}else{if(this._edge>this.deadzone.right){this.view.x=this._targetPosition.x-this.deadzone.right}}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this._targetPosition.y-this.deadzone.top}else{if(this._edge>this.deadzone.bottom){this.view.y=this._targetPosition.y-this.deadzone.bottom}}}else{this.view.x=this._targetPosition.x-this.view.halfWidth;this.view.y=this._targetPosition.y-this.view.halfHeight}},setBoundsToWorld:function(){if(this.bounds){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<=this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.right>=this.bounds.right){this.atLimit.x=true;this.view.x=this.bounds.right-this.width}if(this.view.y<=this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.bottom>=this.bounds.bottom){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height}},setPosition:function(p,q){this.view.x=p;this.view.y=q;if(this.bounds){this.checkBounds()}},setSize:function(q,p){this.view.width=q;this.view.height=p},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};g.Camera.prototype.constructor=g.Camera;Object.defineProperty(g.Camera.prototype,"x",{get:function(){return this.view.x},set:function(p){this.view.x=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"y",{get:function(){return this.view.y},set:function(p){this.view.y=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"position",{get:function(){this._position.set(this.view.centerX,this.view.centerY);return this._position},set:function(p){if(typeof p.x!=="undefined"){this.view.x=p.x}if(typeof p.y!=="undefined"){this.view.y=p.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"width",{get:function(){return this.view.width},set:function(p){this.view.width=p}});Object.defineProperty(g.Camera.prototype,"height",{get:function(){return this.view.height},set:function(p){this.view.height=p}});g.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};g.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};g.State.prototype.constructor=g.State;g.StateManager=function(q,p){this.game=q;this.states={};this._pendingState=null;if(typeof p!=="undefined"&&p!==null){this._pendingState=p}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};g.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(q,r,p){if(typeof p==="undefined"){p=false}var s;if(r instanceof g.State){s=r}else{if(typeof r==="object"){s=r;s.game=this.game}else{if(typeof r==="function"){s=new r(this.game)}}}this.states[q]=s;if(p){if(this.game.isBooted){this.start(q)}else{this._pendingState=q}}return s},remove:function(p){if(this.current===p){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[p]},start:function(q,p,r){if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=false}if(this.checkState(q)){this._pendingState=q;this._clearWorld=p;this._clearCache=r;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(p,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=false}this._pendingState=this.current;this._clearWorld=p;this._clearCache=q;if(arguments.length>2){this._args=Array.prototype.splice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){this.clearCurrentState();this.setCurrentState(this._pendingState);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache===true){this.game.cache.destroy()}}}},checkState:function(p){if(this.states[p]){var q=false;if(this.states[p]["preload"]||this.states[p]["create"]||this.states[p]["update"]||this.states[p]["render"]){q=true}if(q===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+p);return false}},link:function(p){this.states[p].game=this.game;this.states[p].add=this.game.add;this.states[p].make=this.game.make;this.states[p].camera=this.game.camera;this.states[p].cache=this.game.cache;this.states[p].input=this.game.input;this.states[p].load=this.game.load;this.states[p].math=this.game.math;this.states[p].sound=this.game.sound;this.states[p].scale=this.game.scale;this.states[p].state=this;this.states[p].stage=this.game.stage;this.states[p].time=this.game.time;this.states[p].tweens=this.game.tweens;this.states[p].world=this.game.world;this.states[p].particles=this.game.particles;this.states[p].rnd=this.game.rnd;this.states[p].physics=this.game.physics;this.states[p].key=p},unlink:function(p){if(this.states[p]){this.states[p].game=null;this.states[p].add=null;this.states[p].make=null;this.states[p].camera=null;this.states[p].cache=null;this.states[p].input=null;this.states[p].load=null;this.states[p].math=null;this.states[p].sound=null;this.states[p].scale=null;this.states[p].state=null;this.states[p].stage=null;this.states[p].time=null;this.states[p].tweens=null;this.states[p].world=null;this.states[p].particles=null;this.states[p].rnd=null;this.states[p].physics=null}},setCurrentState:function(p){this.callbackContext=this.states[p];this.link(p);this.onInitCallback=this.states[p]["init"]||this.dummy;this.onPreloadCallback=this.states[p]["preload"]||null;this.onLoadRenderCallback=this.states[p]["loadRender"]||null;this.onLoadUpdateCallback=this.states[p]["loadUpdate"]||null;this.onCreateCallback=this.states[p]["create"]||null;this.onUpdateCallback=this.states[p]["update"]||null;this.onPreRenderCallback=this.states[p]["preRender"]||null;this.onRenderCallback=this.states[p]["render"]||null;this.onResizeCallback=this.states[p]["resize"]||null;this.onPausedCallback=this.states[p]["paused"]||null;this.onResumedCallback=this.states[p]["resumed"]||null;this.onPauseUpdateCallback=this.states[p]["pauseUpdate"]||null;this.onShutDownCallback=this.states[p]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=p;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(p===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created&&this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(p){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,p)}},resize:function(q,p){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,q,p)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===g.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};g.StateManager.prototype.constructor=g.StateManager;g.Signal=function(){};g.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:true,validateListener:function(p,q){if(typeof p!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",q))}},_registerListener:function(t,r,s,q){var p=this._indexOfListener(t,s);var u;if(p!==-1){u=this._bindings[p];if(u.isOnce()!==r){throw new Error("You cannot add"+(r?"":"Once")+"() then add"+(!r?"":"Once")+"() the same listener without removing the relationship first.")}}else{u=new g.SignalBinding(this,t,r,s,q);this._addBinding(u)}if(this.memorize&&this._prevParams){u.execute(this._prevParams)}return u},_addBinding:function(p){if(!this._bindings){this._bindings=[]}var q=this._bindings.length;do{q--}while(this._bindings[q]&&p._priority<=this._bindings[q]._priority);this._bindings.splice(q+1,0,p)},_indexOfListener:function(q,p){if(!this._bindings){return -1}if(typeof p==="undefined"){p=null}var s=this._bindings.length;var r;while(s--){r=this._bindings[s];if(r._listener===q&&r.context===p){return s}}return -1},has:function(q,p){return this._indexOfListener(q,p)!==-1},add:function(r,q,p){this.validateListener(r,"add");return this._registerListener(r,false,q,p)},addOnce:function(r,q,p){this.validateListener(r,"addOnce");return this._registerListener(r,true,q,p)},remove:function(r,q){this.validateListener(r,"remove");var p=this._indexOfListener(r,q);if(p!==-1){this._bindings[p]._destroy();this._bindings.splice(p,1)}return r},removeAll:function(p){if(typeof p==="undefined"){p=null}if(!this._bindings){return}var q=this._bindings.length;while(q--){if(p){if(this._bindings[q].context===p){this._bindings[q]._destroy();this._bindings.splice(q,1)}}else{this._bindings[q]._destroy()}}if(!p){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var p=Array.prototype.slice.call(arguments);var r=this._bindings.length;var q;if(this.memorize){this._prevParams=p}if(!r){return}q=this._bindings.slice();this._shouldPropagate=true;do{r--}while(q[r]&&this._shouldPropagate&&q[r].execute(p)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(g.Signal.prototype,"boundDispatch",{get:function(){var p=this;return this._boundDispatch||(this._boundDispatch=function(){return p.dispatch.apply(p,arguments)})}});g.Signal.prototype.constructor=g.Signal;g.SignalBinding=function(t,s,q,r,p){this._listener=s;if(q){this._isOnce=true}if(r!=null){this.context=r}this._signal=t;if(p){this._priority=p}};g.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,callCount:0,active:true,params:null,execute:function(p){var r,q;if(this.active&&!!this._listener){q=this.params?this.params.concat(p):p;r=this._listener.apply(this.context,q);this.callCount++;if(this._isOnce){this.detach()}}return r},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};g.SignalBinding.prototype.constructor=g.SignalBinding;g.Filter=function(q,p,s){this.game=q;this.type=g.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new g.Point();var t=new Date();this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*60*60+t.getMinutes()*60+t.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(p){for(var r in p){this.uniforms[r]=p[r]}}this.fragmentSrc=s||[]};g.Filter.prototype={init:function(){},setResolution:function(q,p){this.uniforms.resolution.value.x=q;this.uniforms.resolution.value.y=p},update:function(q){if(typeof q!=="undefined"){var p=q.x/this.game.width;var r=1-q.y/this.game.height;if(p!==this.prevPoint.x||r!==this.prevPoint.y){this.uniforms.mouse.value.x=p.toFixed(2);this.uniforms.mouse.value.y=r.toFixed(2);this.prevPoint.set(p,r)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};g.Filter.prototype.constructor=g.Filter;Object.defineProperty(g.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(p){this.uniforms.resolution.value.x=p}});Object.defineProperty(g.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(p){this.uniforms.resolution.value.y=p}});g.Plugin=function(p,q){if(typeof q==="undefined"){q=null}this.game=p;this.parent=q;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};g.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};g.Plugin.prototype.constructor=g.Plugin;g.PluginManager=function(p){this.game=p;this.plugins=[];this._len=0;this._i=0};g.PluginManager.prototype={add:function(r){var q=Array.prototype.splice.call(arguments,1);var p=false;if(typeof r==="function"){r=new r(this.game,this)}else{r.game=this.game;r.parent=this}if(typeof r.preUpdate==="function"){r.hasPreUpdate=true;p=true}if(typeof r.update==="function"){r.hasUpdate=true;p=true}if(typeof r.postUpdate==="function"){r.hasPostUpdate=true;p=true}if(typeof r.render==="function"){r.hasRender=true;p=true}if(typeof r.postRender==="function"){r.hasPostRender=true;p=true}if(p){if(r.hasPreUpdate||r.hasUpdate||r.hasPostUpdate){r.active=true}if(r.hasRender||r.hasPostRender){r.visible=true}this._len=this.plugins.push(r);if(typeof r.init==="function"){r.init.apply(r,q)}return r}else{return null}},remove:function(p){this._i=this._len;while(this._i--){if(this.plugins[this._i]===p){p.destroy();this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};g.PluginManager.prototype.constructor=g.PluginManager;g.Stage=function(p){this.game=p;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;if(p.config){this.parseConfig(p.config)}};g.Stage.prototype=Object.create(PIXI.Stage.prototype);g.Stage.prototype.constructor=g.Stage;g.Stage.prototype.parseConfig=function(p){if(p.disableVisibilityChange){this.disableVisibilityChange=p.disableVisibilityChange}if(p.backgroundColor){this.backgroundColor=p.backgroundColor}};g.Stage.prototype.boot=function(){g.DOM.getOffset(this.game.canvas,this.offset);g.Canvas.setUserSelect(this.game.canvas,"none");g.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};g.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}};g.Stage.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();var p=this.children.length;while(p--){if(this.children[p]!==this.game.world.camera.target){this.children[p].postUpdate()}}}else{this.game.world.camera.update();var p=this.children.length;while(p--){this.children[p].postUpdate()}}};g.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var p=0;p<this.children.length;p++){this.children[p].updateTransform()}};g.Stage.prototype.checkVisibility=function(){if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{this._hiddenVar=null}}}}var p=this;this._onChange=function(q){return p.visibilityChange(q)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"resume"})})}};g.Stage.prototype.visibilityChange=function(p){if(p.type==="pagehide"||p.type==="blur"||p.type==="pageshow"||p.type==="focus"){if(p.type==="pagehide"||p.type==="blur"){this.game.focusLoss(p)}else{if(p.type==="pageshow"||p.type==="focus"){this.game.focusGain(p)}}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||p.type==="pause"){this.game.gamePaused(p)}else{this.game.gameResumed(p)}};g.Stage.prototype.setBackgroundColor=function(p){var q=g.Color.valueToColor(p);this._backgroundColor=g.Color.getColor(q.r,q.g,q.b);this.backgroundColorSplit=[q.r/255,q.g/255,q.b/255];this.backgroundColorString=g.Color.RGBtoString(q.r,q.g,q.b,255,"#")};g.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(g.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(p){if(!this.game.transparent){this.setBackgroundColor(p)}}});Object.defineProperty(g.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(p){if(p){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});g.Group=function(q,t,r,p,u,s){if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=false}if(typeof s==="undefined"){s=g.Physics.ARCADE}this.game=q;if(typeof t==="undefined"){t=q.world}this.name=r||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(p){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(t){t.addChild(this);this.z=t.children.length}}this.type=g.GROUP;this.physicsType=g.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.classType=g.Sprite;this.scale=new g.Point(1,1);this.cursor=null;this.enableBody=u;this.enableBodyDebug=false;this.physicsBodyType=s;this.onDestroy=new g.Signal();this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new g.Point();this._hash=[];this._sortProperty="z"};g.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);g.Group.prototype.constructor=g.Group;g.Group.RETURN_NONE=0;g.Group.RETURN_TOTAL=1;g.Group.RETURN_CHILD=2;g.Group.SORT_ASCENDING=-1;g.Group.SORT_DESCENDING=1;g.Group.prototype.add=function(q,p){if(typeof p==="undefined"){p=false}if(q.parent!==this){if(this.enableBody){this.game.physics.enable(q,this.physicsBodyType)}this.addChild(q);this._hash.push(q);q.z=this.children.length;if(!p&&q.events){q.events.onAddedToGroup$dispatch(q,this)}if(this.cursor===null){this.cursor=q}}return q};g.Group.prototype.addMultiple=function(r,p){if(Array.isArray(r)){for(var q=0;q<r.length;q++){this.add(r[q],p)}}return r};g.Group.prototype.addAt=function(r,q,p){if(typeof p==="undefined"){p=false}if(r.parent!==this){if(this.enableBody){this.game.physics.enable(r,this.physicsBodyType)}this.addChildAt(r,q);this._hash.push(r);this.updateZ();if(!p&&r.events){r.events.onAddedToGroup$dispatch(r,this)}if(this.cursor===null){this.cursor=r}}return r};g.Group.prototype.getAt=function(p){if(p<0||p>=this.children.length){return -1}else{return this.getChildAt(p)}};g.Group.prototype.create=function(p,u,q,s,r){if(typeof r==="undefined"){r=true}var t=new this.classType(this.game,p,u,q,s);if(this.enableBody){this.game.physics.enable(t,this.physicsBodyType,this.enableBodyDebug)}t.exists=r;t.visible=r;t.alive=r;this.addChild(t);this._hash.push(t);t.z=this.children.length;if(t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}return t};g.Group.prototype.createMultiple=function(s,q,t,r){if(typeof r==="undefined"){r=false}for(var p=0;p<s;p++){this.create(0,0,q,t,r)}};g.Group.prototype.updateZ=function(){var p=this.children.length;while(p--){this.children[p].z=p}};g.Group.prototype.resetCursor=function(p){if(typeof p==="undefined"){p=0}if(p>this.children.length-1){p=0}if(this.cursor){this.cursorIndex=p;this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.swap=function(q,p){this.swapChildren(q,p);this.updateZ()};g.Group.prototype.bringToTop=function(p){if(p.parent===this&&this.getIndex(p)<this.children.length){this.remove(p,false,true);this.add(p,true)}return p};g.Group.prototype.sendToBack=function(p){if(p.parent===this&&this.getIndex(p)>0){this.remove(p,false,true);this.addAt(p,0,true)}return p};g.Group.prototype.moveUp=function(r){if(r.parent===this&&this.getIndex(r)<this.children.length-1){var q=this.getIndex(r);var p=this.getAt(q+1);if(p){this.swap(r,p)}}return r};g.Group.prototype.moveDown=function(r){if(r.parent===this&&this.getIndex(r)>0){var q=this.getIndex(r);var p=this.getAt(q-1);if(p){this.swap(r,p)}}return r};g.Group.prototype.xy=function(q,p,r){if(q<0||q>this.children.length){return -1}else{this.getChildAt(q).x=p;this.getChildAt(q).y=r}};g.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};g.Group.prototype.getIndex=function(p){return this.children.indexOf(p)};g.Group.prototype.replace=function(r,p){var q=this.getIndex(r);if(q!==-1){if(p.parent){if(p.parent instanceof g.Group){p.parent.remove(p)}else{p.parent.removeChild(p)}}this.remove(r);this.addAt(p,q);return r}};g.Group.prototype.hasProperty=function(r,q){var p=q.length;if(p===1&&q[0] in r){return true}else{if(p===2&&q[0] in r&&q[1] in r[q[0]]){return true}else{if(p===3&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]){return true}else{if(p===4&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]&&q[3] in r[q[0]][q[1]][q[2]]){return true}}}}return false};g.Group.prototype.setProperty=function(u,r,t,q,s){if(typeof s==="undefined"){s=false}q=q||0;if(!this.hasProperty(u,r)&&(!s||q>0)){return false}var p=r.length;if(p===1){if(q===0){u[r[0]]=t}else{if(q==1){u[r[0]]+=t}else{if(q==2){u[r[0]]-=t}else{if(q==3){u[r[0]]*=t}else{if(q==4){u[r[0]]/=t}}}}}}else{if(p===2){if(q===0){u[r[0]][r[1]]=t}else{if(q==1){u[r[0]][r[1]]+=t}else{if(q==2){u[r[0]][r[1]]-=t}else{if(q==3){u[r[0]][r[1]]*=t}else{if(q==4){u[r[0]][r[1]]/=t}}}}}}else{if(p===3){if(q===0){u[r[0]][r[1]][r[2]]=t}else{if(q==1){u[r[0]][r[1]][r[2]]+=t}else{if(q==2){u[r[0]][r[1]][r[2]]-=t}else{if(q==3){u[r[0]][r[1]][r[2]]*=t}else{if(q==4){u[r[0]][r[1]][r[2]]/=t}}}}}}else{if(p===4){if(q===0){u[r[0]][r[1]][r[2]][r[3]]=t}else{if(q==1){u[r[0]][r[1]][r[2]][r[3]]+=t}else{if(q==2){u[r[0]][r[1]][r[2]][r[3]]-=t}else{if(q==3){u[r[0]][r[1]][r[2]][r[3]]*=t}else{if(q==4){u[r[0]][r[1]][r[2]][r[3]]/=t}}}}}}}}}return true};g.Group.prototype.checkProperty=function(s,p,r,q){if(typeof q==="undefined"){q=false}if(!g.Utils.getProperty(s,p)&&q){return false}if(g.Utils.getProperty(s,p)!==r){return false}return true};g.Group.prototype.set=function(v,r,t,q,u,p,s){if(typeof s==="undefined"){s=false}r=r.split(".");if(typeof q==="undefined"){q=false}if(typeof u==="undefined"){u=false}if((q===false||(q&&v.alive))&&(u===false||(u&&v.visible))){return this.setProperty(v,r,t,p,s)}};g.Group.prototype.setAll=function(s,u,q,v,p,t){if(typeof q==="undefined"){q=false}if(typeof v==="undefined"){v=false}if(typeof t==="undefined"){t=false}s=s.split(".");p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){this.setProperty(this.children[r],s,u,p,t)}}};g.Group.prototype.setAllChildren=function(s,u,q,v,p,t){if(typeof q==="undefined"){q=false}if(typeof v==="undefined"){v=false}if(typeof t==="undefined"){t=false}p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){if(this.children[r] instanceof g.Group){this.children[r].setAllChildren(s,u,q,v,p,t)}else{this.setProperty(this.children[r],s.split("."),u,p,t)}}}};g.Group.prototype.checkAll=function(r,t,p,u,s){if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=false}if(typeof s==="undefined"){s=false}for(var q=0;q<this.children.length;q++){if((!p||(p&&this.children[q].alive))&&(!u||(u&&this.children[q].visible))){if(!this.checkProperty(this.children[q],r,t,s)){return false}}}return true};g.Group.prototype.addAll=function(r,q,p,s){this.setAll(r,q,p,s,1)};g.Group.prototype.subAll=function(r,q,p,s){this.setAll(r,q,p,s,2)};g.Group.prototype.multiplyAll=function(r,q,p,s){this.setAll(r,q,p,s,3)};g.Group.prototype.divideAll=function(r,q,p,s){this.setAll(r,q,p,s,4)};g.Group.prototype.callAllExists=function(s,r){var p;if(arguments.length>2){p=[];for(var q=2;q<arguments.length;q++){p.push(arguments[q])}}for(var q=0;q<this.children.length;q++){if(this.children[q].exists===r&&this.children[q][s]){this.children[q][s].apply(this.children[q],p)}}};g.Group.prototype.callbackFromArray=function(r,q,p){if(p==1){if(r[q[0]]){return r[q[0]]}}else{if(p==2){if(r[q[0]][q[1]]){return r[q[0]][q[1]]}}else{if(p==3){if(r[q[0]][q[1]][q[2]]){return r[q[0]][q[1]][q[2]]}}else{if(p==4){if(r[q[0]][q[1]][q[2]][q[3]]){return r[q[0]][q[1]][q[2]][q[3]]}}else{if(r[q]){return r[q]}}}}}return false};g.Group.prototype.callAll=function(w,s){if(typeof w==="undefined"){return}w=w.split(".");var u=w.length;if(typeof s==="undefined"||s===null||s===""){s=null}else{if(typeof s==="string"){s=s.split(".");var t=s.length}}var q;if(arguments.length>2){q=[];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}var v=null;var p=null;for(var r=0;r<this.children.length;r++){v=this.callbackFromArray(this.children[r],w,u);if(s&&v){p=this.callbackFromArray(this.children[r],s,t);if(v){v.apply(p,q)}}else{if(v){v.apply(this.children[r],q)}}}};g.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var p=this.children.length;while(p--){this.children[p].preUpdate()}return true};g.Group.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var p=this.children.length;while(p--){this.children[p].postUpdate()}};g.Group.prototype.filter=function(p,u){var q=-1;var s=this.children.length;var r=[];while(++q<s){var t=this.children[q];if(!u||(u&&t.exists)){if(p(t,q,this.children)){r.push(t)}}}return new g.ArraySet(r)};g.Group.prototype.forEach=function(t,p,s){if(typeof s==="undefined"){s=false}if(arguments.length<=3){for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){t.call(p,this.children[r])}}}else{var q=[null];for(var r=3;r<arguments.length;r++){q.push(arguments[r])}for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){q[0]=this.children[r];t.apply(p,q)}}}};g.Group.prototype.forEachExists=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("exists",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachAlive=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachDead=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",false,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.sort=function(q,p){if(this.children.length<2){return}if(typeof q==="undefined"){q="z"}if(typeof p==="undefined"){p=g.Group.SORT_ASCENDING}this._sortProperty=q;if(p===g.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};g.Group.prototype.customSort=function(p,q){if(this.children.length<2){return}this.children.sort(p.bind(q));this.updateZ()};g.Group.prototype.ascendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return -1}else{if(q[this._sortProperty]>p[this._sortProperty]){return 1}else{if(q.z<p.z){return -1}else{return 1}}}};g.Group.prototype.descendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return 1}else{if(q[this._sortProperty]>p[this._sortProperty]){return -1}else{return 0}}};g.Group.prototype.iterate=function(t,v,r,w,p,q){if(r===g.Group.RETURN_TOTAL&&this.children.length===0){return 0}var u=0;for(var s=0;s<this.children.length;s++){if(this.children[s][t]===v){u++;if(w){if(q){q[0]=this.children[s];w.apply(p,q)}else{w.call(p,this.children[s])}}if(r===g.Group.RETURN_CHILD){return this.children[s]}}}if(r===g.Group.RETURN_TOTAL){return u}return null};g.Group.prototype.getFirstExists=function(p){if(typeof p!=="boolean"){p=true}return this.iterate("exists",p,g.Group.RETURN_CHILD)};g.Group.prototype.getFirstAlive=function(){return this.iterate("alive",true,g.Group.RETURN_CHILD)};g.Group.prototype.getFirstDead=function(){return this.iterate("alive",false,g.Group.RETURN_CHILD)};g.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};g.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};g.Group.prototype.countLiving=function(){return this.iterate("alive",true,g.Group.RETURN_TOTAL)};g.Group.prototype.countDead=function(){return this.iterate("alive",false,g.Group.RETURN_TOTAL)};g.Group.prototype.getRandom=function(q,p){if(this.children.length===0){return null}q=q||0;p=p||this.children.length;return g.ArrayUtils.getRandomItem(this.children,q,p)};g.Group.prototype.remove=function(t,r,p){if(typeof r==="undefined"){r=false}if(typeof p==="undefined"){p=false}if(this.children.length===0||this.children.indexOf(t)===-1){return false}if(!p&&t.events&&!t.destroyPhase){t.events.onRemovedFromGroup$dispatch(t,this)}var s=this.removeChild(t);var q=this._hash.indexOf(s);if(q!==-1){this._hash.splice(q,1)}this.updateZ();if(this.cursor===t){this.next()}if(r&&s){s.destroy(true)}return true};g.Group.prototype.removeAll=function(r,p){if(typeof r==="undefined"){r=false}if(typeof p==="undefined"){p=false}if(this.children.length===0){return}do{if(!p&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var s=this.removeChild(this.children[0]);var q=this._hash.indexOf(s);if(q!==-1){this._hash.splice(q,1)}if(r&&s){s.destroy(true)}}while(this.children.length>0);this._hash=[];this.cursor=null};g.Group.prototype.removeBetween=function(v,t,s,p){if(typeof t==="undefined"){t=this.children.length-1}if(typeof s==="undefined"){s=false}if(typeof p==="undefined"){p=false}if(this.children.length===0){return}if(v>t||v<0||t>this.children.length){return false}var r=t;while(r>=v){if(!p&&this.children[r].events){this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this)}var u=this.removeChild(this.children[r]);var q=this._hash.indexOf(u);if(q!==-1){this._hash.splice(q,1)}if(s&&u){u.destroy(true)}if(this.cursor===this.children[r]){this.cursor=null}r--}this.updateZ()};g.Group.prototype.destroy=function(q,p){if(this.game===null||this.ignoreDestroy){return}if(typeof q==="undefined"){q=true}if(typeof p==="undefined"){p=false}this.onDestroy.dispatch(this,q,p);this.removeAll(q);this.cursor=null;this.filters=null;if(!p){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(g.Group.prototype,"total",{get:function(){return this.iterate("exists",true,g.Group.RETURN_TOTAL)}});Object.defineProperty(g.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(g.Group.prototype,"angle",{get:function(){return g.Math.radToDeg(this.rotation)},set:function(p){this.rotation=g.Math.degToRad(p)}});g.World=function(p){g.Group.call(this,p,null,"__world",false);this.bounds=new g.Rectangle(0,0,p.width,p.height);this.camera=null;this._definedSize=false;this._width=p.width;this._height=p.height};g.World.prototype=Object.create(g.Group.prototype);g.World.prototype.constructor=g.World;g.World.prototype.boot=function(){this.camera=new g.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};g.World.prototype.setBounds=function(q,s,r,p){this._definedSize=true;this._width=r;this._height=p;this.bounds.setTo(q,s,r,p);this.x=q;this.y=s;if(this.camera.bounds){this.camera.bounds.setTo(q,s,Math.max(r,this.game.width),Math.max(p,this.game.height))}this.game.physics.setBoundsToWorld()};g.World.prototype.resize=function(q,p){if(this._definedSize){if(q<this._width){q=this._width}if(p<this._height){p=this._height}}this.bounds.width=q;this.bounds.height=p;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};g.World.prototype.shutdown=function(){this.destroy(true,true)};g.World.prototype.wrap=function(s,t,q,p,r){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=true}if(!q){if(p&&s.x+t<this.bounds.x){s.x=this.bounds.right+t}else{if(p&&s.x-t>this.bounds.right){s.x=this.bounds.left-t}}if(r&&s.y+t<this.bounds.top){s.y=this.bounds.bottom+t}else{if(r&&s.y-t>this.bounds.bottom){s.y=this.bounds.top-t}}}else{s.getBounds();if(p){if((s.x+s._currentBounds.width)<this.bounds.x){s.x=this.bounds.right}else{if(s.x>this.bounds.right){s.x=this.bounds.left}}}if(r){if((s.y+s._currentBounds.height)<this.bounds.top){s.y=this.bounds.bottom}else{if(s.y>this.bounds.bottom){s.y=this.bounds.top}}}}};Object.defineProperty(g.World.prototype,"width",{get:function(){return this.bounds.width},set:function(p){if(p<this.game.width){p=this.game.width}this.bounds.width=p;this._width=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"height",{get:function(){return this.bounds.height},set:function(p){if(p<this.game.height){p=this.game.height}this.bounds.height=p;this._height=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(g.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(g.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(g.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});g.FlexGrid=function(q,r,p){this.game=q.game;this.manager=q;this.width=r;this.height=p;this.boundsCustom=new g.Rectangle(0,0,r,p);this.boundsFluid=new g.Rectangle(0,0,r,p);this.boundsFull=new g.Rectangle(0,0,r,p);this.boundsNone=new g.Rectangle(0,0,r,p);this.positionCustom=new g.Point(0,0);this.positionFluid=new g.Point(0,0);this.positionFull=new g.Point(0,0);this.positionNone=new g.Point(0,0);this.scaleCustom=new g.Point(1,1);this.scaleFluid=new g.Point(1,1);this.scaleFluidInversed=new g.Point(1,1);this.scaleFull=new g.Point(1,1);this.scaleNone=new g.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=r/p;this.ratioV=p/r;this.multiplier=0;this.layers=[]};g.FlexGrid.prototype={setSize:function(q,p){this.width=q;this.height=p;this.ratioH=q/p;this.ratioV=p/q;this.scaleNone=new g.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,p,r,s){if(typeof s==="undefined"){s=true}this.customWidth=t;this.customHeight=p;this.boundsCustom.width=t;this.boundsCustom.height=p;var q=new g.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(s){this.game.world.add(q)}this.layers.push(q);if(typeof r!=="undefined"&&typeof r!==null){q.addMultiple(r)}return q},createFluidLayer:function(q,r){if(typeof r==="undefined"){r=true}var p=new g.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(r){this.game.world.add(p)}this.layers.push(p);if(typeof q!=="undefined"&&typeof q!==null){p.addMultiple(q)}return p},createFullLayer:function(q){var p=new g.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},createFixedLayer:function(q){var p=new g.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},reset:function(){var p=this.layers.length;while(p--){if(!this.layers[p].persist){this.layers[p].position=null;this.layers[p].scale=null;this.layers.slice(p,1)}}},onResize:function(q,p){this.ratioH=q/p;this.ratioV=p/q;this.refresh(q,p)},refresh:function(){this.multiplier=Math.min((this.manager.height/this.height),(this.manager.width/this.width));this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(p){this.manager.scaleSprite(p);p.x=this.manager.bounds.centerX;p.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};g.FlexGrid.prototype.constructor=g.FlexGrid;g.FlexLayer=function(q,p,r,s){g.Group.call(this,q.game,null,"__flexLayer"+q.game.rnd.uuid(),false);this.manager=q.manager;this.grid=q;this.persist=false;this.position=p;this.bounds=r;this.scale=s;this.topLeft=r.topLeft;this.topMiddle=new g.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new g.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};g.FlexLayer.prototype=Object.create(g.Group.prototype);g.FlexLayer.prototype.constructor=g.FlexLayer;g.FlexLayer.prototype.resize=function(){};g.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};g.ScaleManager=function(q,r,p){this.game=q;this.dom=g.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new g.Point();this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.maxIterations=5;this.onOrientationChange=new g.Signal();this.enterLandscape=new g.Signal();this.enterPortrait=new g.Signal();this.enterIncorrectOrientation=new g.Signal();this.leaveIncorrectOrientation=new g.Signal();this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new g.Signal();this.onFullScreenChange=new g.Signal();this.onFullScreenError=new g.Signal();this.enterFullScreen=new g.Signal();this.leaveFullScreen=new g.Signal();this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new g.Point(1,1);this.scaleFactorInversed=new g.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new g.Rectangle();this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=g.ScaleManager.NO_SCALE;this._fullScreenScaleMode=g.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new g.Point(1,1);this.trackParentInterval=2000;this.onSizeChange=new g.Signal();this.onResize=null;this.onResizeContext=null;this._fullScreenRestore=null;this._gameSize=new g.Rectangle();this._userScaleFactor=new g.Point(1,1);this._userScaleTrim=new g.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new g.Rectangle();this._tempBounds=new g.Rectangle();this._lastReportedCanvasSize=new g.Rectangle();this._lastReportedGameSize=new g.Rectangle();if(q.config){this.parseConfig(q.config)}this.setupScale(r,p)};g.ScaleManager.EXACT_FIT=0;g.ScaleManager.NO_SCALE=1;g.ScaleManager.SHOW_ALL=2;g.ScaleManager.RESIZE=3;g.ScaleManager.USER_SCALE=4;g.ScaleManager.prototype={boot:function(){var p=this.compatibility;p.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){p.scrollTo=new g.Point(0,1)}else{p.scrollTo=new g.Point(0,0)}}if(this.game.device.desktop){p.orientationFallback="screen";p.clickTrampoline="when-not-mouse"}else{p.orientationFallback="";p.clickTrampoline=""}var q=this;this._orientationChange=function(r){return q.orientationChange(r)};this._windowResize=function(r){return q.windowResize(r)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(r){return q.fullScreenChange(r)};this._fullScreenError=function(r){return q.fullScreenError(r)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.grid=new g.FlexGrid(this,this.width,this.height)},parseConfig:function(p){if(p.scaleMode){this.scaleMode=p.scaleMode}if(p.fullScreenScaleMode){this.fullScreenScaleMode=p.fullScreenScaleMode}if(p.fullScreenTarget){this.fullScreenTarget=p.fullScreenTarget}},setupScale:function(r,p){var u;var t=new g.Rectangle();if(this.game.parent!==""){if(typeof this.game.parent==="string"){u=document.getElementById(this.game.parent)}else{if(this.game.parent&&this.game.parent.nodeType===1){u=this.game.parent}}}if(!u){this.parentNode=null;this.parentIsWindow=true;t.width=this.dom.visualBounds.width;t.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=u;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);t.width=this._parentBounds.width;t.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var s=0;var q=0;if(typeof r==="number"){s=r}else{this.parentScaleFactor.x=parseInt(r,10)/100;s=t.width*this.parentScaleFactor.x}if(typeof p==="number"){q=p}else{this.parentScaleFactor.y=parseInt(p,10)/100;q=t.height*this.parentScaleFactor.y}this._gameSize.setTo(0,0,s,q);this.updateDimensions(s,q,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(q,p){this._gameSize.setTo(0,0,q,p);if(this.currentScaleMode!==g.ScaleManager.RESIZE){this.updateDimensions(q,p,true)}this.queueUpdate(true)},setUserScale:function(q,s,r,p){this._userScaleFactor.setTo(q,s);this._userScaleTrim.setTo(r|0,p|0);this.queueUpdate(true)},setResizeCallback:function(q,p){this.onResize=q;this.onResizeContext=p},signalSizeChange:function(){if(!g.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!g.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var q=this.width;var p=this.height;this._lastReportedCanvasSize.setTo(0,0,q,p);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(q,p);this.onSizeChange.dispatch(this,q,p);if(this.currentScaleMode===g.ScaleManager.RESIZE){this.game.state.resize(q,p);this.game.load.resize(q,p)}}},setMinMax:function(p,s,r,q){this.minWidth=p;this.minHeight=s;if(typeof r!=="undefined"){this.maxWidth=r}if(typeof q!=="undefined"){this.maxHeight=q}},preUpdate:function(){if(this.game.time.time<(this._lastUpdate+this._updateThrottle)){return}var q=this._updateThrottle;this._updateThrottleReset=q>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var t=this._parentBounds.width;var v=this._parentBounds.height;var s=this.getParentBounds(this._parentBounds);var r=s.width!==t||s.height!==v;var p=this.updateOrientationState();if(r||p){if(this.onResize){this.onResize.call(this.onResizeContext,this,s)}this.updateLayout();this.signalSizeChange()}var u=this._updateThrottle*2;if(this._updateThrottle<q){u=Math.min(q,this._updateThrottleReset)}this._updateThrottle=g.Math.clamp(u,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(r,p,q){this.width=r*this.parentScaleFactor.x;this.height=p*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(q){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(q,p){if(typeof p==="undefined"){p=false}this.forceLandscape=q;this.forcePortrait=p;this.queueUpdate(true)},classifyOrientation:function(p){if(p==="portrait-primary"||p==="portrait-secondary"){return"portrait"}else{if(p==="landscape-primary"||p==="landscape-secondary"){return"landscape"}else{return null}}},updateOrientationState:function(){var r=this.screenOrientation;var q=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=(this.forceLandscape&&!this.isLandscape)||(this.forcePortrait&&!this.isPortrait);var s=r!==this.screenOrientation;var p=q!==this.incorrectOrientation;if(s){if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}}if(p){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(s||p){this.onOrientationChange.dispatch(this,r,q)}return s||p},orientationChange:function(p){this.event=p;this.queueUpdate(true)},windowResize:function(p){this.event=p;this.queueUpdate(true)},scrollTop:function(){var p=this.compatibility.scrollTo;if(p){window.scrollTo(p.x,p.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var p=this.currentScaleMode;if(p===g.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(p===g.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(p===g.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else{if(p===g.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else{if(p===g.ScaleManager.USER_SCALE){this.width=(this.game.width*this._userScaleFactor.x)-this._userScaleTrim.x;this.height=(this.game.height*this._userScaleFactor.y)-this._userScaleTrim.y}}}}}if(!this.compatibility.canExpandParent&&(p===g.ScaleManager.SHOW_ALL||p===g.ScaleManager.USER_SCALE)){var q=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,q.width);this.height=Math.min(this.height,q.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(w){var u=w||new g.Rectangle();var r=this.boundingParent;var q=this.dom.visualBounds;var p=this.dom.layoutBounds;if(!r){u.setTo(0,0,q.width,q.height)}else{var v=r.getBoundingClientRect();u.setTo(v.left,v.top,v.width,v.height);var t=this.windowConstraints;if(t.right){var s=t.right==="layout"?p:q;u.right=Math.min(u.right,s.width)}if(t.bottom){var s=t.bottom==="layout"?p:q;u.bottom=Math.min(u.bottom,s.height)}}u.setTo(Math.round(u.x),Math.round(u.y),Math.round(u.width),Math.round(u.height));return u},alignCanvas:function(q,s){var x=this.getParentBounds(this._tempBounds);var r=this.game.canvas;var t=this.margin;if(q){t.left=t.right=0;var w=r.getBoundingClientRect();if(this.width<x.width&&!this.incorrectOrientation){var p=w.left-x.x;var v=(x.width/2)-(this.width/2);v=Math.max(v,0);var u=v-p;t.left=Math.round(u)}r.style.marginLeft=t.left+"px";if(t.left!==0){t.right=-(x.width-w.width-t.left);r.style.marginRight=t.right+"px"}}if(s){t.top=t.bottom=0;var w=r.getBoundingClientRect();if(this.height<x.height&&!this.incorrectOrientation){var p=w.top-x.y;var v=(x.height/2)-(this.height/2);v=Math.max(v,0);var u=v-p;t.top=Math.round(u)}r.style.marginTop=t.top+"px";if(t.top!==0){t.bottom=-(x.height-w.height-t.top);r.style.marginBottom=t.bottom+"px"}}t.x=t.left;t.y=t.top},reflowGame:function(){this.resetCanvas("","");var p=this.getParentBounds(this._tempBounds);this.updateDimensions(p.width,p.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=g.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=g.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(r,q){if(typeof r==="undefined"){r=this.width+"px"}if(typeof q==="undefined"){q=this.height+"px"}var p=this.game.canvas;if(!this.compatibility.noMargins){p.style.marginLeft="";p.style.marginTop="";p.style.marginRight="";p.style.marginBottom=""}p.style.width=r;p.style.height=q},queueUpdate:function(p){if(p){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(p){if(p){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var r=this.getParentBounds(this._tempBounds);var q=r.width;var p=r.height;var s;if(t){s=Math.max((p/this.game.height),(q/this.game.width))}else{s=Math.min((p/this.game.height),(q/this.game.width))}this.width=Math.round(this.game.width*s);this.height=Math.round(this.game.height*s)},setExactFit:function(){var p=this.getParentBounds(this._tempBounds);this.width=p.width;this.height=p.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var p=document.createElement("div");p.style.margin="0";p.style.padding="0";p.style.background="#000";return p},startFullScreen:function(q,v){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var w=this;setTimeout(function(){w.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var r=this.game.input;if(r.activePointer&&r.activePointer!==r.mousePointer&&(v||v!==false)){r.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[q,false]);return}}if(typeof q!=="undefined"&&this.game.renderType===g.CANVAS){this.game.stage.smoothed=q}var u=this.fullScreenTarget;if(!u){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();u=this._createdFullScreenTarget}var p={targetElement:u};this.onFullScreenInit.dispatch(this,p);if(this._createdFullScreenTarget){var s=this.game.canvas;var t=s.parentNode;t.insertBefore(u,s);u.appendChild(s)}if(this.game.device.fullscreenKeyboard){u[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{u[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var q=this._createdFullScreenTarget;if(q&&q.parentNode){var p=q.parentNode;p.insertBefore(this.game.canvas,q);p.removeChild(q)}this._createdFullScreenTarget=null},prepScreenMode:function(r){var p=!!this._createdFullScreenTarget;var q=this._createdFullScreenTarget||this.fullScreenTarget;if(r){if(p||this.fullScreenScaleMode===g.ScaleManager.EXACT_FIT){if(q!==this.game.canvas){this._fullScreenRestore={targetWidth:q.style.width,targetHeight:q.style.height};q.style.width="100%";q.style.height="100%"}}}else{if(this._fullScreenRestore){q.style.width=this._fullScreenRestore.targetWidth;q.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(p){this.event=p;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true);this.enterFullScreen.dispatch(this.width,this.height)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true);this.leaveFullScreen.dispatch(this.width,this.height)}this.onFullScreenChange.dispatch(this)},fullScreenError:function(p){this.event=p;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(v,q,w,p){if(typeof q==="undefined"){q=this.width}if(typeof w==="undefined"){w=this.height}if(typeof p==="undefined"){p=false}v.scale.set(1);if((v.width<=0)||(v.height<=0)||(q<=0)||(w<=0)){return v}var s=q;var x=(v.height*q)/v.width;var r=(v.width*w)/v.height;var u=w;var t=(r>q);if(t){t=p}else{t=!p}if(t){v.width=Math.floor(s);v.height=Math.floor(x)}else{v.width=Math.floor(r);v.height=Math.floor(u)}return v},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};g.ScaleManager.prototype.constructor=g.ScaleManager;g.ScaleManager.prototype.checkResize=g.ScaleManager.prototype.windowResize;g.ScaleManager.prototype.checkOrientation=g.ScaleManager.prototype.orientationChange;g.ScaleManager.prototype.setScreenSize=g.ScaleManager.prototype.updateLayout;g.ScaleManager.prototype.setSize=g.ScaleManager.prototype.reflowCanvas;g.ScaleManager.prototype.checkOrientationState=function(){var p=this.updateOrientationState();if(p){this.refresh()}return p};Object.defineProperty(g.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||(this.isFullScreen&&!this._createdFullScreenTarget)){return null}var p=this.game.canvas&&this.game.canvas.parentNode;return p||null}});Object.defineProperty(g.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(p){if(p!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=p}return this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(p){if(p!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=p;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=p}}return this._fullScreenScaleMode}});Object.defineProperty(g.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(p){if(p!==this._pageAlignHorizontally){this._pageAlignHorizontally=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(p){if(p!==this._pageAlignVertically){this._pageAlignVertically=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"isFullScreen",{get:function(){return !!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(g.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(g.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(g.ScaleManager.prototype,"orientation",{get:function(){return(this.classifyOrientation(this.screenOrientation)==="portrait"?0:90)}});Object.defineProperty(g.ScaleManager.prototype,"isGamePortrait",{get:function(){return(this.height>this.width)}});Object.defineProperty(g.ScaleManager.prototype,"isGameLandscape",{get:function(){return(this.width>this.height)}});g.Game=function(t,p,v,s,u,w,q,r){this.id=g.GAMES.push(this)-1;this.config=null;this.physicsConfig=r;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.renderer=null;this.renderType=g.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=g.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new g.Signal();this.forceSingleUpdate=false;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof t!=="undefined"){this._width=t}if(typeof p!=="undefined"){this._height=p}if(typeof v!=="undefined"){this.renderType=v}if(typeof s!=="undefined"){this.parent=s}if(typeof w!=="undefined"){this.transparent=w}if(typeof q!=="undefined"){this.antialias=q}this.rnd=new g.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new g.StateManager(this,u)}this.device.whenReady(this.boot,this);return this};g.Game.prototype={parseConfig:function(q){this.config=q;if(typeof q.enableDebug==="undefined"){this.config.enableDebug=true}if(q.width){this._width=q.width}if(q.height){this._height=q.height}if(q.renderer){this.renderType=q.renderer}if(q.parent){this.parent=q.parent}if(q.transparent){this.transparent=q.transparent}if(q.antialias){this.antialias=q.antialias}if(q.resolution){this.resolution=q.resolution}if(q.preserveDrawingBuffer){this.preserveDrawingBuffer=q.preserveDrawingBuffer}if(q.physicsConfig){this.physicsConfig=q.physicsConfig}var p=[(Date.now()*Math.random()).toString()];if(q.seed){p=q.seed}this.rnd=new g.RandomDataGenerator(p);var r=null;if(q.state){r=q.state}this.state=new g.StateManager(this,r)},boot:function(){if(this.isBooted){return}this.onPause=new g.Signal();this.onResume=new g.Signal();this.onBlur=new g.Signal();this.onFocus=new g.Signal();this.isBooted=true;this.math=g.Math;this.scale=new g.ScaleManager(this,this._width,this._height);this.stage=new g.Stage(this);this.setUpRenderer();this.world=new g.World(this);this.add=new g.GameObjectFactory(this);this.make=new g.GameObjectCreator(this);this.cache=new g.Cache(this);this.load=new g.Loader(this);this.load.crossOrigin="Anonymous";this.time=new g.Time(this);this.tweens=new g.TweenManager(this);this.input=new g.Input(this);this.sound=new g.SoundManager(this);this.physics=new g.Physics(this,this.physicsConfig);this.particles=new g.Particles(this);this.plugins=new g.PluginManager(this);this.net=new g.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new g.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new g.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new g.RequestAnimationFrame(this,false)}this._kickstart=true;if(window.focus){if(!window.PhaserGlobal||(window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner){return}var q=g.VERSION;var u="Canvas";var p="HTML Audio";var w=1;if(this.renderType===g.WEBGL){u="WebGL";w++}else{if(this.renderType==g.HEADLESS){u="Headless"}}if(this.device.webAudio){p="WebAudio";w++}if(this.device.chrome){var s=["%c %c %c Phaser v"+q+" | Pixi.js "+PIXI.VERSION+" | "+u+" | "+p+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(var t=0;t<3;t++){if(t<w){s.push("color: #ff2424; background: #fff")}else{s.push("color: #959595; background: #fff")}}console.log.apply(console,s)}else{if(window.console){console.log("Phaser v"+q+" | Pixi.js "+PIXI.VERSION+" | "+u+" | "+p+" | http://phaser.io")}}},setUpRenderer:function(){if(this.config.canvasID){this.canvas=g.Canvas.create(this.width,this.height,this.config.canvasID)}else{this.canvas=g.Canvas.create(this.width,this.height)}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.device.cocoonJS){if(this.renderType===g.CANVAS){this.canvas.screencanvas=true}else{this.canvas.screencanvas=false}}if(this.renderType===g.HEADLESS||this.renderType===g.CANVAS||(this.renderType===g.AUTO&&this.device.webGL===false)){if(this.device.canvas){if(this.renderType===g.AUTO){this.renderType=g.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:true});this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=g.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer});this.context=null}if(this.renderType!==g.HEADLESS){this.stage.smoothed=this.antialias;g.Canvas.addToDOM(this.canvas,this.parent,false);g.Canvas.setTouchAction(this.canvas)}},update:function(r){this.time.update(r);if(this._kickstart){this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+1000*10;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var p=this.time.slowMotion*1000/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(p*3,this.time.elapsed),0);var q=0;this.updatesThisFrame=Math.floor(this._deltaTime/p);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=p){this._deltaTime-=p;this.currentUpdateID=q;this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();q++;if(this.forceSingleUpdate&&q===1){break}}if(q>this._lastCount){this._spiraling++}else{if(q<this._lastCount){this._spiraling=0}}this._lastCount=q;this.updateRender(this._deltaTime/p)}},updateLogic:function(p){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.world.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(p);this.plugins.preUpdate(p);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update(p);this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}},updateRender:function(p){if(this.lockRender){return}this.state.preRender(p);this.renderer.render(this.stage);this.plugins.render(p);this.state.render(p);this.plugins.postRender(p)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);g.Canvas.removeFromDOM(this.canvas);g.GAMES[this.id]=null},gamePaused:function(p){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(p)}},gameResumed:function(p){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(p)}},focusLoss:function(p){this.onBlur.dispatch(p);if(!this.stage.disableVisibilityChange){this.gamePaused(p)}},focusGain:function(p){this.onFocus.dispatch(p);if(!this.stage.disableVisibilityChange){this.gameResumed(p)}}};g.Game.prototype.constructor=g.Game;Object.defineProperty(g.Game.prototype,"paused",{get:function(){return this._paused},set:function(p){if(p===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});g.Input=function(p){this.game=p;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=true;this.multiInputOverride=g.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new g.ArraySet();this._localPoint=new g.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};g.Input.MOUSE_OVERRIDES_TOUCH=0;g.Input.TOUCH_OVERRIDES_MOUSE=1;g.Input.MOUSE_TOUCH_COMBINE=2;g.Input.MAX_POINTERS=10;g.Input.prototype={boot:function(){this.mousePointer=new g.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new g.Mouse(this.game);this.touch=new g.Touch(this.game);this.mspointer=new g.MSPointer(this.game);if(g.Keyboard){this.keyboard=new g.Keyboard(this.game)}if(g.Gamepad){this.gamepad=new g.Gamepad(this.game)}this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.scale=new g.Point(1,1);this.speed=new g.Point();this.position=new g.Point();this._oldPosition=new g.Point();this.circle=new g.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var p=this;this._onClickTrampoline=function(q){p.onClickTrampoline(q)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(q,p){return this.moveCallbacks.push({callback:q,context:p})-1},deleteMoveCallback:function(p){if(this.moveCallbacks[p]){this.moveCallbacks.splice(p,1)}},addPointer:function(){if(this.pointers.length>=g.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: only "+g.Input.MAX_POINTERS+" pointer allowed");return null}var q=this.pointers.length+1;var p=new g.Pointer(this.game,q);this.pointers.push(p);this["pointer"+q]=p;return p},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].update()}this._pollCounter=0},reset:function(q){if(!this.game.isBooted||this.resetLocked){return}if(typeof q==="undefined"){q=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(q)}if(this.gamepad){this.gamepad.reset()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].reset()}this.currentPointers=0;if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(q){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(p,q){this._oldPosition.setTo(p,q);this.speed.setTo(0,0)},startPointer:function(q){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(q)}if(!this.pointer2.active){return this.pointer2.start(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(!r.active){return r.start(q)}}return null},updatePointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.move(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.move(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.move(q)}}return null},stopPointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.stop(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.stop(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.stop(q)}}return null},countActivePointers:function(p){if(typeof p==="undefined"){p=this.pointers.length}var r=p;for(var q=0;q<this.pointers.length&&r>0;q++){var s=this.pointers[q];if(s.active){r--}}this.currentPointers=(p-r);return(p-r)},getPointer:function(q){if(typeof q==="undefined"){q=false}for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active===q){return r}}return null},getPointerFromIdentifier:function(p){for(var q=0;q<this.pointers.length;q++){var r=this.pointers[q];if(r.identifier===p){return r}}return null},getPointerFromId:function(q){for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.pointerId===q){return r}}return null},getLocalPosition:function(s,r,q){if(typeof q==="undefined"){q=new g.Point()}var p=s.worldTransform;var t=1/(p.a*p.d+p.c*-p.b);return q.setTo(p.d*t*r.x+-p.c*t*r.y+(p.ty*p.c-p.tx*p.d)*t,p.a*t*r.y+-p.b*t*r.x+(-p.ty*p.a+p.tx*p.b)*t)},hitTest:function(v,p,y){if(!v.worldVisible){return false}this.getLocalPosition(v,p,this._localPoint);y.copyFrom(this._localPoint);if(v.hitArea&&v.hitArea.contains){return(v.hitArea.contains(this._localPoint.x,this._localPoint.y))}else{if(v instanceof g.TileSprite){var q=v.width;var x=v.height;var r=-q*v.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var w=-x*v.anchor.y;if(this._localPoint.y>=w&&this._localPoint.y<w+x){return true}}}else{if(v instanceof PIXI.Sprite){var q=v.texture.frame.width;var x=v.texture.frame.height;var r=-q*v.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var w=-x*v.anchor.y;if(this._localPoint.y>=w&&this._localPoint.y<w+x){return true}}}else{if(v instanceof g.Graphics){for(var t=0;t<v.graphicsData.length;t++){var s=v.graphicsData[t];if(!s.fill){continue}if(s.shape&&s.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}}}}for(var t=0,u=v.children.length;t<u;t++){if(this.hitTest(v.children[t],p,y)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};g.Input.prototype.constructor=g.Input;Object.defineProperty(g.Input.prototype,"x",{get:function(){return this._x},set:function(p){this._x=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"y",{get:function(){return this._y},set:function(p){this._y=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(g.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(g.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(g.Input.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.Mouse=function(p){this.game=p;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new g.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};g.Mouse.NO_BUTTON=-1;g.Mouse.LEFT_BUTTON=0;g.Mouse.MIDDLE_BUTTON=1;g.Mouse.RIGHT_BUTTON=2;g.Mouse.WHEEL_UP=1;g.Mouse.WHEEL_DOWN=-1;g.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var q=this;this._onMouseDown=function(r){return q.onMouseDown(r)};this._onMouseMove=function(r){return q.onMouseMove(r)};this._onMouseUp=function(r){return q.onMouseUp(r)};this._onMouseUpGlobal=function(r){return q.onMouseUpGlobal(r)};this._onMouseOut=function(r){return q.onMouseOut(r)};this._onMouseOver=function(r){return q.onMouseOver(r)};this._onMouseWheel=function(r){return q.onMouseWheel(r)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,true);this.game.canvas.addEventListener("mousemove",this._onMouseMove,true);this.game.canvas.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);this.game.canvas.addEventListener("mouseover",this._onMouseOver,true);this.game.canvas.addEventListener("mouseout",this._onMouseOut,true)}var p=this.game.device.wheelEvent;if(p){this.game.canvas.addEventListener(p,this._onMouseWheel,true);if(p==="mousewheel"){this._wheelEvent=new m(-1/40,1)}else{if(p==="DOMMouseScroll"){this._wheelEvent=new m(1,1)}}}},onMouseDown:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=p.button;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.start(p)},onMouseMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.move(p)},onMouseUp:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=g.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.stop(p)},onMouseUpGlobal:function(p){if(!this.game.input.mousePointer.withinGame){this.button=g.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}p.identifier=0;this.game.input.mousePointer.stop(p)}},onMouseOut:function(p){this.event=p;if(this.capture){p.preventDefault()}this.game.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}if(this.stopOnGameOut){p.identifier=0;this.game.input.mousePointer.stop(p)}},onMouseWheel:function(p){if(this._wheelEvent){p=this._wheelEvent.bindEvent(p)}this.event=p;if(this.capture){p.preventDefault()}this.wheelDelta=g.Math.clamp(-p.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,p)}},onMouseOver:function(p){this.event=p;if(this.capture){p.preventDefault()}this.game.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}},requestPointerLock:function(){if(this.game.device.pointerLock){var p=this.game.canvas;p.requestPointerLock=p.requestPointerLock||p.mozRequestPointerLock||p.webkitRequestPointerLock;p.requestPointerLock();var q=this;this._pointerLockChange=function(r){return q.pointerLockChange(r)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(q){var p=this.game.canvas;if(document.pointerLockElement===p||document.mozPointerLockElement===p||document.webkitPointerLockElement===p){this.locked=true;this.pointerLock.dispatch(true,q)}else{this.locked=false;this.pointerLock.dispatch(false,q)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,true);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,true);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,true);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,true);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,true);var p=this.game.device.wheelEvent;if(p){this.game.canvas.removeEventListener(p,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};g.Mouse.prototype.constructor=g.Mouse;Object.defineProperty(g.Mouse.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});function m(q,p){this._scaleFactor=q;this._deltaMode=p;this.originalEvent=null}m.prototype={};m.prototype.constructor=m;m.prototype.bindEvent=function(q){if(!m._stubsGenerated&&q){var p=function(s){return function(){var t=this.originalEvent[s];return typeof t!=="function"?t:t.bind(this.originalEvent)}};for(var r in q){if(!(r in m.prototype)){Object.defineProperty(m.prototype,r,{get:p(r)})}}m._stubsGenerated=true}this.originalEvent=q;return this};Object.defineProperties(m.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return(this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail))||0}},deltaX:{get:function(){return(this._scaleFactor*this.originalEvent.wheelDeltaX)||0}},deltaZ:{value:0}});g.MSPointer=function(p){this.game=p;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};g.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var p=this;if(this.game.device.mspointer){this._onMSPointerDown=function(q){return p.onPointerDown(q)};this._onMSPointerMove=function(q){return p.onPointerMove(q)};this._onMSPointerUp=function(q){return p.onPointerUp(q)};this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.canvas.style["-ms-content-zooming"]="none";this.game.canvas.style["-ms-touch-action"]="none"}},onPointerDown:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=p.button;if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.startPointer(p)},onPointerMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.updatePointer(p)},onPointerUp:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=g.Mouse.NO_BUTTON;if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.stopPointer(p)},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};g.MSPointer.prototype.constructor=g.MSPointer;Object.defineProperty(g.MSPointer.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.Pointer=function(p,q){this.game=p;this.id=q;this.type=g.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.dirty=false;this.position=new g.Point();this.positionDown=new g.Point();this.positionUp=new g.Point();this.circle=new g.Circle(0,0,44);if(q===0){this.isMouse=true}this._clickTrampolines=null;this._trampolineTargetObject=null};g.Pointer.prototype={start:function(p){if(p.pointerId){this.pointerId=p.pointerId}this.identifier=p.identifier;this.target=p.target;if(typeof p.button!=="undefined"){this.button=p.button}this._history=[];this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.dirty=false;this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(p,true);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,p);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(!this.isMouse){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this.dirty){if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride==g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(q,r){if(this.game.input.pollLocked){return}if(typeof r==="undefined"){r=false}if(typeof q.button!=="undefined"){this.button=q.button}this.clientX=q.clientX;this.clientY=q.clientY;this.pageX=q.pageX;this.pageY=q.pageY;this.screenX=q.screenX;this.screenY=q.screenY;if(this.isMouse&&this.game.input.mouse.locked&&!r){this.rawMovementX=q.movementX||q.mozMovementX||q.webkitMovementX||0;this.rawMovementY=q.movementY||q.mozMovementY||q.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var p=this.game.input.moveCallbacks.length;while(p--){this.game.input.moveCallbacks[p].callback.call(this.game.input.moveCallbacks[p].context,this,this.x,this.y,r)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else{if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(r)}}return this},processInteractiveObjects:function(t){var r=Number.MAX_VALUE;var q=-1;var p=null;var s=this.game.input.interactiveItems.first;while(s){s.checked=false;if(s.validForInput(q,r,false)){s.checked=true;if((t&&s.checkPointerDown(this,true))||(!t&&s.checkPointerOver(this,true))){r=s.sprite.renderOrderID;q=s.priorityID;p=s}}s=this.game.input.interactiveItems.next}var s=this.game.input.interactiveItems.first;while(s){if(!s.checked&&s.validForInput(q,r,true)){if((t&&s.checkPointerDown(this,false))||(!t&&s.checkPointerOver(this,false))){r=s.sprite.renderOrderID;q=s.priorityID;p=s}}s=this.game.input.interactiveItems.next}if(p===null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=p;p._pointerOverHandler(this)}else{if(this.targetObject===p){if(p.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=p;this.targetObject._pointerOverHandler(this)}}}return(this.targetObject!==null)},leave:function(p){this.withinGame=false;this.move(p,false)},stop:function(p){if(this._stateReset&&this.withinGame){p.preventDefault();return}this.timeUp=this.game.time.time;if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onUp.dispatch(this,p);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){this.game.input.currentPointers--}this.game.input.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(p){p=p||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||this.game.input.justReleasedRate;return(this.isUp===true&&(this.timeUp+p)>this.game.time.time)},addClickTrampoline:function(q,u,p,s){if(!this.isDown){return}var t=(this._clickTrampolines=this._clickTrampolines||[]);for(var r=0;r<t.length;r++){if(t[r].name===q){t.splice(r,1);break}}t.push({name:q,targetObject:this.targetObject,callback:u,callbackContext:p,callbackArgs:s})},processClickTrampolines:function(){var r=this._clickTrampolines;if(!r){return}for(var p=0;p<r.length;p++){var q=r[p];if(q.targetObject===this._trampolineTargetObject){q.callback.apply(q.callbackContext,q.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};g.Pointer.prototype.constructor=g.Pointer;Object.defineProperty(g.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});Object.defineProperty(g.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(g.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});g.Touch=function(p){this.game=p;this.enabled=true;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};g.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var p=this;if(this.game.device.touch){this._onTouchStart=function(q){return p.onTouchStart(q)};this._onTouchMove=function(q){return p.onTouchMove(q)};this._onTouchEnd=function(q){return p.onTouchEnd(q)};this._onTouchEnter=function(q){return p.onTouchEnter(q)};this._onTouchLeave=function(q){return p.onTouchLeave(q)};this._onTouchCancel=function(q){return p.onTouchCancel(q)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(p){p.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(q){this.event=q;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,q)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.startPointer(q.changedTouches[p])}},onTouchCancel:function(q){this.event=q;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,q)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.stopPointer(q.changedTouches[p])}},onTouchEnter:function(p){this.event=p;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){p.preventDefault()}},onTouchLeave:function(p){this.event=p;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,p)}if(this.preventDefault){p.preventDefault()}},onTouchMove:function(q){this.event=q;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,q)}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.updatePointer(q.changedTouches[p])}},onTouchEnd:function(q){this.event=q;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,q)}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.stopPointer(q.changedTouches[p])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};g.Touch.prototype.constructor=g.Touch;Object.defineProperty(g.Touch.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.InputHandler=function(p){this.sprite=p;this.game=p.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this.scaleLayer=false;this.dragOffset=new g.Point();this.dragFromCenter=false;this.dragStartPoint=new g.Point();this._dragPoint=new g.Point();this._dragPhase=false;this._wasEnabled=false;this._tempPoint=new g.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};g.InputHandler.prototype={start:function(r,p){r=r||0;if(typeof p==="undefined"){p=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=p;this.priorityID=r;for(var q=0;q<10;q++){this._pointerData[q]={id:q,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new g.Point();this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);this.flagged=false;return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;this.flagged=false;for(var p=0;p<10;p++){this._pointerData[p]={id:p,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(r,q,p){if(typeof p==="undefined"){p=true}if(this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID){return false}if(!p&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>r||(this.priorityID===r&&this.sprite.renderOrderID<q)){return true}return false},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver)},pointerX:function(p){p=p||0;return this._pointerData[p].x},pointerY:function(p){p=p||0;return this._pointerData[p].y},pointerDown:function(p){p=p||0;return this._pointerData[p].isDown},pointerUp:function(p){p=p||0;return this._pointerData[p].isUp},pointerTimeDown:function(p){p=p||0;return this._pointerData[p].timeDown},pointerTimeUp:function(p){p=p||0;return this._pointerData[p].timeUp},pointerOver:function(p){if(this.enabled){if(typeof p==="undefined"){for(var q=0;q<10;q++){if(this._pointerData[q].isOver){return true}}}else{return this._pointerData[p].isOver}}return false},pointerOut:function(p){if(this.enabled){if(typeof p==="undefined"){for(var q=0;q<10;q++){if(this._pointerData[q].isOut){return true}}}else{return this._pointerData[p].isOut}}return false},pointerTimeOver:function(p){p=p||0;return this._pointerData[p].timeOver},pointerTimeOut:function(p){p=p||0;return this._pointerData[p].timeOut},pointerDragged:function(p){p=p||0;return this._pointerData[p].isDragged},checkPointerDown:function(q,p){if(!q.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(typeof p==="undefined"){p=false}if(!p&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(q,p){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(typeof p==="undefined"){p=false}if(!p&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(p,s,r){if(this.sprite.texture.baseTexture.source){if(p===null&&s===null){this.game.input.getLocalPosition(this.sprite,r,this._tempPoint);var p=this._tempPoint.x;var s=this._tempPoint.y}if(this.sprite.anchor.x!==0){p-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){s-=-this.sprite.texture.frame.height*this.sprite.anchor.y}p+=this.sprite.texture.frame.x;s+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){p-=this.sprite.texture.trim.x;s-=this.sprite.texture.trim.y;if(p<this.sprite.texture.crop.x||p>this.sprite.texture.crop.right||s<this.sprite.texture.crop.y||s>this.sprite.texture.crop.bottom){this._dx=p;this._dy=s;return false}}this._dx=p;this._dy=s;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,p,s,1,1,0,0,1,1);var q=this.game.input.hitContext.getImageData(0,0,1,1);if(q.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(p){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(p);return false}if(this.draggable&&this._draggedPointerID===p.id){return this.updateDrag(p)}else{if(this._pointerData[p.id].isOver){if(this.checkPointerOver(p)){this._pointerData[p.id].x=p.x-this.sprite.x;this._pointerData[p.id].y=p.y-this.sprite.y;return true}else{this._pointerOutHandler(p);return false}}}},_pointerOverHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isOver===false||p.dirty){this._pointerData[p.id].isOver=true;this._pointerData[p.id].isOut=false;this._pointerData[p.id].timeOver=this.game.time.time;this._pointerData[p.id].x=p.x-this.sprite.x;this._pointerData[p.id].y=p.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[p.id].isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,p)}}},_pointerOutHandler:function(p){if(this.sprite===null){return}this._pointerData[p.id].isOver=false;this._pointerData[p.id].isOut=true;this._pointerData[p.id].timeOut=this.game.time.time;if(this.useHandCursor&&this._pointerData[p.id].isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,p)}},_touchedHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isDown===false&&this._pointerData[p.id].isOver===true){if(this.pixelPerfectClick&&!this.checkPixel(null,null,p)){return}this._pointerData[p.id].isDown=true;this._pointerData[p.id].isUp=false;this._pointerData[p.id].timeDown=this.game.time.time;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,p)}p.dirty=true;if(this.draggable&&this.isDragged===false){this.startDrag(p)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isDown&&p.isUp){this._pointerData[p.id].isDown=false;this._pointerData[p.id].isUp=true;this._pointerData[p.id].timeUp=this.game.time.time;this._pointerData[p.id].downDuration=this._pointerData[p.id].timeUp-this._pointerData[p.id].timeDown;if(this.checkPointerOver(p)){if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,p,true)}}else{if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,p,false)}if(this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}}p.dirty=true;if(this.draggable&&this.isDragged&&this._draggedPointerID===p.id){this.stopDrag(p)}}},updateDrag:function(r){if(r.isUp){this.stopDrag(r);return false}var q=this.globalToLocalX(r.x)+this._dragPoint.x+this.dragOffset.x;var p=this.globalToLocalY(r.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=q}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=p}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}else{if(this.allowHorizontalDrag){this.sprite.x=q}if(this.allowVerticalDrag){this.sprite.y=p}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}return true},justOver:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOver&&this.overDuration(q)<p)},justOut:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOut&&(this.game.time.time-this._pointerData[q].timeOut<p))},justPressed:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isDown&&this.downDuration(q)<p)},justReleased:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isUp&&(this.game.time.time-this._pointerData[q].timeUp<p))},overDuration:function(p){p=p||0;if(this._pointerData[p].isOver){return this.game.time.time-this._pointerData[p].timeOver}return -1},downDuration:function(p){p=p||0;if(this._pointerData[p].isDown){return this.game.time.time-this._pointerData[p].timeDown}return -1},enableDrag:function(q,t,p,s,u,r){if(typeof q==="undefined"){q=false}if(typeof t==="undefined"){t=false}if(typeof p==="undefined"){p=false}if(typeof s==="undefined"){s=255}if(typeof u==="undefined"){u=null}if(typeof r==="undefined"){r=null}this._dragPoint=new g.Point();this.draggable=true;this.bringToTop=t;this.dragOffset=new g.Point();this.dragFromCenter=q;this.pixelPerfectClick=p;this.pixelPerfectAlpha=s;if(u){this.boundsRect=u}if(r){this.boundsSprite=r}},disableDrag:function(){if(this._pointerData){for(var p=0;p<10;p++){this._pointerData[p].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(r){var p=this.sprite.x;var s=this.sprite.y;this.isDragged=true;this._draggedPointerID=r.id;this._pointerData[r.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){this.sprite.centerOn(r.x,r.y);this._dragPoint.setTo(this.sprite.cameraOffset.x-r.x,this.sprite.cameraOffset.y-r.y)}else{this._dragPoint.setTo(this.sprite.cameraOffset.x-r.x,this.sprite.cameraOffset.y-r.y)}}else{if(this.dragFromCenter){var q=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(r.x)+(this.sprite.x-q.centerX);this.sprite.y=this.globalToLocalY(r.y)+(this.sprite.y-q.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(r.x),this.sprite.y-this.globalToLocalY(r.y))}this.updateDrag(r);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(p,s);this.sprite.events.onDragStart$dispatch(this.sprite,r,p,s)},globalToLocalX:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.x;p*=this.game.scale.grid.scaleFluidInversed.x}return p},globalToLocalY:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.y;p*=this.game.scale.grid.scaleFluidInversed.y}return p},stopDrag:function(p){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[p.id].isDragged=false;this._dragPhase=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop$dispatch(this.sprite,p);if(this.checkPointerOver(p)===false){this._pointerOutHandler(p)}},setDragLock:function(p,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=true}this.allowHorizontalDrag=p;this.allowVerticalDrag=q},enableSnap:function(s,r,q,p,u,t){if(typeof q==="undefined"){q=true}if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"){t=0}this.snapX=s;this.snapY=r;this.snapOffsetX=u;this.snapOffsetY=t;this.snapOnDrag=q;this.snapOnRelease=p},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else{if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else{if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}}};g.InputHandler.prototype.constructor=g.InputHandler;g.Gamepad=function(p){this.game=p;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!=-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this)]};g.Gamepad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback;this.callbackContext=p}},start:function(){if(this._active){return}this._active=true;var p=this;this._onGamepadConnected=function(q){return p.onGamepadConnected(q)};this._onGamepadDisconnected=function(q){return p.onGamepadDisconnected(q)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(q){var p=q.gamepad;this._rawPads.push(p);this._gamepads[p.index].connect(p)},onGamepadDisconnected:function(q){var r=q.gamepad;for(var p in this._rawPads){if(this._rawPads[p].index===r.index){this._rawPads.splice(p,1)}}this._gamepads[r.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads){var p=navigator.getGamepads()}else{if(navigator.webkitGetGamepads){var p=navigator.webkitGetGamepads()}else{if(navigator.webkitGamepads){var p=navigator.webkitGamepads()}}}if(p){this._rawPads=[];var v=false;for(var u=0;u<p.length;u++){if(typeof p[u]!==this._prevRawGamepadTypes[u]){v=true;this._prevRawGamepadTypes[u]=typeof p[u]}if(p[u]){this._rawPads.push(p[u])}if(u===3){break}}if(v){var y={rawIndices:{},padIndices:{}};var x;for(var t=0;t<this._gamepads.length;t++){x=this._gamepads[t];if(x.connected){for(var s=0;s<this._rawPads.length;s++){if(this._rawPads[s].index===x.index){y.rawIndices[x.index]=true;y.padIndices[t]=true}}}}for(var r=0;r<this._gamepads.length;r++){x=this._gamepads[r];if(y.padIndices[r]){continue}if(this._rawPads.length<1){x.disconnect()}for(var q=0;q<this._rawPads.length;q++){if(y.padIndices[r]){break}var w=this._rawPads[q];if(w){if(y.rawIndices[w.index]){x.disconnect();continue}else{x.connect(w);y.rawIndices[w.index]=true;y.padIndices[r]=true}}else{x.disconnect()}}}}}},setDeadZones:function(q){for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].deadZone=q}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].reset()}},justPressed:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justPressed(p,r)===true){return true}}return false},justReleased:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justReleased(p,r)===true){return true}}return false},isDown:function(p){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].isDown(p)===true){return true}}return false},destroy:function(){this.stop();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].destroy()}}};g.Gamepad.prototype.constructor=g.Gamepad;Object.defineProperty(g.Gamepad.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});Object.defineProperty(g.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(g.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(g.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(g.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(g.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(g.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(g.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});g.Gamepad.BUTTON_0=0;g.Gamepad.BUTTON_1=1;g.Gamepad.BUTTON_2=2;g.Gamepad.BUTTON_3=3;g.Gamepad.BUTTON_4=4;g.Gamepad.BUTTON_5=5;g.Gamepad.BUTTON_6=6;g.Gamepad.BUTTON_7=7;g.Gamepad.BUTTON_8=8;g.Gamepad.BUTTON_9=9;g.Gamepad.BUTTON_10=10;g.Gamepad.BUTTON_11=11;g.Gamepad.BUTTON_12=12;g.Gamepad.BUTTON_13=13;g.Gamepad.BUTTON_14=14;g.Gamepad.BUTTON_15=15;g.Gamepad.AXIS_0=0;g.Gamepad.AXIS_1=1;g.Gamepad.AXIS_2=2;g.Gamepad.AXIS_3=3;g.Gamepad.AXIS_4=4;g.Gamepad.AXIS_5=5;g.Gamepad.AXIS_6=6;g.Gamepad.AXIS_7=7;g.Gamepad.AXIS_8=8;g.Gamepad.AXIS_9=9;g.Gamepad.XBOX360_A=0;g.Gamepad.XBOX360_B=1;g.Gamepad.XBOX360_X=2;g.Gamepad.XBOX360_Y=3;g.Gamepad.XBOX360_LEFT_BUMPER=4;g.Gamepad.XBOX360_RIGHT_BUMPER=5;g.Gamepad.XBOX360_LEFT_TRIGGER=6;g.Gamepad.XBOX360_RIGHT_TRIGGER=7;g.Gamepad.XBOX360_BACK=8;g.Gamepad.XBOX360_START=9;g.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;g.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;g.Gamepad.XBOX360_DPAD_LEFT=14;g.Gamepad.XBOX360_DPAD_RIGHT=15;g.Gamepad.XBOX360_DPAD_UP=12;g.Gamepad.XBOX360_DPAD_DOWN=13;g.Gamepad.XBOX360_STICK_LEFT_X=0;g.Gamepad.XBOX360_STICK_LEFT_Y=1;g.Gamepad.XBOX360_STICK_RIGHT_X=2;g.Gamepad.XBOX360_STICK_RIGHT_Y=3;g.Gamepad.PS3XC_X=0;g.Gamepad.PS3XC_CIRCLE=1;g.Gamepad.PS3XC_SQUARE=2;g.Gamepad.PS3XC_TRIANGLE=3;g.Gamepad.PS3XC_L1=4;g.Gamepad.PS3XC_R1=5;g.Gamepad.PS3XC_L2=6;g.Gamepad.PS3XC_R2=7;g.Gamepad.PS3XC_SELECT=8;g.Gamepad.PS3XC_START=9;g.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;g.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;g.Gamepad.PS3XC_DPAD_UP=12;g.Gamepad.PS3XC_DPAD_DOWN=13;g.Gamepad.PS3XC_DPAD_LEFT=14;g.Gamepad.PS3XC_DPAD_RIGHT=15;g.Gamepad.PS3XC_STICK_LEFT_X=0;g.Gamepad.PS3XC_STICK_LEFT_Y=1;g.Gamepad.PS3XC_STICK_RIGHT_X=2;g.Gamepad.PS3XC_STICK_RIGHT_Y=3;g.SinglePad=function(p,q){this.game=p;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=q;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};g.SinglePad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback}},getButton:function(p){if(this._buttons[p]){return this._buttons[p]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||(this._rawPad.timestamp&&(this._rawPad.timestamp===this._prevTimestamp))){return}for(var r=0;r<this._buttonsLen;r++){var p=isNaN(this._rawPad.buttons[r])?this._rawPad.buttons[r].value:this._rawPad.buttons[r];if(p!==this._buttons[r].value){if(p===1){this.processButtonDown(r,p)}else{if(p===0){this.processButtonUp(r,p)}else{this.processButtonFloat(r,p)}}}}for(var q=0;q<this._axesLen;q++){var s=this._rawPad.axes[q];if((s>0&&s>this.deadZone)||(s<0&&s<-this.deadZone)){this.processAxisChange(q,s)}else{this.processAxisChange(q,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(r){var s=!this.connected;this.connected=true;this.index=r.index;this._rawPad=r;this._buttons=[];this._buttonsLen=r.buttons.length;this._axes=[];this._axesLen=r.axes.length;for(var p=0;p<this._axesLen;p++){this._axes[p]=r.axes[p]}for(var q in r.buttons){q=parseInt(q,10);this._buttons[q]=new g.GamepadButton(this,q)}if(s&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(s&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var r=this.connected;var p=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var q=0;q<this._buttonsLen;q++){this._buttons[q].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(r&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,p)}if(r&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var p=0;p<this._buttonsLen;p++){this._buttons[p].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(p,q){if(this._axes[p]===q){return}this._axes[p]=q;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,p,q)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,p,q)}},processButtonDown:function(p,q){if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonDown(q)}},processButtonUp:function(p,q){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonUp(q)}},processButtonFloat:function(p,q){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonFloat(q)}},axis:function(p){if(this._axes[p]){return this._axes[p]}return false},isDown:function(p){if(this._buttons[p]){return this._buttons[p].isDown}return false},isUp:function(p){if(this._buttons[p]){return this._buttons[p].isUp}return false},justReleased:function(p,q){if(this._buttons[p]){return this._buttons[p].justReleased(q)}},justPressed:function(p,q){if(this._buttons[p]){return this._buttons[p].justPressed(q)}},buttonValue:function(p){if(this._buttons[p]){return this._buttons[p].value}return null},reset:function(){for(var p=0;p<this._axes.length;p++){this._axes[p]=0}}};g.SinglePad.prototype.constructor=g.SinglePad;g.GamepadButton=function(q,p){this.pad=q;this.game=q.game;this.isDown=false;this.isUp=true;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=p;this.onDown=new g.Signal();this.onUp=new g.Signal();this.onFloat=new g.Signal()};g.GamepadButton.prototype={processButtonDown:function(p){this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this.value=p;this.onDown.dispatch(this,p)},processButtonUp:function(p){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.value=p;this.onUp.dispatch(this,p)},processButtonFloat:function(p){this.value=p;this.onFloat.dispatch(this,p)},justPressed:function(p){p=p||250;return(this.isDown===true&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||250;return(this.isUp===true&&(this.timeUp+p)>this.game.time.time)},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};g.GamepadButton.prototype.constructor=g.GamepadButton;g.Key=function(q,p){this.game=q;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=p;this.onDown=new g.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new g.Signal();this._justDown=false;this._justUp=false};g.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(p){if(!this._enabled){return}this.event=p;if(this.isDown){return}this.altKey=p.altKey;this.ctrlKey=p.ctrlKey;this.shiftKey=p.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(p){if(!this._enabled){return}this.event=p;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(p){if(typeof p==="undefined"){p=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(p){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(p){if(typeof p==="undefined"){p=50}return(this.isDown&&this.duration<p)},upDuration:function(p){if(typeof p==="undefined"){p=50}return(!this.isDown&&((this.game.time.time-this.timeUp)<p))}};Object.defineProperty(g.Key.prototype,"justDown",{get:function(){var p=this._justDown;this._justDown=false;return p}});Object.defineProperty(g.Key.prototype,"justUp",{get:function(){var p=this._justUp;this._justUp=false;return p}});Object.defineProperty(g.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(p){p=!!p;if(p!==this._enabled){if(!p){this.reset(false)}this._enabled=p}}});g.Key.prototype.constructor=g.Key;g.Keyboard=function(p){this.game=p;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};g.Keyboard.prototype={addCallbacks:function(p,q,s,r){this.callbackContext=p;if(typeof q!=="undefined"){this.onDownCallback=q}if(typeof s!=="undefined"){this.onUpCallback=s}if(typeof r!=="undefined"){this.onPressCallback=r}},addKey:function(p){if(!this._keys[p]){this._keys[p]=new g.Key(this.game,p);this.addKeyCapture(p)}return this._keys[p]},removeKey:function(p){if(this._keys[p]){this._keys[p]=null;this.removeKeyCapture(p)}},createCursorKeys:function(){return{up:this.addKey(g.Keyboard.UP),down:this.addKey(g.Keyboard.DOWN),left:this.addKey(g.Keyboard.LEFT),right:this.addKey(g.Keyboard.RIGHT)}},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var p=this;this._onKeyDown=function(q){return p.processKeyDown(q)};this._onKeyUp=function(q){return p.processKeyUp(q)};this._onKeyPress=function(q){return p.processKeyPress(q)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(p){if(typeof p==="object"){for(var q in p){this._capture[p[q]]=true}}else{this._capture[p]=true}},removeKeyCapture:function(p){delete this._capture[p]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(p){this.event=p;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[p.keyCode]){p.preventDefault()}if(!this._keys[p.keyCode]){this._keys[p.keyCode]=new g.Key(this.game,p.keyCode)}this._keys[p.keyCode].processKeyDown(p);this._k=p.keyCode;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,p)}},processKeyPress:function(p){this.pressEvent=p;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(p.charCode),p)}},processKeyUp:function(p){this.event=p;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[p.keyCode]){p.preventDefault()}if(!this._keys[p.keyCode]){this._keys[p.keyCode]=new g.Key(this.game,p.keyCode)}this._keys[p.keyCode].processKeyUp(p);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,p)}},reset:function(q){if(typeof q==="undefined"){q=true}this.event=null;var p=this._keys.length;while(p--){if(this._keys[p]){this._keys[p].reset(q)}}},downDuration:function(p,q){if(this._keys[p]){return this._keys[p].downDuration(q)}else{return null}},upDuration:function(p,q){if(this._keys[p]){return this._keys[p].upDuration(q)}else{return null}},isDown:function(p){if(this._keys[p]){return this._keys[p].isDown}else{return null}}};Object.defineProperty(g.Keyboard.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});Object.defineProperty(g.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(g.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});g.Keyboard.prototype.constructor=g.Keyboard;g.Keyboard.A="A".charCodeAt(0);g.Keyboard.B="B".charCodeAt(0);g.Keyboard.C="C".charCodeAt(0);g.Keyboard.D="D".charCodeAt(0);g.Keyboard.E="E".charCodeAt(0);g.Keyboard.F="F".charCodeAt(0);g.Keyboard.G="G".charCodeAt(0);g.Keyboard.H="H".charCodeAt(0);g.Keyboard.I="I".charCodeAt(0);g.Keyboard.J="J".charCodeAt(0);g.Keyboard.K="K".charCodeAt(0);g.Keyboard.L="L".charCodeAt(0);g.Keyboard.M="M".charCodeAt(0);g.Keyboard.N="N".charCodeAt(0);g.Keyboard.O="O".charCodeAt(0);g.Keyboard.P="P".charCodeAt(0);g.Keyboard.Q="Q".charCodeAt(0);g.Keyboard.R="R".charCodeAt(0);g.Keyboard.S="S".charCodeAt(0);g.Keyboard.T="T".charCodeAt(0);g.Keyboard.U="U".charCodeAt(0);g.Keyboard.V="V".charCodeAt(0);g.Keyboard.W="W".charCodeAt(0);g.Keyboard.X="X".charCodeAt(0);g.Keyboard.Y="Y".charCodeAt(0);g.Keyboard.Z="Z".charCodeAt(0);g.Keyboard.ZERO="0".charCodeAt(0);g.Keyboard.ONE="1".charCodeAt(0);g.Keyboard.TWO="2".charCodeAt(0);g.Keyboard.THREE="3".charCodeAt(0);g.Keyboard.FOUR="4".charCodeAt(0);g.Keyboard.FIVE="5".charCodeAt(0);g.Keyboard.SIX="6".charCodeAt(0);g.Keyboard.SEVEN="7".charCodeAt(0);g.Keyboard.EIGHT="8".charCodeAt(0);g.Keyboard.NINE="9".charCodeAt(0);g.Keyboard.NUMPAD_0=96;g.Keyboard.NUMPAD_1=97;g.Keyboard.NUMPAD_2=98;g.Keyboard.NUMPAD_3=99;g.Keyboard.NUMPAD_4=100;g.Keyboard.NUMPAD_5=101;g.Keyboard.NUMPAD_6=102;g.Keyboard.NUMPAD_7=103;g.Keyboard.NUMPAD_8=104;g.Keyboard.NUMPAD_9=105;g.Keyboard.NUMPAD_MULTIPLY=106;g.Keyboard.NUMPAD_ADD=107;g.Keyboard.NUMPAD_ENTER=108;g.Keyboard.NUMPAD_SUBTRACT=109;g.Keyboard.NUMPAD_DECIMAL=110;g.Keyboard.NUMPAD_DIVIDE=111;g.Keyboard.F1=112;g.Keyboard.F2=113;g.Keyboard.F3=114;g.Keyboard.F4=115;g.Keyboard.F5=116;g.Keyboard.F6=117;g.Keyboard.F7=118;g.Keyboard.F8=119;g.Keyboard.F9=120;g.Keyboard.F10=121;g.Keyboard.F11=122;g.Keyboard.F12=123;g.Keyboard.F13=124;g.Keyboard.F14=125;g.Keyboard.F15=126;g.Keyboard.COLON=186;g.Keyboard.EQUALS=187;g.Keyboard.UNDERSCORE=189;g.Keyboard.QUESTION_MARK=191;g.Keyboard.TILDE=192;g.Keyboard.OPEN_BRACKET=219;g.Keyboard.BACKWARD_SLASH=220;g.Keyboard.CLOSED_BRACKET=221;g.Keyboard.QUOTES=222;g.Keyboard.BACKSPACE=8;g.Keyboard.TAB=9;g.Keyboard.CLEAR=12;g.Keyboard.ENTER=13;g.Keyboard.SHIFT=16;g.Keyboard.CONTROL=17;g.Keyboard.ALT=18;g.Keyboard.CAPS_LOCK=20;g.Keyboard.ESC=27;g.Keyboard.SPACEBAR=32;g.Keyboard.PAGE_UP=33;g.Keyboard.PAGE_DOWN=34;g.Keyboard.END=35;g.Keyboard.HOME=36;g.Keyboard.LEFT=37;g.Keyboard.UP=38;g.Keyboard.RIGHT=39;g.Keyboard.DOWN=40;g.Keyboard.INSERT=45;g.Keyboard.DELETE=46;g.Keyboard.HELP=47;g.Keyboard.NUM_LOCK=144;g.Keyboard.PLUS=43;g.Keyboard.MINUS=45;g.Component=function(){};g.Component.Angle=function(){};g.Component.Angle.prototype={angle:{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.rotation))},set:function(p){this.rotation=g.Math.degToRad(g.Math.wrapAngle(p))}}};g.Component.Animation=function(){};g.Component.Animation.prototype={play:function(s,r,q,p){if(this.animations){return this.animations.play(s,r,q,p)}}};g.Component.AutoCull=function(){};g.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.Bounds=function(){};g.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return(this.x+this.width)-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return(this.y+this.height)-this.offsetY}}};g.Component.BringToTop=function(){};g.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};g.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};g.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};g.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};g.Component.Core=function(){};g.Component.Core.install=function(r){g.Utils.mixinPrototype(this,g.Component.Core.prototype);this.components={};for(var q=0;q<r.length;q++){var s=r[q];var p=false;if(s==="Destroy"){p=true}g.Utils.mixinPrototype(this,g.Component[s].prototype,p);this.components[s]=true}};g.Component.Core.init=function(q,p,t,r,s){this.game=q;this.key=r;this.position.set(p,t);this.world=new g.Point(p,t);this.previousPosition=new g.Point(p,t);this.events=new g.Events(this);this._bounds=new g.Rectangle();if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new g.AnimationManager(this)}if(this.components.LoadTexture&&r!==null){this.loadTexture(r,s)}if(this.components.FixedToCamera){this.cameraOffset=new g.Point(p,t)}};g.Component.Core.preUpdate=function(){this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}return true};g.Component.Core.prototype={game:null,name:"",components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(p){if(p){this._exists=true;if(this.body&&this.body.type===g.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===g.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.key instanceof g.BitmapData){this.key.render()}if(this.components.PhysicsBody){g.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){g.Component.FixedToCamera.postUpdate.call(this)}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}}};g.Component.Crop=function(){};g.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(p,q){if(typeof q==="undefined"){q=false}if(p){if(q&&this.cropRect!==null){this.cropRect.setTo(p.x,p.y,p.width,p.height)}else{if(q&&this.cropRect===null){this.cropRect=new g.Rectangle(p.x,p.y,p.width,p.height)}else{this.cropRect=p}}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}this._crop=g.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var p=Math.max(this._frame.x,this._crop.x);var s=Math.max(this._frame.y,this._crop.y);var q=Math.min(this._frame.right,this._crop.right)-p;var r=Math.min(this._frame.bottom,this._crop.bottom)-s;this.texture.crop.x=p;this.texture.crop.y=s;this.texture.crop.width=q;this.texture.crop.height=r;this.texture.frame.width=Math.min(q,this.cropRect.width);this.texture.frame.height=Math.min(r,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}};g.Component.Delta=function(){};g.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};g.Component.Destroy=function(){};g.Component.Destroy.prototype={destroyPhase:false,destroy:function(q){if(this.game===null||this.destroyPhase){return}if(typeof q==="undefined"){q=true}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof g.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}var p=this.children.length;if(q){while(p--){this.children[p].destroy(q)}}else{while(p--){this.removeChild(this.children[p])}}if(this._crop){this._crop=null}if(this._frame){this._frame=null}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.renderable=false;this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this.destroyPhase=false}};g.Events=function(p){this.parent=p};g.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};g.Events.prototype.constructor=g.Events;for(var e in g.Events.prototype){if(!g.Events.prototype.hasOwnProperty(e)||e.indexOf("on")!==0||g.Events.prototype[e]!==null){continue}(function(q,p){Object.defineProperty(g.Events.prototype,q,{get:function(){return this[p]||(this[p]=new g.Signal())}});g.Events.prototype[q+"$dispatch"]=function(){return this[p]?this[p].dispatch.apply(this[p],arguments):null}})(e,"_"+e)}g.Component.FixedToCamera=function(){};g.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};g.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(p){if(p){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new g.Point()};g.Component.Health=function(){};g.Component.Health.prototype={health:1,damage:function(p){if(this.alive){this.health-=p;if(this.health<=0){this.kill()}}return this}};g.Component.InCamera=function(){};g.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.InputEnabled=function(){};g.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return(this.input&&this.input.enabled)},set:function(p){if(p){if(this.input===null){this.input=new g.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};g.Component.InWorld=function(){};g.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else{if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}}return true};g.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};g.Component.LifeSpan=function(){};g.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};g.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(p){if(typeof p==="undefined"){p=1}this.alive=true;this.exists=true;this.visible=true;if(typeof this.health==="number"){this.health=p}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};g.Component.LoadTexture=function(){};g.Component.LoadTexture.prototype={_frame:null,loadTexture:function(s,u,q){u=u||0;if((q||typeof q==="undefined")&&this.animations){this.animations.stop()}this.key=s;var p=true;var r=!this.texture.baseTexture.scaleMode;var t=false;if(g.RenderTexture&&s instanceof g.RenderTexture){this.key=s.key;this.setTexture(s);t=true}else{if(g.BitmapData&&s instanceof g.BitmapData){this.setTexture(s.texture);if(this.game.cache.getFrameData(s.key,g.Cache.BITMAPDATA)){p=!this.animations.loadFrameData(this.game.cache.getFrameData(s.key,g.Cache.BITMAPDATA),u)}}else{if(s instanceof PIXI.Texture){this.setTexture(s)}else{if(s===null||typeof s==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key])}else{if(typeof s==="string"&&!this.game.cache.checkImageKey(s)){console.warn("Texture with key '"+s+"' not found.");this.key="__missing";this.setTexture(PIXI.TextureCache[this.key])}else{this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[s]));p=!this.animations.loadFrameData(this.game.cache.getFrameData(s),u)}}}}}if(!t){this.texture.baseTexture.dirty()}if(p){this._frame=g.Rectangle.clone(this.texture.frame)}if(!r){this.texture.baseTexture.scaleMode=1}},setFrame:function(p){this._frame=p;this.texture.frame.x=p.x;this.texture.frame.y=p.y;this.texture.frame.width=p.width;this.texture.frame.height=p.height;this.texture.crop.x=p.x;this.texture.crop.y=p.y;this.texture.crop.width=p.width;this.texture.crop.height=p.height;if(p.trimmed){if(this.texture.trim){this.texture.trim.x=p.spriteSourceSizeX;this.texture.trim.y=p.spriteSourceSizeY;this.texture.trim.width=p.sourceSizeW;this.texture.trim.height=p.sourceSizeH}else{this.texture.trim={x:p.spriteSourceSizeX,y:p.spriteSourceSizeY,width:p.sourceSizeW,height:p.sourceSizeH}}this.texture.width=p.sourceSizeW;this.texture.height=p.sourceSizeH;this.texture.frame.width=p.sourceSizeW;this.texture.frame.height=p.sourceSizeH}else{if(!p.trimmed&&this.texture.trim){this.texture.trim=null}}if(this.cropRect){this.updateCrop()}if(this.tint!==16777215){this.cachedTint=-1}this.texture._updateUvs()},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(p){this.animations.frame=p}},frameName:{get:function(){return this.animations.frameName},set:function(p){this.animations.frameName=p}}};g.Component.Overlap=function(){};g.Component.Overlap.prototype={overlap:function(p){return g.Rectangle.intersects(this.getBounds(),p.getBounds())}};g.Component.PhysicsBody=function(){};g.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};g.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};g.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(p){this.position.x=p;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(p){this.position.y=p;if(this.body&&!this.body.dirty){this.body._reset=true}}}};g.Component.Reset=function(){};g.Component.Reset.prototype.reset=function(p,r,q){if(typeof q==="undefined"){q=1}this.world.set(p,r);this.position.set(p,r);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=q}if(this.components.PhysicsBody){if(this.body){this.body.reset(p,r,false,false)}}return this};g.Component.ScaleMinMax=function(){};g.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(p){if(this.scaleMin){if(p.a<this.scaleMin.x){p.a=this.scaleMin.x}if(p.d<this.scaleMin.y){p.d=this.scaleMin.y}}if(this.scaleMax){if(p.a>this.scaleMax.x){p.a=this.scaleMax.x}if(p.d>this.scaleMax.y){p.d=this.scaleMax.y}}},setScaleMinMax:function(p,s,r,q){if(typeof s==="undefined"){s=r=q=p}else{if(typeof r==="undefined"){r=q=s;s=p}}if(p===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(p,s)}else{this.scaleMin=new g.Point(p,s)}}if(r===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(r,q)}else{this.scaleMax=new g.Point(r,q)}}}};g.Component.Smoothed=function(){};g.Component.Smoothed.prototype={smoothed:{get:function(){return !this.texture.baseTexture.scaleMode},set:function(p){if(p){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};g.GameObjectFactory=function(p){this.game=p;this.world=this.game.world};g.GameObjectFactory.prototype={existing:function(p){return this.world.add(p)},image:function(p,t,q,s,r){if(typeof r==="undefined"){r=this.world}return r.add(new g.Image(this.game,p,t,q,s))},sprite:function(p,t,q,s,r){if(typeof r==="undefined"){r=this.world}return r.create(p,t,q,s)},tween:function(p){return this.game.tweens.create(p)},group:function(s,q,p,t,r){return new g.Group(this.game,s,q,p,t,r)},physicsGroup:function(s,r,q,p){return new g.Group(this.game,r,q,p,true,s)},spriteBatch:function(r,q,p){if(typeof r==="undefined"){r=null}if(typeof q==="undefined"){q="group"}if(typeof p==="undefined"){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},tileSprite:function(q,v,s,p,r,u,t){if(typeof t==="undefined"){t=this.world}return t.add(new g.TileSprite(this.game,q,v,s,p,r,u))},rope:function(p,u,q,t,r,s){if(typeof s==="undefined"){s=this.world}return s.add(new g.Rope(this.game,p,u,q,t,r))},text:function(p,t,s,q,r){if(typeof r==="undefined"){r=this.world}return r.add(new g.Text(this.game,p,t,s,q))},button:function(v,u,z,A,q,r,p,s,t,w){if(typeof w==="undefined"){w=this.world}return w.add(new g.Button(this.game,v,u,z,A,q,r,p,s,t))},graphics:function(p,r,q){if(typeof q==="undefined"){q=this.world}return q.add(new g.Graphics(this.game,p,r))},emitter:function(p,r,q){return this.game.particles.add(new g.Particles.Arcade.Emitter(this.game,p,r,q))},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,u,q,t,r,s){if(typeof s==="undefined"){s=this.world}return s.add(new g.BitmapText(this.game,p,u,q,t,r))},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}if(typeof p==="undefined"){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},bitmapData:function(s,q,r,p){if(typeof p==="undefined"){p=false}if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.splice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q},plugin:function(p){return this.game.plugins.add(p)}};g.GameObjectFactory.prototype.constructor=g.GameObjectFactory;g.GameObjectCreator=function(p){this.game=p;this.world=this.game.world};g.GameObjectCreator.prototype={image:function(p,s,q,r){return new g.Image(this.game,p,s,q,r)},sprite:function(p,s,q,r){return new g.Sprite(this.game,p,s,q,r)},tween:function(p){return new g.Tween(p,this.game,this.game.tweens)},group:function(s,q,p,t,r){return new g.Group(this.game,null,q,p,t,r)},spriteBatch:function(r,q,p){if(typeof q==="undefined"){q="group"}if(typeof p==="undefined"){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},tileSprite:function(q,u,s,p,r,t){return new g.TileSprite(this.game,q,u,s,p,r,t)},rope:function(p,t,q,s,r){return new g.Rope(this.game,p,t,q,s,r)},text:function(p,s,r,q){return new g.Text(this.game,p,s,r,q)},button:function(v,u,w,z,q,r,p,s,t){return new g.Button(this.game,v,u,w,z,q,r,p,s,t)},graphics:function(p,q){return new g.Graphics(this.game,p,q)},emitter:function(p,r,q){return new g.Particles.Arcade.Emitter(this.game,p,r,q)},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,t,q,s,r){return new g.BitmapText(this.game,p,t,q,s,r)},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}if(typeof p==="undefined"){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},bitmapData:function(s,q,r,p){if(typeof p==="undefined"){p=false}if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.splice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q}};g.GameObjectCreator.prototype.constructor=g.GameObjectCreator;g.Sprite=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.SPRITE;this.physicsType=g.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,p,t,r,s)};g.Sprite.prototype=Object.create(PIXI.Sprite.prototype);g.Sprite.prototype.constructor=g.Sprite;g.Component.Core.install.call(g.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Sprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Sprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Sprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Sprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Image=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.IMAGE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,p,t,r,s)};g.Image.prototype=Object.create(PIXI.Sprite.prototype);g.Image.prototype.constructor=g.Image;g.Component.Core.install.call(g.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]);g.Image.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Image.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.TileSprite=function(r,q,v,t,p,s,u){q=q||0;v=v||0;t=t||256;p=p||256;s=s||null;u=u||null;this.type=g.TILESPRITE;this._scroll=new g.Point();PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,t,p);g.Component.Core.init.call(this,r,q,v,s,u)};g.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);g.TileSprite.prototype.constructor=g.TileSprite;g.Component.Core.install.call(g.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);g.TileSprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.TileSprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.TileSprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.TileSprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.TileSprite.prototype.autoScroll=function(p,q){this._scroll.set(p,q)};g.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};g.TileSprite.prototype.destroy=function(p){g.Component.Destroy.prototype.destroy.call(this,p);PIXI.TilingSprite.prototype.destroy.call(this)};g.TileSprite.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);this.tilePosition.x=0;this.tilePosition.y=0;return this};g.Rope=function(q,p,u,r,t,s){this.points=[];this.points=s;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;p=p||0;u=u||0;r=r||null;t=t||null;this.type=g.ROPE;this._scroll=new g.Point();PIXI.Rope.call(this,r,this.points);g.Component.Core.init.call(this,q,p,u,r,t)};g.Rope.prototype=Object.create(PIXI.Rope.prototype);g.Rope.prototype.constructor=g.Rope;g.Component.Core.install.call(g.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Rope.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Rope.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Rope.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Rope.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Rope.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};g.Rope.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);this.tilePosition.x=0;this.tilePosition.y=0;return this};Object.defineProperty(g.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(p){if(p&&typeof p==="function"){this._hasUpdateAnimation=true;this._updateAnimation=p}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(g.Rope.prototype,"segments",{get:function(){var t=[];var u,r,x,p,w,q,y,v;for(var s=0;s<this.points.length;s++){u=s*4;r=this.verticies[u];x=this.verticies[u+1];p=this.verticies[u+4];w=this.verticies[u+3];q=g.Math.difference(r,p);y=g.Math.difference(x,w);r+=this.world.x;x+=this.world.y;v=new g.Rectangle(r,x,q,y);t.push(v)}return t}});g.Button=function(A,v,u,w,z,q,r,p,s,t){v=v||0;u=u||0;w=w||null;z=z||null;q=q||this;g.Image.call(this,A,v,u,w,p);this.type=g.BUTTON;this.physicsType=g.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new g.Signal();this.onInputOut=new g.Signal();this.onInputDown=new g.Signal();this.onInputUp=new g.Signal();this.onOverMouseOnly=false;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.setFrames(r,p,s,t);if(z!==null){this.onInputUp.add(z,q)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};g.Button.prototype=Object.create(g.Image.prototype);g.Button.prototype.constructor=g.Button;var n="Over";var a="Out";var d="Down";var k="Up";g.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};g.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};g.Button.prototype.setStateFrame=function(r,s,q){var p="_on"+r+"Frame";if(s!=null){this[p]=s;if(q){this.changeStateFrame(r)}}else{this[p]=null}};g.Button.prototype.changeStateFrame=function(q){if(this.freezeFrames){return false}var p="_on"+q+"Frame";var r=this[p];if(typeof r==="string"){this.frameName=r;return true}else{if(typeof r==="number"){this.frame=r;return true}else{return false}}};g.Button.prototype.setFrames=function(q,s,p,r){this.setStateFrame(n,q,this.input.pointerOver());this.setStateFrame(a,s,!this.input.pointerOver());this.setStateFrame(d,p,this.input.pointerDown());this.setStateFrame(k,r,this.input.pointerUp())};g.Button.prototype.setStateSound=function(r,s,p){var t="on"+r+"Sound";var q="on"+r+"SoundMarker";if(s instanceof g.Sound||s instanceof g.AudioSprite){this[t]=s;this[q]=typeof p==="string"?p:""}else{this[t]=null;this[q]=""}};g.Button.prototype.playStateSound=function(r){var t="on"+r+"Sound";var s=this[t];if(s){var q="on"+r+"SoundMarker";var p=this[q];s.play(p);return true}else{return false}};g.Button.prototype.setSounds=function(q,u,p,t,s,w,r,v){this.setStateSound(n,q,u);this.setStateSound(a,s,w);this.setStateSound(d,p,t);this.setStateSound(k,r,v)};g.Button.prototype.setOverSound=function(q,p){this.setStateSound(n,q,p)};g.Button.prototype.setOutSound=function(q,p){this.setStateSound(a,q,p)};g.Button.prototype.setDownSound=function(q,p){this.setStateSound(d,q,p)};g.Button.prototype.setUpSound=function(q,p){this.setStateSound(k,q,p)};g.Button.prototype.onInputOverHandler=function(p,q){if(q.justReleased()){return}this.changeStateFrame(n);if(this.onOverMouseOnly&&!q.isMouse){return}this.playStateSound(n);if(this.onInputOver){this.onInputOver.dispatch(this,q)}};g.Button.prototype.onInputOutHandler=function(p,q){this.changeStateFrame(a);this.playStateSound(a);if(this.onInputOut){this.onInputOut.dispatch(this,q)}};g.Button.prototype.onInputDownHandler=function(p,q){this.changeStateFrame(d);this.playStateSound(d);if(this.onInputDown){this.onInputDown.dispatch(this,q)}};g.Button.prototype.onInputUpHandler=function(p,s,r){this.playStateSound(k);if(this.onInputUp){this.onInputUp.dispatch(this,s,r)}if(this.freezeFrames){return}if(this.forceOut){this.changeStateFrame(a)}else{var q=this.changeStateFrame(k);if(!q){if(r){this.changeStateFrame(n)}else{this.changeStateFrame(a)}}}};g.SpriteBatch=function(q,s,r,p){if(typeof s==="undefined"||s===null){s=q.world}PIXI.SpriteBatch.call(this);g.Group.call(this,q,s,r,p);this.type=g.SPRITEBATCH};g.SpriteBatch.prototype=g.Utils.extend(true,g.SpriteBatch.prototype,g.Group.prototype,PIXI.SpriteBatch.prototype);g.SpriteBatch.prototype.constructor=g.SpriteBatch;g.Particle=function(q,p,t,r,s){g.Sprite.call(this,q,p,t,r,s);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};g.Particle.prototype=Object.create(g.Sprite.prototype);g.Particle.prototype.constructor=g.Particle;g.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};g.Particle.prototype.onEmit=function(){};g.Particle.prototype.setAlphaData=function(p){this.alphaData=p;this._a=p.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};g.Particle.prototype.setScaleData=function(p){this.scaleData=p;this._s=p.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};g.Particle.prototype.reset=function(p,r,q){g.Component.Reset.prototype.reset.call(this,p,r,q);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};g.BitmapData=function(q,r,s,p){if(typeof s==="undefined"){s=256}if(typeof p==="undefined"){p=256}this.game=q;this.key=r;this.width=s;this.height=p;this.canvas=g.Canvas.create(s,p,"",true);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.imageData=this.context.getImageData(0,0,s,p);this.data=this.imageData.data;this.pixels=null;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new g.Frame(0,0,0,s,p,"bitmapData",q.rnd.uuid());this.texture.frame=this.textureFrame;this.type=g.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new g.Point();this._size=new g.Point();this._scale=new g.Point();this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new g.Point();this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new g.Circle()};g.BitmapData.prototype={add:function(p){if(Array.isArray(p)){for(var q=0;q<p.length;q++){if(p[q]["loadTexture"]){p[q].loadTexture(this)}}}else{p.loadTexture(this)}return this},load:function(p){if(typeof p==="string"){p=this.game.cache.getImage(p)}if(p){this.resize(p.width,p.height);this.cls()}else{return}this.draw(p);this.update();return this},clear:function(){this.context.clearRect(0,0,this.width,this.height);this.dirty=true;return this},fill:function(t,s,p,q){if(typeof q==="undefined"){q=1}this.context.fillStyle="rgba("+t+","+s+","+p+","+q+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},resize:function(q,p){if(q!==this.width||p!==this.height){this.width=q;this.height=p;this.canvas.width=q;this.canvas.height=p;this.baseTexture.width=q;this.baseTexture.height=p;this.textureFrame.width=q;this.textureFrame.height=p;this.texture.width=q;this.texture.height=p;this.texture.crop.width=q;this.texture.crop.height=p;this.update();this.dirty=true}return this},update:function(q,s,r,p){if(typeof q==="undefined"){q=0}if(typeof s==="undefined"){s=0}if(typeof r==="undefined"){r=this.width}if(typeof p==="undefined"){p=this.height}this.imageData=this.context.getImageData(q,s,r,p);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(C,s,A,z,r,D){if(typeof A==="undefined"){A=0}if(typeof z==="undefined"){z=0}if(typeof r==="undefined"){r=this.width}if(typeof D==="undefined"){D=this.height}var B=A+r;var v=z+D;var q=g.Color.createColor();var E={r:0,g:0,b:0,a:0};var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){g.Color.unpackPixel(this.getPixel32(u,t),q);E=C.call(s,q,u,t);if(E!==false&&E!==null&&E!==undefined){this.setPixel32(u,t,E.r,E.g,E.b,E.a,false);p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(C,s,A,z,r,D){if(typeof A==="undefined"){A=0}if(typeof z==="undefined"){z=0}if(typeof r==="undefined"){r=this.width}if(typeof D==="undefined"){D=this.height}var B=A+r;var v=z+D;var q=0;var E=0;var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){q=this.getPixel32(u,t);E=C.call(s,q,u,t);if(E!==q){this.pixels[t*this.width+u]=E;p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(u,q,F,s,t,H,C,r,B){var E=0;var A=0;var G=this.width;var v=this.height;var p=g.Color.packPixel(u,q,F,s);if(B!==undefined&&B instanceof g.Rectangle){E=B.x;A=B.y;G=B.width;v=B.height}for(var z=0;z<v;z++){for(var D=0;D<G;D++){if(this.getPixel32(E+D,A+z)===p){this.setPixel32(E+D,A+z,t,H,C,r,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(u,t,q,v){if(typeof u==="undefined"||u===null){u=false}if(typeof t==="undefined"||t===null){t=false}if(typeof q==="undefined"||q===null){q=false}if(!u&&!t&&!q){return}if(typeof v==="undefined"){v=new g.Rectangle(0,0,this.width,this.height)}var r=g.Color.createColor();for(var w=v.y;w<v.bottom;w++){for(var p=v.x;p<v.right;p++){g.Color.unpackPixel(this.getPixel32(p,w),r,true);if(u){r.h=u}if(t){r.s=t}if(q){r.l=q}g.Color.HSLtoRGB(r.h,r.s,r.l,r);this.setPixel32(p,w,r.r,r.g,r.b,r.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(u,t,q,v){if(typeof u==="undefined"||u===null){u=false}if(typeof t==="undefined"||t===null){t=false}if(typeof q==="undefined"||q===null){q=false}if(!u&&!t&&!q){return}if(typeof v==="undefined"){v=new g.Rectangle(0,0,this.width,this.height)}var r=g.Color.createColor();for(var w=v.y;w<v.bottom;w++){for(var p=v.x;p<v.right;p++){g.Color.unpackPixel(this.getPixel32(p,w),r,true);if(u){r.h=this.game.math.wrap(r.h+u,0,1)}if(t){r.s=this.game.math.limitValue(r.s+t,0,1)}if(q){r.l=this.game.math.limitValue(r.l+q,0,1)}g.Color.HSLtoRGB(r.h,r.s,r.l,r);this.setPixel32(p,w,r.r,r.g,r.b,r.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(q,v,u,s,p,t,r){if(typeof r==="undefined"){r=true}if(q>=0&&q<=this.width&&v>=0&&v<=this.height){if(g.Device.LITTLE_ENDIAN){this.pixels[v*this.width+q]=(t<<24)|(p<<16)|(s<<8)|u}else{this.pixels[v*this.width+q]=(u<<24)|(s<<16)|(p<<8)|t}if(r){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(q,u,t,s,p,r){return this.setPixel32(q,u,t,s,p,255,r)},getPixel:function(p,s,r){if(!r){r=g.Color.createColor()}var q=~~(p+(s*this.width));q*=4;r.r=this.data[q];r.g=this.data[++q];r.b=this.data[++q];r.a=this.data[++q];return r},getPixel32:function(p,q){if(p>=0&&p<=this.width&&q>=0&&q<=this.height){return this.pixels[q*this.width+p]}},getPixelRGB:function(p,t,s,q,r){return g.Color.unpackPixel(this.getPixel32(p,t),s,q,r)},getPixels:function(p){return this.context.getImageData(p.x,p.y,p.width,p.height)},getFirstPixel:function(t){if(typeof t==="undefined"){t=0}var s=g.Color.createColor();var p=0;var u=0;var r=1;var q=false;if(t===1){r=-1;u=this.height}else{if(t===3){r=-1;p=this.width}}do{g.Color.unpackPixel(this.getPixel32(p,u),s);if(t===0||t===1){p++;if(p===this.width){p=0;u+=r;if(u>=this.height||u<=0){q=true}}}else{if(t===2||t===3){u++;if(u===this.height){u=0;p+=r;if(p>=this.width||p<=0){q=true}}}}}while(s.a===0&&!q);s.x=p;s.y=u;return s},getBounds:function(p){if(typeof p==="undefined"){p=new g.Rectangle()}p.x=this.getFirstPixel(2).x;if(p.x===this.width){return p.setTo(0,0,0,0)}p.y=this.getFirstPixel(0).y;p.width=(this.getFirstPixel(3).x-p.x)+1;p.height=(this.getFirstPixel(1).y-p.y)+1;return p},addToWorld:function(q,v,p,u,s,r){s=s||1;r=r||1;var t=this.game.add.image(q,v,this);t.anchor.set(p,u);t.scale.set(s,r);return t},copy:function(q,E,D,r,H,A,w,z,p,v,t,s,G,F,u,C,B){if(typeof q==="undefined"||q===null){q=this}this._image=q;if(q instanceof g.Sprite||q instanceof g.Image||q instanceof g.Text){this._pos.set(q.texture.crop.x,q.texture.crop.y);this._size.set(q.texture.crop.width,q.texture.crop.height);this._scale.set(q.scale.x,q.scale.y);this._anchor.set(q.anchor.x,q.anchor.y);this._rotate=q.rotation;this._alpha.current=q.alpha;this._image=q.texture.baseTexture.source;if(typeof A==="undefined"||A===null){A=q.x}if(typeof w==="undefined"||w===null){w=q.y}if(q.texture.trim){A+=q.texture.trim.x-q.anchor.x*q.texture.trim.width;w+=q.texture.trim.y-q.anchor.y*q.texture.trim.height}if(q.tint!==16777215){if(q.cachedTint!==q.tint){q.cachedTint=q.tint;q.tintedTexture=PIXI.CanvasTinter.getTintedTexture(q,q.tint)}this._image=q.tintedTexture}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(q instanceof g.BitmapData){this._image=q.canvas}else{if(typeof q==="string"){q=this.game.cache.getImage(q);if(q===null){return}else{this._image=q}}}this._size.set(this._image.width,this._image.height)}if(typeof E==="undefined"||E===null){E=0}if(typeof D==="undefined"||D===null){D=0}if(r){this._size.x=r}if(H){this._size.y=H}if(typeof A==="undefined"||A===null){A=E}if(typeof w==="undefined"||w===null){w=D}if(typeof z==="undefined"||z===null){z=this._size.x}if(typeof p==="undefined"||p===null){p=this._size.y}if(typeof v==="number"){this._rotate=v}if(typeof t==="number"){this._anchor.x=t}if(typeof s==="number"){this._anchor.y=s}if(typeof G==="number"){this._scale.x=G}if(typeof F==="number"){this._scale.y=F}if(typeof u==="number"){this._alpha.current=u}if(typeof C==="undefined"){C=null}if(typeof B==="undefined"){B=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}this._alpha.prev=this.context.globalAlpha;this.context.save();this.context.globalAlpha=this._alpha.current;if(C){this.context.globalCompositeOperation=C}if(B){A|=0;w|=0}this.context.translate(A,w);this.context.scale(this._scale.x,this._scale.y);this.context.rotate(this._rotate);this.context.drawImage(this._image,this._pos.x+E,this._pos.y+D,this._size.x,this._size.y,-z*this._anchor.x,-p*this._anchor.y,z,p);this.context.restore();this.context.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,s,p,v,u,r,q){return this.copy(t,s.x,s.y,s.width,s.height,p,v,s.width,s.height,0,0,0,1,1,u,r,q)},draw:function(u,q,v,t,p,s,r){return this.copy(u,null,null,null,null,q,v,t,p,null,null,null,null,null,null,s,r)},drawGroup:function(r,q,p){if(r.total>0){r.forEachExists(this.copy,this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,q,p)}return this},shadow:function(q,r,p,s){if(typeof q==="undefined"||q===null){this.context.shadowColor="rgba(0,0,0,0)"}else{this.context.shadowColor=q;this.context.shadowBlur=r||5;this.context.shadowOffsetX=p||10;this.context.shadowOffsetY=s||10}},alphaMask:function(s,p,q,r){if(typeof r==="undefined"||r===null){this.draw(p).blendSourceAtop()}else{this.draw(p,r.x,r.y,r.width,r.height).blendSourceAtop()}if(typeof q==="undefined"||q===null){this.draw(s).blendReset()}else{this.draw(s,q.x,q.y,q.width,q.height).blendReset()}return this},extract:function(v,p,t,w,x,q,s,y,u){if(typeof x==="undefined"){x=255}if(typeof q==="undefined"){q=false}if(typeof s==="undefined"){s=p}if(typeof y==="undefined"){y=t}if(typeof u==="undefined"){u=w}if(q){v.resize(this.width,this.height)}this.processPixelRGB(function(z,r,A){if(z.r===p&&z.g===t&&z.b===w){v.setPixel32(r,A,s,y,u,x,false)}return false},this);v.context.putImageData(v.imageData,0,0);v.dirty=true;return v},rect:function(q,t,s,p,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.fillRect(q,t,s,p);return this},text:function(t,p,v,r,q,u){if(typeof p==="undefined"){p=0}if(typeof v==="undefined"){v=0}if(typeof r==="undefined"){r="14px Courier"}if(typeof q==="undefined"){q="rgb(255,255,255)"}if(typeof u==="undefined"){u=true}var s=this.context.font;this.context.font=r;if(u){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,p+1,v+1)}this.context.fillStyle=q;this.context.fillText(t,p,v);this.context.font=s},circle:function(q,s,p,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.beginPath();this.context.arc(q,s,p,0,Math.PI*2,false);this.context.closePath();this.context.fill();return this},textureLine:function(p,s,r){if(typeof r==="undefined"){r="repeat-x"}if(typeof s==="string"){s=this.game.cache.getImage(s);if(!s){return}}var q=p.length;if(r==="no-repeat"&&q>s.width){q=s.width}this.context.fillStyle=this.context.createPattern(s,r);this._circle=new g.Circle(p.start.x,p.start.y,s.height);this._circle.circumferencePoint(p.angle-1.5707963267948966,false,this._pos);this.context.save();this.context.translate(this._pos.x,this._pos.y);this.context.rotate(p.angle);this.context.fillRect(0,0,q,s.height);this.context.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},blendReset:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceOver:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceIn:function(){this.context.globalCompositeOperation="source-in";return this},blendSourceOut:function(){this.context.globalCompositeOperation="source-out";return this},blendSourceAtop:function(){this.context.globalCompositeOperation="source-atop";return this},blendDestinationOver:function(){this.context.globalCompositeOperation="destination-over";return this},blendDestinationIn:function(){this.context.globalCompositeOperation="destination-in";return this},blendDestinationOut:function(){this.context.globalCompositeOperation="destination-out";return this},blendDestinationAtop:function(){this.context.globalCompositeOperation="destination-atop";return this},blendXor:function(){this.context.globalCompositeOperation="xor";return this},blendAdd:function(){this.context.globalCompositeOperation="lighter";return this},blendMultiply:function(){this.context.globalCompositeOperation="multiply";return this},blendScreen:function(){this.context.globalCompositeOperation="screen";return this},blendOverlay:function(){this.context.globalCompositeOperation="overlay";return this},blendDarken:function(){this.context.globalCompositeOperation="darken";return this},blendLighten:function(){this.context.globalCompositeOperation="lighten";return this},blendColorDodge:function(){this.context.globalCompositeOperation="color-dodge";return this},blendColorBurn:function(){this.context.globalCompositeOperation="color-burn";return this},blendHardLight:function(){this.context.globalCompositeOperation="hard-light";return this},blendSoftLight:function(){this.context.globalCompositeOperation="soft-light";return this},blendDifference:function(){this.context.globalCompositeOperation="difference";return this},blendExclusion:function(){this.context.globalCompositeOperation="exclusion";return this},blendHue:function(){this.context.globalCompositeOperation="hue";return this},blendSaturation:function(){this.context.globalCompositeOperation="saturation";return this},blendColor:function(){this.context.globalCompositeOperation="color";return this},blendLuminosity:function(){this.context.globalCompositeOperation="luminosity";return this}};Object.defineProperty(g.BitmapData.prototype,"smoothed",{get:function(){g.Canvas.getSmoothingEnabled(this.context)},set:function(p){g.Canvas.setSmoothingEnabled(this.context,p)}});g.BitmapData.getTransform=function(u,t,r,p,s,q){if(typeof u!=="number"){u=0}if(typeof t!=="number"){t=0}if(typeof r!=="number"){r=1}if(typeof p!=="number"){p=1}if(typeof s!=="number"){s=0}if(typeof q!=="number"){q=0}return{sx:r,sy:p,scaleX:r,scaleY:p,skewX:s,skewY:q,translateX:u,translateY:t,tx:u,ty:t}};g.BitmapData.prototype.constructor=g.BitmapData;g.Graphics=function(q,p,r){p=p||0;r=r||0;this.type=g.GRAPHICS;this.physicsType=g.SPRITE;PIXI.Graphics.call(this);g.Component.Core.init.call(this,q,p,r,"",null)};g.Graphics.prototype=Object.create(PIXI.Graphics.prototype);g.Graphics.prototype.constructor=g.Graphics;g.Component.Core.install.call(g.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.Graphics.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Graphics.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Graphics.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Graphics.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Graphics.prototype.destroy=function(p){this.clear();g.Component.Destroy.prototype.destroy.call(this,p)};g.Graphics.prototype.drawTriangle=function(r,q){if(typeof q==="undefined"){q=false}var v=new g.Polygon(r);if(q){var t=new g.Point(this.game.camera.x-r[0].x,this.game.camera.y-r[0].y);var s=new g.Point(r[1].x-r[0].x,r[1].y-r[0].y);var p=new g.Point(r[1].x-r[2].x,r[1].y-r[2].y);var u=p.cross(s);if(t.dot(u)>0){this.drawPolygon(v)}}else{this.drawPolygon(v)}};g.Graphics.prototype.drawTriangles=function(r,w,p){if(typeof p==="undefined"){p=false}var v=new g.Point();var t=new g.Point();var q=new g.Point();var u=[];var s;if(!w){if(r[0] instanceof g.Point){for(s=0;s<r.length/3;s++){this.drawTriangle([r[s*3],r[s*3+1],r[s*3+2]],p)}}else{for(s=0;s<r.length/6;s++){v.x=r[s*6+0];v.y=r[s*6+1];t.x=r[s*6+2];t.y=r[s*6+3];q.x=r[s*6+4];q.y=r[s*6+5];this.drawTriangle([v,t,q],p)}}}else{if(r[0] instanceof g.Point){for(s=0;s<w.length/3;s++){u.push(r[w[s*3]]);u.push(r[w[s*3+1]]);u.push(r[w[s*3+2]]);if(u.length===3){this.drawTriangle(u,p);u=[]}}}else{for(s=0;s<w.length;s++){v.x=r[w[s]*2];v.y=r[w[s]*2+1];u.push(v.copyTo({}));if(u.length===3){this.drawTriangle(u,p);u=[]}}}}};g.RenderTexture=function(q,u,p,s,t,r){if(typeof s==="undefined"){s=""}if(typeof t==="undefined"){t=g.scaleModes.DEFAULT}if(typeof r==="undefined"){r=1}this.game=q;this.key=s;this.type=g.RENDERTEXTURE;this.matrix=new PIXI.Matrix();PIXI.RenderTexture.call(this,u,p,this.game.renderer,t,r);this.render=g.RenderTexture.prototype.render};g.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);g.RenderTexture.prototype.constructor=g.RenderTexture;g.RenderTexture.prototype.renderXY=function(r,q,s,p){this.matrix.tx=q;this.matrix.ty=s;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this.matrix,p)}else{this.renderCanvas(r,this.matrix,p)}};g.RenderTexture.prototype.render=function(r,q,p){this.matrix.tx=q.x;this.matrix.ty=q.y;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this.matrix,p)}else{this.renderCanvas(r,this.matrix,p)}};g.Text=function(q,p,t,s,r){p=p||0;t=t||0;s=s||" ";r=r||{};if(s.length===0){s=" "}else{s=s.toString()}this.type=g.TEXT;this.physicsType=g.SPRITE;this.padding=new g.Point();this._text=s;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this.colors=[];this.setStyle(r);PIXI.Text.call(this,s,this.style);g.Component.Core.init.call(this,q,p,t,"",null);if(s!==" "){this.updateText()}};g.Text.prototype=Object.create(PIXI.Text.prototype);g.Text.prototype.constructor=g.Text;g.Component.Core.install.call(g.Text.prototype,["Angle","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","Overlap","PhysicsBody","Reset","Smoothed"]);g.Text.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Text.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Text.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Text.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Text.prototype.update=function(){};g.Text.prototype.destroy=function(p){this.texture.destroy(true);if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}g.Component.Destroy.prototype.destroy.call(this,p)};g.Text.prototype.setShadow=function(p,s,q,r){if(typeof p==="undefined"){p=0}if(typeof s==="undefined"){s=0}if(typeof q==="undefined"){q="rgba(0, 0, 0, 1)"}if(typeof r==="undefined"){r=0}this.style.shadowOffsetX=p;this.style.shadowOffsetY=s;this.style.shadowColor=q;this.style.shadowBlur=r;this.dirty=true};g.Text.prototype.setStyle=function(p){p=p||{};p.font=p.font||"bold 20pt Arial";p.backgroundColor=p.backgroundColor||null;p.fill=p.fill||"black";p.align=p.align||"left";p.stroke=p.stroke||"black";p.strokeThickness=p.strokeThickness||0;p.wordWrap=p.wordWrap||false;p.wordWrapWidth=p.wordWrapWidth||100;p.shadowOffsetX=p.shadowOffsetX||0;p.shadowOffsetY=p.shadowOffsetY||0;p.shadowColor=p.shadowColor||"rgba(0,0,0,0)";p.shadowBlur=p.shadowBlur||0;var q=this.fontToComponents(p.font);if(p.fontStyle){q.fontStyle=p.fontStyle}if(p.fontVariant){q.fontVariant=p.fontVariant}if(p.fontWeight){q.fontWeight=p.fontWeight}if(p.fontSize){if(typeof p.fontSize==="number"){p.fontSize=p.fontSize+"px"}q.fontSize=p.fontSize}this._fontComponents=q;p.font=this.componentsToFont(this._fontComponents);this.style=p;this.dirty=true};g.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var u=this.text;if(this.style.wordWrap){u=this.runWordWrap(this.text)}var B=u.split(/(?:\r\n|\r|\n)/);var t=[];var C=0;var q=this.determineFontProperties(this.style.font);for(var v=0;v<B.length;v++){var w=this.context.measureText(B[v]).width+this.padding.x;t[v]=w;C=Math.max(C,w)}var r=C+this.style.strokeThickness;this.canvas.width=r*this.resolution;var z=q.fontSize+this.style.strokeThickness+this.padding.y;var A=z*B.length;var x=this._lineSpacing;if(x<0&&Math.abs(x)>z){x=-z}if(x!==0){var y=x*(B.length-1);A+=y}this.canvas.height=A*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var s;var p;this._charCount=0;for(v=0;v<B.length;v++){s=this.style.strokeThickness/2;p=(this.style.strokeThickness/2+v*z)+q.ascent;if(v>0){p+=(x*v)}if(this.style.align==="right"){s+=C-t[v]}else{if(this.style.align==="center"){s+=(C-t[v])/2}}if(this.colors.length>0){this.updateLine(B[v],s,p)}else{if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(B[v],s,p)}if(this.style.fill){this.context.fillText(B[v],s,p)}}}this.updateTexture()};g.Text.prototype.updateLine=function(q,p,t){for(var r=0;r<q.length;r++){var s=q[r];if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount];this.context.strokeStyle=this.colors[this._charCount]}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(s,p,t)}if(this.style.fill){this.context.fillText(s,p,t)}p+=this.context.measureText(s).width;this._charCount++}};g.Text.prototype.clearColors=function(){this.colors=[];this.dirty=true};g.Text.prototype.addColor=function(q,p){this.colors[p]=q;this.dirty=true};g.Text.prototype.runWordWrap=function(u){var x="";var w=u.split("\n");for(var r=0;r<w.length;r++){var q=this.style.wordWrapWidth;var t=w[r].split(" ");for(var p=0;p<t.length;p++){var v=this.context.measureText(t[p]).width;var s=v+this.context.measureText(" ").width;if(s>q){if(p>0){x+="\n"}x+=t[p]+" ";q=this.style.wordWrapWidth-v}else{q-=s;x+=t[p]+" "}}if(r<w.length-1){x+="\n"}}return x};g.Text.prototype.updateFont=function(q){var p=this.componentsToFont(q);if(this.style.font!==p){this.style.font=p;this.dirty=true;if(this.parent){this.updateTransform()}}};g.Text.prototype.fontToComponents=function(q){var p=q.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(p){return{font:q,fontStyle:p[1]||"normal",fontVariant:p[2]||"normal",fontWeight:p[3]||"normal",fontSize:p[4]||"medium",fontFamily:p[5]}}else{console.warn("Phaser.Text - unparsable CSS font: "+q);return{font:q}}};g.Text.prototype.componentsToFont=function(q){var r=[];var p;p=q.fontStyle;if(p&&p!=="normal"){r.push(p)}p=q.fontVariant;if(p&&p!=="normal"){r.push(p)}p=q.fontWeight;if(p&&p!=="normal"){r.push(p)}p=q.fontSize;if(p&&p!=="medium"){r.push(p)}p=q.fontFamily;if(p){r.push(p)}if(!r.length){r.push(q.font)}return r.join(" ")};Object.defineProperty(g.Text.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||" ";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(p){p=p||"bold 20pt Arial";this._fontComponents=this.fontToComponents(p);this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(p){p=p||"Arial";p=p.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(p)&&!/['",]/.exec(p)){p="'"+p+"'"}this._fontComponents.fontFamily=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontSize",{get:function(){var p=this._fontComponents.fontSize;if(p&&/(?:^0$|px$)/.exec(p)){return parseInt(p,10)}else{return p}},set:function(p){p=p||"0";if(typeof p==="number"){p=p+"px"}this._fontComponents.fontSize=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontWeight=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontStyle=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontVariant=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(p){if(p!==this.style.fill){this.style.fill=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"align",{get:function(){return this.style.align},set:function(p){if(p!==this.style.align){this.style.align=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(p){if(p!==this.style.stroke){this.style.stroke=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(p){if(p!==this.style.strokeThickness){this.style.strokeThickness=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(p){if(p!==this.style.wordWrap){this.style.wordWrap=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(p){if(p!==this.style.wordWrapWidth){this.style.wordWrapWidth=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(p){if(p!==this._lineSpacing){this._lineSpacing=parseFloat(p);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(p){if(p!==this.style.shadowOffsetX){this.style.shadowOffsetX=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(p){if(p!==this.style.shadowOffsetY){this.style.shadowOffsetY=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(p){if(p!==this.style.shadowColor){this.style.shadowColor=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(p){if(p!==this.style.shadowBlur){this.style.shadowBlur=p;this.dirty=true}}});g.BitmapText=function(r,p,u,q,t,s){p=p||0;u=u||0;q=q||"";t=t||"";s=s||32;this.type=g.BITMAPTEXT;this.physicsType=g.SPRITE;this._text=t;this._font=q;this._fontSize=s;this._align="left";this._tint=16777215;this._tw=0;this._th=0;PIXI.BitmapText.call(this,t);g.Component.Core.init.call(this,r,p,u,"",null)};g.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);g.BitmapText.prototype.constructor=g.BitmapText;g.Component.Core.install.call(g.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.BitmapText.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.BitmapText.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.BitmapText.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.BitmapText.prototype.preUpdateCore=g.Component.Core.preUpdate;g.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.BitmapText.prototype.postUpdate=function(){g.Component.PhysicsBody.postUpdate.call(this);g.Component.FixedToCamera.postUpdate.call(this);if(this.body&&((this.textWidth!==this._tw)||(this.textHeight!==this._th))){this.body.setSize(this.textWidth,this.textHeight);this._tw=this.textWidth;this._th=this.textHeight}};g.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=true};Object.defineProperty(g.BitmapText.prototype,"align",{get:function(){return this._align},set:function(p){if(p!==this._align){this._align=p;this.setStyle()}}});Object.defineProperty(g.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(p){if(p!==this._tint){this._tint=p;this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"font",{get:function(){return this._font},set:function(p){if(p!==this._font){this._font=p.trim();this.fontName=this._font;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(p){p=parseInt(p,10);if(p!==this._fontSize){this._fontSize=p;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||" ";this.dirty=true}}});g.RetroFont=function(F,E,s,x,B,D,C,z,y,w){if(!F.cache.checkImageKey(E)){return false}if(typeof D==="undefined"||D===null){D=F.cache.getImage(E).width/s}this.characterWidth=s;this.characterHeight=x;this.characterSpacingX=C||0;this.characterSpacingY=z||0;this.characterPerRow=D;this.offsetX=y||0;this.offsetY=w||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=F.cache.getImage(E);this._text="";this.grabData=[];this.frameData=new g.FrameData();var v=this.offsetX;var u=this.offsetY;var q=0;for(var A=0;A<B.length;A++){var p=F.rnd.uuid();var t=this.frameData.addFrame(new g.Frame(A,v,u,this.characterWidth,this.characterHeight,"",p));this.grabData[B.charCodeAt(A)]=t.index;PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[E],{x:v,y:u,width:this.characterWidth,height:this.characterHeight});q++;if(q==this.characterPerRow){q=0;v=this.offsetX;u+=this.characterHeight+this.characterSpacingY}else{v+=this.characterWidth+this.characterSpacingX}}F.cache.updateFrameData(E,this.frameData);this.stamp=new g.Image(F,0,0,E,0);g.RenderTexture.call(this,F,100,100,"",g.scaleModes.NEAREST);this.type=g.RETROFONT};g.RetroFont.prototype=Object.create(g.RenderTexture.prototype);g.RetroFont.prototype.constructor=g.RetroFont;g.RetroFont.ALIGN_LEFT="left";g.RetroFont.ALIGN_RIGHT="right";g.RetroFont.ALIGN_CENTER="center";g.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";g.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";g.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";g.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";g.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";g.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";g.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";g.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";g.RetroFont.prototype.setFixedWidth=function(q,p){if(typeof p==="undefined"){p="left"}this.fixedWidth=q;this.align=p};g.RetroFont.prototype.setText=function(s,t,r,u,q,p){this.multiLine=t||false;this.customSpacingX=r||0;this.customSpacingY=u||0;this.align=q||"left";if(p){this.autoUpperCase=false}else{this.autoUpperCase=true}if(s.length>0){this.text=s}};g.RetroFont.prototype.buildRetroFontText=function(){var p=0;var s=0;this.clear();if(this.multiLine){var q=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var r=0;r<q.length;r++){switch(this.align){case g.RetroFont.ALIGN_LEFT:p=0;break;case g.RetroFont.ALIGN_RIGHT:p=this.width-(q[r].length*(this.characterWidth+this.customSpacingX));break;case g.RetroFont.ALIGN_CENTER:p=(this.width/2)-((q[r].length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2;break}if(p<0){p=0}this.pasteLine(q[r],p,s,this.customSpacingX);s+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}switch(this.align){case g.RetroFont.ALIGN_LEFT:p=0;break;case g.RetroFont.ALIGN_RIGHT:p=this.width-(this._text.length*(this.characterWidth+this.customSpacingX));break;case g.RetroFont.ALIGN_CENTER:p=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2;break}this.textureBuffer.clear();this.pasteLine(this._text,p,0,this.customSpacingX)}};g.RetroFont.prototype.pasteLine=function(r,q,v,s){var t=new g.Point();for(var u=0;u<r.length;u++){if(r.charAt(u)==" "){q+=this.characterWidth+s}else{if(this.grabData[r.charCodeAt(u)]>=0){this.stamp.frame=this.grabData[r.charCodeAt(u)];t.set(q,v);this.render(this.stamp,t,false);q+=this.characterWidth+s;if(q>this.width){break}}}}};g.RetroFont.prototype.getLongestLine=function(){var q=0;if(this._text.length>0){var p=this._text.split("\n");for(var r=0;r<p.length;r++){if(p[r].length>q){q=p[r].length}}}return q};g.RetroFont.prototype.removeUnsupportedCharacters=function(s){var q="";for(var t=0;t<this._text.length;t++){var p=this._text[t];var r=p.charCodeAt(0);if(this.grabData[r]>=0||(!s&&p==="\n")){q=q.concat(p)}}return q};g.RetroFont.prototype.updateOffset=function(p,u){if(this.offsetX===p&&this.offsetY===u){return}var r=p-this.offsetX;var q=u-this.offsetY;var t=this.game.cache.getFrameData(this.stamp.key).getFrames();var s=t.length;while(s--){t[s].x+=r;t[s].y+=q;PIXI.TextureCache[t[s].uuid].frame.x=t[s].x;PIXI.TextureCache[t[s].uuid].frame.y=t[s].y}this.buildRetroFontText()};Object.defineProperty(g.RetroFont.prototype,"text",{get:function(){return this._text},set:function(q){var p;if(this.autoUpperCase){p=q.toUpperCase()}else{p=q}if(p!==this._text){this._text=p;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(g.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(p){this.stamp.smoothed=p;this.buildRetroFontText()}});g.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=false;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};g.Device=new g.Device();g.Device.onInitialized=new g.Signal();g.Device.whenReady=function(u,r,q){var s=this._readyCheck;if(this.deviceReadyAt||!s){u.call(r,this)}else{if(s._monitor||q){s._queue=s._queue||[];s._queue.push([u,r])}else{s._monitor=s.bind(this);s._queue=s._queue||[];s._queue.push([u,r]);var t=typeof window.cordova!=="undefined";var p=navigator.isCocoonJS;if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(s._monitor,0)}else{if(t&&!p){document.addEventListener("deviceready",s._monitor,false)}else{document.addEventListener("DOMContentLoaded",s._monitor,false);window.addEventListener("load",s._monitor,false)}}}}};g.Device._readyCheck=function(){var q=this._readyCheck;if(!document.body){window.setTimeout(q._monitor,20)}else{if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",q._monitor);document.removeEventListener("DOMContentLoaded",q._monitor);window.removeEventListener("load",q._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var r;while((r=q._queue.shift())){var s=r[0];var p=r[1];s.call(p,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}}};g.Device._initialize=function(){var s=this;function r(){var B=navigator.userAgent;if(/Playstation Vita/.test(B)){s.vita=true}else{if(/Kindle/.test(B)||/\bKF[A-Z][A-Z]+/.test(B)||/Silk.*Mobile Safari/.test(B)){s.kindle=true}else{if(/Android/.test(B)){s.android=true}else{if(/CrOS/.test(B)){s.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(B)){s.iOS=true}else{if(/Linux/.test(B)){s.linux=true}else{if(/Mac OS/.test(B)){s.macOS=true}else{if(/Windows/.test(B)){s.windows=true;if(/Windows Phone/i.test(B)){s.windowsPhone=true}}}}}}}}}var A=/Silk/.test(B);if(s.windows||s.macOS||(s.linux&&!A)||s.chromeOS){s.desktop=true}if(s.windowsPhone||((/Windows NT/i.test(B))&&(/Touch/i.test(B)))){s.desktop=false}}function z(){s.canvas=!!window.CanvasRenderingContext2D||s.cocoonJS;try{s.localStorage=!!localStorage.getItem}catch(A){s.localStorage=false}s.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;s.fileSystem=!!window.requestFileSystem;s.webGL=(function(){try{var B=document.createElement("canvas");B.screencanvas=false;return !!window.WebGLRenderingContext&&(B.getContext("webgl")||B.getContext("experimental-webgl"))}catch(C){return false}})();s.webGL=!!s.webGL;s.worker=!!window.Worker;s.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;s.quirksMode=(document.compatMode==="CSS1Compat")?false:true;s.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);if(!s.iOS&&(s.ie||s.firefox||s.chrome)){s.canvasBitBltShift=true}if(s.safari||s.mobileSafari){s.canvasBitBltShift=false}}function y(){if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){s.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){s.mspointer=true}if(!s.cocoonJS){if("onwheel" in window||(s.ie&&"WheelEvent" in window)){s.wheelEvent="wheel"}else{if("onmousewheel" in window){s.wheelEvent="mousewheel"}else{if(s.firefox&&"MouseScrollEvent" in window){s.wheelEvent="DOMMouseScroll"}}}}}function w(){var B=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var D=document.createElement("div");for(var C=0;C<B.length;C++){if(D[B[C]]){s.fullscreen=true;s.requestFullscreen=B[C];break}}var A=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(s.fullscreen){for(var C=0;C<A.length;C++){if(document[A[C]]){s.cancelFullscreen=A[C];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){s.fullscreenKeyboard=true}}function x(){var B=navigator.userAgent;if(/Arora/.test(B)){s.arora=true}else{if(/Chrome/.test(B)){s.chrome=true}else{if(/Epiphany/.test(B)){s.epiphany=true}else{if(/Firefox/.test(B)){s.firefox=true}else{if(/AppleWebKit/.test(B)&&s.iOS){s.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(B)){s.ie=true;s.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(B)){s.midori=true}else{if(/Opera/.test(B)){s.opera=true}else{if(/Safari/.test(B)){s.safari=true}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(B)){s.ie=true;s.trident=true;s.tridentVersion=parseInt(RegExp.$1,10);s.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}if(/Silk/.test(B)){s.silk=true}if(navigator.standalone){s.webApp=true}if(typeof window.cordova!=="undefined"){s.cordova=true}if(typeof process!=="undefined"&&typeof require!=="undefined"){s.node=true}if(s.node){try{s.nodeWebkit=(typeof require("nw.gui")!=="undefined")}catch(A){s.nodeWebkit=false}}if(navigator.isCocoonJS){s.cocoonJS=true}if(s.cocoonJS){try{s.cocoonJSApp=(typeof CocoonJS!=="undefined")}catch(A){s.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){s.ejecta=true}if(/Crosswalk/.test(B)){s.crosswalk=true}}function v(){s.audioData=!!(window.Audio);s.webAudio=!!(window.AudioContext||window.webkitAudioContext);var C=document.createElement("audio");var A=false;try{if(A=!!C.canPlayType){if(C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){s.ogg=true}if(C.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||C.canPlayType("audio/opus;").replace(/^no$/,"")){s.opus=true}if(C.canPlayType("audio/mpeg;").replace(/^no$/,"")){s.mp3=true}if(C.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){s.wav=true}if(C.canPlayType("audio/x-m4a;")||C.canPlayType("audio/aac;").replace(/^no$/,"")){s.m4a=true}if(C.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){s.webm=true}}}catch(B){}}function p(){s.pixelRatio=window.devicePixelRatio||1;s.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;s.iPhone4=(s.pixelRatio==2&&s.iPhone);s.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){s.typedArray=true}else{s.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){s.littleEndian=u();s.LITTLE_ENDIAN=s.littleEndian}s.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&s.littleEndian!==null&&t());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){s.vibration=true}}function u(){var B=new ArrayBuffer(4);var A=new Uint8Array(B);var C=new Uint32Array(B);A[0]=161;A[1]=178;A[2]=195;A[3]=212;if(C[0]==3569595041){return true}if(C[0]==2712847316){return false}else{return null}}function t(){if(typeof Uint8ClampedArray==="undefined"){return false}var B=document.createElement("canvas");var A=B.getContext("2d");if(!A){return false}var C=A.createImageData(1,1);return C.data instanceof Uint8ClampedArray}function q(){var C=document.createElement("p");var D;var B={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(C,null);for(var A in B){if(C.style[A]!==undefined){C.style[A]="translate3d(1px,1px,1px)";D=window.getComputedStyle(C).getPropertyValue(B[A])}}document.body.removeChild(C);s.css3D=(D!==undefined&&D.length>0&&D!=="none")}r();v();x();q();p();z();w();y()};g.Device.canPlayAudio=function(p){if(p=="mp3"&&this.mp3){return true}else{if(p=="ogg"&&(this.ogg||this.opus)){return true}else{if(p=="m4a"&&this.m4a){return true}else{if(p=="opus"&&this.opus){return true}else{if(p=="wav"&&this.wav){return true}else{if(p=="webm"&&this.webm){return true}}}}}}return false};g.Device.isConsoleOpen=function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false};g.Device.isAndroidStockBrowser=function(){var p=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return p&&p[1]<537};g.DOM={getOffset:function(q,p){p=p||new g.Point();var r=q.getBoundingClientRect();var s=g.DOM.scrollY;var t=g.DOM.scrollX;var v=document.documentElement.clientTop;var u=document.documentElement.clientLeft;p.x=r.left+t-u;p.y=r.top+s-v;return p},getBounds:function(q,p){if(typeof p==="undefined"){p=0}q=q&&!q.nodeType?q[0]:q;if(!q||q.nodeType!==1){return false}else{return this.calibrate(q.getBoundingClientRect(),p)}},calibrate:function(r,q){q=+q||0;var p={width:0,height:0,left:0,right:0,top:0,bottom:0};p.width=(p.right=r.right+q)-(p.left=r.left-q);p.height=(p.bottom=r.bottom+q)-(p.top=r.top-q);return p},getAspectRatio:function(q){q=null==q?this.visualBounds:1===q.nodeType?this.getBounds(q):q;var p=q.width;var r=q.height;if(typeof p==="function"){p=p.call(q)}if(typeof r==="function"){r=r.call(q)}return p/r},inLayoutViewport:function(q,p){var s=this.getBounds(q,p);return !!s&&s.bottom>=0&&s.right>=0&&s.top<=this.layoutBounds.width&&s.left<=this.layoutBounds.height},getScreenOrientation:function(t){var q=window.screen;var p=q.orientation||q.mozOrientation||q.msOrientation;if(p&&typeof p.type==="string"){return p.type}else{if(typeof p==="string"){return p}}var s="portrait-primary";var r="landscape-primary";if(t==="screen"){return(q.height>q.width)?s:r}else{if(t==="viewport"){return(this.visualBounds.height>this.visualBounds.width)?s:r}else{if(t==="window.orientation"&&typeof window.orientation==="number"){return(window.orientation===0||window.orientation===180)?s:r}else{if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return s}else{if(window.matchMedia("(orientation: landscape)").matches){return r}}}}}}return(this.visualBounds.height>this.visualBounds.width)?s:r},visualBounds:new g.Rectangle(),layoutBounds:new g.Rectangle(),documentBounds:new g.Rectangle()};g.Device.whenReady(function(r){var u=window&&("pageXOffset" in window)?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var s=window&&("pageYOffset" in window)?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(g.DOM,"scrollX",{get:u});Object.defineProperty(g.DOM,"scrollY",{get:s});Object.defineProperty(g.DOM.visualBounds,"x",{get:u});Object.defineProperty(g.DOM.visualBounds,"y",{get:s});Object.defineProperty(g.DOM.layoutBounds,"x",{value:0});Object.defineProperty(g.DOM.layoutBounds,"y",{value:0});var q=r.desktop&&(document.documentElement.clientWidth<=window.innerWidth)&&(document.documentElement.clientHeight<=window.innerHeight);if(q){var t=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var p=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(g.DOM.visualBounds,"width",{get:t});Object.defineProperty(g.DOM.visualBounds,"height",{get:p});Object.defineProperty(g.DOM.layoutBounds,"width",{get:t});Object.defineProperty(g.DOM.layoutBounds,"height",{get:p})}else{Object.defineProperty(g.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(g.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(g.DOM.layoutBounds,"width",{get:function(){var w=document.documentElement.clientWidth;var v=window.innerWidth;return w<v?v:w}});Object.defineProperty(g.DOM.layoutBounds,"height",{get:function(){var w=document.documentElement.clientHeight;var v=window.innerHeight;return w<v?v:w}})}Object.defineProperty(g.DOM.documentBounds,"x",{value:0});Object.defineProperty(g.DOM.documentBounds,"y",{value:0});Object.defineProperty(g.DOM.documentBounds,"width",{get:function(){var v=document.documentElement;return Math.max(v.clientWidth,v.offsetWidth,v.scrollWidth)}});Object.defineProperty(g.DOM.documentBounds,"height",{get:function(){var v=document.documentElement;return Math.max(v.clientHeight,v.offsetHeight,v.scrollHeight)}})},null,true);g.Canvas={create:function(r,p,s){r=r||256;p=p||256;var q=document.createElement("canvas");if(typeof s==="string"&&s!==""){q.id=s}q.width=r;q.height=p;q.style.display="block";return q},setBackgroundColor:function(q,p){p=p||"rgb(0,0,0)";q.style.backgroundColor=p;return q},setTouchAction:function(p,q){q=q||"none";p.style.msTouchAction=q;p.style["ms-touch-action"]=q;p.style["touch-action"]=q;return p},setUserSelect:function(p,q){q=q||"none";p.style["-webkit-touch-callout"]=q;p.style["-webkit-user-select"]=q;p.style["-khtml-user-select"]=q;p.style["-moz-user-select"]=q;p.style["-ms-user-select"]=q;p.style["user-select"]=q;p.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return p},addToDOM:function(p,q,s){var r;if(typeof s==="undefined"){s=true}if(q){if(typeof q==="string"){r=document.getElementById(q)}else{if(typeof q==="object"&&q.nodeType===1){r=q}}}if(!r){r=document.body}if(s&&r.style){r.style.overflow="hidden"}r.appendChild(p);return p},removeFromDOM:function(p){if(p.parentNode){p.parentNode.removeChild(p)}},setTransform:function(t,v,u,r,p,s,q){t.setTransform(r,s,q,p,v,u);return t},setSmoothingEnabled:function(p,q){p.imageSmoothingEnabled=q;p.mozImageSmoothingEnabled=q;p.oImageSmoothingEnabled=q;p.webkitImageSmoothingEnabled=q;p.msImageSmoothingEnabled=q;return p},getSmoothingEnabled:function(p){return(p.imageSmoothingEnabled||p.mozImageSmoothingEnabled||p.oImageSmoothingEnabled||p.webkitImageSmoothingEnabled||p.msImageSmoothingEnabled)},setImageRenderingCrisp:function(p){p.style["image-rendering"]="optimizeSpeed";p.style["image-rendering"]="crisp-edges";p.style["image-rendering"]="-moz-crisp-edges";p.style["image-rendering"]="-webkit-optimize-contrast";p.style["image-rendering"]="optimize-contrast";p.style["image-rendering"]="pixelated";p.style.msInterpolationMode="nearest-neighbor";return p},setImageRenderingBicubic:function(p){p.style["image-rendering"]="auto";p.style.msInterpolationMode="bicubic";return p}};g.Canvas.getOffset=g.DOM.getOffset;g.Canvas.getAspectRatio=g.DOM.getAspectRatio;g.RequestAnimationFrame=function(q,r){if(typeof r==="undefined"){r=false}this.game=q;this.isRunning=false;this.forceSetTimeOut=r;var s=["ms","moz","webkit","o"];for(var p=0;p<s.length&&!window.requestAnimationFrame;p++){window.requestAnimationFrame=window[s[p]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[s[p]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};g.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var p=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return p.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(q){return p.updateRAF(q)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(p){this.game.update(Math.floor(p));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};g.RequestAnimationFrame.prototype.constructor=g.RequestAnimationFrame;g.Math={PI2:Math.PI*2,fuzzyEqual:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return Math.abs(q-p)<r},fuzzyLessThan:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return q<p+r},fuzzyGreaterThan:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return q>p-r},fuzzyCeil:function(p,q){if(typeof q==="undefined"){q=0.0001}return Math.ceil(p-q)},fuzzyFloor:function(p,q){if(typeof q==="undefined"){q=0.0001}return Math.floor(p+q)},average:function(){var q=0;for(var p=0;p<arguments.length;p++){q+=(+arguments[p])}return q/arguments.length},truncate:function(p){return Math.trunc(p)},shear:function(p){return p%1},snapTo:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.round(p/r);return q+p},snapToFloor:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.floor(p/r);return q+p},snapToCeil:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.ceil(p/r);return q+p},snapToInArray:function(q,p,r){if(typeof r==="undefined"){r=true}if(r){p.sort()}return g.ArrayUtils.findClosest(q,p)},roundTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.round(s*t)/t},floorTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.floor(s*t)/t},ceilTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.ceil(s*t)/t},interpolateFloat:function(q,p,r){return(p-q)*r+q},angleBetween:function(q,s,p,r){return Math.atan2(r-s,p-q)},angleBetweenY:function(q,s,p,r){return Math.atan2(p-q,r-s)},angleBetweenPoints:function(q,p){return Math.atan2(p.y-q.y,p.x-q.x)},angleBetweenPointsY:function(q,p){return Math.atan2(p.x-q.x,p.y-q.y)},reverseAngle:function(p){return this.normalizeAngle(p+Math.PI,true)},normalizeAngle:function(p){p=p%(2*Math.PI);return p>=0?p:p+2*Math.PI},normalizeLatitude:function(p){return g.Math.clamp(p,-90,90)},normalizeLongitude:function(p){return g.Math.wrap(p,-180,180)},chanceRoll:function(p){return g.Utils.chanceRoll(p)},numberArray:function(q,p){return g.ArrayUtils.numberArray(q,p)},numberArrayStep:function(r,p,q){return g.ArrayUtils.numberArrayStep(r,p,q)},maxAdd:function(r,q,p){return Math.min(r+q,p)},minSub:function(r,q,p){return Math.max(r-q,p)},wrap:function(t,s,q){var r=q-s;if(r<=0){return 0}var p=(t-s)%r;if(p<0){p+=r}return p+s},wrapValue:function(r,q,p){var s;r=Math.abs(r);q=Math.abs(q);p=Math.abs(p);s=(r+q)%p;return s},limitValue:function(r,q,p){return g.Math.clamp(r,q,p)},randomSign:function(){return g.Utils.randomChoice(-1,1)},isOdd:function(p){return(p&1)},isEven:function(p){return !(p&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]<s[q]){q=r}}return s[q]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]>s[q]){q=r}}return s[q]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]<s[q][t]){q=r}}return s[q][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]>s[q][t]){q=r}}return s[q][t]},wrapAngle:function(q,p){return p?this.wrap(q,-Math.PI,Math.PI):this.wrap(q,-180,180)},angleLimit:function(s,r,q){var p=s;if(s>q){p=q}else{if(s<r){p=r}}return p},linearInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(q<0){return this.linear(r[0],r[1],t)}if(q>1){return this.linear(r[p],r[p-1],p-t)}return this.linear(r[s],r[s+1>p?p:s+1],t-s)},bezierInterpolation:function(r,q){var p=0;var t=r.length-1;for(var s=0;s<=t;s++){p+=Math.pow(1-q,t-s)*Math.pow(q,s)*r[s]*this.bernstein(t,s)}return p},catmullRomInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(r[0]===r[p]){if(q<0){s=Math.floor(t=p*(1+q))}return this.catmullRom(r[(s-1+p)%p],r[s],r[(s+1)%p],r[(s+2)%p],t-s)}else{if(q<0){return r[0]-(this.catmullRom(r[0],r[0],r[1],r[1],-t)-r[0])}if(q>1){return r[p]-(this.catmullRom(r[p],r[p],r[p-1],r[p-1],t-p)-r[p])}return this.catmullRom(r[s?s-1:0],r[s],r[p<s+1?p:s+1],r[p<s+2?p:s+2],t-s)}},linear:function(r,q,p){return(q-r)*p+r},bernstein:function(q,p){return this.factorial(q)/this.factorial(p)/this.factorial(q-p)},factorial:function(q){if(q===0){return 1}var p=q;while(--q){p*=q}return p},catmullRom:function(x,w,u,s,y){var v=(u-x)*0.5,r=(s-w)*0.5,q=y*y,p=y*q;return(2*w-2*u+v+r)*p+(-3*w+3*u-2*v-r)*q+v*y+w},difference:function(q,p){return Math.abs(q-p)},getRandom:function(q,r,p){return g.ArrayUtils.getRandomItem(q,r,p)},removeRandom:function(q,r,p){return g.ArrayUtils.removeRandomItem(q,r,p)},floor:function(p){return Math.trunc(p)},ceil:function(p){return g.Math.roundAwayFromZero(p)},roundAwayFromZero:function(p){return(p>0)?Math.ceil(p):Math.floor(p)},sinCosGenerator:function(p,w,q,u){if(typeof w==="undefined"){w=1}if(typeof q==="undefined"){q=1}if(typeof u==="undefined"){u=1}var v=w;var y=q;var s=u*Math.PI/p;var r=[];var x=[];for(var t=0;t<p;t++){y-=v*s;v+=y*s;r[t]=y;x[t]=v}return{sin:x,cos:r,length:p}},shift:function(q){var p=q.shift();q.push(p);return p},shuffleArray:function(p){return g.ArrayUtils.shuffle(p)},distance:function(s,u,r,t){var q=s-r;var p=u-t;return Math.sqrt(q*q+p*p)},distancePow:function(q,s,p,r,t){if(typeof t==="undefined"){t=2}return Math.sqrt(Math.pow(p-q,t)+Math.pow(r-s,t))},distanceRounded:function(q,s,p,r){return Math.round(g.Math.distance(q,s,p,r))},clamp:function(q,r,p){return(q<r)?r:((q>p)?p:q)},clampBottom:function(p,q){return p<q?q:p},within:function(q,p,r){return(Math.abs(q-p)<=r)},mapLinear:function(q,r,p,t,s){return t+(q-r)*(s-t)/(p-r)},smoothstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*(3-2*q)},smootherstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*q*(q*(q*6-15)+10)},sign:function(p){return(p<0)?-1:((p>0)?1:0)},percent:function(q,p,r){if(typeof r==="undefined"){r=0}if(q>p||r>p){return 1}else{if(q<r||r>q){return 0}else{return(q-r)/p}}}};var f=Math.PI/180;var c=180/Math.PI;g.Math.degToRad=function o(p){return p*f};g.Math.radToDeg=function i(p){return p*c};g.RandomDataGenerator=function(p){if(typeof p==="undefined"){p=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(p)};g.RandomDataGenerator.prototype={rnd:function(){var p=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=p|0;this.s0=this.s1;this.s1=this.s2;this.s2=p-this.c;return this.s2},sow:function(q){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!q){return}for(var r=0;r<q.length&&(q[r]!=null);r++){var p=q[r];this.s0-=this.hash(p);this.s0+=~~(this.s0<0);this.s1-=this.hash(p);this.s1+=~~(this.s1<0);this.s2-=this.hash(p);this.s2+=~~(this.s2<0)}},hash:function(r){var q,p,s;s=4022871197;r=r.toString();for(p=0;p<r.length;p++){s+=r.charCodeAt(p);q=0.02519603282416938*s;s=q>>>0;q-=s;q*=s;s=q>>>0;q-=s;s+=q*4294967296}return(s>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(q,p){return Math.floor(this.realInRange(0,p-q+1)+q)},between:function(q,p){return this.integerInRange(q,p)},realInRange:function(q,p){return this.frac()*(p-q)+q},normal:function(){return 1-2*this.frac()},uuid:function(){var q="";var p="";for(p=q="";q++<36;p+=~q%5|q*3&4?(q^15?8^this.frac()*(q^20?16:4):4).toString(16):"-"){}return p},pick:function(p){return p[this.integerInRange(0,p.length-1)]},weightedPick:function(p){return p[~~(Math.pow(this.frac(),2)*(p.length-1))]},timestamp:function(q,p){return this.realInRange(q||946684800000,p||1577862000000)},angle:function(){return this.integerInRange(-180,180)}};g.RandomDataGenerator.prototype.constructor=g.RandomDataGenerator;g.QuadTree=function(q,v,t,p,s,r,u){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(q,v,t,p,s,r,u)};g.QuadTree.prototype={reset:function(q,v,t,p,s,r,u){this.maxObjects=s||10;this.maxLevels=r||4;this.level=u||0;this.bounds={x:Math.round(q),y:Math.round(v),width:t,height:p,subWidth:Math.floor(t/2),subHeight:Math.floor(p/2),right:Math.round(q)+Math.floor(t/2),bottom:Math.round(v)+Math.floor(p/2)};this.objects.length=0;this.nodes.length=0},populate:function(p){p.forEach(this.populateHandler,this,true)},populateHandler:function(p){if(p.body&&p.exists){this.insert(p.body)}},split:function(){this.nodes[0]=new g.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new g.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new g.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new g.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(p){var r=0;var q;if(this.nodes[0]!=null){q=this.getIndex(p);if(q!==-1){this.nodes[q].insert(p);return}}this.objects.push(p);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(r<this.objects.length){q=this.getIndex(this.objects[r]);if(q!==-1){this.nodes[q].insert(this.objects.splice(r,1)[0])}else{r++}}}},getIndex:function(q){var p=-1;if(q.x<this.bounds.right&&q.right<this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=1}else{if(q.y>this.bounds.bottom){p=2}}}else{if(q.x>this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=0}else{if(q.y>this.bounds.bottom){p=3}}}}return p},retrieve:function(q){if(q instanceof g.Rectangle){var r=this.objects;var p=this.getIndex(q)}else{if(!q.body){return this._empty}var r=this.objects;var p=this.getIndex(q.body)}if(this.nodes[0]){if(p!==-1){r=r.concat(this.nodes[p].retrieve(q))}else{r=r.concat(this.nodes[0].retrieve(q));r=r.concat(this.nodes[1].retrieve(q));r=r.concat(this.nodes[2].retrieve(q));r=r.concat(this.nodes[3].retrieve(q))}}return r},clear:function(){this.objects.length=0;var p=this.nodes.length;while(p--){this.nodes[p].clear();this.nodes.splice(p,1)}this.nodes.length=0}};g.QuadTree.prototype.constructor=g.QuadTree;g.Net=function(p){this.game=p};g.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(p){return window.location.hostname.indexOf(p)!==-1},updateQueryString:function(r,t,w,q){if(typeof w==="undefined"){w=false}if(typeof q==="undefined"||q===""){q=window.location.href}var p="";var s=new RegExp("([?|&])"+r+"=.*?(&|#|$)(.*)","gi");if(s.test(q)){if(typeof t!=="undefined"&&t!==null){p=q.replace(s,"$1"+r+"="+t+"$2$3")}else{p=q.replace(s,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof t!=="undefined"&&t!==null){var v=q.indexOf("?")!==-1?"&":"?";var u=q.split("#");q=u[0]+v+r+"="+t;if(u[1]){q+="#"+u[1]}p=q}else{p=q}}if(w){window.location.href=p}else{return p}},getQueryString:function(t){if(typeof t==="undefined"){t=""}var q={};var p=location.search.substring(1).split("&");for(var s in p){var r=p[s].split("=");if(r.length>1){if(t&&t==this.decodeURI(r[0])){return this.decodeURI(r[1])}else{q[this.decodeURI(r[0])]=this.decodeURI(r[1])}}}return q},decodeURI:function(p){return decodeURIComponent(p.replace(/\+/g," "))}};g.Net.prototype.constructor=g.Net;g.TweenManager=function(p){this.game=p;this._tweens=[];this._add=[];this.easeMap={Power0:g.Easing.Power0,Power1:g.Easing.Power1,Power2:g.Easing.Power2,Power3:g.Easing.Power3,Power4:g.Easing.Power4,Linear:g.Easing.Linear.None,Quad:g.Easing.Quadratic.Out,Cubic:g.Easing.Cubic.Out,Quart:g.Easing.Quartic.Out,Quint:g.Easing.Quintic.Out,Sine:g.Easing.Sinusoidal.Out,Expo:g.Easing.Exponential.Out,Circ:g.Easing.Circular.Out,Elastic:g.Easing.Elastic.Out,Back:g.Easing.Back.Out,Bounce:g.Easing.Bounce.Out,"Quad.easeIn":g.Easing.Quadratic.In,"Cubic.easeIn":g.Easing.Cubic.In,"Quart.easeIn":g.Easing.Quartic.In,"Quint.easeIn":g.Easing.Quintic.In,"Sine.easeIn":g.Easing.Sinusoidal.In,"Expo.easeIn":g.Easing.Exponential.In,"Circ.easeIn":g.Easing.Circular.In,"Elastic.easeIn":g.Easing.Elastic.In,"Back.easeIn":g.Easing.Back.In,"Bounce.easeIn":g.Easing.Bounce.In,"Quad.easeOut":g.Easing.Quadratic.Out,"Cubic.easeOut":g.Easing.Cubic.Out,"Quart.easeOut":g.Easing.Quartic.Out,"Quint.easeOut":g.Easing.Quintic.Out,"Sine.easeOut":g.Easing.Sinusoidal.Out,"Expo.easeOut":g.Easing.Exponential.Out,"Circ.easeOut":g.Easing.Circular.Out,"Elastic.easeOut":g.Easing.Elastic.Out,"Back.easeOut":g.Easing.Back.Out,"Bounce.easeOut":g.Easing.Bounce.Out,"Quad.easeInOut":g.Easing.Quadratic.InOut,"Cubic.easeInOut":g.Easing.Cubic.InOut,"Quart.easeInOut":g.Easing.Quartic.InOut,"Quint.easeInOut":g.Easing.Quintic.InOut,"Sine.easeInOut":g.Easing.Sinusoidal.InOut,"Expo.easeInOut":g.Easing.Exponential.InOut,"Circ.easeInOut":g.Easing.Circular.InOut,"Elastic.easeInOut":g.Easing.Elastic.InOut,"Back.easeInOut":g.Easing.Back.InOut,"Bounce.easeInOut":g.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};g.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var p=0;p<this._tweens.length;p++){this._tweens[p].pendingDelete=true}this._add=[]},removeFrom:function(s,r){if(typeof r==="undefined"){r=true}var q;var p;if(Array.isArray(s)){for(q=0,p=s.length;q<p;q++){this.removeFrom(s[q])}}else{if(s.type===g.GROUP&&r){for(var q=0,p=s.children.length;q<p;q++){this.removeFrom(s.children[q])}}else{for(q=0,p=this._tweens.length;q<p;q++){if(s===this._tweens[q].target){this.remove(this._tweens[q])}}for(q=0,p=this._add.length;q<p;q++){if(s===this._add[q].target){this.remove(this._add[q])}}}}},add:function(p){p._manager=this;this._add.push(p)},create:function(p){return new g.Tween(p,this.game,this)},remove:function(q){var p=this._tweens.indexOf(q);if(p!==-1){this._tweens[p].pendingDelete=true}else{p=this._add.indexOf(q);if(p!==-1){this._add[p].pendingDelete=true}}},update:function(){var r=this._add.length;var q=this._tweens.length;if(q===0&&r===0){return false}var p=0;while(p<q){if(this._tweens[p].update(this.game.time.time)){p++}else{this._tweens.splice(p,1);q--}}if(r>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(p){return this._tweens.some(function(q){return q.target===p})},_pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._pause()}},_resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._resume()}},pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].pause()}},resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].resume(true)}}};g.TweenManager.prototype.constructor=g.TweenManager;g.Tween=function(r,p,q){this.game=p;this.target=r;this.manager=q;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new g.Signal();this.onLoop=new g.Signal();this.onRepeat=new g.Signal();this.onChildComplete=new g.Signal();this.onComplete=new g.Signal();this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false};g.Tween.prototype={to:function(r,u,v,q,p,t,s){if(typeof u==="undefined"){u=1000}if(typeof v==="undefined"){v=g.Easing.Default}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=0}if(typeof t==="undefined"){t=0}if(typeof s==="undefined"){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).to(r,u,v,p,t,s));if(q){this.start()}return this},from:function(r,u,v,q,p,t,s){if(typeof u==="undefined"){u=1000}if(typeof v==="undefined"){v=g.Easing.Default}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=0}if(typeof t==="undefined"){t=0}if(typeof s==="undefined"){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).from(r,u,v,p,t,s));if(q){this.start()}return this},start:function(p){if(typeof p==="undefined"){p=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}this.manager.add(this);this.isRunning=true;if(p<0||p>this.timeline.length-1){p=0}this.current=p;this.timeline[this.current].start();this.onStart.dispatch(this.target,this);return this},stop:function(p){if(typeof p==="undefined"){p=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(p){this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(s,r,p){if(this.timeline.length===0){return this}if(typeof p==="undefined"){p=0}if(p===-1){for(var q=0;q<this.timeline.length;q++){this.timeline[q][s]=r}}else{this.timeline[p][s]=r}return this},delay:function(q,p){return this.updateTweenData("delay",q,p)},repeat:function(q,r,p){if(typeof r==="undefined"){r=0}this.updateTweenData("repeatCounter",q,p);return this.updateTweenData("repeatDelay",r,p)},repeatDelay:function(q,p){return this.updateTweenData("repeatDelay",q,p)},yoyo:function(q,r,p){if(typeof r==="undefined"){r=0}this.updateTweenData("yoyo",q,p);return this.updateTweenData("yoyoDelay",r,p)},yoyoDelay:function(q,p){return this.updateTweenData("yoyoDelay",q,p)},easing:function(q,p){if(typeof q==="string"&&this.manager.easeMap[q]){q=this.manager.easeMap[q]}return this.updateTweenData("easingFunction",q,p)},interpolation:function(p,r,q){if(typeof r==="undefined"){r=g.Math}this.updateTweenData("interpolationFunction",p,q);return this.updateTweenData("interpolationContext",r,q)},repeatAll:function(p){if(typeof p==="undefined"){p=0}this.repeatCounter=p;return this},chain:function(){var p=arguments.length;while(p--){if(p>0){arguments[p-1].chainedTween=arguments[p]}else{this.chainedTween=arguments[p]}}return this},loop:function(p){if(typeof p==="undefined"){p=true}if(p){this.repeatAll(-1)}else{this.repeatCounter=0}return this},onUpdateCallback:function(q,p){this._onUpdateCallback=q;this._onUpdateCallbackContext=p;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var p=0;p<this.timeline.length;p++){if(!this.timeline[p].isRunning){this.timeline[p].startTime+=(this.game.time.time-this._pausedTime)}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(r){if(this.pendingDelete){return false}if(this.isPaused){return true}var q=this.timeline[this.current].update(r);if(q===g.TweenData.PENDING){return true}else{if(q===g.TweenData.RUNNING){if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else{if(q===g.TweenData.LOOPED){this.onLoop.dispatch(this.target,this);return true}else{if(q===g.TweenData.COMPLETE){var p=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;p=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;p=true}}if(p){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}return false}}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}}}}},generateData:function(p,s){if(this.game===null||this.target===null){return null}if(typeof s==="undefined"){s=[]}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}for(var q=0;q<this.timeline.length;q++){s=s.concat(this.timeline[q].generateData(p))}return s}};Object.defineProperty(g.Tween.prototype,"totalDuration",{get:function(){var q=0;for(var p=0;p<this.timeline.length;p++){q+=this.timeline[p].duration}return q}});g.Tween.prototype.constructor=g.Tween;g.TweenData=function(p){this.parent=p;this.game=p.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1000;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=g.Easing.Default;this.interpolationFunction=g.Math.linearInterpolation;this.interpolationContext=g.Math;this.isRunning=false;this.isFrom=false};g.TweenData.PENDING=0;g.TweenData.RUNNING=1;g.TweenData.LOOPED=2;g.TweenData.COMPLETE=3;g.TweenData.prototype={to:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatCounter=s;this.yoyo=r;this.isFrom=false;return this},from:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatCounter=s;this.yoyo=r;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p];this.parent.target[p]=this.vStart[p]}}this.value=0;this.yoyoCounter=0;return this},loadValues:function(){for(var p in this.parent.properties){this.vStart[p]=this.parent.properties[p];if(Array.isArray(this.vEnd[p])){if(this.vEnd[p].length===0){continue}this.vEnd[p]=[this.vStart[p]].concat(this.vEnd[p])}if(typeof this.vEnd[p]!=="undefined"){if(typeof this.vEnd[p]==="string"){this.vEnd[p]=this.vStart[p]+parseFloat(this.vEnd[p],10)}this.parent.properties[p]=this.vEnd[p]}else{this.vEnd[p]=this.vStart[p]}this.vStartCache[p]=this.vStart[p];this.vEndCache[p]=this.vEnd[p]}return this},update:function(){if(!this.isRunning){if(this.game.time.time>=this.startTime){this.isRunning=true}else{return g.TweenData.PENDING}}else{if(this.game.time.time<this.startTime){return g.TweenData.RUNNING}}if(this.parent.reverse){this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var q in this.vEnd){var r=this.vStart[q];var p=this.vEnd[q];if(Array.isArray(p)){this.parent.target[q]=this.interpolationFunction.call(this.interpolationContext,p,this.value)}else{this.parent.target[q]=r+((p-r)*this.value)}}if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){return this.repeat()}return g.TweenData.RUNNING},generateData:function(x){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var v=[];var r=false;var s=(1/x)*1000;do{if(this.parent.reverse){this.dt-=s;this.dt=Math.max(this.dt,0)}else{this.dt+=s;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var p={};for(var w in this.vEnd){var q=this.vStart[w];var t=this.vEnd[w];if(Array.isArray(t)){p[w]=this.interpolationFunction(t,this.value)}else{p[w]=q+((t-q)*this.value)}}v.push(p);if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){r=true}}while(!r);if(this.yoyo){var u=v.slice();u.reverse();v=v.concat(u)}return v},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){return g.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return g.TweenData.COMPLETE}}if(this.inReverse){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p]}}else{for(var p in this.vStartCache){this.vStart[p]=this.vStartCache[p];this.vEnd[p]=this.vEndCache[p]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else{if(!this.inReverse){this.startTime+=this.repeatDelay}}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return g.TweenData.LOOPED}};g.TweenData.prototype.constructor=g.TweenData;g.Easing={Linear:{None:function(p){return p}},Quadratic:{In:function(p){return p*p},Out:function(p){return p*(2-p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p}return -0.5*(--p*(p-2)-1)}},Cubic:{In:function(p){return p*p*p},Out:function(p){return --p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p}return 0.5*((p-=2)*p*p+2)}},Quartic:{In:function(p){return p*p*p*p},Out:function(p){return 1-(--p*p*p*p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p}return -0.5*((p-=2)*p*p*p-2)}},Quintic:{In:function(p){return p*p*p*p*p},Out:function(p){return --p*p*p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p*p}return 0.5*((p-=2)*p*p*p*p+2)}},Sinusoidal:{In:function(p){if(p===0){return 0}if(p===1){return 1}return 1-Math.cos(p*Math.PI/2)},Out:function(p){if(p===0){return 0}if(p===1){return 1}return Math.sin(p*Math.PI/2)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}return 0.5*(1-Math.cos(Math.PI*p))}},Exponential:{In:function(p){return p===0?0:Math.pow(1024,p-1)},Out:function(p){return p===1?1:1-Math.pow(2,-10*p)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}if((p*=2)<1){return 0.5*Math.pow(1024,p-1)}return 0.5*(-Math.pow(2,-10*(p-1))+2)}},Circular:{In:function(p){return 1-Math.sqrt(1-p*p)},Out:function(p){return Math.sqrt(1-(--p*p))},InOut:function(p){if((p*=2)<1){return -0.5*(Math.sqrt(1-p*p)-1)}return 0.5*(Math.sqrt(1-(p-=2)*p)+1)}},Elastic:{In:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return -(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))},Out:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return(q*Math.pow(2,-10*r)*Math.sin((r-t)*(2*Math.PI)/u)+1)},InOut:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}if((r*=2)<1){return -0.5*(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))}return q*Math.pow(2,-10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u)*0.5+1}},Back:{In:function(p){var q=1.70158;return p*p*((q+1)*p-q)},Out:function(p){var q=1.70158;return --p*p*((q+1)*p+q)+1},InOut:function(p){var q=1.70158*1.525;if((p*=2)<1){return 0.5*(p*p*((q+1)*p-q))}return 0.5*((p-=2)*p*((q+1)*p+q)+2)}},Bounce:{In:function(p){return 1-g.Easing.Bounce.Out(1-p)},Out:function(p){if(p<(1/2.75)){return 7.5625*p*p}else{if(p<(2/2.75)){return 7.5625*(p-=(1.5/2.75))*p+0.75}else{if(p<(2.5/2.75)){return 7.5625*(p-=(2.25/2.75))*p+0.9375}else{return 7.5625*(p-=(2.625/2.75))*p+0.984375}}}},InOut:function(p){if(p<0.5){return g.Easing.Bounce.In(p*2)*0.5}return g.Easing.Bounce.Out(p*2-1)*0.5+0.5}}};g.Easing.Default=g.Easing.Linear.None;g.Easing.Power0=g.Easing.Linear.None;g.Easing.Power1=g.Easing.Quadratic.Out;g.Easing.Power2=g.Easing.Cubic.Out;g.Easing.Power3=g.Easing.Quartic.Out;g.Easing.Power4=g.Easing.Quintic.Out;g.Time=function(p){this.game=p;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=0;this.physicsElapsedMS=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new g.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};g.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(p){this._timers.push(p);return p},create:function(p){if(typeof p==="undefined"){p=true}var q=new g.Timer(this.game,p);this._timers.push(q);return q},removeAll:function(){for(var p=0;p<this._timers.length;p++){this._timers[p].destroy()}this._timers=[];this.events.removeAll()},update:function(s){var r=this.time;this.time=Date.now();this.elapsedMS=this.time-r;this.prevTime=this.now;this.now=s;this.elapsed=this.now-this.prevTime;this.timeToCall=Math.floor(Math.max(0,(1000/this.desiredFps)-(this.timeCallExpected-s)));this.timeCallExpected=s+this.timeToCall;this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this.desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.physicsElapsed=1/this.desiredFps;this.physicsElapsedMS=this.physicsElapsed*1000;if(this.advancedTiming){this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}}if(!this.game.paused){this.events.update(this.time);var q=0;var p=this._timers.length;while(q<p){if(this._timers[q].update(this.time)){q++}else{this._timers.splice(q,1);p--}}}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var p=this._timers.length;while(p--){this._timers[p]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var p=this._timers.length;while(p--){this._timers[p]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*0.001},elapsedSince:function(p){return this.time-p},elapsedSecondsSince:function(p){return(this.time-p)*0.001},reset:function(){this._started=this.time;this.removeAll()}};g.Time.prototype.constructor=g.Time;g.Timer=function(p,q){if(typeof q==="undefined"){q=true}this.game=p;this.running=false;this.autoDestroy=q;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new g.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};g.Timer.MINUTE=60000;g.Timer.SECOND=1000;g.Timer.HALF=500;g.Timer.QUARTER=250;g.Timer.prototype={create:function(t,p,r,w,q,s){t=Math.round(t);var u=t;if(this._now===0){u+=this.game.time.time}else{u+=this._now}var v=new g.TimerEvent(this,t,u,r,p,w,q,s);this.events.push(v);this.order();this.expired=false;return v},add:function(q,r,p){return this.create(q,false,0,r,p,Array.prototype.splice.call(arguments,3))},repeat:function(r,q,s,p){return this.create(r,false,q,s,p,Array.prototype.splice.call(arguments,4))},loop:function(q,r,p){return this.create(q,true,0,r,p,Array.prototype.splice.call(arguments,3))},start:function(p){if(this.running){return}this._started=this.game.time.time+(p||0);this.running=true;for(var q=0;q<this.events.length;q++){this.events[q].tick=this.events[q].delay+this._started}},stop:function(p){this.running=false;if(typeof p==="undefined"){p=true}if(p){this.events.length=0}},remove:function(q){for(var p=0;p<this.events.length;p++){if(this.events[p]===q){this.events[p].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(q,p){if(q.tick<p.tick){return -1}else{if(q.tick>p.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(p){if(this.paused){return true}this.elapsed=p-this._now;this._now=p;if(this.elapsed>this.timeCap){this.adjustEvents(p-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(s){for(var q=0;q<this.events.length;q++){if(!this.events[q].pendingDelete){var p=this.events[q].tick-s;if(p<0){p=0}this.events[q].tick=this._now+p}}var r=this.nextTick-s;if(r<0){this.nextTick=this._now}else{this.nextTick=this._now+r}},resume:function(){if(!this.paused){return}var p=this.game.time.time;this._pauseTotal+=p-this._now;this._now=p;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(g.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(g.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(g.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(g.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(g.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});g.Timer.prototype.constructor=g.Timer;g.TimerEvent=function(w,t,u,r,p,v,q,s){this.timer=w;this.delay=t;this.tick=u;this.repeatCount=r-1;this.loop=p;this.callback=v;this.callbackContext=q;this.args=s;this.pendingDelete=false};g.TimerEvent.prototype.constructor=g.TimerEvent;g.AnimationManager=function(p){this.sprite=p;this.game=p.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};g.AnimationManager.prototype={loadFrameData:function(p,r){if(typeof p==="undefined"){return false}if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(p)}}this._frameData=p;if(typeof r==="undefined"||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},copyFrameData:function(p,r){this._frameData=p.clone();if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(this._frameData)}}if(typeof r==="undefined"||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},add:function(s,t,r,q,p){t=t||[];r=r||60;if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){if(t&&typeof t[0]==="number"){p=true}else{p=false}}this._outputFrames.length=0;this._frameData.getFrameIndexes(t,p,this._outputFrames);this._anims[s]=new g.Animation(this.game,this.sprite,s,this._frameData,this._outputFrames,r,q);this.currentAnim=this._anims[s];this.currentFrame=this.currentAnim.currentFrame;if(this.sprite.__tilePattern){this.sprite.__tilePattern=false;this.tilingTexture=false}return this._anims[s]},validateFrames:function(r,p){if(typeof p==="undefined"){p=true}for(var q=0;q<r.length;q++){if(p===true){if(r[q]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(r[q])===false){return false}}}return true},play:function(s,r,q,p){if(this._anims[s]){if(this.currentAnim===this._anims[s]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(r,q,p)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[s];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(r,q,p)}}},stop:function(q,p){if(typeof p==="undefined"){p=false}if(typeof q==="string"){if(this._anims[q]){this.currentAnim=this._anims[q];this.currentAnim.stop(p)}}else{if(this.currentAnim){this.currentAnim.stop(p)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(p){if(this.currentAnim){this.currentAnim.next(p);this.currentFrame=this.currentAnim.currentFrame}},previous:function(p){if(this.currentAnim){this.currentAnim.previous(p);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(p){if(typeof p==="string"){if(this._anims[p]){return this._anims[p]}}return null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var p=null;for(var p in this._anims){if(this._anims.hasOwnProperty(p)){this._anims[p].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};g.AnimationManager.prototype.constructor=g.AnimationManager;Object.defineProperty(g.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(g.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(g.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(p){this.currentAnim.paused=p}});Object.defineProperty(g.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(g.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(p){if(typeof p==="number"&&this._frameData&&this._frameData.getFrame(p)!==null){this.currentFrame=this._frameData.getFrame(p);if(this.currentFrame){this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});Object.defineProperty(g.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(p){if(typeof p==="string"&&this._frameData.getFrameByName(p)!==null){this.currentFrame=this._frameData.getFrameByName(p);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{console.warn("Cannot set frameName: "+p)}}});g.Animation=function(q,u,s,t,v,r,p){if(typeof p==="undefined"){p=false}this.game=q;this._parent=u;this._frameData=t;this.name=s;this._frames=[];this._frames=this._frames.concat(v);this.delay=1000/r;this.loop=p;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new g.Signal();this.onUpdate=null;this.onComplete=new g.Signal();this.onLoop=new g.Signal();this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};g.Animation.prototype={play:function(r,q,p){if(typeof r==="number"){this.delay=1000/r}if(typeof q==="boolean"){this.loop=q}if(typeof p!=="undefined"){this.killOnComplete=p}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.updateCurrentFrame(false);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(r,p){var s;if(typeof p==="undefined"){p=false}if(typeof r==="string"){for(var q=0;q<this._frames.length;q++){if(this._frameData.getFrame(this._frames[q]).name===r){s=q}}}else{if(typeof r==="number"){if(p){s=r}else{for(var q=0;q<this._frames.length;q++){if(this._frames[q]===s){s=q}}}}}if(s){this._frameIndex=s-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(p,q){if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(p){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(q){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);return this.updateCurrentFrame(true)}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(p){if(!this._frameData){return false}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}if(this.onUpdate&&p){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}},next:function(p){if(typeof p==="undefined"){p=1}var q=this._frameIndex+p;if(q>=this._frames.length){if(this.loop){q%=this._frames.length}else{q=this._frames.length-1}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},previous:function(p){if(typeof p==="undefined"){p=1}var q=this._frameIndex-p;if(q<0){if(this.loop){q=this._frames.length+q}else{q++}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},updateFrameData:function(p){this._frameData=p;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};g.Animation.prototype.constructor=g.Animation;Object.defineProperty(g.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(p){this.isPaused=p;if(p){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(g.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(g.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(p){this.currentFrame=this._frameData.getFrame(this._frames[p]);if(this.currentFrame!==null){this._frameIndex=p;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(g.Animation.prototype,"speed",{get:function(){return Math.round(1000/this.delay)},set:function(p){if(p>=1){this.delay=1000/p}}});Object.defineProperty(g.Animation.prototype,"enableUpdate",{get:function(){return(this.onUpdate!==null)},set:function(p){if(p&&this.onUpdate===null){this.onUpdate=new g.Signal()}else{if(!p&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}}});g.Animation.generateFrameNames=function(t,w,r,u,s){if(typeof u==="undefined"){u=""}var p=[];var v="";if(w<r){for(var q=w;q<=r;q++){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}else{for(var q=w;q>=r;q--){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}return p};g.Frame=function(s,q,v,u,p,r,t){this.index=s;this.x=q;this.y=v;this.width=u;this.height=p;this.name=r;this.uuid=t;this.centerX=Math.floor(u/2);this.centerY=Math.floor(p/2);this.distance=g.Math.distance(0,0,u,p);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=u;this.sourceSizeH=p;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};g.Frame.prototype={setTrim:function(t,s,v,q,p,r,u){this.trimmed=t;if(t){this.sourceSizeW=s;this.sourceSizeH=v;this.centerX=Math.floor(s/2);this.centerY=Math.floor(v/2);this.spriteSourceSizeX=q;this.spriteSourceSizeY=p;this.spriteSourceSizeW=r;this.spriteSourceSizeH=u}},clone:function(){var p=new g.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var q in this){if(this.hasOwnProperty(q)){p[q]=this[q]}}return p},getRect:function(p){if(typeof p==="undefined"){p=new g.Rectangle(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p}};g.Frame.prototype.constructor=g.Frame;g.FrameData=function(){this._frames=[];this._frameNames=[]};g.FrameData.prototype={addFrame:function(p){p.index=this._frames.length;this._frames.push(p);if(p.name!==""){this._frameNames[p.name]=p.index}return p},getFrame:function(p){if(p>=this._frames.length){p=0}return this._frames[p]},getFrameByName:function(p){if(typeof this._frameNames[p]==="number"){return this._frames[this._frameNames[p]]}return null},checkFrameName:function(p){if(this._frameNames[p]==null){return false}return true},clone:function(){var q=new g.FrameData();for(var r=0;r<this._frames.length;r++){q._frames.push(this._frames[r].clone())}for(var s in this._frameNames){if(this._frameNames.hasOwnProperty(s)){q._frameNames.push(this._frameNames[s])}}return q},getFrameRange:function(s,p,q){if(typeof q==="undefined"){q=[]}for(var r=s;r<=p;r++){q.push(this._frames[r])}return q},getFrames:function(t,q,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=[]}if(typeof t==="undefined"||t.length===0){for(var s=0;s<this._frames.length;s++){r.push(this._frames[s])}}else{for(var s=0,p=t.length;s<p;s++){if(q){r.push(this.getFrame(t[s]))}else{r.push(this.getFrameByName(t[s]))}}}return r},getFrameIndexes:function(t,q,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=[]}if(typeof t==="undefined"||t.length===0){for(var s=0,p=this._frames.length;s<p;s++){r.push(this._frames[s].index)}}else{for(var s=0,p=t.length;s<p;s++){if(q){r.push(t[s])}else{if(this.getFrameByName(t[s])){r.push(this.getFrameByName(t[s]).index)}}}}return r}};g.FrameData.prototype.constructor=g.FrameData;Object.defineProperty(g.FrameData.prototype,"total",{get:function(){return this._frames.length}});g.AnimationParser={spriteSheet:function(E,G,A,s,D,v,q){var I=E.cache.getImage(G);if(I==null){return null}var z=I.width;var w=I.height;if(A<=0){A=Math.floor(-z/Math.min(-1,A))}if(s<=0){s=Math.floor(-w/Math.min(-1,s))}var r=Math.floor((z-v)/(A+q));var p=Math.floor((w-v)/(s+q));var H=r*p;if(D!==-1){H=D}if(z===0||w===0||z<A||w<s||H===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+G+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var F=new g.FrameData();var u=v;var t=v;for(var C=0;C<H;C++){var B=E.rnd.uuid();F.addFrame(new g.Frame(C,u,t,A,s,"",B));PIXI.TextureCache[B]=new PIXI.Texture(PIXI.BaseTextureCache[G],{x:u,y:t,width:A,height:s});u+=A+q;if(u+A>z){u=v;t+=s+q}}return F},JSONData:function(p,r,v){if(!r.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(r);return}var t=new g.FrameData();var u=r.frames;var w;for(var q=0;q<u.length;q++){var s=p.rnd.uuid();w=t.addFrame(new g.Frame(q,u[q].frame.x,u[q].frame.y,u[q].frame.w,u[q].frame.h,u[q].filename,s));PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[v],{x:u[q].frame.x,y:u[q].frame.y,width:u[q].frame.w,height:u[q].frame.h});if(u[q].trimmed){w.setTrim(u[q].trimmed,u[q].sourceSize.w,u[q].sourceSize.h,u[q].spriteSourceSize.x,u[q].spriteSourceSize.y,u[q].spriteSourceSize.w,u[q].spriteSourceSize.h)}}return t},JSONDataHash:function(w,x,t){if(!x.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(x);return}var q=new g.FrameData();var u=x.frames;var s;var r=0;for(var v in u){var p=w.rnd.uuid();s=q.addFrame(new g.Frame(r,u[v].frame.x,u[v].frame.y,u[v].frame.w,u[v].frame.h,v,p));PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:u[v].frame.x,y:u[v].frame.y,width:u[v].frame.w,height:u[v].frame.h});if(u[v].trimmed){s.setTrim(u[v].trimmed,u[v].sourceSize.w,u[v].sourceSize.h,u[v].spriteSourceSize.x,u[v].spriteSourceSize.y,u[v].spriteSourceSize.w,u[v].spriteSourceSize.h)}r++}return q},XMLData:function(G,r,s){if(!r.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var H=new g.FrameData();var z=r.getElementsByTagName("SubTexture");var t;var F;var I;var A;var w;var v;var C;var B;var q;var p;var D;var u;for(var E=0;E<z.length;E++){F=G.rnd.uuid();A=z[E].attributes;I=A.name.value;w=parseInt(A.x.value,10);v=parseInt(A.y.value,10);C=parseInt(A.width.value,10);B=parseInt(A.height.value,10);q=null;p=null;if(A.frameX){q=Math.abs(parseInt(A.frameX.value,10));p=Math.abs(parseInt(A.frameY.value,10));D=parseInt(A.frameWidth.value,10);u=parseInt(A.frameHeight.value,10)}t=H.addFrame(new g.Frame(E,w,v,C,B,I,F));PIXI.TextureCache[F]=new PIXI.Texture(PIXI.BaseTextureCache[s],{x:w,y:v,width:C,height:B});if(q!==null||p!==null){t.setTrim(true,C,B,q,p,D,u)}}return H}};g.Cache=function(p){this.game=p;this.autoResolveURL=false;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this._urlMap={};this._urlResolver=new Image();this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new g.Signal();this._cacheMap=[];this._cacheMap[g.Cache.CANVAS]=this._canvases;this._cacheMap[g.Cache.IMAGE]=this._images;this._cacheMap[g.Cache.TEXTURE]=this._textures;this._cacheMap[g.Cache.SOUND]=this._sounds;this._cacheMap[g.Cache.TEXT]=this._text;this._cacheMap[g.Cache.PHYSICS]=this._physics;this._cacheMap[g.Cache.TILEMAP]=this._tilemaps;this._cacheMap[g.Cache.BINARY]=this._binary;this._cacheMap[g.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[g.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[g.Cache.JSON]=this._json;this._cacheMap[g.Cache.XML]=this._xml};g.Cache.CANVAS=1;g.Cache.IMAGE=2;g.Cache.TEXTURE=3;g.Cache.SOUND=4;g.Cache.TEXT=5;g.Cache.PHYSICS=6;g.Cache.TILEMAP=7;g.Cache.BINARY=8;g.Cache.BITMAPDATA=9;g.Cache.BITMAPFONT=10;g.Cache.JSON=11;g.Cache.XML=12;g.Cache.prototype={addCanvas:function(r,p,q){this._canvases[r]={canvas:p,context:q}},addBinary:function(q,p){this._binary[q]=p},addBitmapData:function(p,r,q){r.key=p;if(typeof q==="undefined"){q=new g.FrameData();q.addFrame(r.textureFrame)}this._bitmapDatas[p]={data:r,frameData:q};return r},addRenderTexture:function(p,q){var r=new g.Frame(0,0,0,q.width,q.height,"","");this._textures[p]={texture:q,frame:r}},addSpriteSheet:function(s,r,u,p,q,v,t,w){this._images[s]={url:r,data:u,frameWidth:p,frameHeight:q,margin:t,spacing:w};PIXI.BaseTextureCache[s]=new PIXI.BaseTexture(u);PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[s]);this._images[s].frameData=g.AnimationParser.spriteSheet(this.game,s,p,q,v,t,w);this._resolveURL(r,this._images[s])},addTilemap:function(q,p,s,r){this._tilemaps[q]={url:p,data:s,format:r};this._resolveURL(p,this._tilemaps[q])},addTextureAtlas:function(r,q,s,p,t){this._images[r]={url:q,data:s};PIXI.BaseTextureCache[r]=new PIXI.BaseTexture(s);PIXI.TextureCache[r]=new PIXI.Texture(PIXI.BaseTextureCache[r]);if(t==g.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[r].frameData=g.AnimationParser.JSONData(this.game,p,r)}else{if(t==g.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[r].frameData=g.AnimationParser.JSONDataHash(this.game,p,r)}else{if(t==g.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[r].frameData=g.AnimationParser.XMLData(this.game,p,r)}}}this._resolveURL(q,this._images[r])},addBitmapFont:function(q,p,u,r,t,s){this._images[q]={url:p,data:u};PIXI.BaseTextureCache[q]=new PIXI.BaseTexture(u);PIXI.TextureCache[q]=new PIXI.Texture(PIXI.BaseTextureCache[q]);g.LoaderParser.bitmapFont(this.game,r,q,t,s);this._bitmapFont[q]=PIXI.BitmapText.fonts[q];this._resolveURL(p,this._bitmapFont[q])},addPhysicsData:function(q,p,r,s){this._physics[q]={url:p,data:r,format:s};this._resolveURL(p,this._physics[q])},addDefaultImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:p};this._images.__default.frame=new g.Frame(0,0,0,32,32,"","");this._images.__default.frameData=new g.FrameData();this._images.__default.frameData.addFrame(new g.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(p);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:p};this._images.__missing.frame=new g.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new g.FrameData();this._images.__missing.frameData.addFrame(new g.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(p);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(q,p,r){this._text[q]={url:p,data:r};this._resolveURL(p,this._text[q])},addJSON:function(q,p,r){this._json[q]={url:p,data:r};this._resolveURL(p,this._json[q])},addXML:function(q,p,r){this._xml[q]={url:p,data:r};this._resolveURL(p,this._xml[q])},addImage:function(q,p,r){if(this.checkImageKey(q)){this.removeImage(q)}this._images[q]={url:p,data:r};this._images[q].frame=new g.Frame(0,0,0,r.width,r.height,q,this.game.rnd.uuid());this._images[q].frameData=new g.FrameData();this._images[q].frameData.addFrame(new g.Frame(0,0,0,r.width,r.height,p,this.game.rnd.uuid()));PIXI.BaseTextureCache[q]=new PIXI.BaseTexture(r);PIXI.TextureCache[q]=new PIXI.Texture(PIXI.BaseTextureCache[q]);this._resolveURL(p,this._images[q])},addSound:function(s,r,u,q,t){q=q||true;t=t||false;var p=false;if(t){p=true}this._sounds[s]={url:r,data:u,isDecoding:false,decoded:p,webAudio:q,audioTag:t,locked:this.game.sound.touchLocked};this._resolveURL(r,this._sounds[s])},reloadSound:function(p){var q=this;if(this._sounds[p]){this._sounds[p].data.src=this._sounds[p].url;this._sounds[p].data.addEventListener("canplaythrough",function(){return q.reloadSoundComplete(p)},false);this._sounds[p].data.load()}},reloadSoundComplete:function(p){if(this._sounds[p]){this._sounds[p].locked=false;this.onSoundUnlock.dispatch(p)}},updateSound:function(p,r,q){if(this._sounds[p]){this._sounds[p][r]=q}},decodedSound:function(p,q){this._sounds[p].data=q;this._sounds[p].decoded=true;this._sounds[p].isDecoding=false},getCanvas:function(p){if(this._canvases[p]){return this._canvases[p].canvas}else{console.warn('Phaser.Cache.getCanvas: Invalid key: "'+p+'"');return null}},getBitmapData:function(p){if(this._bitmapDatas[p]){return this._bitmapDatas[p].data}else{console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+p+'"');return null}},getBitmapFont:function(p){if(this._bitmapFont[p]){return this._bitmapFont[p]}else{console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+p+'"');return null}},getPhysicsData:function(r,q,p){if(typeof q==="undefined"||q===null){if(this._physics[r]){return this._physics[r].data}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+r+'"')}}else{if(this._physics[r]&&this._physics[r].data[q]){var s=this._physics[r].data[q];if(s&&p){for(var t in s){t=s[t];if(t.fixtureKey===p){return t}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+p+" in "+r+'"')}else{return s}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+r+" / "+q+'"')}}return null},checkKey:function(q,p){if(this._cacheMap[q][p]){return true}return false},checkCanvasKey:function(p){return this.checkKey(g.Cache.CANVAS,p)},checkImageKey:function(p){return this.checkKey(g.Cache.IMAGE,p)},checkTextureKey:function(p){return this.checkKey(g.Cache.TEXTURE,p)},checkSoundKey:function(p){return this.checkKey(g.Cache.SOUND,p)},checkTextKey:function(p){return this.checkKey(g.Cache.TEXT,p)},checkPhysicsKey:function(p){return this.checkKey(g.Cache.PHYSICS,p)},checkTilemapKey:function(p){return this.checkKey(g.Cache.TILEMAP,p)},checkBinaryKey:function(p){return this.checkKey(g.Cache.BINARY,p)},checkBitmapDataKey:function(p){return this.checkKey(g.Cache.BITMAPDATA,p)},checkBitmapFontKey:function(p){return this.checkKey(g.Cache.BITMAPFONT,p)},checkJSONKey:function(p){return this.checkKey(g.Cache.JSON,p)},checkXMLKey:function(p){return this.checkKey(g.Cache.XML,p)},checkURL:function(p){if(this._urlMap[this._resolveURL(p)]){return true}return false},getImage:function(p){if(this._images[p]){return this._images[p].data}else{console.warn('Phaser.Cache.getImage: Invalid key: "'+p+'"');return null}},getTilemapData:function(p){if(this._tilemaps[p]){return this._tilemaps[p]}else{console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+p+'"');return null}},getFrameData:function(p,q){if(typeof q==="undefined"){q=g.Cache.IMAGE}if(this._cacheMap[q][p]){return this._cacheMap[q][p].frameData}return null},updateFrameData:function(p,q){if(this._images[p]){this._images[p].frameData=q}},getFrameByIndex:function(p,q){if(this._images[p]){return this._images[p].frameData.getFrame(q)}return null},getFrameByName:function(p,q){if(this._images[p]){return this._images[p].frameData.getFrameByName(q)}return null},getFrame:function(p){if(this._images[p]){return this._images[p].frame}return null},getTextureFrame:function(p){if(this._textures[p]){return this._textures[p].frame}return null},getRenderTexture:function(p){if(this._textures[p]){return this._textures[p]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+p+'"');return null}},getTexture:function(p){if(this._textures[p]){return this._textures[p]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+p+'"')}},getSound:function(p){if(this._sounds[p]){return this._sounds[p]}else{console.warn('Phaser.Cache.getSound: Invalid key: "'+p+'"');return null}},getSoundData:function(p){if(this._sounds[p]){return this._sounds[p].data}else{console.warn('Phaser.Cache.getSoundData: Invalid key: "'+p+'"');return null}},isSoundDecoded:function(p){if(this._sounds[p]){return this._sounds[p].decoded}},isSoundReady:function(p){return(this._sounds[p]&&this._sounds[p].decoded&&this.game.sound.touchLocked===false)},getFrameCount:function(p){if(this._images[p]){return this._images[p].frameData.total}return 0},getText:function(p){if(this._text[p]){return this._text[p].data}else{console.warn('Phaser.Cache.getText: Invalid key: "'+p+'"');return null}},getJSON:function(p){if(this._json[p]){return this._json[p].data}else{console.warn('Phaser.Cache.getJSON: Invalid key: "'+p+'"');return null}},getXML:function(p){if(this._xml[p]){return this._xml[p].data}else{console.warn('Phaser.Cache.getXML: Invalid key: "'+p+'"');return null}},getBinary:function(p){if(this._binary[p]){return this._binary[p]}else{console.warn('Phaser.Cache.getBinary: Invalid key: "'+p+'"');return null}},getURL:function(p){var p=this._resolveURL(p);if(p){return this._urlMap[p]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+p+'" or Cache.autoResolveURL was false');return null}},getUrl:function(p){return this.getURL(p)},getKeys:function(q){var s=null;switch(q){case g.Cache.CANVAS:s=this._canvases;break;case g.Cache.IMAGE:s=this._images;break;case g.Cache.TEXTURE:s=this._textures;break;case g.Cache.SOUND:s=this._sounds;break;case g.Cache.TEXT:s=this._text;break;case g.Cache.PHYSICS:s=this._physics;break;case g.Cache.TILEMAP:s=this._tilemaps;break;case g.Cache.BINARY:s=this._binary;break;case g.Cache.BITMAPDATA:s=this._bitmapDatas;break;case g.Cache.BITMAPFONT:s=this._bitmapFont;break;case g.Cache.JSON:s=this._json;break;case g.Cache.XML:s=this._xml;break}if(!s){return}var p=[];for(var r in s){if(r!=="__default"&&r!=="__missing"){p.push(r)}}return p},removeCanvas:function(p){delete this._canvases[p]},removeImage:function(q,p){if(typeof p==="undefined"){p=true}delete this._images[q];if(p){PIXI.BaseTextureCache[q].destroy()}},removeSound:function(p){delete this._sounds[p]},removeText:function(p){delete this._text[p]},removeJSON:function(p){delete this._json[p]},removeXML:function(p){delete this._xml[p]},removePhysics:function(p){delete this._physics[p]},removeTilemap:function(p){delete this._tilemaps[p]},removeBinary:function(p){delete this._binary[p]},removeBitmapData:function(p){delete this._bitmapDatas[p]},removeBitmapFont:function(p){delete this._bitmapFont[p]},_resolveURL:function(p,q){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+p;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(q){this._urlMap[this._urlTemp]=q}return this._urlTemp},destroy:function(){for(var q in this._images){if(q!=="__default"&&q!=="__missing"){delete this._images[q]}}var r=[this._canvases,this._sounds,this._text,this._json,this._xml,this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont];for(var p=0;p<r.length;p++){for(var q in r[p]){delete r[p][q]}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};g.Cache.prototype.constructor=g.Cache;g.Loader=function(p){this.game=p;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.onLoadStart=new g.Signal();this.onLoadComplete=new g.Signal();this.onPackComplete=new g.Signal();this.onFileStart=new g.Signal();this.onFileComplete=new g.Signal();this.onFileError=new g.Signal();this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};g.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;g.Loader.TEXTURE_ATLAS_JSON_HASH=1;g.Loader.TEXTURE_ATLAS_XML_STARLING=2;g.Loader.PHYSICS_LIME_CORONA_JSON=3;g.Loader.PHYSICS_PHASER_JSON=4;g.Loader.prototype={setPreloadSprite:function(p,q){q=q||0;this.preloadSprite={sprite:p,direction:q,width:p.width,height:p.height,rect:null};if(q===0){this.preloadSprite.rect=new g.Rectangle(0,0,1,p.height)}else{this.preloadSprite.rect=new g.Rectangle(0,0,p.width,1)}p.crop(this.preloadSprite.rect);p.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(q,p){return this.getAssetIndex(q,p)>-1},getAssetIndex:function(s,r){var t=-1;for(var q=0;q<this._fileList.length;q++){var p=this._fileList[q];if(p.type===s&&p.key===r){t=q;if(!p.loaded&&!p.loading){break}}}return t},getAsset:function(q,p){var r=this.getAssetIndex(q,p);if(r>-1){return{index:r,file:this._fileList[r]}}return false},reset:function(q,p){if(typeof p==="undefined"){p=false}if(this.resetLocked){return}if(q){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(p){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(w,x,q,v,u){var t={type:w,key:x,url:q,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(v){for(var p in v){t[p]=v[p]}}var s=this.getAssetIndex(w,x);if(u&&s>-1){var r=this._fileList[s];if(!r.loading&&!r.loaded){this._fileList[s]=t}else{this._fileList.push(t);this._totalFileCount++}}else{if(s===-1){this._fileList.push(t);this._totalFileCount++}}},replaceInFileList:function(s,r,p,q){return this.addToFileList(s,r,p,q,true)},pack:function(u,q,v,p){if(typeof q==="undefined"){q=null}if(typeof v==="undefined"){v=null}if(typeof p==="undefined"){p=null}if(!q&&!v){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var t={type:"packfile",key:u,url:q,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:p};if(v){if(typeof v==="string"){v=JSON.parse(v)}t.data=v||{};t.loaded=true}for(var s=0;s<this._fileList.length+1;s++){var r=this._fileList[s];if(!r||(!r.loaded&&!r.loading&&r.type!=="packfile")){this._fileList.splice(s,1,t);this._totalPackCount++;break}}return this},image:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("image",r,q,undefined,p);return this},text:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("text",r,q,undefined,p);return this},json:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("json",r,q,undefined,p);return this},xml:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("xml",r,q,undefined,p);return this},script:function(r,q,s,p){if(typeof s==="undefined"){s=false}if(s!==false&&typeof p==="undefined"){p=s}this.addToFileList("script",r,q,{syncPoint:true,callback:s,callbackContext:p});return this},binary:function(r,q,s,p){if(typeof s==="undefined"){s=false}if(s!==false&&typeof p==="undefined"){p=s}this.addToFileList("binary",r,q,{callback:s,callbackContext:p});return this},spritesheet:function(s,r,p,q,u,t,v){if(typeof u==="undefined"){u=-1}if(typeof t==="undefined"){t=0}if(typeof v==="undefined"){v=0}this.addToFileList("spritesheet",s,r,{frameWidth:p,frameHeight:q,frameMax:u,margin:t,spacing:v});return this},audio:function(q,r,p){if(typeof p==="undefined"){p=true}if(typeof r==="string"){r=[r]}this.addToFileList("audio",q,r,{buffer:null,autoDecode:p});return this},audiosprite:function(q,t,s,r,p){if(typeof s==="undefined"){s=null}if(typeof r==="undefined"){r=null}if(typeof p==="undefined"){p=true}this.audio(q,t,p);if(s){this.json(q+"-audioatlas",s)}else{if(r){if(typeof r==="string"){r=JSON.parse(r)}this.game.cache.addJSON(q+"-audioatlas","",r)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}}return this},tilemap:function(q,p,r,s){if(typeof p==="undefined"){p=null}if(typeof r==="undefined"){r=null}if(typeof s==="undefined"){s=g.Tilemap.CSV}if(!p&&!r){console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set.");return this}if(r){switch(s){case g.Tilemap.CSV:break;case g.Tilemap.TILED_JSON:if(typeof r==="string"){r=JSON.parse(r)}break}this.game.cache.addTilemap(q,null,r,s)}else{this.addToFileList("tilemap",q,p,{format:s})}return this},physics:function(q,p,r,s){if(typeof p==="undefined"){p=null}if(typeof r==="undefined"){r=null}if(typeof s==="undefined"){s=g.Physics.LIME_CORONA_JSON}if(!p&&!r){console.warn("Phaser.Loader.physics - Both url and data are null. One must be set.");return this}if(r){if(typeof r==="string"){r=JSON.parse(r)}this.game.cache.addPhysicsData(q,null,r,s)}else{this.addToFileList("physics",q,p,{format:s})}return this},bitmapFont:function(s,r,q,t,v,u){if(typeof q==="undefined"){q=null}if(typeof t==="undefined"){t=null}if(typeof v==="undefined"){v=0}if(typeof u==="undefined"){u=0}if(q){this.addToFileList("bitmapfont",s,r,{xmlURL:q,xSpacing:v,ySpacing:u})}else{if(typeof t==="string"){var p=this.parseXml(t);if(!p){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}this.addToFileList("bitmapfont",s,r,{xmlURL:null,xmlData:p,xSpacing:v,ySpacing:u})}}return this},atlasJSONArray:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(s,r,t,p,u){if(typeof t==="undefined"){t=null}if(typeof p==="undefined"){p=null}if(typeof u==="undefined"){u=g.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(t){this.addToFileList("textureatlas",s,r,{atlasURL:t,format:u})}else{switch(u){case g.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof p==="string"){p=JSON.parse(p)}break;case g.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof p==="string"){var q=this.parseXml(p);if(!q){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}p=q}break}this.addToFileList("textureatlas",s,r,{atlasURL:null,atlasData:p,format:u})}return this},withSyncPoint:function(q,p){this._withSyncPointDepth++;try{q.call(p||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(r,p){var q=this.getAsset(r,p);if(q){q.file.syncPoint=true}return this},removeFile:function(r,p){var q=this.getAsset(r,p);if(q){if(!q.loaded&&!q.loading){this._fileList.splice(q.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var s=0;s<this._flightQueue.length;s++){var r=this._flightQueue[s];if(r.loaded||r.error){this._flightQueue.splice(s,1);s--;r.loading=false;r.requestUrl=null;r.requestObject=null;if(r.error){this.onFileError.dispatch(r.key,r)}if(r.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,r.key,!r.error,this._loadedFileCount,this._totalFileCount)}else{if(r.type==="packfile"&&r.error){this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}}}}var p=false;var q=this.enableParallel?g.Math.clamp(this.maxParallelDownloads,1,12):1;for(var s=this._processingHead;s<this._fileList.length;s++){var r=this._fileList[s];if(r.type==="packfile"&&!r.error&&r.loaded&&s===this._processingHead){this.processPack(r);this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}if(r.loaded||r.error){if(s===this._processingHead){this._processingHead=s+1}}else{if(!r.loading&&this._flightQueue.length<q){if(r.type==="packfile"&&!r.data){this._flightQueue.push(r);r.loading=true;this.loadFile(r)}else{if(!p){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(r);r.loading=true;this.onFileStart.dispatch(this.progress,r.key,r.url);this.loadFile(r)}}}}if(!r.loaded&&r.syncPoint){p=true}if(this._flightQueue.length>=q||(p&&this._loadedPackCount===this._totalPackCount)){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else{if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var t=this;setTimeout(function(){t.finishedLoading(true)},2000)}}},finishedLoading:function(p){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!p&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.reset();this.game.state.loadComplete()},asyncComplete:function(q,p){if(typeof p==="undefined"){p=""}q.loaded=true;q.error=!!p;if(p){q.errorMessage=p;console.warn("Phaser.Loader - "+q.type+"["+q.key+"]: "+p)}this.processLoadQueue()},processPack:function(s){var p=s.data[s.key];if(!p){console.warn("Phaser.Loader - "+s.key+": pack has data, but not for pack key");return}for(var r=0;r<p.length;r++){var q=p[r];switch(q.type){case"image":this.image(q.key,q.url,q.overwrite);break;case"text":this.text(q.key,q.url,q.overwrite);break;case"json":this.json(q.key,q.url,q.overwrite);break;case"xml":this.xml(q.key,q.url,q.overwrite);break;case"script":this.script(q.key,q.url,q.callback,s.callbackContext||this);break;case"binary":this.binary(q.key,q.url,q.callback,s.callbackContext||this);break;case"spritesheet":this.spritesheet(q.key,q.url,q.frameWidth,q.frameHeight,q.frameMax,q.margin,q.spacing);break;case"audio":this.audio(q.key,q.urls,q.autoDecode);break;case"audiosprite":this.audio(q.key,q.urls,q.jsonURL);break;case"tilemap":this.tilemap(q.key,q.url,q.data,g.Tilemap[q.format]);break;case"physics":this.physics(q.key,q.url,q.data,g.Loader[q.format]);break;case"bitmapFont":this.bitmapFont(q.key,q.textureURL,q.xmlURL,q.xmlData,q.xSpacing,q.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasXML":this.atlasXML(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlas":this.atlas(q.key,q.textureURL,q.atlasURL,q.atlasData,g.Loader[q.format]);break}}},transformUrl:function(p){return this.baseURL+p},loadFile:function(p){switch(p.type){case"packfile":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(p);break;case"audio":p.url=this.getAudioURL(p.url);if(p.url){if(this.game.sound.usingWebAudio){this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete)}else{if(this.game.sound.usingAudioTag){this.loadAudioTag(p)}}}else{this.fileError(p,null,"no supported audio URL specified")}break;case"json":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.xmlLoadComplete);break;case"tilemap":if(p.format===g.Tilemap.TILED_JSON){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete)}else{if(p.format===g.Tilemap.CSV){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.csvLoadComplete)}else{this.asyncComplete(p,"invalid Tilemap format: "+p.format)}}break;case"text":case"script":case"physics":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"binary":this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete);break}},loadImageTag:function(p){var q=this;p.data=new Image();p.data.name=p.key;if(this.crossOrigin){p.data.crossOrigin=this.crossOrigin}p.data.onload=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileComplete(p)}};p.data.onerror=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileError(p)}};p.data.src=this.transformUrl(p.url,p);if(p.data.complete&&p.data.width&&p.data.height){p.data.onload=null;p.data.onerror=null;this.fileComplete(p)}},loadAudioTag:function(q){var r=this;if(this.game.sound.touchLocked){q.data=new Audio();q.data.name=q.key;q.data.preload="auto";q.data.src=this.transformUrl(q.url,q);this.fileComplete(q)}else{q.data=new Audio();q.data.name=q.key;var p=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;g.GAMES[r.game.id].load.fileComplete(q)};q.data.onerror=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;r.fileError(q)};q.data.preload="auto";q.data.src=this.transformUrl(q.url,q);q.data.addEventListener("canplaythrough",p,false);q.data.load()}},xhrLoad:function(r,q,s,t,p){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(r,q,s,t,p);return}var u=new XMLHttpRequest();u.open("GET",q,true);u.responseType=s;p=p||this.fileError;var v=this;u.onload=function(){try{return t.call(v,r,u)}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};u.onerror=function(){try{return p.call(v,r,u)}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};r.requestObject=u;r.requestUrl=q;u.send()},xhrLoadWithXDR:function(r,q,s,t,p){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var u=new window.XDomainRequest();u.open("GET",q,true);u.responseType=s;u.timeout=3000;p=p||this.fileError;var v=this;u.onerror=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.ontimeout=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.onprogress=function(){};u.onload=function(){try{return t.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};r.requestObject=u;r.requestUrl=q;setTimeout(function(){u.send()},0)},getAudioURL:function(s){for(var r=0;r<s.length;r++){var q=s[r];var p;if(q.uri){q=q.uri;p=q.type}else{if(q.indexOf("blob:")===0||q.indexOf("data:")===0){return q}if(q.indexOf("?")>=0){q=q.substr(0,q.indexOf("?"))}var t=q.substr((Math.max(0,q.lastIndexOf("."))||Infinity)+1);p=t.toLowerCase()}if(this.game.device.canPlayAudio(p)){return s[r]}}return null},fileError:function(q,t,s){var p=q.requestUrl||this.transformUrl(q.url,q);var r="error loading asset from URL "+p;if(!s&&t){s=t.status}if(s){r=r+" ("+s+")"}this.asyncComplete(q,r)},fileComplete:function(p,s){var r=true;switch(p.type){case"packfile":var q=JSON.parse(s.responseText);p.data=q||{};break;case"image":this.game.cache.addImage(p.key,p.url,p.data);break;case"spritesheet":this.game.cache.addSpriteSheet(p.key,p.url,p.data,p.frameWidth,p.frameHeight,p.frameMax,p.margin,p.spacing);break;case"textureatlas":if(p.atlasURL==null){this.game.cache.addTextureAtlas(p.key,p.url,p.data,p.atlasData,p.format)}else{r=false;if(p.format==g.Loader.TEXTURE_ATLAS_JSON_ARRAY||p.format==g.Loader.TEXTURE_ATLAS_JSON_HASH){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.jsonLoadComplete)}else{if(p.format==g.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+p.format)}}}break;case"bitmapfont":if(!p.xmlURL){this.game.cache.addBitmapFont(p.key,p.url,p.data,p.xmlData,p.xSpacing,p.ySpacing)}else{r=false;this.xhrLoad(p,this.transformUrl(p.xmlURL,p),"text",this.xmlLoadComplete)}break;case"audio":if(this.game.sound.usingWebAudio){p.data=s.response;this.game.cache.addSound(p.key,p.url,p.data,true,false);if(p.autoDecode){this.game.sound.decode(p.key)}}else{this.game.cache.addSound(p.key,p.url,p.data,false,true)}break;case"text":p.data=s.responseText;this.game.cache.addText(p.key,p.url,p.data);break;case"physics":var q=JSON.parse(s.responseText);this.game.cache.addPhysicsData(p.key,p.url,q,p.format);break;case"script":p.data=document.createElement("script");p.data.language="javascript";p.data.type="text/javascript";p.data.defer=false;p.data.text=s.responseText;document.head.appendChild(p.data);if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,s.responseText)}break;case"binary":if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,s.response)}else{p.data=s.response}this.game.cache.addBinary(p.key,p.data);break}if(r){this.asyncComplete(p)}},jsonLoadComplete:function(p,r){var q=JSON.parse(r.responseText);if(p.type==="tilemap"){this.game.cache.addTilemap(p.key,p.url,q,p.format)}else{if(p.type==="json"){this.game.cache.addJSON(p.key,p.url,q)}else{this.game.cache.addTextureAtlas(p.key,p.url,p.data,q,p.format)}}this.asyncComplete(p)},csvLoadComplete:function(p,r){var q=r.responseText;this.game.cache.addTilemap(p.key,p.url,q,p.format);this.asyncComplete(p)},xmlLoadComplete:function(r,t){var s=t.responseText;var q=this.parseXml(s);if(!q){var p=t.responseType||t.contentType;console.warn("Phaser.Loader - "+r.key+": invalid XML ("+p+")");this.asyncComplete(r,"invalid XML");return}if(r.type==="bitmapfont"){this.game.cache.addBitmapFont(r.key,r.url,r.data,q,r.xSpacing,r.ySpacing)}else{if(r.type==="textureatlas"){this.game.cache.addTextureAtlas(r.key,r.url,r.data,q,r.format)}else{if(r.type==="xml"){this.game.cache.addXML(r.key,r.url,q)}}}this.asyncComplete(r)},parseXml:function(q){var p;try{if(window.DOMParser){var s=new DOMParser();p=s.parseFromString(q,"text/xml")}else{p=new ActiveXObject("Microsoft.XMLDOM");p.async="false";p.loadXML(q)}}catch(r){p=null}if(!p||!p.documentElement||p.getElementsByTagName("parsererror").length){return null}else{return p}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(g.Loader.prototype,"progressFloat",{get:function(){var p=(this._loadedFileCount/this._totalFileCount)*100;return g.Math.clamp(p||0,0,100)}});Object.defineProperty(g.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});g.Loader.prototype.constructor=g.Loader;g.LoaderParser={bitmapFont:function(E,v,z,A,w){var s={};var q=v.getElementsByTagName("info")[0];var x=v.getElementsByTagName("common")[0];s.font=q.getAttribute("face");s.size=parseInt(q.getAttribute("size"),10);s.lineHeight=parseInt(x.getAttribute("lineHeight"),10)+w;s.chars={};var y=v.getElementsByTagName("char");for(var r=0;r<y.length;r++){var D=parseInt(y[r].getAttribute("id"),10);var C=new PIXI.Rectangle(parseInt(y[r].getAttribute("x"),10),parseInt(y[r].getAttribute("y"),10),parseInt(y[r].getAttribute("width"),10),parseInt(y[r].getAttribute("height"),10));s.chars[D]={xOffset:parseInt(y[r].getAttribute("xoffset"),10),yOffset:parseInt(y[r].getAttribute("yoffset"),10),xAdvance:parseInt(y[r].getAttribute("xadvance"),10)+A,kerning:{},texture:PIXI.TextureCache[z]=new PIXI.Texture(PIXI.BaseTextureCache[z],C)}}var B=v.getElementsByTagName("kerning");for(r=0;r<B.length;r++){var u=parseInt(B[r].getAttribute("first"),10);var p=parseInt(B[r].getAttribute("second"),10);var t=parseInt(B[r].getAttribute("amount"),10);s.chars[p].kerning[u]=t}PIXI.BitmapText.fonts[z]=s}};g.AudioSprite=function(r,s){this.game=r;this.key=s;this.config=this.game.cache.getJSON(s+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var q in this.config.spritemap){var p=this.config.spritemap[q];var t=this.game.add.sound(this.key);t.addMarker(q,p.start,(p.end-p.start),null,p.loop);this.sounds[q]=t}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};g.AudioSprite.prototype={play:function(p,q){if(typeof q==="undefined"){q=1}return this.sounds[p].play(p,null,q)},stop:function(p){if(!p){for(var q in this.sounds){this.sounds[q].stop()}}else{this.sounds[p].stop()}},get:function(p){return this.sounds[p]}};g.AudioSprite.prototype.constructor=g.AudioSprite;g.Sound=function(r,s,t,p,q){if(typeof t==="undefined"){t=1}if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=r.sound.connectToMaster}this.game=r;this.name=s;this.key=s;this.loop=p;this.volume=t;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=t*this.game.sound.volume;if(q){this.gainNode.connect(this.masterGainNode)}}else{if(this.usingAudioTag){if(this.game.cache.getSound(s)&&this.game.cache.isSoundReady(s)){this._sound=this.game.cache.getSoundData(s);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}}this.onDecoded=new g.Signal();this.onPlay=new g.Signal();this.onPause=new g.Signal();this.onResume=new g.Signal();this.onLoop=new g.Signal();this.onStop=new g.Signal();this.onMute=new g.Signal();this.onMarkerComplete=new g.Signal();this.onFadeComplete=new g.Signal();this._volume=t;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};g.Sound.prototype={soundHasUnlocked:function(p){if(p===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(q,t,s,r,p){if(typeof r==="undefined"){r=1}if(typeof p==="undefined"){p=false}this.markers[q]={name:q,start:t,stop:t+s,volume:r,duration:s,durationMS:s*1000,loop:p}},removeMarker:function(p){delete this.markers[p]},onEndedHandler:function(){this.isPlaying=false;this.stop()},update:function(){if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(p){this.play(null,0,p,true)},play:function(r,p,t,q,s){if(typeof r==="undefined"||r===false||r===null){r=""}if(typeof s==="undefined"){s=true}if(this.isPlaying&&!this.allowMultiple&&!s&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||s)){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(u){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}if(r===""&&Object.keys(this.markers).length>0){return this}if(r!==""){this.currentMarker=r;if(this.markers[r]){this.position=this.markers[r].start;this.volume=this.markers[r].volume;this.loop=this.markers[r].loop;this.duration=this.markers[r].duration;this.durationMS=this.markers[r].durationMS;if(typeof t!=="undefined"){this.volume=t}if(typeof q!=="undefined"){this.loop=q}this._tempMarker=r;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{return this}}else{p=p||0;if(typeof t==="undefined"){t=this._volume}if(typeof q==="undefined"){q=this.loop}this.position=p;this.volume=t;this.loop=q;this.duration=0;this.durationMS=0;this._tempMarker=r;this._tempPosition=p;this._tempVolume=t;this._tempLoop=q}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer===null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop&&r===""){this._sound.loop=true}if(!this.loop&&r===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1000)}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&r===""){this._sound.start(0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(r,p,s,q){r=r||"";p=p||0;s=s||1;if(typeof q==="undefined"){q=false}this.play(r,p,s,q,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var r=this.position+(this.pausedPosition/1000);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var q=this.duration-(this.pausedPosition/1000);if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,r,q)}else{this._sound.start(0,r,q)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.time-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(q){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.pendingPlayback=false;this.isPlaying=false;var p=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}if(!this.paused){this.onStop.dispatch(this,p)}},fadeIn:function(r,q,p){if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=this.currentMarker}if(this.paused){return}this.play(p,0,0,q);this.fadeTo(r,1)},fadeOut:function(p){this.fadeTo(p,0)},fadeTo:function(q,p){if(!this.isPlaying||this.paused||p===this.volume){return}if(typeof q==="undefined"){q=1000}if(typeof p==="undefined"){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:p},q,g.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},destroy:function(p){if(typeof p==="undefined"){p=true}this.stop();if(p){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};g.Sound.prototype.constructor=g.Sound;Object.defineProperty(g.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(g.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(g.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(p){p=p||null;if(p){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(g.Sound.prototype,"volume",{get:function(){return this._volume},set:function(p){if(this.usingWebAudio){this._volume=p;this.gainNode.gain.value=p}else{if(this.usingAudioTag&&this._sound){if(p>=0&&p<=1){this._volume=p;this._sound.volume=p}}}}});g.SoundManager=function(p){this.game=p;this.onSoundDecode=new g.Signal();this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new g.ArraySet();this._watching=false;this._watchCallback=null;this._watchContext=null;this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};g.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(!this.game.device.cocoonJS&&this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext){this.context=window.PhaserGlobal.audioContext}else{if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.noAudio=true}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.noAudio=true}}}}if(!!window.Audio&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||(window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===true)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var p=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=p;this._unlockSource.connect(this.context.destination);if(typeof this._unlockSource.start==="undefined"){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}},stopAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].stop()}}},pauseAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].pause()}}},resumeAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].resume()}}},decode:function(q,s){s=s||null;var p=this.game.cache.getSoundData(q);if(p){if(this.game.cache.isSoundDecoded(q)===false){this.game.cache.updateSound(q,"isDecoding",true);var r=this;this.context.decodeAudioData(p,function(t){if(t){r.game.cache.decodedSound(q,t);r.onSoundDecode.dispatch(q,s)}})}}},setDecodedCallback:function(r,s,p){if(typeof r==="string"){r=[r]}this._watchList.reset();for(var q=0;q<r.length;q++){if(r[q] instanceof g.Sound){if(!this.game.cache.isSoundDecoded(r[q].key)){this._watchList.add(r[q].key)}}else{if(!this.game.cache.isSoundDecoded(r[q])){this._watchList.add(r[q])}}}if(this._watchList.total===0){this._watching=false;s.call(p)}else{this._watching=true;this._watchCallback=s;this._watchContext=p}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if((this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var q=0;q<this._sounds.length;q++){this._sounds[q].update()}if(this._watching){var p=this._watchList.first;while(p){if(this.game.cache.isSoundDecoded(p)){this._watchList.remove(p)}p=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(r,s,p,q){if(typeof s==="undefined"){s=1}if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=this.connectToMaster}var t=new g.Sound(this.game,r,s,p,q);this._sounds.push(t);return t},addSprite:function(q){var p=new g.AudioSprite(this.game,q);return p},remove:function(q){var p=this._sounds.length;while(p--){if(this._sounds[p]===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);return true}}return false},removeByKey:function(q){var p=this._sounds.length;var r=0;while(p--){if(this._sounds[p].key===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);r++}}return r},play:function(q,r,p){var s=this.add(q,r,p);s.play();return s},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=true}}},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=false}}},destroy:function(){this.stopAll();for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context&&window.PhaserGlobal){window.PhaserGlobal.audioContext=this.context}}};g.SoundManager.prototype.constructor=g.SoundManager;Object.defineProperty(g.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(p){p=p||null;if(p){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(g.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(q){this._volume=q;if(this.usingWebAudio){this.masterGain.gain.value=q}else{for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].volume=this._sounds[p].volume*q}}}}});g.Utils.Debug=function(p){this.game=p;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};g.Utils.Debug.prototype={boot:function(){if(this.game.renderType===g.CANVAS){this.context=this.game.context}else{this.bmd=this.game.make.bitmapData(this.game.width,this.game.height);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.canvas=g.Canvas.create(this.game.width,this.game.height,"",true);this.context=this.canvas.getContext("2d")}},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(p,s,q,r){if(typeof p!=="number"){p=0}if(typeof s!=="number"){s=0}q=q||"rgb(255,255,255)";if(typeof r==="undefined"){r=0}this.currentX=p;this.currentY=s;this.currentColor=q;this.currentAlpha=this.context.globalAlpha;this.columnWidth=r;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=q;this.context.fillStyle=q;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(){var p=this.currentX;for(var q=0;q<arguments.length;q++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[q],p+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[q],p,this.currentY);p+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sound: "+r.key+" Locked: "+r.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(r.key)+" Pending Playback: "+r.pendingPlayback);this.line("Decoded: "+r.isDecoded+" Decoding: "+r.isDecoding);this.line("Total Duration: "+r.totalDuration+" Playing: "+r.isPlaying);this.line("Time: "+r.currentTime);this.line("Volume: "+r.volume+" Muted: "+r.mute);this.line("WebAudio: "+r.usingWebAudio+" Audio: "+r.usingAudioTag);if(r.currentMarker!==""){this.line("Marker: "+r.currentMarker+" Duration: "+r.duration+" (ms: "+r.durationMS+")");this.line("Start: "+r.markers[r.currentMarker].start+" Stop: "+r.markers[r.currentMarker].stop);this.line("Position: "+r.position)}this.stop()},cameraInfo:function(r,p,s,q){this.start(p,s,q);this.line("Camera ("+r.width+" x "+r.height+")");this.line("X: "+r.x+" Y: "+r.y);if(r.bounds){this.line("Bounds x: "+r.bounds.x+" Y: "+r.bounds.y+" w: "+r.bounds.width+" h: "+r.bounds.height)}this.line("View x: "+r.view.x+" Y: "+r.view.y+" w: "+r.view.width+" h: "+r.view.height);this.line("Total in view: "+r.totalInView);this.stop()},timer:function(s,p,r,q){this.start(p,r,q);this.line("Timer (running: "+s.running+" expired: "+s.expired+")");this.line("Next Tick: "+s.next+" Duration: "+s.duration);this.line("Paused: "+s.paused+" Length: "+s.length);this.stop()},pointer:function(t,s,q,r,p){if(t==null){return}if(typeof s==="undefined"){s=false}q=q||"rgba(0,255,0,0.5)";r=r||"rgba(255,0,0,0.5)";if(s===true&&t.isUp===true){return}this.start(t.x,t.y-100,p);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=q}else{this.context.fillStyle=r}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite Input: ("+r.width+" x "+r.height+")");this.line("x: "+r.input.pointerX().toFixed(1)+" y: "+r.input.pointerY().toFixed(1));this.line("over: "+r.input.pointerOver()+" duration: "+r.input.overDuration().toFixed(0));this.line("down: "+r.input.pointerDown()+" duration: "+r.input.downDuration().toFixed(0));this.line("just over: "+r.input.justOver()+" just out: "+r.input.justOut());this.stop()},key:function(r,p,s,q){this.start(p,s,q,150);this.line("Key:",r.keyCode,"isDown:",r.isDown);this.line("justDown:",r.justDown,"justUp:",r.justUp);this.line("Time Down:",r.timeDown.toFixed(0),"duration:",r.duration.toFixed(0));this.stop()},inputInfo:function(p,r,q){this.start(p,r,q);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(q,p,s){var r=q.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,p,s)},ropeSegments:function(s,p,r){var q=s.segments;q.forEach(function(t){this.rectangle(t,p,r)},this)},spriteInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite:  ("+r.width+" x "+r.height+") anchor: "+r.anchor.x+" x "+r.anchor.y);this.line("x: "+r.x.toFixed(1)+" y: "+r.y.toFixed(1));this.line("angle: "+r.angle.toFixed(1)+" rotation: "+r.rotation.toFixed(1));this.line("visible: "+r.visible+" in camera: "+r.inCamera);this.line("bounds x: "+r._bounds.x.toFixed(1)+" y: "+r._bounds.y.toFixed(1)+" w: "+r._bounds.width.toFixed(1)+" h: "+r._bounds.height.toFixed(1));this.stop()},spriteCoords:function(r,p,s,q){this.start(p,s,q,100);if(r.name){this.line(r.name)}this.line("x:",r.x.toFixed(2),"y:",r.y.toFixed(2));this.line("pos x:",r.position.x.toFixed(2),"pos y:",r.position.y.toFixed(2));this.line("world x:",r.world.x.toFixed(2),"world y:",r.world.y.toFixed(2));this.stop()},lineInfo:function(q,p,s,r){this.start(p,s,r,80);this.line("start.x:",q.start.x.toFixed(2),"start.y:",q.start.y.toFixed(2));this.line("end.x:",q.end.x.toFixed(2),"end.y:",q.end.y.toFixed(2));this.line("length:",q.length.toFixed(2),"angle:",q.angle);this.stop()},pixel:function(p,s,q,r){r=r||2;this.start();this.context.fillStyle=q;this.context.fillRect(p,s,r,r);this.stop()},geom:function(q,p,s,r){if(typeof s==="undefined"){s=true}if(typeof r==="undefined"){r=0}p=p||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=p;this.context.strokeStyle=p;if(q instanceof g.Rectangle||r===1){if(s){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}}else{if(q instanceof g.Circle||r===2){this.context.beginPath();this.context.arc(q.x-this.game.camera.x,q.y-this.game.camera.y,q.radius,0,Math.PI*2,false);this.context.closePath();if(s){this.context.fill()}else{this.context.stroke()}}else{if(q instanceof g.Point||r===3){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,4,4)}else{if(q instanceof g.Line||r===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo((q.start.x+0.5)-this.game.camera.x,(q.start.y+0.5)-this.game.camera.y);this.context.lineTo((q.end.x+0.5)-this.game.camera.x,(q.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(q,p,r){if(typeof r==="undefined"){r=true}p=p||"rgba(0, 255, 0, 0.4)";this.start();if(r){this.context.fillStyle=p;this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeStyle=p;this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}this.stop()},text:function(s,p,t,r,q){r=r||"rgb(255,255,255)";q=q||"16px Courier";this.start();this.context.font=q;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(s,p+1,t+1)}this.context.fillStyle=r;this.context.fillText(s,p,t);this.stop()},quadTree:function(p,q){q=q||"rgba(255,0,0,0.3)";this.start();var s=p.bounds;if(p.nodes.length===0){this.context.strokeStyle=q;this.context.strokeRect(s.x,s.y,s.width,s.height);this.text("size: "+p.objects.length,s.x+4,s.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<p.objects.length;r++){this.context.strokeRect(p.objects[r].x,p.objects[r].y,p.objects[r].width,p.objects[r].height)}}else{for(var r=0;r<p.nodes.length;r++){this.quadTree(p.nodes[r])}}this.stop()},body:function(q,p,r){if(q.body){this.start();if(q.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.NINJA){g.Physics.Ninja.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.BOX2D){g.Physics.Box2D.renderBody(this.context,q.body,p)}}}this.stop()}},bodyInfo:function(r,p,s,q){if(r.body){this.start(p,s,q,210);if(r.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.renderBodyInfo(this,r.body)}else{if(r.body.type===g.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,r.body)}}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(p,q){this.start();g.Physics.Box2D.renderBody(this.context,p,q);this.stop()}};g.Utils.Debug.prototype.constructor=g.Utils.Debug;g.ArraySet=function(p){this.position=0;this.list=p||[]};g.ArraySet.prototype={add:function(p){if(!this.exists(p)){this.list.push(p)}return p},getIndex:function(p){return this.list.indexOf(p)},getByKey:function(r,q){var p=this.list.length;while(p--){if(this.list[p][r]===q){return this.list[p]}}return null},exists:function(p){return(this.list.indexOf(p)>-1)},reset:function(){this.list.length=0},remove:function(q){var p=this.list.indexOf(q);if(p>-1){this.list.splice(p,1);return q}},setAll:function(q,r){var p=this.list.length;while(p--){if(this.list[p]){this.list[p][q]=r}}},callAll:function(r){var p=Array.prototype.splice.call(arguments,1);var q=this.list.length;while(q--){if(this.list[q]&&this.list[q][r]){this.list[q][r].apply(this.list[q],p)}}},removeAll:function(q){if(typeof q==="undefined"){q=false}var p=this.list.length;while(p--){if(this.list[p]){var r=this.remove(this.list[p]);if(q){r.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(g.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(g.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(g.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});g.ArraySet.prototype.constructor=g.ArraySet;g.ArrayList=g.ArraySet;g.ArrayUtils={getRandomItem:function(r,s,q){if(r==null){return null}if(typeof s==="undefined"){s=0}if(typeof q==="undefined"){q=r.length}var p=s+Math.floor(Math.random()*q);return r[p]===undefined?null:r[p]},removeRandomItem:function(r,t,q){if(r==null){return null}if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=r.length}var p=t+Math.floor(Math.random()*q);if(p<r.length){var s=r.splice(p,1);return s[0]===undefined?null:s[0]}else{return null}},shuffle:function(s){for(var r=s.length-1;r>0;r--){var q=Math.floor(Math.random()*(r+1));var p=s[r];s[r]=s[q];s[q]=p}return s},transposeMatrix:function(u){var t=u.length;var q=u[0].length;var p=new Array(q);for(var s=0;s<q;s++){p[s]=new Array(t);for(var r=t-1;r>-1;r--){p[s][r]=u[r][s]}}return p},rotateMatrix:function(p,r){if(typeof r!=="string"){r=((r%360)+360)%360}if(r===90||r===-270||r==="rotateLeft"){p=g.ArrayUtils.transposeMatrix(p);p=p.reverse()}else{if(r===-90||r===270||r==="rotateRight"){p=p.reverse();p=g.ArrayUtils.transposeMatrix(p)}else{if(Math.abs(r)===180||r==="rotate180"){for(var q=0;q<p.length;q++){p[q].reverse()}p=p.reverse()}}}return p},findClosest:function(t,q){if(!q.length){return NaN}else{if(q.length===1||t<q[0]){return q[0]}}var r=1;while(q[r]<t){r++}var p=q[r-1];var s=(r<q.length)?q[r]:Number.POSITIVE_INFINITY;return((s-t)<=(t-p))?s:p},rotate:function(q){var p=q.shift();q.push(p);return p},numberArray:function(s,q){var p=[];for(var r=s;r<=q;r++){p.push(r)}return p},numberArrayStep:function(v,q,u){v=+v||0;var s=typeof q;if((s==="number"||s==="string")&&u&&u[q]===v){q=u=null}u=u==null?1:(+u||0);if(q===null){q=v;v=0}else{q=+q||0}var r=-1;var t=Math.max(g.Math.roundAwayFromZero((q-v)/(u||1)),0);var p=new Array(t);while(++r<t){p[r]=v;v+=u}return p}};g.Color={packPixel:function(t,s,p,q){if(g.Device.LITTLE_ENDIAN){return((q<<24)|(p<<16)|(s<<8)|t)>>>0}else{return((t<<24)|(s<<16)|(p<<8)|q)>>>0}},unpackPixel:function(s,r,p,q){if(typeof r==="undefined"||r===null){r=g.Color.createColor()}if(typeof p==="undefined"||p===null){p=false}if(typeof q==="undefined"||q===null){q=false}if(g.Device.LITTLE_ENDIAN){r.a=((s&4278190080)>>>24);r.b=((s&16711680)>>>16);r.g=((s&65280)>>>8);r.r=((s&255))}else{r.r=((s&4278190080)>>>24);r.g=((s&16711680)>>>16);r.b=((s&65280)>>>8);r.a=((s&255))}r.color=s;r.rgba="rgba("+r.r+","+r.g+","+r.b+","+(r.a/255)+")";if(p){g.Color.RGBtoHSL(r.r,r.g,r.b,r)}if(q){g.Color.RGBtoHSV(r.r,r.g,r.b,r)}return r},fromRGBA:function(q,p){if(!p){p=g.Color.createColor()}p.r=((q&4278190080)>>>24);p.g=((q&16711680)>>>16);p.b=((q&65280)>>>8);p.a=((q&255));p.rgba="rgba("+p.r+","+p.g+","+p.b+","+p.a+")";return p},toRGBA:function(t,s,p,q){return(t<<24)|(s<<16)|(p<<8)|q},RGBtoHSL:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,1)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);s.h=0;s.s=0;s.l=(p+t)/2;if(p!==t){var w=p-t;s.s=s.l>0.5?w/(2-p-t):w/(p+t);if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSLtoRGB:function(v,u,r,t){if(!t){t=g.Color.createColor(r,r,r)}else{t.r=r;t.g=r;t.b=r}if(u!==0){var w=r<0.5?r*(1+u):r+u-r*u;var x=2*r-w;t.r=g.Color.hueToColor(x,w,v+1/3);t.g=g.Color.hueToColor(x,w,v);t.b=g.Color.hueToColor(x,w,v-1/3)}t.r=Math.floor((t.r*255|0));t.g=Math.floor((t.g*255|0));t.b=Math.floor((t.b*255|0));g.Color.updateColor(t);return t},RGBtoHSV:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,255)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);var w=p-t;s.h=0;s.s=p===0?0:w/p;s.v=p;if(p!==t){if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSVtoRGB:function(A,G,E,y){if(typeof y==="undefined"){y=g.Color.createColor(0,0,0,1,A,G,0,E)}var u,B,D;var z=Math.floor(A*6);var C=A*6-z;var x=E*(1-G);var w=E*(1-C*G);var F=E*(1-(1-C)*G);switch(z%6){case 0:u=E;B=F;D=x;break;case 1:u=w;B=E;D=x;break;case 2:u=x;B=E;D=F;break;case 3:u=x;B=w;D=E;break;case 4:u=F;B=x;D=E;break;case 5:u=E;B=x;D=w;break}y.r=Math.floor(u*255);y.g=Math.floor(B*255);y.b=Math.floor(D*255);g.Color.updateColor(y);return y},hueToColor:function(u,s,r){if(r<0){r+=1}if(r>1){r-=1}if(r<1/6){return u+(s-u)*6*r}if(r<1/2){return s}if(r<2/3){return u+(s-u)*(2/3-r)*6}return u},createColor:function(p,w,x,y,u,A,q,z){var t={r:p||0,g:w||0,b:x||0,a:y||1,h:u||0,s:A||0,l:q||0,v:z||0,color:0,color32:0,rgba:""};t.color=g.Color.getColor(t.r,t.g,t.b);t.color32=g.Color.getColor32(t.a,t.r,t.g,t.b);return g.Color.updateColor(t)},updateColor:function(p){p.rgba="rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+p.a.toString()+")";return p},getColor32:function(q,t,s,p){return q<<24|t<<16|s<<8|p},getColor:function(s,q,p){return s<<16|q<<8|p},RGBtoString:function(t,s,p,q,u){if(typeof q==="undefined"){q=255}if(typeof u==="undefined"){u="#"}if(u==="#"){return"#"+((1<<24)+(t<<16)+(s<<8)+p).toString(16).slice(1)}else{return"0x"+g.Color.componentToHex(q)+g.Color.componentToHex(t)+g.Color.componentToHex(s)+g.Color.componentToHex(p)}},hexToRGB:function(q){var p=g.Color.hexToColor(q);if(p){return g.Color.getColor32(p.a,p.r,p.g,p.b)}},hexToColor:function(v,s){v=v.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(x,z,y,w){return z+z+y+y+w+w});var q=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);if(q){var u=parseInt(q[1],16);var t=parseInt(q[2],16);var p=parseInt(q[3],16);if(!s){s=g.Color.createColor(u,t,p)}else{s.r=u;s.g=t;s.b=p}}return s},webToColor:function(q,r){if(!r){r=g.Color.createColor()}var p=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(q);if(p){r.r=parseInt(p[1],10);r.g=parseInt(p[2],10);r.b=parseInt(p[3],10);r.a=p[4]!==undefined?parseFloat(p[4]):1}return r},valueToColor:function(r,q){if(!q){q=g.Color.createColor()}if(typeof r==="string"){if(r.indexOf("rgb")===0){return g.Color.webToColor(r,q)}else{q.a=1;return g.Color.hexToColor(r,q)}}else{if(typeof r==="number"){var p=g.Color.getRGB(r);q.r=p.r;q.g=p.g;q.b=p.b;q.a=p.a/255;return q}else{return q}}},componentToHex:function(p){var q=p.toString(16);return q.length==1?"0"+q:q},HSVColorWheel:function(r,q){if(typeof r==="undefined"){r=1}if(typeof q==="undefined"){q=1}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSVtoRGB(t/359,r,q))}return p},HSLColorWheel:function(r,q){if(typeof r==="undefined"){r=0.5}if(typeof q==="undefined"){q=0.5}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSLtoRGB(t/359,r,q))}return p},interpolateColor:function(z,y,x,q,u){if(typeof u==="undefined"){u=255}var t=g.Color.getRGB(z);var s=g.Color.getRGB(y);var p=(((s.red-t.red)*q)/x)+t.red;var v=(((s.green-t.green)*q)/x)+t.green;var w=(((s.blue-t.blue)*q)/x)+t.blue;return g.Color.getColor32(u,p,v,w)},interpolateColorWithRGB:function(u,q,w,y,x,s){var p=g.Color.getRGB(u);var v=(((q-p.red)*s)/x)+p.red;var z=(((w-p.green)*s)/x)+p.green;var t=(((y-p.blue)*s)/x)+p.blue;return g.Color.getColor(v,z,t)},interpolateRGB:function(u,q,z,t,A,x,y,s){var p=(((t-u)*s)/y)+u;var v=(((A-q)*s)/y)+q;var w=(((x-z)*s)/y)+z;return g.Color.getColor(p,v,w)},getRandomColor:function(r,q,u){if(typeof r==="undefined"){r=0}if(typeof q==="undefined"){q=255}if(typeof u==="undefined"){u=255}if(q>255||r>q){return g.Color.getColor(255,255,255)}var t=r+Math.round(Math.random()*(q-r));var s=r+Math.round(Math.random()*(q-r));var p=r+Math.round(Math.random()*(q-r));return g.Color.getColor32(u,t,s,p)},getRGB:function(p){if(p>16777215){return{alpha:p>>>24,red:p>>16&255,green:p>>8&255,blue:p&255,a:p>>>24,r:p>>16&255,g:p>>8&255,b:p&255}}else{return{alpha:255,red:p>>16&255,green:p>>8&255,blue:p&255,a:255,r:p>>16&255,g:p>>8&255,b:p&255}}},getWebRGB:function(p){if(typeof p==="object"){return"rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+(p.a/255).toString()+")"}else{var q=g.Color.getRGB(p);return"rgba("+q.r.toString()+","+q.g.toString()+","+q.b.toString()+","+(q.a/255).toString()+")"}},getAlpha:function(p){return p>>>24},getAlphaFloat:function(p){return(p>>>24)/255},getRed:function(p){return p>>16&255},getGreen:function(p){return p>>8&255},getBlue:function(p){return p&255}};g.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};g.LinkedList.prototype={add:function(p){if(this.total===0&&this.first===null&&this.last===null){this.first=p;this.last=p;this.next=p;p.prev=this;this.total++;return p}this.last.next=p;p.prev=this.last;this.last=p;this.total++;return p},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(p){if(this.total===1){this.reset();p.next=p.prev=null;return}if(p===this.first){this.first=this.first.next}else{if(p===this.last){this.last=this.last.prev}}if(p.prev){p.prev.next=p.next}if(p.next){p.next.prev=p.prev}p.next=p.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(q){if(!this.first||!this.last){return}var p=this.first;do{if(p&&p[q]){p[q].call(p)}p=p.next}while(p!=this.last.next)}};g.LinkedList.prototype.constructor=g.LinkedList;g.Physics=function(p,q){q=q||{};this.game=p;this.config=q;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};g.Physics.ARCADE=0;g.Physics.P2JS=1;g.Physics.NINJA=2;g.Physics.BOX2D=3;g.Physics.CHIPMUNK=4;g.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&g.Physics.hasOwnProperty("Arcade")){this.arcade=new g.Physics.Arcade(this.game);this.game.time.deltaCap=0.2}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&g.Physics.hasOwnProperty("Ninja")){this.ninja=new g.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&g.Physics.hasOwnProperty("P2")){this.p2=new g.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config.box2d===true&&g.Physics.hasOwnProperty("BOX2D")){this.box2d=new g.Physics.BOX2D(this.game,this.config)}},startSystem:function(p){if(p===g.Physics.ARCADE){this.arcade=new g.Physics.Arcade(this.game)}else{if(p===g.Physics.P2JS){if(this.p2===null){this.p2=new g.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else{if(p===g.Physics.NINJA){this.ninja=new g.Physics.Ninja(this.game)}else{if(p===g.Physics.BOX2D){if(this.box2d===null){this.box2d=new g.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}}}}},enable:function(q,r,p){if(typeof r==="undefined"){r=g.Physics.ARCADE}if(typeof p==="undefined"){p=false}if(r===g.Physics.ARCADE){this.arcade.enable(q)}else{if(r===g.Physics.P2JS&&this.p2){this.p2.enable(q,p)}else{if(r===g.Physics.NINJA&&this.ninja){this.ninja.enableAABB(q)}else{if(r===g.Physics.BOX2D&&this.box2d){this.box2d.enable(q)}}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null}};g.Physics.prototype.constructor=g.Physics;g.Physics.Arcade=function(p){this.game=p;this.gravity=new g.Point();this.bounds=new g.Rectangle(0,0,p.world.width,p.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=g.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new g.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};g.Physics.Arcade.prototype.constructor=g.Physics.Arcade;g.Physics.Arcade.SORT_NONE=0;g.Physics.Arcade.LEFT_RIGHT=1;g.Physics.Arcade.RIGHT_LEFT=2;g.Physics.Arcade.TOP_BOTTOM=3;g.Physics.Arcade.BOTTOM_TOP=4;g.Physics.Arcade.prototype={setBounds:function(q,s,r,p){this.bounds.setTo(q,s,r,p)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(p,r){if(typeof r==="undefined"){r=true}var q=1;if(Array.isArray(p)){q=p.length;while(q--){if(p[q] instanceof g.Group){this.enable(p[q].children,r)}else{this.enableBody(p[q]);if(r&&p[q].hasOwnProperty("children")&&p[q].children.length>0){this.enable(p[q],true)}}}}else{if(p instanceof g.Group){this.enable(p.children,r)}else{this.enableBody(p);if(r&&p.hasOwnProperty("children")&&p.children.length>0){this.enable(p.children,true)}}}},enableBody:function(p){if(p.hasOwnProperty("body")&&p.body===null){p.body=new g.Physics.Arcade.Body(p)}},updateMotion:function(p){var q=this.computeVelocity(0,p,p.angularVelocity,p.angularAcceleration,p.angularDrag,p.maxAngular)-p.angularVelocity;p.angularVelocity+=q;p.rotation+=(p.angularVelocity*this.game.time.physicsElapsed);p.velocity.x=this.computeVelocity(1,p,p.velocity.x,p.acceleration.x,p.drag.x,p.maxVelocity.x);p.velocity.y=this.computeVelocity(2,p,p.velocity.y,p.acceleration.y,p.drag.y,p.maxVelocity.y)},computeVelocity:function(s,q,u,t,r,p){if(typeof p==="undefined"){p=10000}if(s===1&&q.allowGravity){u+=(this.gravity.x+q.gravity.x)*this.game.time.physicsElapsed}else{if(s===2&&q.allowGravity){u+=(this.gravity.y+q.gravity.y)*this.game.time.physicsElapsed}}if(t){u+=t*this.game.time.physicsElapsed}else{if(r){r*=this.game.time.physicsElapsed;if(u-r>0){u-=r}else{if(u+r<0){u+=r}else{u=0}}}}if(u>p){u=p}else{if(u<-p){u=-p}}return u},overlap:function(v,u,p,t,q){p=p||null;t=t||null;q=q||p;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<u.length;s++){this.collideHandler(v,u[s],p,t,q,true)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var s=0;s<v.length;s++){this.collideHandler(v[s],u,p,t,q,true)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<v.length;s++){for(var r=0;r<u.length;r++){this.collideHandler(v[s],u[r],p,t,q,true)}}}else{this.collideHandler(v,u,p,t,q,true)}}}return(this._total>0)},collide:function(v,u,t,s,p){t=t||null;s=s||null;p=p||t;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<u.length;r++){this.collideHandler(v,u[r],t,s,p,false)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var r=0;r<v.length;r++){this.collideHandler(v[r],u,t,s,p,false)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<v.length;r++){for(var q=0;q<u.length;q++){this.collideHandler(v[r],u[q],t,s,p,false)}}}else{this.collideHandler(v,u,t,s,p,false)}}}return(this._total>0)},sort:function(p){if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return r.body.x-q.body.x})}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return q.body.x-r.body.x})}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return r.body.y-q.body.y})}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return q.body.y-r.body.y})}}}}},collideHandler:function(u,t,s,r,p,q){if(typeof t==="undefined"&&u.physicsType===g.GROUP){this.sort(u);this.collideGroupVsSelf(u,s,r,p,q);return}if(!u||!t||!u.exists||!t.exists){return}if(this.sortDirection!==g.Physics.Arcade.SORT_NONE){if(u.physicsType===g.GROUP){this.sort(u)}if(t.physicsType===g.GROUP){this.sort(t)}}if(u.physicsType===g.SPRITE){if(t.physicsType===g.SPRITE){this.collideSpriteVsSprite(u,t,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideSpriteVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(u,t,s,r,p)}}}}else{if(u.physicsType===g.GROUP){if(t.physicsType===g.SPRITE){this.collideSpriteVsGroup(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideGroupVsTilemapLayer(u,t,s,r,p,q)}}}}else{if(u.physicsType===g.TILEMAPLAYER){if(t.physicsType===g.SPRITE){this.collideSpriteVsTilemapLayer(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsTilemapLayer(t,u,s,r,p,q)}}}}}},collideSpriteVsSprite:function(u,t,s,r,p,q){if(!u.body||!t.body){return false}if(this.separate(u.body,t.body,r,p,q)){if(s){s.call(p,u,t)}this._total++}return true},collideSpriteVsGroup:function(t,w,v,u,q,r){if(w.length===0||!t.body){return}if(this.skipQuadTree||t.body.skipQuadTree){for(var s=0;s<w._hash.length;s++){if(!w._hash[s]||!w._hash[s].exists||!w._hash[s].body){continue}if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(t.body.right<w._hash[s].body.x){break}else{if(w._hash[s].body.right<t.body.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(t.body.x>w._hash[s].body.right){break}else{if(w._hash[s].body.x>t.body.right){continue}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<w._hash[s].body.y){break}else{if(w._hash[s].body.bottom<t.body.y){continue}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(t.body.y>w._hash[s].body.bottom){break}else{if(w._hash[s].body.y>t.body.bottom){continue}}}}}}this.collideSpriteVsSprite(t,w._hash[s],v,u,q,r)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(w);var p=this.quadTree.retrieve(t);for(var s=0;s<p.length;s++){if(this.separate(t.body,p[s],u,q,r)){if(v){v.call(q,t,p[s].sprite)}this._total++}}}},collideGroupVsSelf:function(w,x,p,q,t){if(w.length===0){return}for(var s=0;s<w._hash.length;s++){if(!w._hash[s]||!w._hash[s].exists||!w._hash[s].body){continue}var v=w._hash[s];for(var r=s+1;r<w._hash.length;r++){if(!w._hash[r]||!w._hash[r].exists||!w._hash[r].body){continue}var u=w._hash[r];if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(v.body.right<u.body.x){break}else{if(u.body.right<v.body.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(v.body.x>u.body.right){continue}else{if(u.body.x>v.body.right){break}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(v.body.bottom<u.body.y){continue}else{if(u.body.bottom<v.body.y){break}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(v.body.y>u.body.bottom){continue}else{if(u.body.y>v.body.bottom){break}}}}}}this.collideSpriteVsSprite(v,u,x,p,q,t)}}},collideGroupVsGroup:function(p,v,u,t,q,r){if(p.length===0||v.length===0){return}for(var s=0;s<p.children.length;s++){if(p.children[s].exists){if(p.children[s].physicsType===g.GROUP){this.collideGroupVsGroup(p.children[s],v,u,t,q,r)}else{this.collideSpriteVsGroup(p.children[s],v,u,t,q,r)}}}},separate:function(t,r,u,q,s){if(!t.enable||!r.enable||!this.intersects(t,r)){return false}if(u&&u.call(q,t.sprite,r.sprite)===false){return false}var p=false;if(this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)){p=(this.separateX(t,r,s)||this.separateY(t,r,s))}else{p=(this.separateY(t,r,s)||this.separateX(t,r,s))}if(s){return true}else{return p}},intersects:function(q,p){if(q.right<=p.position.x){return false}if(q.bottom<=p.position.y){return false}if(q.position.x>=p.right){return false}if(q.position.y>=p.bottom){return false}return true},separateX:function(p,y,r){if(p.immovable&&y.immovable){return false}var w=0;if(this.intersects(p,y)){var t=p.deltaAbsX()+y.deltaAbsX()+this.OVERLAP_BIAS;if(p.deltaX()===0&&y.deltaX()===0){p.embedded=true;y.embedded=true}else{if(p.deltaX()>y.deltaX()){w=p.right-y.x;if((w>t)||p.checkCollision.right===false||y.checkCollision.left===false){w=0}else{p.touching.none=false;p.touching.right=true;y.touching.none=false;y.touching.left=true}}else{if(p.deltaX()<y.deltaX()){w=p.x-y.width-y.x;if((-w>t)||p.checkCollision.left===false||y.checkCollision.right===false){w=0}else{p.touching.none=false;p.touching.left=true;y.touching.none=false;y.touching.right=true}}}}p.overlapX=w;y.overlapX=w;if(w!==0){if(r||p.customSeparateX||y.customSeparateX){return true}var x=p.velocity.x;var v=y.velocity.x;if(!p.immovable&&!y.immovable){w*=0.5;p.x=p.x-w;y.x+=w;var u=Math.sqrt((v*v*y.mass)/p.mass)*((v>0)?1:-1);var s=Math.sqrt((x*x*p.mass)/y.mass)*((x>0)?1:-1);var q=(u+s)*0.5;u-=q;s-=q;p.velocity.x=q+u*p.bounce.x;y.velocity.x=q+s*y.bounce.x}else{if(!p.immovable){p.x=p.x-w;p.velocity.x=v-x*p.bounce.x;if(y.moves){p.y+=(y.y-y.prev.y)*y.friction.y}}else{if(!y.immovable){y.x+=w;y.velocity.x=x-v*y.bounce.x;if(p.moves){y.y+=(p.y-p.prev.y)*p.friction.y}}}}return true}}return false},separateY:function(p,y,r){if(p.immovable&&y.immovable){return false}var w=0;if(this.intersects(p,y)){var t=p.deltaAbsY()+y.deltaAbsY()+this.OVERLAP_BIAS;if(p.deltaY()===0&&y.deltaY()===0){p.embedded=true;y.embedded=true}else{if(p.deltaY()>y.deltaY()){w=p.bottom-y.y;if((w>t)||p.checkCollision.down===false||y.checkCollision.up===false){w=0}else{p.touching.none=false;p.touching.down=true;y.touching.none=false;y.touching.up=true}}else{if(p.deltaY()<y.deltaY()){w=p.y-y.bottom;if((-w>t)||p.checkCollision.up===false||y.checkCollision.down===false){w=0}else{p.touching.none=false;p.touching.up=true;y.touching.none=false;y.touching.down=true}}}}p.overlapY=w;y.overlapY=w;if(w!==0){if(r||p.customSeparateY||y.customSeparateY){return true}var x=p.velocity.y;var v=y.velocity.y;if(!p.immovable&&!y.immovable){w*=0.5;p.y=p.y-w;y.y+=w;var u=Math.sqrt((v*v*y.mass)/p.mass)*((v>0)?1:-1);var s=Math.sqrt((x*x*p.mass)/y.mass)*((x>0)?1:-1);var q=(u+s)*0.5;u-=q;s-=q;p.velocity.y=q+u*p.bounce.y;y.velocity.y=q+s*y.bounce.y}else{if(!p.immovable){p.y=p.y-w;p.velocity.y=v-x*p.bounce.y;if(y.moves){p.x+=(y.x-y.prev.x)*y.friction.x}}else{if(!y.immovable){y.y+=w;y.velocity.y=x-v*y.bounce.y;if(p.moves){y.x+=(p.x-p.prev.x)*p.friction.x}}}}return true}}return false},getObjectsUnderPointer:function(r,q,s,p){if(q.length===0||!r.exists){return}return this.getObjectsAtLocation(r.x,r.y,q,s,p,r)},getObjectsAtLocation:function(w,u,z,A,q,s){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(z);var v=new g.Rectangle(w,u,1,1);var p=[];var t=this.quadTree.retrieve(v);for(var r=0;r<t.length;r++){if(t[r].hitTest(w,u)){if(A){A.call(q,s,t[r].sprite)}p.push(t[r].sprite)}}return p},moveToObject:function(t,p,r,q){if(typeof r==="undefined"){r=60}if(typeof q==="undefined"){q=0}var s=Math.atan2(p.y-t.y,p.x-t.x);if(q>0){r=this.distanceBetween(t,p)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},moveToPointer:function(t,q,s,p){if(typeof q==="undefined"){q=60}s=s||this.game.input.activePointer;if(typeof p==="undefined"){p=0}var r=this.angleToPointer(t,s);if(p>0){q=this.distanceToPointer(t,s)/(p/1000)}t.body.velocity.x=Math.cos(r)*q;t.body.velocity.y=Math.sin(r)*q;return r},moveToXY:function(t,p,u,r,q){if(typeof r==="undefined"){r=60}if(typeof q==="undefined"){q=0}var s=Math.atan2(u-t.y,p-t.x);if(q>0){r=this.distanceToXY(t,p,u)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},velocityFromAngle:function(r,q,p){if(typeof q==="undefined"){q=60}p=p||new g.Point();return p.setTo((Math.cos(this.game.math.degToRad(r))*q),(Math.sin(this.game.math.degToRad(r))*q))},velocityFromRotation:function(q,r,p){if(typeof r==="undefined"){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerationFromRotation:function(q,r,p){if(typeof r==="undefined"){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerateToObject:function(t,q,r,p,u){if(typeof r==="undefined"){r=60}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var s=this.angleBetween(t,q);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},accelerateToPointer:function(t,s,q,p,u){if(typeof q==="undefined"){q=60}if(typeof s==="undefined"){s=this.game.input.activePointer}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var r=this.angleToPointer(t,s);t.body.acceleration.setTo(Math.cos(r)*q,Math.sin(r)*q);t.body.maxVelocity.setTo(p,u);return r},accelerateToXY:function(t,q,v,r,p,u){if(typeof r==="undefined"){r=60}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var s=this.angleToXY(t,q,v);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},distanceBetween:function(r,s){var q=r.x-s.x;var p=r.y-s.y;return Math.sqrt(q*q+p*p)},distanceToXY:function(s,p,t){var r=s.x-p;var q=s.y-t;return Math.sqrt(r*r+q*q)},distanceToPointer:function(s,r){r=r||this.game.input.activePointer;var q=s.x-r.worldX;var p=s.y-r.worldY;return Math.sqrt(q*q+p*p)},angleBetween:function(r,s){var q=s.x-r.x;var p=s.y-r.y;return Math.atan2(p,q)},angleToXY:function(s,p,t){var r=p-s.x;var q=t-s.y;return Math.atan2(q,r)},angleToPointer:function(s,r){r=r||this.game.input.activePointer;var q=r.worldX-s.x;var p=r.worldY-s.y;return Math.atan2(p,q)}};g.Physics.Arcade.Body=function(p){this.sprite=p;this.game=p.game;this.type=g.Physics.ARCADE;this.enable=true;this.offset=new g.Point();this.position=new g.Point(p.x,p.y);this.prev=new g.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=p.rotation;this.preRotation=p.rotation;this.width=p.width;this.height=p.height;this.sourceWidth=p.width;this.sourceHeight=p.height;if(p.texture){this.sourceWidth=p.texture.frame.width;this.sourceHeight=p.texture.frame.height}this.halfWidth=Math.abs(p.width/2);this.halfHeight=Math.abs(p.height/2);this.center=new g.Point(p.x+this.halfWidth,p.y+this.halfHeight);this.velocity=new g.Point();this.newVelocity=new g.Point(0,0);this.deltaMax=new g.Point(0,0);this.acceleration=new g.Point();this.drag=new g.Point();this.allowGravity=true;this.gravity=new g.Point(0,0);this.bounce=new g.Point();this.maxVelocity=new g.Point(10000,10000);this.friction=new g.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=g.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new g.Point();this.dirty=false;this.skipQuadTree=false;this._reset=true;this._sx=p.scale.x;this._sy=p.scale.y;this._dx=0;this._dy=0};g.Physics.Arcade.Body.prototype={updateBounds:function(){var q=Math.abs(this.sprite.scale.x);var p=Math.abs(this.sprite.scale.y);if(q!==this._sx||p!==this._sy){this.width=this.sourceWidth*q;this.height=this.sourceHeight*p;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this._sx=q;this._sy=p;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this._reset=true}},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.height))+this.offset.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);this.angle=Math.atan2(this.velocity.y,this.velocity.x)}if(this.collideWorldBounds){this.checkWorldBounds()}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},postUpdate:function(){if(!this.enable||!this.dirty){return}this.dirty=false;if(this.deltaX()<0){this.facing=g.LEFT}else{if(this.deltaX()>0){this.facing=g.RIGHT}}if(this.deltaY()<0){this.facing=g.UP}else{if(this.deltaY()>0){this.facing=g.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},destroy:function(){this.sprite.body=null;this.sprite=null},checkWorldBounds:function(){if(this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left){this.position.x=this.game.physics.arcade.bounds.x;this.velocity.x*=-this.bounce.x;this.blocked.left=true}else{if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right){this.position.x=this.game.physics.arcade.bounds.right-this.width;this.velocity.x*=-this.bounce.x;this.blocked.right=true}}if(this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up){this.position.y=this.game.physics.arcade.bounds.y;this.velocity.y*=-this.bounce.y;this.blocked.up=true}else{if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down){this.position.y=this.game.physics.arcade.bounds.bottom-this.height;this.velocity.y*=-this.bounce.y;this.blocked.down=true}}},setSize:function(r,q,p,s){if(typeof p==="undefined"){p=this.offset.x}if(typeof s==="undefined"){s=this.offset.y}this.sourceWidth=r;this.sourceHeight=q;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(p,s);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(p,q){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=(p-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(q-(this.sprite.anchor.y*this.height))+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(p,q){return g.Rectangle.contains(this,p,q)},onFloor:function(){return this.blocked.down},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(g.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(p){this.position.x=p}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(p){this.position.y=p}});g.Physics.Arcade.Body.render=function(r,p,q,s){if(typeof s==="undefined"){s=true}q=q||"rgba(0,255,0,0.4)";if(s){r.fillStyle=q;r.fillRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}else{r.strokeStyle=q;r.strokeRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}};g.Physics.Arcade.Body.renderBodyInfo=function(q,p){q.line("x: "+p.x.toFixed(2),"y: "+p.y.toFixed(2),"width: "+p.width,"height: "+p.height);q.line("velocity x: "+p.velocity.x.toFixed(2),"y: "+p.velocity.y.toFixed(2),"deltaX: "+p._dx.toFixed(2),"deltaY: "+p._dy.toFixed(2));q.line("acceleration x: "+p.acceleration.x.toFixed(2),"y: "+p.acceleration.y.toFixed(2),"speed: "+p.speed.toFixed(2),"angle: "+p.angle.toFixed(2));q.line("gravity x: "+p.gravity.x,"y: "+p.gravity.y,"bounce x: "+p.bounce.x.toFixed(2),"y: "+p.bounce.y.toFixed(2));q.line("touching left: "+p.touching.left,"right: "+p.touching.right,"up: "+p.touching.up,"down: "+p.touching.down);q.line("blocked left: "+p.blocked.left,"right: "+p.blocked.right,"up: "+p.blocked.up,"down: "+p.blocked.down)};g.Physics.Arcade.Body.prototype.constructor=g.Physics.Arcade.Body;g.Physics.Arcade.TilemapCollision=function(){};g.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(s,p,u,t,q){if(!s.body){return}var v=p.getTiles(s.body.position.x-s.body.tilePadding.x,s.body.position.y-s.body.tilePadding.y,s.body.width+s.body.tilePadding.x,s.body.height+s.body.tilePadding.y,false,false);if(v.length===0){return}for(var r=0;r<v.length;r++){if(t){if(t.call(q,s,v[r])){if(this.separateTile(r,s.body,v[r])){this._total++;if(u){u.call(q,s,v[r])}}}}else{if(this.separateTile(r,s.body,v[r])){this._total++;if(u){u.call(q,s,v[r])}}}}},collideGroupVsTilemapLayer:function(u,p,t,s,q){if(u.length===0){return}for(var r=0;r<u.children.length;r++){if(u.children[r].exists){this.collideSpriteVsTilemapLayer(u.children[r],p,t,s,q)}}},separateTile:function(t,q,u){if(!q.enable||!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return false}if(u.collisionCallback&&!u.collisionCallback.call(u.collisionCallbackContext,q.sprite,u)){return false}else{if(u.layer.callbacks[u.index]&&!u.layer.callbacks[u.index].callback.call(u.layer.callbacks[u.index].callbackContext,q.sprite,u)){return false}}if(!u.faceLeft&&!u.faceRight&&!u.faceTop&&!u.faceBottom){return false}var s=0;var r=0;var p=0;var v=1;if(q.deltaAbsX()>q.deltaAbsY()){p=-1}else{if(q.deltaAbsX()<q.deltaAbsY()){v=-1}}if(q.deltaX()!==0&&q.deltaY()!==0&&(u.faceLeft||u.faceRight)&&(u.faceTop||u.faceBottom)){p=Math.min(Math.abs(q.position.x-u.right),Math.abs(q.right-u.left));v=Math.min(Math.abs(q.position.y-u.bottom),Math.abs(q.bottom-u.top))}if(p<v){if(u.faceLeft||u.faceRight){s=this.tileCheckX(q,u);if(s!==0&&!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return true}}if(u.faceTop||u.faceBottom){r=this.tileCheckY(q,u)}}else{if(u.faceTop||u.faceBottom){r=this.tileCheckY(q,u);if(r!==0&&!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return true}}if(u.faceLeft||u.faceRight){s=this.tileCheckX(q,u)}}return(s!==0||r!==0)},tileCheckX:function(p,r){var q=0;if(p.deltaX()<0&&!p.blocked.left&&r.collideRight&&p.checkCollision.left){if(r.faceRight&&p.x<r.right){q=p.x-r.right;if(q<-this.TILE_BIAS){q=0}}}else{if(p.deltaX()>0&&!p.blocked.right&&r.collideLeft&&p.checkCollision.right){if(r.faceLeft&&p.right>r.left){q=p.right-r.left;if(q>this.TILE_BIAS){q=0}}}}if(q!==0){if(p.customSeparateX){p.overlapX=q}else{this.processTileSeparationX(p,q)}}return q},tileCheckY:function(p,r){var q=0;if(p.deltaY()<0&&!p.blocked.up&&r.collideDown&&p.checkCollision.up){if(r.faceBottom&&p.y<r.bottom){q=p.y-r.bottom;if(q<-this.TILE_BIAS){q=0}}}else{if(p.deltaY()>0&&!p.blocked.down&&r.collideUp&&p.checkCollision.down){if(r.faceTop&&p.bottom>r.top){q=p.bottom-r.top;if(q>this.TILE_BIAS){q=0}}}}if(q!==0){if(p.customSeparateY){p.overlapY=q}else{this.processTileSeparationY(p,q)}}return q},processTileSeparationX:function(q,p){if(p<0){q.blocked.left=true}else{if(p>0){q.blocked.right=true}}q.position.x-=p;if(q.bounce.x===0){q.velocity.x=0}else{q.velocity.x=-q.velocity.x*q.bounce.x}},processTileSeparationY:function(p,q){if(q<0){p.blocked.up=true}else{if(q>0){p.blocked.down=true}}p.position.y-=q;if(p.bounce.y===0){p.velocity.y=0}else{p.velocity.y=-p.velocity.y*p.bounce.y}}};g.Utils.mixinPrototype(g.Physics.Arcade.prototype,g.Physics.Arcade.TilemapCollision.prototype);!function(p){"object"==typeof exports?module.exports=p():"function"==typeof define&&define.amd?define(p):"undefined"!=typeof window?window.p2=p():"undefined"!=typeof global?global.p2=p():"undefined"!=typeof self&&(self.p2=p())}(function(){var s,q,p;return(function r(v,z,x){function w(C,A){if(!z[C]){if(!v[C]){var t=typeof require=="function"&&require;if(!A&&t){return t(C,!0)}if(u){return u(C,!0)}throw new Error("Cannot find module '"+C+"'")}var B=z[C]={exports:{}};v[C][0].call(B.exports,function(D){var E=v[C][1][D];return w(E?E:D)},B,B.exports,r,v,z,x)}return z[C].exports}var u=typeof require=="function"&&require;for(var y=0;y<x.length;y++){w(x[y])}return w})({1:[function(v,w,u){var t=v("./Scalar");w.exports=x;function x(){}x.lineInt=function(B,A,F){F=F||0;var E=[0,0];var z,I,D,y,H,C,G;z=B[1][1]-B[0][1];I=B[0][0]-B[1][0];D=z*B[0][0]+I*B[0][1];y=A[1][1]-A[0][1];H=A[0][0]-A[1][0];C=y*A[0][0]+H*A[0][1];G=z*H-y*I;if(!t.eq(G,0,F)){E[0]=(H*D-I*C)/G;E[1]=(z*C-y*D)/G}return E};x.segmentsIntersect=function(B,A,z,y){var H=A[0]-B[0];var E=A[1]-B[1];var G=y[0]-z[0];var D=y[1]-z[1];if(G*E-D*H==0){return false}var F=(H*(z[1]-B[1])+E*(B[0]-z[0]))/(G*E-D*H);var C=(G*(B[1]-z[1])+D*(z[0]-B[0]))/(D*H-G*E);return(F>=0&&F<=1&&C>=0&&C<=1)}},{"./Scalar":4}],2:[function(w,x,v){x.exports=y;function y(){}y.area=function(A,z,B){return(((z[0]-A[0])*(B[1]-A[1]))-((B[0]-A[0])*(z[1]-A[1])))};y.left=function(A,z,B){return y.area(A,z,B)>0};y.leftOn=function(A,z,B){return y.area(A,z,B)>=0};y.right=function(A,z,B){return y.area(A,z,B)<0};y.rightOn=function(A,z,B){return y.area(A,z,B)<=0};var u=[],t=[];y.collinear=function(F,E,C,D){if(!D){return y.area(F,E,C)==0}else{var I=u,B=t;I[0]=E[0]-F[0];I[1]=E[1]-F[1];B[0]=C[0]-E[0];B[1]=C[1]-E[1];var z=I[0]*B[0]+I[1]*B[1],H=Math.sqrt(I[0]*I[0]+I[1]*I[1]),G=Math.sqrt(B[0]*B[0]+B[1]*B[1]),A=Math.acos(z/(H*G));return A<D}};y.sqdist=function(B,z){var C=z[0]-B[0];var A=z[1]-B[1];return C*C+A*A}},{}],3:[function(w,t,y){var x=w("./Line"),C=w("./Point"),z=w("./Scalar");t.exports=A;function A(){this.vertices=[]}A.prototype.at=function(E){var D=this.vertices,F=D.length;return D[E<0?E%F+F:E%F]};A.prototype.first=function(){return this.vertices[0]};A.prototype.last=function(){return this.vertices[this.vertices.length-1]};A.prototype.clear=function(){this.vertices.length=0};A.prototype.append=function(E,G,F){if(typeof(G)=="undefined"){throw new Error("From is not given!")}if(typeof(F)=="undefined"){throw new Error("To is not given!")}if(F-1<G){throw new Error("lol1")}if(F>E.vertices.length){throw new Error("lol2")}if(G<0){throw new Error("lol3")}for(var D=G;D<F;D++){this.vertices.push(E.vertices[D])}};A.prototype.makeCCW=function(){var F=0,D=this.vertices;for(var E=1;E<this.vertices.length;++E){if(D[E][1]<D[F][1]||(D[E][1]==D[F][1]&&D[E][0]>D[F][0])){F=E}}if(!C.left(this.at(F-1),this.at(F),this.at(F+1))){this.reverse()}};A.prototype.reverse=function(){var E=[];for(var D=0,F=this.vertices.length;D!==F;D++){E.push(this.vertices.pop())}this.vertices=E};A.prototype.isReflex=function(D){return C.right(this.at(D-1),this.at(D),this.at(D+1))};var v=[],u=[];A.prototype.canSee=function(G,E){var I,J,F=v,D=u;if(C.leftOn(this.at(G+1),this.at(G),this.at(E))&&C.rightOn(this.at(G-1),this.at(G),this.at(E))){return false}J=C.sqdist(this.at(G),this.at(E));for(var H=0;H!==this.vertices.length;++H){if((H+1)%this.vertices.length===G||H===G){continue}if(C.leftOn(this.at(G),this.at(E),this.at(H+1))&&C.rightOn(this.at(G),this.at(E),this.at(H))){F[0]=this.at(G);F[1]=this.at(E);D[0]=this.at(H);D[1]=this.at(H+1);I=x.lineInt(F,D);if(C.sqdist(this.at(G),I)<J){return false}}}return true};A.prototype.copy=function(F,E,H){var G=H||new A();G.clear();if(F<E){for(var D=F;D<=E;D++){G.vertices.push(this.vertices[D])}}else{for(var D=0;D<=E;D++){G.vertices.push(this.vertices[D])}for(var D=F;D<this.vertices.length;D++){G.vertices.push(this.vertices[D])}}return G};A.prototype.getCutEdges=function(){var G=[],K=[],H=[],J=new A();var I=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F){if(this.isReflex(F)){for(var E=0;E<this.vertices.length;++E){if(this.canSee(F,E)){K=this.copy(F,E,J).getCutEdges();H=this.copy(E,F,J).getCutEdges();for(var D=0;D<H.length;D++){K.push(H[D])}if(K.length<I){G=K;I=K.length;G.push([this.at(F),this.at(E)])}}}}}return G};A.prototype.decomp=function(){var D=this.getCutEdges();if(D.length>0){return this.slice(D)}else{return[this]}};A.prototype.slice=function(F){if(F.length==0){return[this]}if(F instanceof Array&&F.length&&F[0] instanceof Array&&F[0].length==2&&F[0][0] instanceof Array){var E=[this];for(var H=0;H<F.length;H++){var I=F[H];for(var G=0;G<E.length;G++){var J=E[G];var D=J.slice(I);if(D){E.splice(G,1);E.push(D[0],D[1]);break}}}return E}else{var I=F;var H=this.vertices.indexOf(I[0]);var G=this.vertices.indexOf(I[1]);if(H!=-1&&G!=-1){return[this.copy(H,G),this.copy(G,H)]}else{return false}}};A.prototype.isSimple=function(){var F=this.vertices;for(var E=0;E<F.length-1;E++){for(var D=0;D<E-1;D++){if(x.segmentsIntersect(F[E],F[E+1],F[D],F[D+1])){return false}}}for(var E=1;E<F.length-2;E++){if(x.segmentsIntersect(F[0],F[F.length-1],F[E],F[E+1])){return false}}return true};function B(O,N,J,H,M){M=M||0;var E=N[1]-O[1];var L=O[0]-N[0];var G=(E*O[0])+(L*O[1]);var D=H[1]-J[1];var K=J[0]-H[0];var F=(D*J[0])+(K*J[1]);var I=(E*K)-(D*L);if(!z.eq(I,0,M)){return[((K*G)-(L*F))/I,((E*F)-(D*G))/I]}else{return[0,0]}}A.prototype.quickDecomp=function(L,I,K,X,Y,E){Y=Y||100;E=E||0;X=X||25;L=typeof(L)!="undefined"?L:[];I=I||[];K=K||[];var Q=[0,0],D=[0,0],P=[0,0];var N=0,U=0,W=0,G=0;var R=0,O=0,V=0;var J=new A(),F=new A();var H=this,M=this.vertices;if(M.length<3){return L}E++;if(E>Y){console.warn("quickDecomp: max level ("+Y+") reached.");return L}for(var T=0;T<this.vertices.length;++T){if(H.isReflex(T)){I.push(H.vertices[T]);N=U=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S){if(C.left(H.at(T-1),H.at(T),H.at(S))&&C.rightOn(H.at(T-1),H.at(T),H.at(S-1))){P=B(H.at(T-1),H.at(T),H.at(S),H.at(S-1));if(C.right(H.at(T+1),H.at(T),P)){W=C.sqdist(H.vertices[T],P);if(W<U){U=W;D=P;O=S}}}if(C.left(H.at(T+1),H.at(T),H.at(S+1))&&C.rightOn(H.at(T+1),H.at(T),H.at(S))){P=B(H.at(T+1),H.at(T),H.at(S),H.at(S+1));if(C.left(H.at(T-1),H.at(T),P)){W=C.sqdist(H.vertices[T],P);if(W<N){N=W;Q=P;R=S}}}}if(O==(R+1)%this.vertices.length){P[0]=(D[0]+Q[0])/2;P[1]=(D[1]+Q[1])/2;K.push(P);if(T<R){J.append(H,T,R+1);J.vertices.push(P);F.vertices.push(P);if(O!=0){F.append(H,O,H.vertices.length)}F.append(H,0,T+1)}else{if(T!=0){J.append(H,T,H.vertices.length)}J.append(H,0,R+1);J.vertices.push(P);F.vertices.push(P);F.append(H,O,T+1)}}else{if(O>R){R+=this.vertices.length}G=Number.MAX_VALUE;if(R<O){return L}for(var S=O;S<=R;++S){if(C.leftOn(H.at(T-1),H.at(T),H.at(S))&&C.rightOn(H.at(T+1),H.at(T),H.at(S))){W=C.sqdist(H.at(T),H.at(S));if(W<G){G=W;V=S%this.vertices.length}}}if(T<V){J.append(H,T,V+1);if(V!=0){F.append(H,V,M.length)}F.append(H,0,T+1)}else{if(T!=0){J.append(H,T,M.length)}J.append(H,0,V+1);F.append(H,V,T+1)}}if(J.vertices.length<F.vertices.length){J.quickDecomp(L,I,K,X,Y,E);F.quickDecomp(L,I,K,X,Y,E)}else{F.quickDecomp(L,I,K,X,Y,E);J.quickDecomp(L,I,K,X,Y,E)}return L}}L.push(this);return L};A.prototype.removeCollinearPoints=function(D){var E=0;for(var F=this.vertices.length-1;this.vertices.length>3&&F>=0;--F){if(C.collinear(this.at(F-1),this.at(F),this.at(F+1),D)){this.vertices.splice(F%this.vertices.length,1);F--;E++}}return E}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(v,w,u){w.exports=t;function t(){}t.eq=function(z,x,y){y=y||0;return Math.abs(z-x)<y}},{}],5:[function(u,v,t){v.exports={Polygon:u("./Polygon"),Point:u("./Point"),}},{"./Point":2,"./Polygon":3}],6:[function(u,v,t){v.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(u,w,t){var x=u("../math/vec2"),z=u("../utils/Utils");w.exports=y;function y(A){this.lowerBound=x.create();if(A&&A.lowerBound){x.copy(this.lowerBound,A.lowerBound)}this.upperBound=x.create();if(A&&A.upperBound){x.copy(this.upperBound,A.upperBound)}}var v=x.create();y.prototype.setFromPoints=function(L,H,D,C){var E=this.lowerBound,M=this.upperBound;if(typeof(D)!=="number"){D=0}if(D!==0){x.rotate(E,L[0],D)}else{x.copy(E,L[0])}x.copy(M,E);var J=Math.cos(D),B=Math.sin(D);for(var G=1;G<L.length;G++){var A=L[G];if(D!==0){var K=A[0],I=A[1];v[0]=J*K-B*I;v[1]=B*K+J*I;A=v}for(var F=0;F<2;F++){if(A[F]>M[F]){M[F]=A[F]}if(A[F]<E[F]){E[F]=A[F]}}}if(H){x.add(this.lowerBound,this.lowerBound,H);x.add(this.upperBound,this.upperBound,H)}if(C){this.lowerBound[0]-=C;this.lowerBound[1]-=C;this.upperBound[0]+=C;this.upperBound[1]+=C}};y.prototype.copy=function(A){x.copy(this.lowerBound,A.lowerBound);x.copy(this.upperBound,A.upperBound)};y.prototype.extend=function(B){var D=2;while(D--){var A=B.lowerBound[D];if(this.lowerBound[D]>A){this.lowerBound[D]=A}var C=B.upperBound[D];if(this.upperBound[D]<C){this.upperBound[D]=C}}};y.prototype.overlaps=function(C){var B=this.lowerBound,E=this.upperBound,A=C.lowerBound,D=C.upperBound;return((A[0]<=E[0]&&E[0]<=D[0])||(B[0]<=D[0]&&D[0]<=E[0]))&&((A[1]<=E[1]&&E[1]<=D[1])||(B[1]<=D[1]&&D[1]<=E[1]))}},{"../math/vec2":31,"../utils/Utils":50}],8:[function(v,w,u){var x=v("../math/vec2");var y=v("../objects/Body");w.exports=t;function t(A){this.type=A;this.result=[];this.world=null;this.boundingVolumeType=t.AABB}t.AABB=1;t.BOUNDING_CIRCLE=2;t.prototype.setWorld=function(A){this.world=A};t.prototype.getCollisionPairs=function(A){throw new Error("getCollisionPairs must be implemented in a subclass!")};var z=x.create();t.boundingRadiusCheck=function(D,C){x.sub(z,D.position,C.position);var B=x.squaredLength(z),A=D.boundingRadius+C.boundingRadius;return B<=A*A};t.aabbCheck=function(B,A){return B.getAABB().overlaps(A.getAABB())};t.prototype.boundingVolumeCheck=function(C,B){var A;switch(this.boundingVolumeType){case t.BOUNDING_CIRCLE:A=t.boundingRadiusCheck(C,B);break;case t.AABB:A=t.aabbCheck(C,B);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return A};t.canCollide=function(B,A){if(B.type===y.STATIC&&A.type===y.STATIC){return false}if((B.type===y.KINEMATIC&&A.type===y.STATIC)||(B.type===y.STATIC&&A.type===y.KINEMATIC)){return false}if(B.type===y.KINEMATIC&&A.type===y.KINEMATIC){return false}if(B.sleepState===y.SLEEPING&&A.sleepState===y.SLEEPING){return false}if((B.sleepState===y.SLEEPING&&A.type===y.STATIC)||(A.sleepState===y.SLEEPING&&B.type===y.STATIC)){return false}return true};t.NAIVE=1;t.SAP=2},{"../math/vec2":31,"../objects/Body":32}],9:[function(v,u,y){var t=v("../shapes/Circle"),w=v("../shapes/Plane"),x=v("../shapes/Particle"),B=v("../collision/Broadphase"),z=v("../math/vec2"),A=v("../utils/Utils");u.exports=C;function C(D){B.apply(this);D=A.defaults(D,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=D.xmin;this.ymin=D.ymin;this.xmax=D.xmax;this.ymax=D.ymax;this.nx=D.nx;this.ny=D.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}C.prototype=new B();C.prototype.constructor=C;C.prototype.getCollisionPairs=function(V){var N=[],L=V.bodies,J=L.length,ab=this.binsizeX,Z=this.binsizeY,ah=this.nx,ag=this.ny,P=this.xmin,Y=this.ymin,U=this.xmax,ad=this.ymax;var W=[],ae=ah*ag;for(var ac=0;ac<ae;ac++){W.push([])}var K=ah/(U-P);var ai=ag/(ad-Y);for(var ac=0;ac!==J;ac++){var G=L[ac];var M=G.aabb;var I=Math.max(M.lowerBound[0],P);var H=Math.max(M.lowerBound[1],Y);var al=Math.min(M.upperBound[0],U);var ak=Math.min(M.upperBound[1],ad);var E=Math.floor(K*(I-P));var T=Math.floor(ai*(H-Y));var D=Math.floor(K*(al-P));var S=Math.floor(ai*(ak-Y));for(var aa=E;aa<=D;aa++){for(var X=T;X<=S;X++){var R=aa;var aj=X;var O=R*(ag-1)+aj;if(O>=0&&O<ae){W[O].push(G)}}}}for(var ac=0;ac!==ae;ac++){var Q=W[ac];for(var aa=0,af=Q.length;aa!==af;aa++){var G=Q[aa];for(var X=0;X!==aa;X++){var F=Q[X];if(B.canCollide(G,F)&&this.boundingVolumeCheck(G,F)){N.push(G,F)}}}}return N}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50}],10:[function(v,u,z){var t=v("../shapes/Circle"),w=v("../shapes/Plane"),y=v("../shapes/Shape"),x=v("../shapes/Particle"),B=v("../collision/Broadphase"),A=v("../math/vec2");u.exports=C;function C(){B.call(this,B.NAIVE)}C.prototype=new B();C.prototype.constructor=C;C.prototype.getCollisionPairs=function(K){var G=K.bodies,D=this.result;D.length=0;for(var J=0,I=G.length;J!==I;J++){var F=G[J];for(var H=0;H<J;H++){var E=G[H];if(B.canCollide(F,E)&&this.boundingVolumeCheck(F,E)){D.push(F,E)}}}return D};C.prototype.aabbQuery=function(I,F,E){E=E||[];var G=I.bodies;for(var H=0;H<G.length;H++){var D=G[H];if(D.aabbNeedsUpdate){D.updateAABB()}if(D.aabb.overlaps(F)){E.push(D)}}return E}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45}],11:[function(aJ,aQ,ai){var aA=aJ("../math/vec2"),aK=aA.sub,N=aA.add,R=aA.dot,aB=aJ("../utils/Utils"),u=aJ("../utils/TupleDictionary"),z=aJ("../equations/Equation"),aN=aJ("../equations/ContactEquation"),az=aJ("../equations/FrictionEquation"),ay=aJ("../shapes/Circle"),aG=aJ("../shapes/Convex"),af=aJ("../shapes/Shape"),ah=aJ("../objects/Body"),ac=aJ("../shapes/Rectangle");aQ.exports=aL;var an=aA.fromValues(0,1);var M=aA.fromValues(0,0),L=aA.fromValues(0,0),J=aA.fromValues(0,0),H=aA.fromValues(0,0),G=aA.fromValues(0,0),F=aA.fromValues(0,0),E=aA.fromValues(0,0),D=aA.fromValues(0,0),B=aA.fromValues(0,0),Y=aA.fromValues(0,0),X=aA.fromValues(0,0),W=aA.fromValues(0,0),V=aA.fromValues(0,0),U=aA.fromValues(0,0),T=aA.fromValues(0,0),S=aA.fromValues(0,0),Q=aA.fromValues(0,0),P=aA.fromValues(0,0),aP=[];function aL(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.reuseObjects=true;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=z.DEFAULT_STIFFNESS;this.relaxation=z.DEFAULT_RELAXATION;this.frictionStiffness=z.DEFAULT_STIFFNESS;this.frictionRelaxation=z.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new u();this.contactSkinSize=0.01}var x=aA.create();var w=aA.create();aL.prototype.bodiesOverlap=function(aY,aW){var a5=x;var a4=w;for(var aZ=0,aT=aY.shapes.length;aZ!==aT;aZ++){var aX=aY.shapes[aZ],a1=aY.shapeOffsets[aZ],a3=aY.shapeAngles[aZ];aY.toWorldFrame(a5,a1);for(var aV=0,aS=aW.shapes.length;aV!==aS;aV++){var aU=aW.shapes[aV],a0=aW.shapeOffsets[aV],a2=aW.shapeAngles[aV];aW.toWorldFrame(a4,a0);if(this[aX.type|aU.type](aY,aX,a5,aX.angle+aY.angle,aW,aU,a4,aU.angle+aW.angle,true)){return true}}}return false};aL.prototype.collidedLastStep=function(aV,aU){var aT=aV.id|0,aS=aU.id|0;return !!this.collidingBodiesLastStep.get(aT,aS)};aL.prototype.reset=function(){this.collidingBodiesLastStep.reset();var aV=this.contactEquations;var aU=aV.length;while(aU--){var a0=aV[aU],aY=a0.bodyA.id,aW=a0.bodyB.id;this.collidingBodiesLastStep.set(aY,aW,true)}if(this.reuseObjects){var aT=this.contactEquations,aS=this.frictionEquations,aX=this.reusableFrictionEquations,aZ=this.reusableContactEquations;aB.appendArray(aZ,aT);aB.appendArray(aX,aS)}this.contactEquations.length=this.frictionEquations.length=0};aL.prototype.createContactEquation=function(aV,aU,aT,aS){var aW=this.reusableContactEquations.length?this.reusableContactEquations.pop():new aN(aV,aU);aW.bodyA=aV;aW.bodyB=aU;aW.shapeA=aT;aW.shapeB=aS;aW.restitution=this.restitution;aW.firstImpact=!this.collidedLastStep(aV,aU);aW.stiffness=this.stiffness;aW.relaxation=this.relaxation;aW.needsUpdate=true;aW.enabled=this.enabledEquations;aW.offset=this.contactSkinSize;return aW};aL.prototype.createFrictionEquation=function(aV,aU,aT,aS){var aW=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new az(aV,aU);aW.bodyA=aV;aW.bodyB=aU;aW.shapeA=aT;aW.shapeB=aS;aW.setSlipForce(this.slipForce);aW.frictionCoefficient=this.frictionCoefficient;aW.relativeVelocity=this.surfaceVelocity;aW.enabled=this.enabledEquations;aW.needsUpdate=true;aW.stiffness=this.frictionStiffness;aW.relaxation=this.frictionRelaxation;aW.contactEquations.length=0;return aW};aL.prototype.createFrictionFromContact=function(aT){var aS=this.createFrictionEquation(aT.bodyA,aT.bodyB,aT.shapeA,aT.shapeB);aA.copy(aS.contactPointA,aT.contactPointA);aA.copy(aS.contactPointB,aT.contactPointB);aA.rotate90cw(aS.t,aT.normalA);aS.contactEquations.push(aT);return aS};aL.prototype.createFrictionFromAverage=function(aT){var aY=this.contactEquations[this.contactEquations.length-1];var aS=this.createFrictionEquation(aY.bodyA,aY.bodyB,aY.shapeA,aY.shapeB);var aX=aY.bodyA;var aW=aY.bodyB;aA.set(aS.contactPointA,0,0);aA.set(aS.contactPointB,0,0);aA.set(aS.t,0,0);for(var aV=0;aV!==aT;aV++){aY=this.contactEquations[this.contactEquations.length-1-aV];if(aY.bodyA===aX){aA.add(aS.t,aS.t,aY.normalA);aA.add(aS.contactPointA,aS.contactPointA,aY.contactPointA);aA.add(aS.contactPointB,aS.contactPointB,aY.contactPointB)}else{aA.sub(aS.t,aS.t,aY.normalA);aA.add(aS.contactPointA,aS.contactPointA,aY.contactPointB);aA.add(aS.contactPointB,aS.contactPointB,aY.contactPointA)}aS.contactEquations.push(aY)}var aU=1/aT;aA.scale(aS.contactPointA,aS.contactPointA,aU);aA.scale(aS.contactPointB,aS.contactPointB,aU);aA.normalize(aS.t,aS.t);aA.rotate90cw(aS.t,aS.t);return aS};aL.prototype[af.LINE|af.CONVEX]=aL.prototype.convexLine=function(aT,aS,aV,aZ,aW,a0,aU,aY,aX){if(aX){return false}else{return 0}};aL.prototype[af.LINE|af.RECTANGLE]=aL.prototype.lineRectangle=function(aU,a0,aT,aX,aZ,aS,aV,aY,aW){if(aW){return false}else{return 0}};function ae(aT,aS){aA.set(aT.vertices[0],-aS.length*0.5,-aS.radius);aA.set(aT.vertices[1],aS.length*0.5,-aS.radius);aA.set(aT.vertices[2],aS.length*0.5,aS.radius);aA.set(aT.vertices[3],-aS.length*0.5,aS.radius)}var v=new ac(1,1),ag=aA.create();aL.prototype[af.CAPSULE|af.CONVEX]=aL.prototype[af.CAPSULE|af.RECTANGLE]=aL.prototype.convexCapsule=function(aX,aT,a1,a3,a0,a4,aU,a2,aZ){var aW=ag;aA.set(aW,a4.length/2,0);aA.rotate(aW,aW,a2);aA.add(aW,aW,aU);var aY=this.circleConvex(a0,a4,aW,a2,aX,aT,a1,a3,aZ,a4.radius);aA.set(aW,-a4.length/2,0);aA.rotate(aW,aW,a2);aA.add(aW,aW,aU);var aV=this.circleConvex(a0,a4,aW,a2,aX,aT,a1,a3,aZ,a4.radius);if(aZ&&(aY||aV)){return true}var aS=v;ae(aS,a4);var a5=this.convexConvex(aX,aT,a1,a3,a0,aS,aU,a2,aZ);return a5+aY+aV};aL.prototype[af.CAPSULE|af.LINE]=aL.prototype.lineCapsule=function(aU,a0,aS,aY,aW,aZ,aT,aX,aV){if(aV){return false}else{return 0}};var ad=aA.create();var ab=aA.create();var aH=new ac(1,1);aL.prototype[af.CAPSULE|af.CAPSULE]=aL.prototype.capsuleCapsule=function(aW,a9,a1,a5,aV,a8,a0,a3,aY){var aX;var a7=ad,a6=ab;var ba=0;for(var a4=0;a4<2;a4++){aA.set(a7,(a4===0?-1:1)*a9.length/2,0);aA.rotate(a7,a7,a5);aA.add(a7,a7,a1);for(var a2=0;a2<2;a2++){aA.set(a6,(a2===0?-1:1)*a8.length/2,0);aA.rotate(a6,a6,a3);aA.add(a6,a6,a0);if(this.enableFrictionReduction){aX=this.enableFriction;this.enableFriction=false}var aZ=this.circleCircle(aW,a9,a7,a5,aV,a8,a6,a3,aY,a9.radius,a8.radius);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aZ){return true}ba+=aZ}}if(this.enableFrictionReduction){aX=this.enableFriction;this.enableFriction=false}var aU=aH;ae(aU,a9);var aT=this.convexCapsule(aW,aU,a1,a5,aV,a8,a0,a3,aY);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aT){return true}ba+=aT;if(this.enableFrictionReduction){var aX=this.enableFriction;this.enableFriction=false}ae(aU,a8);var aS=this.convexCapsule(aV,aU,a0,a3,aW,a9,a1,a5,aY);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aS){return true}ba+=aS;if(this.enableFrictionReduction){if(ba&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(ba))}}return ba};aL.prototype[af.LINE|af.LINE]=aL.prototype.lineLine=function(aV,aU,aY,a0,aT,aS,aX,aZ,aW){if(aW){return false}else{return 0}};aL.prototype[af.PLANE|af.LINE]=aL.prototype.planeLine=function(a4,a7,bc,a3,aU,a1,a8,aV,aT){var aY=M,aW=L,bd=J,aZ=H,aX=G,bf=F,a5=E,a0=D,aS=B,bb=aP,be=0;aA.set(aY,-a1.length/2,0);aA.set(aW,a1.length/2,0);aA.rotate(bd,aY,aV);aA.rotate(aZ,aW,aV);N(bd,bd,a8);N(aZ,aZ,a8);aA.copy(aY,bd);aA.copy(aW,aZ);aK(aX,aW,aY);aA.normalize(bf,aX);aA.rotate90cw(aS,bf);aA.rotate(a0,an,a3);bb[0]=aY;bb[1]=aW;for(var a6=0;a6<bb.length;a6++){var a2=bb[a6];aK(a5,a2,bc);var a9=R(a5,a0);if(a9<0){if(aT){return true}var ba=this.createContactEquation(a4,aU,a7,a1);be++;aA.copy(ba.normalA,a0);aA.normalize(ba.normalA,ba.normalA);aA.scale(a5,a0,a9);aK(ba.contactPointA,a2,a5);aK(ba.contactPointA,ba.contactPointA,a4.position);aK(ba.contactPointB,a2,a8);N(ba.contactPointB,ba.contactPointB,a8);aK(ba.contactPointB,ba.contactPointB,aU.position);this.contactEquations.push(ba);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(ba))}}}}if(aT){return false}if(!this.enableFrictionReduction){if(be&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(be))}}return be};aL.prototype[af.PARTICLE|af.CAPSULE]=aL.prototype.particleCapsule=function(a0,aY,aS,aW,aV,aZ,aT,aX,aU){return this.circleLine(a0,aY,aS,aW,aV,aZ,aT,aX,aU,aZ.radius,0)};aL.prototype[af.CIRCLE|af.LINE]=aL.prototype.circleLine=function(a8,aT,aW,bf,aZ,ba,bg,a1,aY,be,aS){var be=be||0,aS=typeof(aS)!=="undefined"?aS:aT.radius,bm=M,aU=L,bj=J,aV=H,aX=G,a4=F,bp=E,a6=D,a3=B,bo=Y,a9=X,bc=W,a5=V,bl=U,bn=aP;aA.set(a6,-ba.length/2,0);aA.set(a3,ba.length/2,0);aA.rotate(bo,a6,a1);aA.rotate(a9,a3,a1);N(bo,bo,bg);N(a9,a9,bg);aA.copy(a6,bo);aA.copy(a3,a9);aK(a4,a3,a6);aA.normalize(bp,a4);aA.rotate90cw(aX,bp);aK(bc,aW,a6);var bh=R(bc,aX);aK(aV,a6,bg);aK(a5,aW,bg);var bk=aS+be;if(Math.abs(bh)<bk){aA.scale(bm,aX,bh);aK(bj,aW,bm);aA.scale(aU,aX,R(aX,a5));aA.normalize(aU,aU);aA.scale(aU,aU,be);N(bj,bj,aU);var a7=R(bp,bj);var a2=R(bp,a6);var a0=R(bp,a3);if(a7>a2&&a7<a0){if(aY){return true}var bi=this.createContactEquation(a8,aZ,aT,ba);aA.scale(bi.normalA,bm,-1);aA.normalize(bi.normalA,bi.normalA);aA.scale(bi.contactPointA,bi.normalA,aS);N(bi.contactPointA,bi.contactPointA,aW);aK(bi.contactPointA,bi.contactPointA,a8.position);aK(bi.contactPointB,bj,bg);N(bi.contactPointB,bi.contactPointB,bg);aK(bi.contactPointB,bi.contactPointB,aZ.position);this.contactEquations.push(bi);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bi))}return 1}}bn[0]=a6;bn[1]=a3;for(var bd=0;bd<bn.length;bd++){var bb=bn[bd];aK(bc,bb,aW);if(aA.squaredLength(bc)<Math.pow(bk,2)){if(aY){return true}var bi=this.createContactEquation(a8,aZ,aT,ba);aA.copy(bi.normalA,bc);aA.normalize(bi.normalA,bi.normalA);aA.scale(bi.contactPointA,bi.normalA,aS);N(bi.contactPointA,bi.contactPointA,aW);aK(bi.contactPointA,bi.contactPointA,a8.position);aK(bi.contactPointB,bb,bg);aA.scale(bl,bi.normalA,-be);N(bi.contactPointB,bi.contactPointB,bl);N(bi.contactPointB,bi.contactPointB,bg);aK(bi.contactPointB,bi.contactPointB,aZ.position);this.contactEquations.push(bi);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bi))}return 1}}return 0};aL.prototype[af.CIRCLE|af.CAPSULE]=aL.prototype.circleCapsule=function(aT,aV,aZ,a0,aS,aU,aY,aX,aW){return this.circleLine(aT,aV,aZ,a0,aS,aU,aY,aX,aW,aU.radius)};aL.prototype[af.CIRCLE|af.CONVEX]=aL.prototype[af.CIRCLE|af.RECTANGLE]=aL.prototype.circleConvex=function(bn,bk,br,bj,a2,bc,a3,bd,aZ,aS){var aS=typeof(aS)==="number"?aS:bk.radius;var a7=M,a6=L,aT=J,bi=H,a8=G,a4=F,bb=E,bg=D,aX=B,aV=Y,aY=X,bl=-1,a9=null,bp=W,bf=V,bh=U,a5=T,ba=S,aW=false,be=Number.MAX_VALUE;var a0=0;var bo=bc.vertices;for(var bm=0;bm!==bo.length+1;bm++){var bt=bo[bm%bo.length],bs=bo[(bm+1)%bo.length];aA.rotate(a7,bt,bd);aA.rotate(a6,bs,bd);N(a7,a7,a3);N(a6,a6,a3);aK(aT,a6,a7);aA.normalize(bi,aT);aA.rotate90cw(a8,bi);aA.scale(bh,a8,-bk.radius);N(bh,bh,br);if(t(bh,bc,a3,bd)){aA.sub(a5,a7,bh);var a1=Math.abs(aA.dot(a5,a8));if(a1<be){aA.copy(ba,bh);be=a1;aA.scale(bf,a8,a1);aA.add(bf,bf,bh);aW=true}}}if(aW){if(aZ){return true}var bq=this.createContactEquation(bn,a2,bk,bc);aA.sub(bq.normalA,ba,br);aA.normalize(bq.normalA,bq.normalA);aA.scale(bq.contactPointA,bq.normalA,aS);N(bq.contactPointA,bq.contactPointA,br);aK(bq.contactPointA,bq.contactPointA,bn.position);aK(bq.contactPointB,bf,a3);N(bq.contactPointB,bq.contactPointB,a3);aK(bq.contactPointB,bq.contactPointB,a2.position);this.contactEquations.push(bq);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bq))}return 1}if(aS>0){for(var bm=0;bm<bo.length;bm++){var aU=bo[bm];aA.rotate(aY,aU,bd);N(aY,aY,a3);aK(aV,aY,br);if(aA.squaredLength(aV)<Math.pow(aS,2)){if(aZ){return true}var bq=this.createContactEquation(bn,a2,bk,bc);aA.copy(bq.normalA,aV);aA.normalize(bq.normalA,bq.normalA);aA.scale(bq.contactPointA,bq.normalA,aS);N(bq.contactPointA,bq.contactPointA,br);aK(bq.contactPointA,bq.contactPointA,bn.position);aK(bq.contactPointB,aY,a3);N(bq.contactPointB,bq.contactPointB,a3);aK(bq.contactPointB,bq.contactPointB,a2.position);this.contactEquations.push(bq);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bq))}return 1}}}return 0};var aE=aA.create(),aD=aA.create(),ax=aA.create(),aw=aA.create();function t(aW,aS,aV,a2){var aZ=aE,aY=aD,aU=ax,aT=aw,a5=aW,a4=aS.vertices,a0=null;for(var aX=0;aX!==a4.length+1;aX++){var a6=a4[aX%a4.length],a3=a4[(aX+1)%a4.length];aA.rotate(aZ,a6,a2);aA.rotate(aY,a3,a2);N(aZ,aZ,aV);N(aY,aY,aV);aK(aU,aZ,a5);aK(aT,aY,a5);var a1=aA.crossLength(aU,aT);if(a0===null){a0=a1}if(a1*a0<=0){return false}a0=a1}return true}aL.prototype[af.PARTICLE|af.CONVEX]=aL.prototype[af.PARTICLE|af.RECTANGLE]=aL.prototype.particleConvex=function(bg,bb,bd,bc,a2,be,a3,bf,aX){var a7=M,a6=L,aS=J,bm=H,bj=G,a4=F,bt=E,bk=D,aV=B,aT=Y,aW=X,bn=-1,a9=null,br=W,bi=V,a0=U,aZ=T,bl=S,a5=Q,a8=P,bh=Number.MAX_VALUE;var aY=0,aU=false,bp=be.vertices;if(!t(bd,be,a3,bf)){return 0}if(aX){return true}var ba=null;for(var bo=0;bo!==bp.length+1;bo++){var bv=bp[bo%bp.length],bu=bp[(bo+1)%bp.length];aA.rotate(a7,bv,bf);aA.rotate(a6,bu,bf);N(a7,a7,a3);N(a6,a6,a3);aK(aS,a6,a7);aA.normalize(bm,aS);aA.rotate90cw(bj,bm);aK(aT,bd,a7);var bq=R(aT,bj);aK(a4,a7,a3);aK(bt,bd,a3);aA.sub(a5,a7,bd);var a1=Math.abs(aA.dot(a5,bj));if(a1<bh){bh=a1;aA.scale(bi,bj,a1);aA.add(bi,bi,bd);aA.copy(a8,bj);aU=true}}if(aU){var bs=this.createContactEquation(bg,a2,bb,be);aA.scale(bs.normalA,a8,-1);aA.normalize(bs.normalA,bs.normalA);aA.set(bs.contactPointA,0,0);N(bs.contactPointA,bs.contactPointA,bd);aK(bs.contactPointA,bs.contactPointA,bg.position);aK(bs.contactPointB,bi,a3);N(bs.contactPointB,bs.contactPointB,a3);aK(bs.contactPointB,bs.contactPointB,a2.position);this.contactEquations.push(bs);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bs))}return 1}return 0};aL.prototype[af.CIRCLE]=aL.prototype.circleCircle=function(aY,aX,a0,a5,aW,aV,aZ,a4,a1,aU,aT){var a3=M,aU=aU||aX.radius,aT=aT||aV.radius;aK(a3,a0,aZ);var aS=aU+aT;if(aA.squaredLength(a3)>Math.pow(aS,2)){return 0}if(a1){return true}var a2=this.createContactEquation(aY,aW,aX,aV);aK(a2.normalA,aZ,a0);aA.normalize(a2.normalA,a2.normalA);aA.scale(a2.contactPointA,a2.normalA,aU);aA.scale(a2.contactPointB,a2.normalA,-aT);N(a2.contactPointA,a2.contactPointA,a0);aK(a2.contactPointA,a2.contactPointA,aY.position);N(a2.contactPointB,a2.contactPointB,aZ);aK(a2.contactPointB,a2.contactPointB,aW.position);this.contactEquations.push(a2);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a2))}return 1};aL.prototype[af.PLANE|af.CONVEX]=aL.prototype[af.PLANE|af.RECTANGLE]=aL.prototype.planeConvex=function(aZ,aY,a3,aS,aV,aT,aX,a7,a2){var aW=M,a1=L,a6=J;var aU=0;aA.rotate(a1,an,aS);for(var a0=0;a0!==aT.vertices.length;a0++){var a8=aT.vertices[a0];aA.rotate(aW,a8,a7);N(aW,aW,aX);aK(a6,aW,a3);if(R(a6,a1)<=0){if(a2){return true}aU++;var a5=this.createContactEquation(aZ,aV,aY,aT);aK(a6,aW,a3);aA.copy(a5.normalA,a1);var a4=R(a6,a5.normalA);aA.scale(a6,a5.normalA,a4);aK(a5.contactPointB,aW,aV.position);aK(a5.contactPointA,aW,a6);aK(a5.contactPointA,a5.contactPointA,aZ.position);this.contactEquations.push(a5);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&aU){this.frictionEquations.push(this.createFrictionFromAverage(aU))}}return aU};aL.prototype[af.PARTICLE|af.PLANE]=aL.prototype.particlePlane=function(a4,a3,aT,aZ,aV,aU,aY,aS,aX){var a2=M,aW=L;aS=aS||0;aK(a2,aT,aY);aA.rotate(aW,an,aS);var a0=R(a2,aW);if(a0>0){return 0}if(aX){return true}var a1=this.createContactEquation(aV,a4,aU,a3);aA.copy(a1.normalA,aW);aA.scale(a2,a1.normalA,a0);aK(a1.contactPointA,aT,a2);aK(a1.contactPointA,a1.contactPointA,aV.position);aK(a1.contactPointB,aT,a4.position);this.contactEquations.push(a1);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a1))}return 1};aL.prototype[af.CIRCLE|af.PARTICLE]=aL.prototype.circleParticle=function(aV,aX,a0,aT,a2,a1,aS,aW,aU){var aZ=M;aK(aZ,aS,a0);if(aA.squaredLength(aZ)>Math.pow(aX.radius,2)){return 0}if(aU){return true}var aY=this.createContactEquation(aV,a2,aX,a1);aA.copy(aY.normalA,aZ);aA.normalize(aY.normalA,aY.normalA);aA.scale(aY.contactPointA,aY.normalA,aX.radius);N(aY.contactPointA,aY.contactPointA,a0);aK(aY.contactPointA,aY.contactPointA,aV.position);aK(aY.contactPointB,aS,a2.position);this.contactEquations.push(aY);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aY))}return 1};var aF=new ay(1),C=aA.create(),A=aA.create(),y=aA.create();aL.prototype[af.PLANE|af.CAPSULE]=aL.prototype.planeCapsule=function(aW,aV,aY,aT,aZ,a8,aU,a2,aX){var a4=C,a1=A,aS=aF,a6=y;aA.set(a4,-a8.length/2,0);aA.rotate(a4,a4,a2);N(a4,a4,aU);aA.set(a1,a8.length/2,0);aA.rotate(a1,a1,a2);N(a1,a1,aU);aS.radius=a8.radius;var a0;if(this.enableFrictionReduction){a0=this.enableFriction;this.enableFriction=false}var a5=this.circlePlane(aZ,aS,a4,0,aW,aV,aY,aT,aX),a3=this.circlePlane(aZ,aS,a1,0,aW,aV,aY,aT,aX);if(this.enableFrictionReduction){this.enableFriction=a0}if(aX){return a5||a3}else{var a7=a5+a3;if(this.enableFrictionReduction){if(a7){this.frictionEquations.push(this.createFrictionFromAverage(a7))}}return a7}};aL.prototype[af.CIRCLE|af.PLANE]=aL.prototype.circlePlane=function(aV,bb,a3,a7,aT,ba,a2,a6,aW){var aY=aV,aS=bb,aU=a3,a1=aT,a4=ba,bc=a2,a0=a6;a0=a0||0;var aX=M,aZ=L,a9=J;aK(aX,aU,bc);aA.rotate(aZ,an,a0);var a8=R(aZ,aX);if(a8>aS.radius){return 0}if(aW){return true}var a5=this.createContactEquation(a1,aY,ba,bb);aA.copy(a5.normalA,aZ);aA.scale(a5.contactPointB,a5.normalA,-aS.radius);N(a5.contactPointB,a5.contactPointB,aU);aK(a5.contactPointB,a5.contactPointB,aY.position);aA.scale(a9,a5.normalA,a8);aK(a5.contactPointA,aX,a9);N(a5.contactPointA,a5.contactPointA,bc);aK(a5.contactPointA,a5.contactPointA,a1.position);this.contactEquations.push(a5);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}return 1};aL.prototype[af.CONVEX]=aL.prototype[af.CONVEX|af.RECTANGLE]=aL.prototype[af.RECTANGLE]=aL.prototype.convexConvex=function(br,bc,bk,a9,bq,ba,bh,a8,a7,bs){var aT=M,a6=L,a5=J,a4=H,aY=G,a1=F,be=E,aZ=D,bf=B,bg=0,bs=typeof(bs)==="number"?bs:0;var a0=aL.findSeparatingAxis(bc,bk,a9,ba,bh,a8,aT);if(!a0){return 0}aK(aZ,bh,bk);if(R(aT,aZ)>0){aA.scale(aT,aT,-1)}var bd=aL.getClosestEdge(bc,a9,aT,true),bb=aL.getClosestEdge(ba,a8,aT);if(bd===-1||bb===-1){return 0}for(var bn=0;bn<2;bn++){var a3=bd,a2=bb,aX=bc,aV=ba,by=bk,bw=bh,aW=a9,aU=a8,bA=br,bz=bq;if(bn===0){var bm;bm=a3;a3=a2;a2=bm;bm=aX;aX=aV;aV=bm;bm=by;by=bw;bw=bm;bm=aW;aW=aU;aU=bm;bm=bA;bA=bz;bz=bm}for(var bo=a2;bo<a2+2;bo++){var bl=aV.vertices[(bo+aV.vertices.length)%aV.vertices.length];aA.rotate(a6,bl,aU);N(a6,a6,bw);var aS=0;for(var bp=a3-1;bp<a3+2;bp++){var bx=aX.vertices[(bp+aX.vertices.length)%aX.vertices.length],bv=aX.vertices[(bp+1+aX.vertices.length)%aX.vertices.length];aA.rotate(a5,bx,aW);aA.rotate(a4,bv,aW);N(a5,a5,by);N(a4,a4,by);aK(aY,a4,a5);aA.rotate90cw(bf,aY);aA.normalize(bf,bf);aK(aZ,a6,a5);var bt=R(bf,aZ);if((bp===a3&&bt<=bs)||(bp!==a3&&bt<=0)){aS++}}if(aS>=3){if(a7){return true}var bu=this.createContactEquation(bA,bz,aX,aV);bg++;var bx=aX.vertices[(a3)%aX.vertices.length],bv=aX.vertices[(a3+1)%aX.vertices.length];aA.rotate(a5,bx,aW);aA.rotate(a4,bv,aW);N(a5,a5,by);N(a4,a4,by);aK(aY,a4,a5);aA.rotate90cw(bu.normalA,aY);aA.normalize(bu.normalA,bu.normalA);aK(aZ,a6,a5);var bt=R(bu.normalA,aZ);aA.scale(be,bu.normalA,bt);aK(bu.contactPointA,a6,by);aK(bu.contactPointA,bu.contactPointA,be);N(bu.contactPointA,bu.contactPointA,by);aK(bu.contactPointA,bu.contactPointA,bA.position);aK(bu.contactPointB,a6,bw);N(bu.contactPointB,bu.contactPointB,bw);aK(bu.contactPointB,bu.contactPointB,bz.position);this.contactEquations.push(bu);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bu))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&bg){this.frictionEquations.push(this.createFrictionFromAverage(bg))}}return bg};var Z=aA.fromValues(0,0);aL.projectConvexOntoAxis=function(aS,aU,a0,aX,a4){var aZ=null,aV=null,a2,a1,aY=Z;aA.rotate(aY,aX,-a0);for(var aW=0;aW<aS.vertices.length;aW++){a2=aS.vertices[aW];a1=R(a2,aY);if(aZ===null||a1>aZ){aZ=a1}if(aV===null||a1<aV){aV=a1}}if(aV>aZ){var a3=aV;aV=aZ;aZ=a3}var aT=R(aU,aX);aA.set(a4,aV+aT,aZ+aT)};var au=aA.fromValues(0,0),at=aA.fromValues(0,0),aq=aA.fromValues(0,0),ap=aA.fromValues(0,0),ao=aA.fromValues(0,0),am=aA.fromValues(0,0);aL.findSeparatingAxis=function(a2,a5,aU,a0,a3,aT,bc){var aV=null,aS=false,aX=false,aW=au,aZ=at,aY=aq,bf=ap,a6=ao,a4=am;if(a2 instanceof ac&&a0 instanceof ac){for(var a7=0;a7!==2;a7++){var ba=a2,a9=aU;if(a7===1){ba=a0;a9=aT}for(var a8=0;a8!==2;a8++){if(a8===0){aA.set(bf,0,1)}else{if(a8===1){aA.set(bf,1,0)}}if(a9!==0){aA.rotate(bf,bf,a9)}aL.projectConvexOntoAxis(a2,a5,aU,bf,a6);aL.projectConvexOntoAxis(a0,a3,aT,bf,a4);var be=a6,bb=a4,bd=false;if(a6[0]>a4[0]){bb=a6;be=a4;bd=true}var a1=bb[0]-be[1];aS=(a1<=0);if(aV===null||a1>aV){aA.copy(bc,bf);aV=a1;aX=aS}}}}else{for(var a7=0;a7!==2;a7++){var ba=a2,a9=aU;if(a7===1){ba=a0;a9=aT}for(var a8=0;a8!==ba.vertices.length;a8++){aA.rotate(aZ,ba.vertices[a8],a9);aA.rotate(aY,ba.vertices[(a8+1)%ba.vertices.length],a9);aK(aW,aY,aZ);aA.rotate90cw(bf,aW);aA.normalize(bf,bf);aL.projectConvexOntoAxis(a2,a5,aU,bf,a6);aL.projectConvexOntoAxis(a0,a3,aT,bf,a4);var be=a6,bb=a4,bd=false;if(a6[0]>a4[0]){bb=a6;be=a4;bd=true}var a1=bb[0]-be[1];aS=(a1<=0);if(aV===null||a1>aV){aA.copy(bc,bf);aV=a1;aX=aS}}}}return aX};var al=aA.fromValues(0,0),ak=aA.fromValues(0,0),aj=aA.fromValues(0,0);aL.getClosestEdge=function(a2,aU,aT,aX){var aY=al,aS=ak,a0=aj;aA.rotate(aY,aT,-aU);if(aX){aA.scale(aY,aY,-1)}var aV=-1,aZ=a2.vertices.length,a3=-1;for(var aW=0;aW!==aZ;aW++){aK(aS,a2.vertices[(aW+1)%aZ],a2.vertices[aW%aZ]);aA.rotate90cw(a0,aS);aA.normalize(a0,a0);var a1=R(a0,aY);if(aV===-1||a1>a3){aV=aW%aZ;a3=a1}}return aV};var aC=aA.create(),aI=aA.create(),K=aA.create(),I=aA.create(),aR=aA.create(),aa=aA.create(),av=aA.create();aL.prototype[af.CIRCLE|af.HEIGHTFIELD]=aL.prototype.circleHeightfield=function(aY,aS,a8,be,a1,a9,bh,a0,aV,aW){var bi=a9.data,aW=aW||aS.radius,a6=a9.elementWidth,ba=aI,aZ=aC,a3=aR,aX=av,a2=aa,aU=K,aT=I;var a5=Math.floor((a8[0]-aW-bh[0])/a6),a4=Math.ceil((a8[0]+aW-bh[0])/a6);if(a5<0){a5=0}if(a4>=bi.length){a4=bi.length-1}var bd=bi[a5],bb=bi[a4];for(var bc=a5;bc<a4;bc++){if(bi[bc]<bb){bb=bi[bc]}if(bi[bc]>bd){bd=bi[bc]}}if(a8[1]-aW>bd){return aV?false:0}var a7=false;for(var bc=a5;bc<a4;bc++){aA.set(aU,bc*a6,bi[bc]);aA.set(aT,(bc+1)*a6,bi[bc+1]);aA.add(aU,aU,bh);aA.add(aT,aT,bh);aA.sub(a2,aT,aU);aA.rotate(a2,a2,Math.PI/2);aA.normalize(a2,a2);aA.scale(aZ,a2,-aW);aA.add(aZ,aZ,a8);aA.sub(ba,aZ,aU);var bf=aA.dot(ba,a2);if(aZ[0]>=aU[0]&&aZ[0]<aT[0]&&bf<=0){if(aV){return true}a7=true;aA.scale(ba,a2,-bf);aA.add(a3,aZ,ba);aA.copy(aX,a2);var bg=this.createContactEquation(a1,aY,a9,aS);aA.copy(bg.normalA,aX);aA.scale(bg.contactPointB,bg.normalA,-aW);N(bg.contactPointB,bg.contactPointB,a8);aK(bg.contactPointB,bg.contactPointB,aY.position);aA.copy(bg.contactPointA,a3);aA.sub(bg.contactPointA,bg.contactPointA,a1.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}}}a7=false;if(aW>0){for(var bc=a5;bc<=a4;bc++){aA.set(aU,bc*a6,bi[bc]);aA.add(aU,aU,bh);aA.sub(ba,a8,aU);if(aA.squaredLength(ba)<Math.pow(aW,2)){if(aV){return true}a7=true;var bg=this.createContactEquation(a1,aY,a9,aS);aA.copy(bg.normalA,ba);aA.normalize(bg.normalA,bg.normalA);aA.scale(bg.contactPointB,bg.normalA,-aW);N(bg.contactPointB,bg.contactPointB,a8);aK(bg.contactPointB,bg.contactPointB,aY.position);aK(bg.contactPointA,aU,bh);N(bg.contactPointA,bg.contactPointA,bh);aK(bg.contactPointA,bg.contactPointA,a1.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}}}}if(a7){return 1}return 0};var aO=aA.create(),aM=aA.create(),ar=aA.create(),O=new aG([aA.create(),aA.create(),aA.create(),aA.create()]);aL.prototype[af.RECTANGLE|af.HEIGHTFIELD]=aL.prototype[af.CONVEX|af.HEIGHTFIELD]=aL.prototype.convexHeightfield=function(aX,a3,aW,aU,aZ,a6,bc,aY,aV){var bd=a6.data,a4=a6.elementWidth,aT=aO,aS=aM,a7=ar,bb=O;var a2=Math.floor((aX.aabb.lowerBound[0]-bc[0])/a4),a1=Math.ceil((aX.aabb.upperBound[0]-bc[0])/a4);if(a2<0){a2=0}if(a1>=bd.length){a1=bd.length-1}var ba=bd[a2],a8=bd[a1];for(var a9=a2;a9<a1;a9++){if(bd[a9]<a8){a8=bd[a9]}if(bd[a9]>ba){ba=bd[a9]}}if(aX.aabb.lowerBound[1]>ba){return aV?false:0}var a5=false;var be=0;for(var a9=a2;a9<a1;a9++){aA.set(aT,a9*a4,bd[a9]);aA.set(aS,(a9+1)*a4,bd[a9+1]);aA.add(aT,aT,bc);aA.add(aS,aS,bc);var a0=100;aA.set(a7,(aS[0]+aT[0])*0.5,(aS[1]+aT[1]-a0)*0.5);aA.sub(bb.vertices[0],aS,a7);aA.sub(bb.vertices[1],aT,a7);aA.copy(bb.vertices[2],bb.vertices[1]);aA.copy(bb.vertices[3],bb.vertices[0]);bb.vertices[2][1]-=a0;bb.vertices[3][1]-=a0;be+=this.convexConvex(aX,a3,aW,aU,aZ,bb,a7,0,aV)}return be}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50}],12:[function(z,y,T){y.exports=J;var W=z("../math/vec2");var M=z("../collision/RaycastResult");var A=z("../shapes/Shape");var X=z("../collision/AABB");function J(af){af=af||{};this.from=af.from?W.fromValues(af.from[0],af.from[1]):W.create();this.to=af.to?W.fromValues(af.to[0],af.to[1]):W.create();this._direction=W.create();this.precision=0.0001;this.checkCollisionResponse=true;this.skipBackfaces=false;this.collisionMask=-1;this.collisionGroup=-1;this.mode=J.ANY;this.result=new M();this.hasHit=false;this.callback=function(ag){}}J.prototype.constructor=J;J.CLOSEST=1;J.ANY=2;J.ALL=4;var S=new X();var u=[];J.prototype.intersectWorld=function(ag,af){this.mode=af.mode||J.ANY;this.result=af.result||new M();this.skipBackfaces=!!af.skipBackfaces;this.collisionMask=typeof(af.collisionMask)!=="undefined"?af.collisionMask:-1;this.collisionGroup=typeof(af.collisionGroup)!=="undefined"?af.collisionGroup:-1;if(af.from){W.copy(this.from,af.from)}if(af.to){W.copy(this.to,af.to)}this.callback=af.callback||function(){};this.hasHit=false;this.result.reset();this._updateDirection();this.getAABB(S);u.length=0;ag.broadphase.aabbQuery(ag,S,u);this.intersectBodies(u);return this.hasHit};var ad=W.create(),ab=W.create();var H=W.create();J.prototype.intersectBody=function(ag,af){if(af){this.result=af;this._updateDirection()}var ak=this.checkCollisionResponse;if(ak&&!ag.collisionResponse){return}var al=H;for(var aj=0,am=ag.shapes.length;aj<am;aj++){var ah=ag.shapes[aj];if(ak&&!ah.collisionResponse){continue}W.copy(al,ag.shapeOffsets[aj]);W.rotate(al,al,ag.angle);W.add(al,al,ag.position);var ai=ag.shapeAngles[aj]+ag.angle;this.intersectShape(ah,ai,al,ag);if(this.result._shouldStop){break}}};J.prototype.intersectBodies=function(ah,af){if(af){this.result=af;this._updateDirection()}for(var ai=0,ag=ah.length;!this.result._shouldStop&&ai<ag;ai++){this.intersectBody(ah[ai])}};J.prototype._updateDirection=function(){var af=this._direction;W.sub(af,this.to,this.from);W.normalize(af,af)};J.prototype.intersectShape=function(ah,ai,ag,af){var al=this.from;var ak=w(al,this._direction,ag);if(ak>ah.boundingSphereRadius){return}var aj=this[ah.type];if(aj){aj.call(this,ah,ai,ag,af)}};var v=W.create();var Q=W.create();var D=W.create();var ac=W.create();var aa=W.create();var Z=W.create();var Y=W.create();var F=new M();var R=W.create();var U=W.create();var B=W.create();var N=W.create();var t=W.create();var V=W.create();var E=W.create();J.prototype.intersectRectangle=function(ag,ar,aw,an){var ay=-Number.MAX_VALUE;var af=Number.MAX_VALUE;var at=R;var ap=U;var ao=B;var aq=N;var ak=t;var aj=V;var al=E;W.set(aj,-ag.width*0.5,-ag.height*0.5);W.set(al,ag.width*0.5,ag.height*0.5);W.rotate(at,this._direction,-ar);an.toLocalFrame(ap,this.from);if(at[0]!==0){var ax=(aj[0]-ap[0])/at[0];var av=(al[0]-ap[0])/at[0];var am=ay;ay=Math.max(ay,Math.min(ax,av));if(ay!==am){W.set(ao,ax>av?1:-1,0)}var au=af;af=Math.min(af,Math.max(ax,av));if(af!==au){W.set(aq,ax<av?1:-1,0)}}if(at[1]!==0){var ai=(aj[1]-ap[1])/at[1];var ah=(al[1]-ap[1])/at[1];var am=ay;ay=Math.max(ay,Math.min(ai,ah));if(ay!==am){W.set(ao,0,ai>ah?1:-1)}var au=af;af=Math.min(af,Math.max(ai,ah));if(af!==au){W.set(aq,0,ai<ah?1:-1)}}if(af>=ay){W.set(ak,ap[0]+at[0]*ay,ap[1]+at[1]*ay);W.rotate(ao,ao,ar);an.toWorldFrame(ak,ak);this.reportIntersection(ao,ak,ag,an,-1);if(this._shouldStop){return}W.rotate(aq,aq,ar);W.set(ak,ap[0]+at[0]*af,ap[1]+at[1]*af);an.toWorldFrame(ak,ak);this.reportIntersection(aq,ak,ag,an,-1)}};J.prototype[A.RECTANGLE]=J.prototype.intersectRectangle;var K=W.create();var O=W.create();var x=W.create();var G=W.create();var P=W.create();J.prototype.intersectPlane=function(an,ai,ak,al){var ar=this.from;var at=this.to;var ap=this._direction;var au=K;var aq=O;var ah=x;var aj=G;var am=P;W.set(aj,0,1);W.rotate(aj,aj,ai);W.sub(am,ar,ak);var af=W.dot(am,aj);W.sub(am,at,ak);var ao=W.dot(am,aj);if(af*ao>0){return}if(W.distance(ar,at)<af){return}var ag=W.dot(aj,ap);W.sub(au,ar,ak);var av=-W.dot(aj,au)/ag;W.scale(aq,ap,av);W.add(ah,ar,aq);this.reportIntersection(aj,ah,an,al,-1)};J.prototype[A.PLANE]=J.prototype.intersectPlane;var C=W.create();var L=W.create();J.prototype.intersectCircle=function(am,ai,aj,ak){var aq=this.from,ar=this.to,ag=am.radius;var ap=Math.pow(ar[0]-aq[0],2)+Math.pow(ar[1]-aq[1],2);var ao=2*((ar[0]-aq[0])*(aq[0]-aj[0])+(ar[1]-aq[1])*(aq[1]-aj[1]));var an=Math.pow(aq[0]-aj[0],2)+Math.pow(aq[1]-aj[1],2)-Math.pow(ag,2);var at=Math.pow(ao,2)-4*ap*an;var au=C;var al=L;if(at<0){return}else{if(at===0){W.lerp(au,aq,ar,at);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1)}else{var ah=(-ao-Math.sqrt(at))/(2*ap);var af=(-ao+Math.sqrt(at))/(2*ap);W.lerp(au,aq,ar,ah);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1);if(this.result._shouldStop){return}W.lerp(au,aq,ar,af);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1)}}};J.prototype[A.CIRCLE]=J.prototype.intersectCircle;J.prototype.getAABB=function(af){var ah=this.to;var ag=this.from;af.lowerBound[0]=Math.min(ah[0],ag[0]);af.lowerBound[1]=Math.min(ah[1],ag[1]);af.upperBound[0]=Math.max(ah[0],ag[0]);af.upperBound[1]=Math.max(ah[1],ag[1])};J.prototype.reportIntersection=function(aj,ah,ak,ai,af){var al=this.from;var am=this.to;var ag=W.distance(al,ah);var an=this.result;if(this.skipBackfaces&&W.dot(aj,this._direction)>0){return}an.hitFaceIndex=typeof(af)!=="undefined"?af:-1;switch(this.mode){case J.ALL:this.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag);an.hasHit=true;this.callback(an);break;case J.CLOSEST:if(ag<an.distance||!an.hasHit){this.hasHit=true;an.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag)}break;case J.ANY:this.hasHit=true;an.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag);an._shouldStop=true;break}};var ae=W.create(),I=W.create();function w(aj,ah,af){W.sub(ae,af,aj);var ag=W.dot(ae,ah);W.scale(I,ah,ag);W.add(I,I,aj);var ai=W.distance(af,I);return ai}},{"../collision/AABB":7,"../collision/RaycastResult":13,"../math/vec2":31,"../shapes/Shape":45}],13:[function(v,w,u){var x=v("../math/vec2");w.exports=t;function t(){this.rayFromWorld=x.create();this.rayToWorld=x.create();this.hitNormalWorld=x.create();this.hitPointWorld=x.create();this.hasHit=false;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=false}t.prototype.reset=function(){x.set(this.rayFromWorld,0,0);x.set(this.rayToWorld,0,0);x.set(this.hitNormalWorld,0,0);x.set(this.hitPointWorld,0,0);this.hasHit=false;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=false};t.prototype.abort=function(){this._shouldStop=true};t.prototype.set=function(D,A,C,B,z,y,E){x.copy(this.rayFromWorld,D);x.copy(this.rayToWorld,A);x.copy(this.hitNormalWorld,C);x.copy(this.hitPointWorld,B);this.shape=z;this.body=y;this.distance=E}},{"../math/vec2":31}],14:[function(v,w,u){var y=v("../utils/Utils"),t=v("../collision/Broadphase");w.exports=x;function x(){t.call(this,t.SAP);this.axisList=[];this.axisIndex=0;var z=this;this._addBodyHandler=function(A){z.axisList.push(A.body)};this._removeBodyHandler=function(B){var A=z.axisList.indexOf(B.body);if(A!==-1){z.axisList.splice(A,1)}}}x.prototype=new t();x.prototype.constructor=x;x.prototype.setWorld=function(z){this.axisList.length=0;y.appendArray(this.axisList,z.bodies);z.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);z.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=z};x.sortAxisList=function(A,E){E=E|0;for(var D=1,z=A.length;D<z;D++){var B=A[D];for(var C=D-1;C>=0;C--){if(A[C].aabb.lowerBound[E]<=B.aabb.lowerBound[E]){break}A[C+1]=A[C]}A[C+1]=B}return A};x.prototype.sortList=function(){var z=this.axisList,A=this.axisIndex;x.sortAxisList(z,A)};x.prototype.getCollisionPairs=function(G){var z=this.axisList,K=this.result,J=this.axisIndex;K.length=0;var C=z.length;while(C--){var I=z[C];if(I.aabbNeedsUpdate){I.updateAABB()}}this.sortList();for(var F=0,H=z.length|0;F!==H;F++){var D=z[F];for(var E=F+1;E<H;E++){var B=z[E];var A=(B.aabb.lowerBound[J]<=D.aabb.upperBound[J]);if(!A){break}if(t.canCollide(D,B)&&this.boundingVolumeCheck(D,B)){K.push(D,B)}}}return K};x.prototype.aabbQuery=function(D,C,I){I=I||[];this.sortList();var H=this.axisIndex;var z="x";if(H===1){z="y"}if(H===2){z="z"}var F=this.axisList;var B=C.lowerBound[z];var G=C.upperBound[z];for(var A=0;A<F.length;A++){var E=F[A];if(E.aabbNeedsUpdate){E.updateAABB()}if(E.aabb.overlaps(C)){I.push(E)}}return I}},{"../collision/Broadphase":8,"../utils/Utils":50}],15:[function(u,w,t){w.exports=v;var x=u("../utils/Utils");function v(B,A,z,y){this.type=z;y=x.defaults(y,{collideConnected:true,wakeUpBodies:true,});this.equations=[];this.bodyA=B;this.bodyB=A;this.collideConnected=y.collideConnected;if(y.wakeUpBodies){if(B){B.wakeUp()}if(A){A.wakeUp()}}}v.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};v.DISTANCE=1;v.GEAR=2;v.LOCK=3;v.PRISMATIC=4;v.REVOLUTE=5;v.prototype.setStiffness=function(z){var A=this.equations;for(var B=0;B!==A.length;B++){var y=A[B];y.stiffness=z;y.needsUpdate=true}};v.prototype.setRelaxation=function(B){var z=this.equations;for(var A=0;A!==z.length;A++){var y=z[A];y.relaxation=B;y.needsUpdate=true}}},{"../utils/Utils":50}],16:[function(v,t,w){var D=v("./Constraint"),z=v("../equations/Equation"),x=v("../math/vec2"),y=v("../utils/Utils");t.exports=C;function C(G,F,Q){Q=y.defaults(Q,{localAnchorA:[0,0],localAnchorB:[0,0]});D.call(this,G,F,D.DISTANCE,Q);this.localAnchorA=x.fromValues(Q.localAnchorA[0],Q.localAnchorA[1]);this.localAnchorB=x.fromValues(Q.localAnchorB[0],Q.localAnchorB[1]);var K=this.localAnchorA;var I=this.localAnchorB;this.distance=0;if(typeof(Q.distance)==="number"){this.distance=Q.distance}else{var O=x.create(),N=x.create(),E=x.create();x.rotate(O,K,G.angle);x.rotate(N,I,F.angle);x.add(E,F.position,N);x.sub(E,E,O);x.sub(E,E,G.position);this.distance=x.length(E)}var P;if(typeof(Q.maxForce)==="undefined"){P=Number.MAX_VALUE}else{P=Q.maxForce}var J=new z(G,F,-P,P);this.equations=[J];this.maxForce=P;var E=x.create();var M=x.create();var L=x.create();var H=this;J.computeGq=function(){var U=this.bodyA,T=this.bodyB,S=U.position,R=T.position;x.rotate(M,K,U.angle);x.rotate(L,I,T.angle);x.add(E,R,L);x.sub(E,E,M);x.sub(E,E,S);return x.length(E)-H.distance};this.setMaxForce(P);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}C.prototype=new D();C.prototype.constructor=C;var u=x.create();var B=x.create();var A=x.create();C.prototype.update=function(){var K=this.equations[0],I=this.bodyA,H=this.bodyB,E=this.distance,M=I.position,L=H.position,F=this.equations[0],O=K.G;x.rotate(B,this.localAnchorA,I.angle);x.rotate(A,this.localAnchorB,H.angle);x.add(u,L,A);x.sub(u,u,B);x.sub(u,u,M);this.position=x.length(u);var P=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){F.maxForce=0;F.minForce=-this.maxForce;this.distance=this.upperLimit;P=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){F.maxForce=this.maxForce;F.minForce=0;this.distance=this.lowerLimit;P=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!P){F.enabled=false;return}F.enabled=true;x.normalize(u,u);var J=x.crossLength(B,u),N=x.crossLength(A,u);O[0]=-u[0];O[1]=-u[1];O[2]=-J;O[3]=u[0];O[4]=u[1];O[5]=N};C.prototype.setMaxForce=function(E){var F=this.equations[0];F.minForce=-E;F.maxForce=E};C.prototype.getMaxForce=function(E){var F=this.equations[0];return F.maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15}],17:[function(u,w,t){var v=u("./Constraint"),y=u("../equations/Equation"),z=u("../equations/AngleLockEquation"),x=u("../math/vec2");w.exports=A;function A(D,C,B){B=B||{};v.call(this,D,C,v.GEAR,B);this.ratio=typeof(B.ratio)==="number"?B.ratio:1;this.angle=typeof(B.angle)==="number"?B.angle:C.angle-this.ratio*D.angle;B.angle=this.angle;B.ratio=this.ratio;this.equations=[new z(D,C,B),];if(typeof(B.maxTorque)==="number"){this.setMaxTorque(B.maxTorque)}}A.prototype=new v();A.prototype.constructor=A;A.prototype.update=function(){var B=this.equations[0];if(B.ratio!==this.ratio){B.setRatio(this.ratio)}B.angle=this.angle};A.prototype.setMaxTorque=function(B){this.equations[0].setMaxTorque(B)};A.prototype.getMaxTorque=function(B){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],18:[function(y,x,A){var F=y("./Constraint"),B=y("../math/vec2"),C=y("../equations/Equation");x.exports=D;function D(L,J,S){S=S||{};F.call(this,L,J,F.LOCK,S);var Q=(typeof(S.maxForce)==="undefined"?Number.MAX_VALUE:S.maxForce);var K=S.localAngleB||0;var P=new C(L,J,-Q,Q),O=new C(L,J,-Q,Q),H=new C(L,J,-Q,Q);var I=B.create(),M=B.create(),N=this;P.computeGq=function(){B.rotate(I,N.localOffsetB,L.angle);B.sub(M,J.position,L.position);B.sub(M,M,I);return M[0]};O.computeGq=function(){B.rotate(I,N.localOffsetB,L.angle);B.sub(M,J.position,L.position);B.sub(M,M,I);return M[1]};var G=B.create(),R=B.create();H.computeGq=function(){B.rotate(G,N.localOffsetB,J.angle-N.localAngleB);B.scale(G,G,-1);B.sub(M,L.position,J.position);B.add(M,M,G);B.rotate(R,G,-Math.PI/2);B.normalize(R,R);return B.dot(M,R)};this.localOffsetB=B.create();if(S.localOffsetB){B.copy(this.localOffsetB,S.localOffsetB)}else{B.sub(this.localOffsetB,J.position,L.position);B.rotate(this.localOffsetB,this.localOffsetB,-L.angle)}this.localAngleB=0;if(typeof(S.localAngleB)==="number"){this.localAngleB=S.localAngleB}else{this.localAngleB=J.angle-L.angle}this.equations.push(P,O,H);this.setMaxForce(Q)}D.prototype=new F();D.prototype.constructor=D;D.prototype.setMaxForce=function(H){var t=this.equations;for(var G=0;G<this.equations.length;G++){t[G].maxForce=H;t[G].minForce=-H}};D.prototype.getMaxForce=function(){return this.equations[0].maxForce};var z=B.create();var u=B.create();var E=B.create();var w=B.fromValues(1,0);var v=B.fromValues(0,1);D.prototype.update=function(){var t=this.equations[0],J=this.equations[1],G=this.equations[2],I=this.bodyA,H=this.bodyB;B.rotate(z,this.localOffsetB,I.angle);B.rotate(u,this.localOffsetB,H.angle-this.localAngleB);B.scale(u,u,-1);B.rotate(E,u,Math.PI/2);B.normalize(E,E);t.G[0]=-1;t.G[1]=0;t.G[2]=-B.crossLength(z,w);t.G[3]=1;J.G[0]=0;J.G[1]=-1;J.G[2]=-B.crossLength(z,v);J.G[4]=1;G.G[0]=-E[0];G.G[1]=-E[1];G.G[3]=E[0];G.G[4]=E[1];G.G[5]=B.crossLength(u,E)}},{"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],19:[function(x,v,z){var H=x("./Constraint"),B=x("../equations/ContactEquation"),D=x("../equations/Equation"),C=x("../math/vec2"),t=x("../equations/RotationalLockEquation");v.exports=y;function y(L,K,X){X=X||{};H.call(this,L,K,H.PRISMATIC,X);var Q=C.fromValues(0,0),M=C.fromValues(1,0),P=C.fromValues(0,0);if(X.localAnchorA){C.copy(Q,X.localAnchorA)}if(X.localAxisA){C.copy(M,X.localAxisA)}if(X.localAnchorB){C.copy(P,X.localAnchorB)}this.localAnchorA=Q;this.localAnchorB=P;this.localAxisA=M;var U=this.maxForce=typeof(X.maxForce)!=="undefined"?X.maxForce:Number.MAX_VALUE;var W=new D(L,K,-U,U);var T=new C.create(),S=new C.create(),R=new C.create(),V=new C.create();W.computeGq=function(){return C.dot(R,V)};W.updateJacobian=function(){var aa=this.G,Z=L.position,Y=K.position;C.rotate(T,Q,L.angle);C.rotate(S,P,K.angle);C.add(R,Y,S);C.sub(R,R,Z);C.sub(R,R,T);C.rotate(V,M,L.angle+Math.PI/2);aa[0]=-V[0];aa[1]=-V[1];aa[2]=-C.crossLength(T,V)+C.crossLength(V,R);aa[3]=V[0];aa[4]=V[1];aa[5]=C.crossLength(S,V)};this.equations.push(W);if(!X.disableRotationalLock){var I=new t(L,K,-U,U);this.equations.push(I)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(X.lowerLimit)!=="undefined"?true:false;this.upperLimitEnabled=typeof(X.upperLimit)!=="undefined"?true:false;this.lowerLimit=typeof(X.lowerLimit)!=="undefined"?X.lowerLimit:0;this.upperLimit=typeof(X.upperLimit)!=="undefined"?X.upperLimit:1;this.upperLimitEquation=new B(L,K);this.lowerLimitEquation=new B(L,K);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=U;this.motorEquation=new D(L,K);this.motorEnabled=false;this.motorSpeed=0;var O=this;var N=this.motorEquation;var J=N.computeGW;N.computeGq=function(){return 0};N.computeGW=function(){var ab=this.G,aa=this.bodyA,Z=this.bodyB,ad=aa.velocity,ac=Z.velocity,Y=aa.angularVelocity,ae=Z.angularVelocity;return this.gmult(ab,ad,Y,ac,ae)+O.motorSpeed}}y.prototype=new H();y.prototype.constructor=y;var G=C.create(),F=C.create(),E=C.create(),w=C.create(),u=C.create(),A=C.create();y.prototype.update=function(){var Q=this.equations,V=Q[0],L=this.upperLimit,T=this.lowerLimit,U=this.upperLimitEquation,P=this.lowerLimitEquation,J=this.bodyA,I=this.bodyB,K=this.localAxisA,O=this.localAnchorA,N=this.localAnchorB;V.updateJacobian();C.rotate(G,K,J.angle);C.rotate(w,O,J.angle);C.add(F,w,J.position);C.rotate(u,N,I.angle);C.add(E,u,I.position);var M=this.position=C.dot(E,G)-C.dot(F,G);if(this.motorEnabled){var S=this.motorEquation.G;S[0]=G[0];S[1]=G[1];S[2]=C.crossLength(G,u);S[3]=-G[0];S[4]=-G[1];S[5]=-C.crossLength(G,w)}if(this.upperLimitEnabled&&M>L){C.scale(U.normalA,G,-1);C.sub(U.contactPointA,F,J.position);C.sub(U.contactPointB,E,I.position);C.scale(A,G,L);C.add(U.contactPointA,U.contactPointA,A);if(Q.indexOf(U)===-1){Q.push(U)}}else{var R=Q.indexOf(U);if(R!==-1){Q.splice(R,1)}}if(this.lowerLimitEnabled&&M<T){C.scale(P.normalA,G,1);C.sub(P.contactPointA,F,J.position);C.sub(P.contactPointB,E,I.position);C.scale(A,G,T);C.sub(P.contactPointB,P.contactPointB,A);if(Q.indexOf(P)===-1){Q.push(P)}}else{var R=Q.indexOf(P);if(R!==-1){Q.splice(R,1)}}};y.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};y.prototype.disableMotor=function(){if(!this.motorEnabled){return}var I=this.equations.indexOf(this.motorEquation);this.equations.splice(I,1);this.motorEnabled=false};y.prototype.setLimits=function(I,J){if(typeof(I)==="number"){this.lowerLimit=I;this.lowerLimitEnabled=true}else{this.lowerLimit=I;this.lowerLimitEnabled=false}if(typeof(J)==="number"){this.upperLimit=J;this.upperLimitEnabled=true}else{this.upperLimit=J;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15}],20:[function(z,x,B){var G=z("./Constraint"),E=z("../equations/Equation"),F=z("../equations/RotationalVelocityEquation"),u=z("../equations/RotationalLockEquation"),D=z("../math/vec2");x.exports=A;var y=D.create(),w=D.create(),v=D.fromValues(1,0),t=D.fromValues(0,1),C=D.create();function A(N,M,J){J=J||{};G.call(this,N,M,G.REVOLUTE,J);var L=this.maxForce=typeof(J.maxForce)!=="undefined"?J.maxForce:Number.MAX_VALUE;this.pivotA=D.create();this.pivotB=D.create();if(J.worldPivot){D.sub(this.pivotA,J.worldPivot,N.position);D.sub(this.pivotB,J.worldPivot,M.position);D.rotate(this.pivotA,this.pivotA,-N.angle);D.rotate(this.pivotB,this.pivotB,-M.angle)}else{D.copy(this.pivotA,J.localPivotA);D.copy(this.pivotB,J.localPivotB)}var I=this.equations=[new E(N,M,-L,L),new E(N,M,-L,L),];var H=I[0];var O=I[1];var K=this;H.computeGq=function(){D.rotate(y,K.pivotA,N.angle);D.rotate(w,K.pivotB,M.angle);D.add(C,M.position,w);D.sub(C,C,N.position);D.sub(C,C,y);return D.dot(C,v)};O.computeGq=function(){D.rotate(y,K.pivotA,N.angle);D.rotate(w,K.pivotB,M.angle);D.add(C,M.position,w);D.sub(C,C,N.position);D.sub(C,C,y);return D.dot(C,t)};O.minForce=H.minForce=-L;O.maxForce=H.maxForce=L;this.motorEquation=new F(N,M);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new u(N,M);this.lowerLimitEquation=new u(N,M);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}A.prototype=new G();A.prototype.constructor=A;A.prototype.setLimits=function(H,I){if(typeof(H)==="number"){this.lowerLimit=H;this.lowerLimitEnabled=true}else{this.lowerLimit=H;this.lowerLimitEnabled=false}if(typeof(I)==="number"){this.upperLimit=I;this.upperLimitEnabled=true}else{this.upperLimit=I;this.upperLimitEnabled=false}};A.prototype.update=function(){var I=this.bodyA,H=this.bodyB,L=this.pivotA,J=this.pivotB,P=this.equations,N=P[0],U=P[1],R=P[0],Q=P[1],K=this.upperLimit,T=this.lowerLimit,V=this.upperLimitEquation,O=this.lowerLimitEquation;var M=this.angle=H.angle-I.angle;if(this.upperLimitEnabled&&M>K){V.angle=K;if(P.indexOf(V)===-1){P.push(V)}}else{var S=P.indexOf(V);if(S!==-1){P.splice(S,1)}}if(this.lowerLimitEnabled&&M<T){O.angle=T;if(P.indexOf(O)===-1){P.push(O)}}else{var S=P.indexOf(O);if(S!==-1){P.splice(S,1)}}D.rotate(y,L,I.angle);D.rotate(w,J,H.angle);R.G[0]=-1;R.G[1]=0;R.G[2]=-D.crossLength(y,v);R.G[3]=1;R.G[4]=0;R.G[5]=D.crossLength(w,v);Q.G[0]=0;Q.G[1]=-1;Q.G[2]=-D.crossLength(y,t);Q.G[3]=0;Q.G[4]=1;Q.G[5]=D.crossLength(w,t)};A.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};A.prototype.disableMotor=function(){if(!this.motorEnabled){return}var H=this.equations.indexOf(this.motorEquation);this.equations.splice(H,1);this.motorEnabled=false};A.prototype.motorIsEnabled=function(){return !!this.motorEnabled};A.prototype.setMotorSpeed=function(I){if(!this.motorEnabled){return}var H=this.equations.indexOf(this.motorEquation);this.equations[H].relativeVelocity=I};A.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15}],21:[function(u,v,t){var x=u("./Equation"),w=u("../math/vec2");v.exports=y;function y(B,A,z){z=z||{};x.call(this,B,A,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=z.angle||0;this.ratio=typeof(z.ratio)==="number"?z.ratio:1;this.setRatio(this.ratio)}y.prototype=new x();y.prototype.constructor=y;y.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};y.prototype.setRatio=function(A){var z=this.G;z[2]=A;z[5]=-1;this.ratio=A};y.prototype.setMaxTorque=function(z){this.maxForce=z;this.minForce=-z}},{"../math/vec2":31,"./Equation":23}],22:[function(v,w,u){var y=v("./Equation"),x=v("../math/vec2");w.exports=t;function t(A,z){y.call(this,A,z,0,Number.MAX_VALUE);this.contactPointA=x.create();this.penetrationVec=x.create();this.contactPointB=x.create();this.normalA=x.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}t.prototype=new y();t.prototype.constructor=t;t.prototype.computeB=function(S,R,P){var C=this.bodyA,z=this.bodyB,H=this.contactPointA,F=this.contactPointB,L=C.position,K=z.position;var Q=this.penetrationVec,M=this.normalA,E=this.G;var I=x.crossLength(H,M),A=x.crossLength(F,M);E[0]=-M[0];E[1]=-M[1];E[2]=-I;E[3]=M[0];E[4]=M[1];E[5]=A;x.add(Q,K,F);x.sub(Q,Q,L);x.sub(Q,Q,H);var D,O;if(this.firstImpact&&this.restitution!==0){O=0;D=(1/R)*(1+this.restitution)*this.computeGW()}else{O=x.dot(M,Q)+this.offset;D=this.computeGW()}var N=this.computeGiMf();var J=-O*S-D*R-P*N;return J}},{"../math/vec2":31,"./Equation":23}],23:[function(z,x,B){x.exports=E;var C=z("../math/vec2"),D=z("../utils/Utils"),F=z("../objects/Body");function E(O,N,L,M){this.minForce=typeof(L)==="undefined"?-Number.MAX_VALUE:L;this.maxForce=typeof(M)==="undefined"?Number.MAX_VALUE:M;this.bodyA=O;this.bodyB=N;this.stiffness=E.DEFAULT_STIFFNESS;this.relaxation=E.DEFAULT_RELAXATION;this.G=new D.ARRAY_TYPE(6);for(var K=0;K<6;K++){this.G[K]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}E.prototype.constructor=E;E.DEFAULT_STIFFNESS=1000000;E.DEFAULT_RELAXATION=4;E.prototype.update=function(){var K=this.stiffness,M=this.relaxation,L=this.timeStep;this.a=4/(L*(1+4*M));this.b=(4*M)/(1+4*M);this.epsilon=4/(L*L*K*(1+4*M));this.needsUpdate=false};E.prototype.gmult=function(L,N,K,M,O){return L[0]*N[0]+L[1]*N[1]+L[2]*K+L[3]*M[0]+L[4]*M[1]+L[5]*O};E.prototype.computeB=function(M,K,N){var P=this.computeGW();var O=this.computeGq();var L=this.computeGiMf();return -O*M-P*K-L*N};var w=C.create(),v=C.create();E.prototype.computeGq=function(){var P=this.G,O=this.bodyA,M=this.bodyB,N=O.position,L=M.position,K=O.angle,Q=M.angle;return this.gmult(P,w,K,v,Q)+this.offset};E.prototype.computeGW=function(){var N=this.G,M=this.bodyA,L=this.bodyB,P=M.velocity,O=L.velocity,K=M.angularVelocity,Q=L.angularVelocity;return this.gmult(N,P,K,O,Q)+this.relativeVelocity};E.prototype.computeGWlambda=function(){var N=this.G,M=this.bodyA,L=this.bodyB,P=M.vlambda,O=L.vlambda,K=M.wlambda,Q=L.wlambda;return this.gmult(N,P,K,O,Q)};var A=C.create(),y=C.create();E.prototype.computeGiMf=function(){var N=this.bodyA,M=this.bodyB,U=N.force,L=N.angularForce,T=M.force,K=M.angularForce,P=N.invMassSolve,O=M.invMassSolve,R=N.invInertiaSolve,Q=M.invInertiaSolve,S=this.G;C.scale(A,U,P);C.scale(y,T,O);return this.gmult(S,A,L*R,y,K*Q)};E.prototype.computeGiMGt=function(){var O=this.bodyA,M=this.bodyB,N=O.invMassSolve,L=M.invMassSolve,K=O.invInertiaSolve,Q=M.invInertiaSolve,P=this.G;return P[0]*P[0]*N+P[1]*P[1]*N+P[2]*P[2]*K+P[3]*P[3]*L+P[4]*P[4]*L+P[5]*P[5]*Q};var G=C.create(),J=C.create(),H=C.create(),t=C.create(),I=C.create(),u=C.create();E.prototype.addToWlambda=function(K){var M=this.bodyA,L=this.bodyB,X=G,Q=J,P=H,S=t,R=I,O=M.invMassSolve,N=L.invMassSolve,V=M.invInertiaSolve,U=L.invInertiaSolve,T=u,W=this.G;Q[0]=W[0];Q[1]=W[1];P[0]=W[3];P[1]=W[4];C.scale(X,Q,O*K);C.add(M.vlambda,M.vlambda,X);M.wlambda+=V*W[2]*K;C.scale(X,P,N*K);C.add(L.vlambda,L.vlambda,X);L.wlambda+=U*W[5]*K};E.prototype.computeInvC=function(K){return 1/(this.computeGiMGt()+K)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50}],24:[function(u,w,t){var y=u("../math/vec2"),x=u("./Equation"),z=u("../utils/Utils");w.exports=v;function v(C,B,A){x.call(this,C,B,-A,A);this.contactPointA=y.create();this.contactPointB=y.create();this.t=y.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}v.prototype=new x();v.prototype.constructor=v;v.prototype.setSlipForce=function(A){this.maxForce=A;this.minForce=-A};v.prototype.getSlipForce=function(){return this.maxForce};v.prototype.computeB=function(K,I,F){var E=this.bodyA,D=this.bodyB,L=this.contactPointA,J=this.contactPointB,N=this.t,M=this.G;M[0]=-N[0];M[1]=-N[1];M[2]=-y.crossLength(L,N);M[3]=N[0];M[4]=N[1];M[5]=y.crossLength(J,N);var H=this.computeGW(),A=this.computeGiMf();var C=-H*I-F*A;return C}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23}],25:[function(x,w,z){var C=x("./Equation"),B=x("../math/vec2");w.exports=u;function u(H,F,D){D=D||{};C.call(this,H,F,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=D.angle||0;var E=this.G;E[2]=1;E[5]=-1}u.prototype=new C();u.prototype.constructor=u;var A=B.create(),y=B.create(),v=B.fromValues(1,0),t=B.fromValues(0,1);u.prototype.computeGq=function(){B.rotate(A,v,this.bodyA.angle+this.angle);B.rotate(y,t,this.bodyB.angle);return B.dot(A,y)}},{"../math/vec2":31,"./Equation":23}],26:[function(u,v,t){var x=u("./Equation"),w=u("../math/vec2");v.exports=y;function y(A,z){x.call(this,A,z,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}y.prototype=new x();y.prototype.constructor=y;y.prototype.computeB=function(C,z,E){var D=this.G;D[2]=-1;D[5]=this.ratio;var A=this.computeGiMf();var H=this.computeGW();var F=-H*z-E*A;return F}},{"../math/vec2":31,"./Equation":23}],27:[function(u,v,t){var w=function(){};v.exports=w;w.prototype={constructor:w,on:function(z,A,x){A.context=x||this;if(this._listeners===undefined){this._listeners={}}var y=this._listeners;if(y[z]===undefined){y[z]=[]}if(y[z].indexOf(A)===-1){y[z].push(A)}return this},has:function(y,z){if(this._listeners===undefined){return false}var x=this._listeners;if(z){if(x[y]!==undefined&&x[y].indexOf(z)!==-1){return true}}else{if(x[y]!==undefined){return true}}return false},off:function(z,A){if(this._listeners===undefined){return this}var y=this._listeners;var x=y[z].indexOf(A);if(x!==-1){y[z].splice(x,1)}return this},emit:function(B){if(this._listeners===undefined){return this}var A=this._listeners;var x=A[B.type];if(x!==undefined){B.target=this;for(var z=0,y=x.length;z<y;z++){var C=x[z];C.call(C.context,B)}}return this}}},{}],28:[function(v,w,u){var y=v("./Material");var x=v("../equations/Equation");w.exports=t;function t(B,A,z){z=z||{};if(!(B instanceof y)||!(A instanceof y)){throw new Error("First two arguments must be Material instances.")}this.id=t.idCounter++;this.materialA=B;this.materialB=A;this.friction=typeof(z.friction)!=="undefined"?Number(z.friction):0.3;this.restitution=typeof(z.restitution)!=="undefined"?Number(z.restitution):0;this.stiffness=typeof(z.stiffness)!=="undefined"?Number(z.stiffness):x.DEFAULT_STIFFNESS;this.relaxation=typeof(z.relaxation)!=="undefined"?Number(z.relaxation):x.DEFAULT_RELAXATION;this.frictionStiffness=typeof(z.frictionStiffness)!=="undefined"?Number(z.frictionStiffness):x.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(z.frictionRelaxation)!=="undefined"?Number(z.frictionRelaxation):x.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(z.surfaceVelocity)!=="undefined"?Number(z.surfaceVelocity):0;this.contactSkinSize=0.005}t.idCounter=0},{"../equations/Equation":23,"./Material":29}],29:[function(u,v,t){v.exports=w;function w(x){this.id=x||w.idCounter++}w.idCounter=0},{}],30:[function(v,w,u){var t={};t.GetArea=function(A){if(A.length<6){return 0}var x=A.length-2;var z=0;for(var y=0;y<x;y+=2){z+=(A[y+2]-A[y])*(A[y+1]+A[y+3])}z+=(A[0]-A[x])*(A[x+1]+A[1]);return -z*0.5};t.Triangulate=function(D){var E=D.length>>1;if(E<3){return[]}var M=[];var C=[];for(var K=0;K<E;K++){C.push(K)}var K=0;var H=E;while(H>3){var I=C[(K+0)%H];var G=C[(K+1)%H];var F=C[(K+2)%H];var B=D[2*I],z=D[2*I+1];var N=D[2*G],L=D[2*G+1];var y=D[2*F],x=D[2*F+1];var A=false;if(t._convex(B,z,N,L,y,x)){A=true;for(var J=0;J<H;J++){var O=C[J];if(O==I||O==G||O==F){continue}if(t._PointInTriangle(D[2*O],D[2*O+1],B,z,N,L,y,x)){A=false;break}}}if(A){M.push(I,G,F);C.splice((K+1)%H,1);H--;K=0}else{if(K++>3*H){break}}}M.push(C[0],C[1],C[2]);return M};t._PointInTriangle=function(L,K,H,G,S,R,D,B){var A=D-H;var z=B-G;var F=S-H;var E=R-G;var Q=L-H;var O=K-G;var P=A*A+z*z;var N=A*F+z*E;var M=A*Q+z*O;var y=F*F+E*E;var x=F*Q+E*O;var C=1/(P*y-N*N);var J=(y*M-N*x)*C;var I=(P*x-N*M)*C;return(J>=0)&&(I>=0)&&(J+I<1)};t._convex=function(z,y,B,A,x,C){return(y-A)*(x-B)+(B-z)*(C-A)>=0};w.exports=t},{}],31:[function(u,v,t){var w=v.exports={};var x=u("../utils/Utils");w.crossLength=function(z,y){return z[0]*y[1]-z[1]*y[0]};w.crossVZ=function(y,z,A){w.rotate(y,z,-Math.PI/2);w.scale(y,y,A);return y};w.crossZV=function(y,A,z){w.rotate(y,z,Math.PI/2);w.scale(y,y,A);return y};w.rotate=function(B,A,D){if(D!==0){var F=Math.cos(D),C=Math.sin(D),z=A[0],E=A[1];B[0]=F*z-C*E;B[1]=C*z+F*E}else{B[0]=A[0];B[1]=A[1]}};w.rotate90cw=function(B,A){var z=A[0];var C=A[1];B[0]=C;B[1]=-z};w.toLocalFrame=function(y,B,z,A){w.copy(y,B);w.sub(y,y,z);w.rotate(y,y,-A)};w.toGlobalFrame=function(y,B,z,A){w.copy(y,B);w.rotate(y,y,A);w.add(y,y,z)};w.centroid=function(A,z,y,B){w.add(A,z,y);w.add(A,A,B);w.scale(A,A,1/3);return A};w.create=function(){var y=new x.ARRAY_TYPE(2);y[0]=0;y[1]=0;return y};w.clone=function(y){var z=new x.ARRAY_TYPE(2);z[0]=y[0];z[1]=y[1];return z};w.fromValues=function(z,B){var A=new x.ARRAY_TYPE(2);A[0]=z;A[1]=B;return A};w.copy=function(z,y){z[0]=y[0];z[1]=y[1];return z};w.set=function(A,z,B){A[0]=z;A[1]=B;return A};w.add=function(A,z,y){A[0]=z[0]+y[0];A[1]=z[1]+y[1];return A};w.subtract=function(A,z,y){A[0]=z[0]-y[0];A[1]=z[1]-y[1];return A};w.sub=w.subtract;w.multiply=function(A,z,y){A[0]=z[0]*y[0];A[1]=z[1]*y[1];return A};w.mul=w.multiply;w.divide=function(A,z,y){A[0]=z[0]/y[0];A[1]=z[1]/y[1];return A};w.div=w.divide;w.scale=function(A,z,y){A[0]=z[0]*y;A[1]=z[1]*y;return A};w.distance=function(B,A){var z=A[0]-B[0],C=A[1]-B[1];return Math.sqrt(z*z+C*C)};w.dist=w.distance;w.squaredDistance=function(B,A){var z=A[0]-B[0],C=A[1]-B[1];return z*z+C*C};w.sqrDist=w.squaredDistance;w.length=function(A){var z=A[0],B=A[1];return Math.sqrt(z*z+B*B)};w.len=w.length;w.squaredLength=function(A){var z=A[0],B=A[1];return z*z+B*B};w.sqrLen=w.squaredLength;w.negate=function(z,y){z[0]=-y[0];z[1]=-y[1];return z};w.normalize=function(C,B){var A=B[0],D=B[1];var z=A*A+D*D;if(z>0){z=1/Math.sqrt(z);C[0]=B[0]*z;C[1]=B[1]*z}return C};w.dot=function(z,y){return z[0]*y[0]+z[1]*y[1]};w.str=function(y){return"vec2("+y[0]+", "+y[1]+")"};w.lerp=function(A,z,y,B){var D=z[0],C=z[1];A[0]=D+B*(y[0]-D);A[1]=C+B*(y[1]-C);return A}},{"../utils/Utils":50}],32:[function(D,u,O){var t=D("../math/vec2"),E=D("poly-decomp"),G=D("../shapes/Convex"),K=D("../collision/AABB"),B=D("../events/EventEmitter");u.exports=J;function J(P){P=P||{};B.call(this);this.id=++J._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=P.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!P.fixedRotation;this.position=t.fromValues(0,0);if(P.position){t.copy(this.position,P.position)}this.interpolatedPosition=t.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=t.fromValues(0,0);this.previousAngle=0;this.velocity=t.fromValues(0,0);if(P.velocity){t.copy(this.velocity,P.velocity)}this.vlambda=t.fromValues(0,0);this.wlambda=0;this.angle=P.angle||0;this.angularVelocity=P.angularVelocity||0;this.force=t.create();if(P.force){t.copy(this.force,P.force)}this.angularForce=P.angularForce||0;this.damping=typeof(P.damping)==="number"?P.damping:0.1;this.angularDamping=typeof(P.angularDamping)==="number"?P.angularDamping:0.1;this.type=J.STATIC;if(typeof(P.type)!=="undefined"){this.type=P.type}else{if(!P.mass){this.type=J.STATIC}else{this.type=J.DYNAMIC}}this.boundingRadius=0;this.aabb=new K();this.aabbNeedsUpdate=true;this.allowSleep=true;this.wantsToSleep=false;this.sleepState=J.AWAKE;this.sleepSpeedLimit=0.2;this.sleepTimeLimit=1;this.gravityScale=1;this.collisionResponse=true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=P.ccdSpeedThreshold!==undefined?P.ccdSpeedThreshold:-1;this.ccdIterations=P.ccdIterations!==undefined?P.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}J.prototype=new B();J.prototype.constructor=J;J._idCounter=0;J.prototype.updateSolveMassProperties=function(){if(this.sleepState===J.SLEEPING||this.type===J.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};J.prototype.setDensity=function(P){var Q=this.getArea();this.mass=Q*P;this.updateMassProperties()};J.prototype.getArea=function(){var P=0;for(var Q=0;Q<this.shapes.length;Q++){P+=this.shapes[Q].area}return P};J.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var x=new K(),M=t.create();J.prototype.updateAABB=function(){var P=this.shapes,U=this.shapeOffsets,Q=this.shapeAngles,V=P.length,S=M,X=this.angle;for(var T=0;T!==V;T++){var W=P[T],R=Q[T]+X;t.rotate(S,U[T],X);t.add(S,S,this.position);W.computeAABB(x,S,R);if(T===0){this.aabb.copy(x)}else{this.aabb.extend(x)}}this.aabbNeedsUpdate=false};J.prototype.updateBoundingRadius=function(){var Q=this.shapes,U=this.shapeOffsets,W=Q.length,P=0;for(var S=0;S!==W;S++){var R=Q[S],V=t.length(U[S]),T=R.boundingRadius;if(V+T>P){P=V+T}}this.boundingRadius=P};J.prototype.addShape=function(P,R,Q){Q=Q||0;if(R){R=t.fromValues(R[0],R[1])}else{R=t.fromValues(0,0)}this.shapes.push(P);this.shapeOffsets.push(R);this.shapeAngles.push(Q);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};J.prototype.removeShape=function(Q){var P=this.shapes.indexOf(Q);if(P!==-1){this.shapes.splice(P,1);this.shapeOffsets.splice(P,1);this.shapeAngles.splice(P,1);this.aabbNeedsUpdate=true;return true}else{return false}};J.prototype.updateMassProperties=function(){if(this.type===J.STATIC||this.type===J.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var R=this.shapes,W=R.length,P=this.mass/W,T=0;if(!this.fixedRotation){for(var U=0;U<W;U++){var S=R[U],Q=t.squaredLength(this.shapeOffsets[U]),V=S.computeMomentOfInertia(P);T+=V+P*Q}this.inertia=T;this.invInertia=T>0?1/T:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass}};var H=t.create();J.prototype.applyForce=function(S,Q){var R=H;t.sub(R,Q,this.position);t.add(this.force,this.force,S);var P=t.crossLength(R,S);this.angularForce+=P};J.prototype.toLocalFrame=function(P,Q){t.toLocalFrame(P,Q,this.position,this.angle)};J.prototype.toWorldFrame=function(P,Q){t.toGlobalFrame(P,Q,this.position,this.angle)};J.prototype.fromPolygon=function(W,X){X=X||{};for(var R=this.shapes.length;R>=0;--R){this.removeShape(this.shapes[R])}var P=new E.Polygon();P.vertices=W;P.makeCCW();if(typeof(X.removeCollinearPoints)==="number"){P.removeCollinearPoints(X.removeCollinearPoints)}if(typeof(X.skipSimpleCheck)==="undefined"){if(!P.isSimple()){return false}}this.concavePath=P.vertices.slice(0);for(var R=0;R<this.concavePath.length;R++){var V=[0,0];t.copy(V,this.concavePath[R]);this.concavePath[R]=V}var S;if(X.optimalDecomp){S=P.decomp()}else{S=P.quickDecomp()}var U=t.create();for(var R=0;R!==S.length;R++){var T=new G(S[R].vertices);for(var Q=0;Q!==T.vertices.length;Q++){var V=T.vertices[Q];t.sub(V,V,T.centerOfMass)}t.scale(U,T.centerOfMass,1);T.updateTriangles();T.updateCenterOfMass();T.updateBoundingRadius();this.addShape(T,U)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var C=t.fromValues(0,0),A=t.fromValues(0,0),z=t.fromValues(0,0),y=t.fromValues(0,0);J.prototype.adjustCenterOfMass=function(){var V=A,T=z,P=y,Q=0;t.set(T,0,0);for(var R=0;R!==this.shapes.length;R++){var S=this.shapes[R],U=this.shapeOffsets[R];t.scale(V,U,S.area);t.add(T,T,V);Q+=S.area}t.scale(P,T,1/Q);for(var R=0;R!==this.shapes.length;R++){var S=this.shapes[R],U=this.shapeOffsets[R];if(!U){U=this.shapeOffsets[R]=t.create()}t.sub(U,U,P)}t.add(this.position,this.position,P);for(var R=0;this.concavePath&&R<this.concavePath.length;R++){t.sub(this.concavePath[R],this.concavePath[R],P)}this.updateMassProperties();this.updateBoundingRadius()};J.prototype.setZeroForce=function(){t.set(this.force,0,0);this.angularForce=0};J.prototype.resetConstraintVelocity=function(){var P=this,Q=P.vlambda;t.set(Q,0,0);P.wlambda=0};J.prototype.addConstraintVelocity=function(){var P=this,Q=P.velocity;t.add(Q,Q,P.vlambda);P.angularVelocity+=P.wlambda};J.prototype.applyDamping=function(Q){if(this.type===J.DYNAMIC){var P=this.velocity;t.scale(P,P,Math.pow(1-this.damping,Q));this.angularVelocity*=Math.pow(1-this.angularDamping,Q)}};J.prototype.wakeUp=function(){var P=this.sleepState;this.sleepState=J.AWAKE;this.idleTime=0;if(P!==J.AWAKE){this.emit(J.wakeUpEvent)}};J.prototype.sleep=function(){this.sleepState=J.SLEEPING;this.angularVelocity=0;this.angularForce=0;t.set(this.velocity,0,0);t.set(this.force,0,0);this.emit(J.sleepEvent)};J.prototype.sleepTick=function(U,Q,S){if(!this.allowSleep||this.type===J.SLEEPING){return}this.wantsToSleep=false;var R=this.sleepState,P=t.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),T=Math.pow(this.sleepSpeedLimit,2);if(P>=T){this.idleTime=0;this.sleepState=J.AWAKE}else{this.idleTime+=S;this.sleepState=J.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!Q){this.sleep()}else{this.wantsToSleep=true}}};J.prototype.getVelocityFromPosition=function(P,Q){P=P||t.create();t.sub(P,this.position,this.previousPosition);t.scale(P,P,1/Q);return P};J.prototype.getAngularVelocityFromPosition=function(P){return(this.angle-this.previousAngle)/P};J.prototype.overlaps=function(P){return this.world.overlapKeeper.bodiesAreOverlapping(this,P)};var v=t.create();var L=t.create();J.prototype.integrate=function(R){var P=this.invMass,S=this.force,T=this.position,Q=this.velocity;t.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*R}t.scale(v,S,R*P);t.add(Q,v,Q);if(!this.integrateToTimeOfImpact(R)){t.scale(L,Q,R);t.add(T,T,L);if(!this.fixedRotation){this.angle+=this.angularVelocity*R}}this.aabbNeedsUpdate=true};var N=t.create();var w=t.create();var F=t.create();var I=t.create();J.prototype.integrateToTimeOfImpact=function(T){if(this.ccdSpeedThreshold<0||t.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}t.normalize(N,this.velocity);t.scale(w,this.velocity,T);t.add(w,w,this.position);t.sub(F,w,this.position);var Z=this.angularVelocity*T;var Y=t.length(F);var R=1;var P;var X=this;this.world.raycastAll(this.position,w,{},function(ab){if(ab.body===X){return}P=ab.body;t.copy(w,ab.hitPointWorld);t.sub(F,ab.hitPointWorld,X.position);R=t.length(F)/Y;ab.abort()});if(!P){return false}var U=this.angle;t.copy(I,this.position);var aa=0;var Q=0;var W=0;var V=R;while(V>=Q&&aa<this.ccdIterations){aa++;W=(V-Q)/2;t.scale(L,F,R);t.add(this.position,I,L);this.angle=U+Z*R;this.updateAABB();var S=this.aabb.overlaps(P.aabb)&&this.world.narrowphase.bodiesOverlap(this,P);if(S){Q=W}else{V=W}}R=W;t.copy(this.position,I);this.angle=U;t.scale(L,F,R);t.add(this.position,this.position,L);if(!this.fixedRotation){this.angle+=Z*R}return true};J.sleepyEvent={type:"sleepy"};J.sleepEvent={type:"sleep"};J.wakeUpEvent={type:"wakeup"};J.DYNAMIC=1;J.STATIC=2;J.KINEMATIC=4;J.AWAKE=0;J.SLEEPY=1;J.SLEEPING=2},{"../collision/AABB":7,"../events/EventEmitter":27,"../math/vec2":31,"../shapes/Convex":39,"poly-decomp":5}],33:[function(w,v,z){var B=w("../math/vec2");var t=w("./Spring");var D=w("../utils/Utils");v.exports=u;function u(O,N,K){K=K||{};t.call(this,O,N,K);this.localAnchorA=B.fromValues(0,0);this.localAnchorB=B.fromValues(0,0);if(K.localAnchorA){B.copy(this.localAnchorA,K.localAnchorA)}if(K.localAnchorB){B.copy(this.localAnchorB,K.localAnchorB)}if(K.worldAnchorA){this.setWorldAnchorA(K.worldAnchorA)}if(K.worldAnchorB){this.setWorldAnchorB(K.worldAnchorB)}var L=B.create();var J=B.create();this.getWorldAnchorA(L);this.getWorldAnchorB(J);var M=B.distance(L,J);this.restLength=typeof(K.restLength)==="number"?K.restLength:M}u.prototype=new t();u.prototype.constructor=u;u.prototype.setWorldAnchorA=function(J){this.bodyA.toLocalFrame(this.localAnchorA,J)};u.prototype.setWorldAnchorB=function(J){this.bodyB.toLocalFrame(this.localAnchorB,J)};u.prototype.getWorldAnchorA=function(J){this.bodyA.toWorldFrame(J,this.localAnchorA)};u.prototype.getWorldAnchorB=function(J){this.bodyB.toWorldFrame(J,this.localAnchorB)};var I=B.create(),y=B.create(),G=B.create(),x=B.create(),H=B.create(),F=B.create(),E=B.create(),C=B.create(),A=B.create();u.prototype.applyForce=function(){var N=this.stiffness,T=this.damping,L=this.restLength,M=this.bodyA,K=this.bodyB,J=I,P=y,Z=G,R=x,O=A;var Y=H,W=F,V=E,U=C;this.getWorldAnchorA(Y);this.getWorldAnchorB(W);B.sub(V,Y,M.position);B.sub(U,W,K.position);B.sub(J,W,Y);var X=B.len(J);B.normalize(P,J);B.sub(Z,K.velocity,M.velocity);B.crossZV(O,K.angularVelocity,U);B.add(Z,Z,O);B.crossZV(O,M.angularVelocity,V);B.sub(Z,Z,O);B.scale(R,P,-N*(X-L)-T*B.dot(Z,P));B.sub(M.force,M.force,R);B.add(K.force,K.force,R);var S=B.crossLength(V,R);var Q=B.crossLength(U,R);M.angularForce-=S;K.angularForce+=Q}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35}],34:[function(w,x,v){var y=w("../math/vec2");var u=w("./Spring");x.exports=t;function t(B,A,z){z=z||{};u.call(this,B,A,z);this.restAngle=typeof(z.restAngle)==="number"?z.restAngle:A.angle-B.angle}t.prototype=new u();t.prototype.constructor=t;t.prototype.applyForce=function(){var C=this.stiffness,G=this.damping,B=this.restAngle,F=this.bodyA,E=this.bodyB,A=E.angle-F.angle,D=E.angularVelocity-F.angularVelocity;var z=-C*(A-B)-G*D*0;F.angularForce-=z;E.angularForce+=z}},{"../math/vec2":31,"./Spring":35}],35:[function(v,w,u){var x=v("../math/vec2");var y=v("../utils/Utils");w.exports=t;function t(B,A,z){z=y.defaults(z,{stiffness:100,damping:1,});this.stiffness=z.stiffness;this.damping=z.damping;this.bodyA=B;this.bodyB=A}t.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50}],36:[function(u,v,t){v.exports={AABB:u("./collision/AABB"),AngleLockEquation:u("./equations/AngleLockEquation"),Body:u("./objects/Body"),Broadphase:u("./collision/Broadphase"),Capsule:u("./shapes/Capsule"),Circle:u("./shapes/Circle"),Constraint:u("./constraints/Constraint"),ContactEquation:u("./equations/ContactEquation"),ContactMaterial:u("./material/ContactMaterial"),Convex:u("./shapes/Convex"),DistanceConstraint:u("./constraints/DistanceConstraint"),Equation:u("./equations/Equation"),EventEmitter:u("./events/EventEmitter"),FrictionEquation:u("./equations/FrictionEquation"),GearConstraint:u("./constraints/GearConstraint"),GridBroadphase:u("./collision/GridBroadphase"),GSSolver:u("./solver/GSSolver"),Heightfield:u("./shapes/Heightfield"),Line:u("./shapes/Line"),LockConstraint:u("./constraints/LockConstraint"),Material:u("./material/Material"),Narrowphase:u("./collision/Narrowphase"),NaiveBroadphase:u("./collision/NaiveBroadphase"),Particle:u("./shapes/Particle"),Plane:u("./shapes/Plane"),RevoluteConstraint:u("./constraints/RevoluteConstraint"),PrismaticConstraint:u("./constraints/PrismaticConstraint"),Ray:u("./collision/Ray"),RaycastResult:u("./collision/RaycastResult"),Rectangle:u("./shapes/Rectangle"),RotationalVelocityEquation:u("./equations/RotationalVelocityEquation"),SAPBroadphase:u("./collision/SAPBroadphase"),Shape:u("./shapes/Shape"),Solver:u("./solver/Solver"),Spring:u("./objects/Spring"),LinearSpring:u("./objects/LinearSpring"),RotationalSpring:u("./objects/RotationalSpring"),Utils:u("./utils/Utils"),World:u("./world/World"),vec2:u("./math/vec2"),version:u("../package.json").version,}},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/GridBroadphase":9,"./collision/NaiveBroadphase":10,"./collision/Narrowphase":11,"./collision/Ray":12,"./collision/RaycastResult":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54}],37:[function(v,w,u){var z=v("./Shape"),x=v("../math/vec2");w.exports=t;function t(B,A){this.length=B||1;this.radius=A||1;z.call(this,z.CAPSULE)}t.prototype=new z();t.prototype.constructor=t;t.prototype.computeMomentOfInertia=function(B){var D=this.radius,A=this.length+D,C=D*2;return B*(C*C+A*A)/12};t.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};t.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var y=x.create();t.prototype.computeAABB=function(C,B,D){var A=this.radius;x.set(y,this.length/2,0);if(D!==0){x.rotate(y,y,D)}x.set(C.upperBound,Math.max(y[0]+A,-y[0]+A),Math.max(y[1]+A,-y[1]+A));x.set(C.lowerBound,Math.min(y[0]-A,-y[0]-A),Math.min(y[1]-A,-y[1]-A));x.add(C.lowerBound,C.lowerBound,B);x.add(C.upperBound,C.upperBound,B)}},{"../math/vec2":31,"./Shape":45}],38:[function(u,v,t){var y=u("./Shape"),x=u("../math/vec2");v.exports=w;function w(z){this.radius=z||1;y.call(this,y.CIRCLE)}w.prototype=new y();w.prototype.constructor=w;w.prototype.computeMomentOfInertia=function(z){var A=this.radius;return z*A*A/2};w.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};w.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};w.prototype.computeAABB=function(A,z,C){var B=this.radius;x.set(A.upperBound,B,B);x.set(A.lowerBound,-B,-B);if(z){x.add(A.lowerBound,A.lowerBound,z);x.add(A.upperBound,A.upperBound,z)}}},{"../math/vec2":31,"./Shape":45}],39:[function(B,v,K){var A=B("./Shape"),u=B("../math/vec2"),y=B("../math/polyk"),C=B("poly-decomp");v.exports=E;function E(N,T){this.vertices=[];this.axes=[];for(var O=0;O<N.length;O++){var M=u.create();u.copy(M,N[O]);this.vertices.push(M)}if(T){for(var O=0;O<T.length;O++){var Q=u.create();u.copy(Q,T[O]);this.axes.push(Q)}}else{for(var O=0;O<N.length;O++){var R=N[O];var P=N[(O+1)%N.length];var S=u.create();u.sub(S,P,R);u.rotate90cw(S,S);u.normalize(S,S);this.axes.push(S)}}this.centerOfMass=u.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;A.call(this,A.CONVEX);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}E.prototype=new A();E.prototype.constructor=E;var z=u.create();var x=u.create();E.prototype.projectOntoLocalAxis=function(S,N){var M=null,R=null,O,T,S=z;for(var Q=0;Q<this.vertices.length;Q++){O=this.vertices[Q];T=u.dot(O,S);if(M===null||T>M){M=T}if(R===null||T<R){R=T}}if(R>M){var P=R;R=M;M=P}u.set(N,R,M)};E.prototype.projectOntoWorldAxis=function(P,O,R,M){var N=x;this.projectOntoLocalAxis(P,M);if(R!==0){u.rotate(N,P,R)}else{N=P}var Q=u.dot(O,N);u.set(M,M[0]+Q,M[1]+Q)};E.prototype.updateTriangles=function(){this.triangles.length=0;var S=[];for(var P=0;P<this.vertices.length;P++){var M=this.vertices[P];S.push(M[0],M[1])}var R=y.Triangulate(S);for(var P=0;P<R.length;P+=3){var Q=R[P],O=R[P+1],N=R[P+2];this.triangles.push([Q,O,N])}};var D=u.create(),w=u.create(),L=u.create(),J=u.create(),I=u.create(),t=u.create(),H=u.create(),G=u.create(),F=u.create();E.prototype.updateCenterOfMass=function(){var Q=this.triangles,X=this.vertices,Y=this.centerOfMass,M=D,N=F,W=L,V=J,U=I,ab=t,R=H,P=G,T=w;u.set(Y,0,0);var aa=0;for(var S=0;S!==Q.length;S++){var Z=Q[S],W=X[Z[0]],V=X[Z[1]],U=X[Z[2]];u.centroid(M,W,V,U);var O=E.triangleArea(W,V,U);aa+=O;u.scale(T,M,O);u.add(Y,Y,T)}u.scale(Y,Y,1/aa)};E.prototype.computeMomentOfInertia=function(S){var Q=0,P=0,R=this.vertices.length;for(var M=R-1,O=0;O<R;M=O,O++){var W=this.vertices[M];var V=this.vertices[O];var U=Math.abs(u.crossLength(W,V));var T=u.dot(V,V)+u.dot(V,W)+u.dot(W,W);Q+=U*T;P+=U}return(S/6)*(Q/P)};E.prototype.updateBoundingRadius=function(){var P=this.vertices,N=0;for(var O=0;O!==P.length;O++){var M=u.squaredLength(P[O]);if(M>N){N=M}}this.boundingRadius=Math.sqrt(N)};E.triangleArea=function(N,M,O){return(((M[0]-N[0])*(O[1]-N[1]))-((O[0]-N[0])*(M[1]-N[1])))*0.5};E.prototype.updateArea=function(){this.updateTriangles();this.area=0;var R=this.triangles,T=this.vertices;for(var Q=0;Q!==R.length;Q++){var P=R[Q],O=T[P[0]],N=T[P[1]],S=T[P[2]];var M=E.triangleArea(O,N,S);this.area+=M}};E.prototype.computeAABB=function(N,M,O){N.setFromPoints(this.vertices,M,O,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,"poly-decomp":5}],40:[function(u,w,t){var z=u("./Shape"),x=u("../math/vec2"),y=u("../utils/Utils");w.exports=v;function v(D,B){B=y.defaults(B,{maxValue:null,minValue:null,elementWidth:0.1});if(B.minValue===null||B.maxValue===null){B.maxValue=D[0];B.minValue=D[0];for(var C=0;C!==D.length;C++){var A=D[C];if(A>B.maxValue){B.maxValue=A}if(A<B.minValue){B.minValue=A}}}this.data=D;this.maxValue=B.maxValue;this.minValue=B.minValue;this.elementWidth=B.elementWidth;z.call(this,z.HEIGHTFIELD)}v.prototype=new z();v.prototype.constructor=v;v.prototype.computeMomentOfInertia=function(A){return Number.MAX_VALUE};v.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};v.prototype.updateArea=function(){var C=this.data,B=0;for(var A=0;A<C.length-1;A++){B+=(C[A]+C[A+1])/2*this.elementWidth}this.area=B};v.prototype.computeAABB=function(B,A,C){B.upperBound[0]=this.elementWidth*this.data.length+A[0];B.upperBound[1]=this.maxValue+A[1];B.lowerBound[0]=A[0];B.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],41:[function(u,v,t){var y=u("./Shape"),x=u("../math/vec2");v.exports=z;function z(A){this.length=A||1;y.call(this,y.LINE)}z.prototype=new y();z.prototype.constructor=z;z.prototype.computeMomentOfInertia=function(A){return A*Math.pow(this.length,2)/12};z.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var w=[x.create(),x.create()];z.prototype.computeAABB=function(C,B,D){var A=this.length/2;x.set(w[0],-A,0);x.set(w[1],A,0);C.setFromPoints(w,B,D,0)}},{"../math/vec2":31,"./Shape":45}],42:[function(v,w,u){var y=v("./Shape"),x=v("../math/vec2");w.exports=t;function t(){y.call(this,y.PARTICLE)}t.prototype=new y();t.prototype.constructor=t;t.prototype.computeMomentOfInertia=function(z){return 0};t.prototype.updateBoundingRadius=function(){this.boundingRadius=0};t.prototype.computeAABB=function(A,z,B){x.copy(A.lowerBound,z);x.copy(A.upperBound,z)}},{"../math/vec2":31,"./Shape":45}],43:[function(u,v,t){var z=u("./Shape"),w=u("../math/vec2"),y=u("../utils/Utils");v.exports=x;function x(){z.call(this,z.PLANE)}x.prototype=new z();x.prototype.constructor=x;x.prototype.computeMomentOfInertia=function(A){return 0};x.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};x.prototype.computeAABB=function(C,A,D){var B=0,E=w.set;if(typeof(D)==="number"){B=D%(2*Math.PI)}if(B===0){E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,0)}else{if(B===Math.PI/2){E(C.lowerBound,0,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(B===Math.PI){E(C.lowerBound,-Number.MAX_VALUE,0);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(B===3*Math.PI/2){E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,0,Number.MAX_VALUE)}else{E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}}}}w.add(C.lowerBound,C.lowerBound,A);w.add(C.upperBound,C.upperBound,A)};x.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],44:[function(w,t,B){var C=w("../math/vec2"),A=w("./Shape"),y=w("./Convex");t.exports=D;function D(F,E){this.width=F||1;this.height=E||1;var H=[C.fromValues(-F/2,-E/2),C.fromValues(F/2,-E/2),C.fromValues(F/2,E/2),C.fromValues(-F/2,E/2)];var G=[C.fromValues(1,0),C.fromValues(0,1)];y.call(this,H,G);this.type=A.RECTANGLE}D.prototype=new y([]);D.prototype.constructor=D;D.prototype.computeMomentOfInertia=function(F){var E=this.width,G=this.height;return F*(G*G+E*E)/12};D.prototype.updateBoundingRadius=function(){var E=this.width,F=this.height;this.boundingRadius=Math.sqrt(E*E+F*F)/2};var z=C.create(),x=C.create(),v=C.create(),u=C.create();D.prototype.computeAABB=function(F,E,G){F.setFromPoints(this.vertices,E,G,0)};D.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45}],45:[function(u,v,t){v.exports=w;function w(x){this.type=x;this.id=w.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionResponse=true;this.collisionMask=1;if(x){this.updateBoundingRadius()}this.material=null;this.area=0;this.sensor=false;this.updateArea()}w.idCounter=0;w.CIRCLE=1;w.PARTICLE=2;w.PLANE=4;w.CONVEX=8;w.LINE=16;w.RECTANGLE=32;w.CAPSULE=64;w.HEIGHTFIELD=128;w.prototype.computeMomentOfInertia=function(x){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")};w.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")};w.prototype.updateArea=function(){};w.prototype.computeAABB=function(y,x,z){}},{}],46:[function(v,t,w){var y=v("../math/vec2"),u=v("./Solver"),z=v("../utils/Utils"),B=v("../equations/FrictionEquation");t.exports=x;function x(C){u.call(this,C,u.GS);C=C||{};this.iterations=C.iterations||10;this.tolerance=C.tolerance||1e-10;this.arrayStep=30;this.lambda=new z.ARRAY_TYPE(this.arrayStep);this.Bs=new z.ARRAY_TYPE(this.arrayStep);this.invCs=new z.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}x.prototype=new u();x.prototype.constructor=x;function A(D){var C=D.length;while(C--){D[C]=+0}}x.prototype.solve=function(X,P){this.sortEquations();var U=0,F=this.iterations,M=this.frictionIterations,I=this.equations,E=I.length,T=Math.pow(this.tolerance*E,2),H=P.bodies,G=P.bodies.length,L=y.add,K=y.set,D=this.useZeroRHS,J=this.lambda;this.usedIterations=0;if(E){for(var V=0;V!==G;V++){var ab=H[V];ab.updateSolveMassProperties()}}if(J.length<E){J=this.lambda=new z.ARRAY_TYPE(E+this.arrayStep);this.Bs=new z.ARRAY_TYPE(E+this.arrayStep);this.invCs=new z.ARRAY_TYPE(E+this.arrayStep)}A(J);var Y=this.invCs,C=this.Bs,J=this.lambda;for(var V=0;V!==I.length;V++){var aa=I[V];if(aa.timeStep!==X||aa.needsUpdate){aa.timeStep=X;aa.update()}C[V]=aa.computeB(aa.a,aa.b,X);Y[V]=aa.computeInvC(aa.epsilon)}var O,N,aa,W,V,S;if(E!==0){for(V=0;V!==G;V++){var ab=H[V];ab.resetConstraintVelocity()}if(M){for(U=0;U!==M;U++){W=0;for(S=0;S!==E;S++){aa=I[S];var R=x.iterateEquation(S,aa,aa.epsilon,C,Y,J,D,X,U);W+=Math.abs(R)}this.usedIterations++;if(W*W<=T){break}}x.updateMultipliers(I,J,1/X);for(S=0;S!==E;S++){var ac=I[S];if(ac instanceof B){var Z=0;for(var Q=0;Q!==ac.contactEquations.length;Q++){Z+=ac.contactEquations[Q].multiplier}Z*=ac.frictionCoefficient/ac.contactEquations.length;ac.maxForce=Z;ac.minForce=-Z}}}for(U=0;U!==F;U++){W=0;for(S=0;S!==E;S++){aa=I[S];var R=x.iterateEquation(S,aa,aa.epsilon,C,Y,J,D,X,U);W+=Math.abs(R)}this.usedIterations++;if(W*W<=T){break}}for(V=0;V!==G;V++){H[V].addConstraintVelocity()}x.updateMultipliers(I,J,1/X)}};x.updateMultipliers=function(C,F,E){var D=C.length;while(D--){C[D].multiplier=F[D]*E}};x.iterateEquation=function(I,R,S,C,J,M,Q,G,N){var F=C[I],L=J[I],K=M[I],E=R.computeGWlambda();var P=R.maxForce,D=R.minForce;if(Q){F=0}var H=L*(F-E-S*K);var O=K+H;if(O<D*G){H=D*G-K}else{if(O>P*G){H=P*G-K}}M[I]+=H;R.addToWlambda(H);return H}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47}],47:[function(u,v,t){var y=u("../utils/Utils"),x=u("../events/EventEmitter");v.exports=z;function z(A,B){A=A||{};x.call(this);this.type=B;this.equations=[];this.equationSortFunction=A.equationSortFunction||false}z.prototype=new x();z.prototype.constructor=z;z.prototype.solve=function(A,B){throw new Error("Solver.solve should be implemented by subclasses!")};var w={bodies:[]};z.prototype.solveIsland=function(B,A){this.removeAllEquations();if(A.equations.length){this.addEquations(A.equations);w.bodies.length=0;A.getBodies(w.bodies);if(w.bodies.length){this.solve(B,w)}}};z.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};z.prototype.addEquation=function(A){if(A.enabled){this.equations.push(A)}};z.prototype.addEquations=function(B){for(var C=0,D=B.length;C!==D;C++){var A=B[C];if(A.enabled){this.equations.push(A)}}};z.prototype.removeEquation=function(A){var B=this.equations.indexOf(A);if(B!==-1){this.equations.splice(B,1)}};z.prototype.removeAllEquations=function(){this.equations.length=0};z.GS=1;z.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50}],48:[function(v,w,t){var x=v("./TupleDictionary");var y=v("./Utils");w.exports=u;function u(){this.overlappingShapesLastState=new x();this.overlappingShapesCurrentState=new x();this.recordPool=[];this.tmpDict=new x();this.tmpArray1=[]}u.prototype.tick=function(){var D=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;var B=D.keys.length;while(B--){var C=D.keys[B];var F=D.getByKey(C);var A=E.getByKey(C);if(F&&!A){this.recordPool.push(F)}}D.reset();D.copy(E);E.reset()};u.prototype.setOverlapping=function(G,D,F,B){var A=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;if(!E.get(D.id,B.id)){var C;if(this.recordPool.length){C=this.recordPool.pop();C.set(G,D,F,B)}else{C=new z(G,D,F,B)}E.set(D.id,B.id,C)}};u.prototype.getNewOverlaps=function(A){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,A)};u.prototype.getEndOverlaps=function(A){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,A)};u.prototype.bodiesAreOverlapping=function(F,E){var D=this.overlappingShapesCurrentState;var A=D.keys.length;while(A--){var B=D.keys[A];var C=D.data[B];if((C.bodyA===F&&C.bodyB===E)||C.bodyA===E&&C.bodyB===F){return true}}return false};u.prototype.getDiff=function(C,A,I){var I=I||[];var G=C;var F=A;I.length=0;var D=F.keys.length;while(D--){var H=F.keys[D];var E=F.data[H];if(!E){throw new Error("Key "+H+" had no data!")}var B=G.data[H];if(!B){I.push(E)}}return I};u.prototype.isNewOverlap=function(D,C){var A=D.id|0,F=C.id|0;var B=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;return !!!B.get(A,F)&&!!E.get(A,F)};u.prototype.getNewBodyOverlaps=function(A){this.tmpArray1.length=0;var B=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(B,A)};u.prototype.getEndBodyOverlaps=function(A){this.tmpArray1.length=0;var B=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(B,A)};u.prototype.getBodyDiff=function(E,A){A=A||[];var C=this.tmpDict;var B=E.length;while(B--){var D=E[B];C.set(D.bodyA.id|0,D.bodyB.id|0,D)}B=C.keys.length;while(B--){var D=C.getByKey(C.keys[B]);if(D){A.push(D.bodyA,D.bodyB)}}C.reset();return A};function z(D,B,C,A){this.shapeA=B;this.shapeB=A;this.bodyA=D;this.bodyB=C}z.prototype.set=function(D,B,C,A){z.call(this,D,B,C,A)}},{"./TupleDictionary":49,"./Utils":50}],49:[function(u,v,t){var x=u("./Utils");v.exports=w;function w(){this.data={};this.keys=[]}w.prototype.getKey=function(z,y){z=z|0;y=y|0;if((z|0)===(y|0)){return -1}return((z|0)>(y|0)?(z<<16)|(y&65535):(y<<16)|(z&65535))|0};w.prototype.getByKey=function(y){y=y|0;return this.data[y]};w.prototype.get=function(z,y){return this.data[this.getKey(z,y)]};w.prototype.set=function(A,y,B){if(!B){throw new Error("No data!")}var z=this.getKey(A,y);if(!this.data[z]){this.keys.push(z)}this.data[z]=B;return z};w.prototype.reset=function(){var A=this.data,z=this.keys;var y=z.length;while(y--){delete A[z[y]]}z.length=0};w.prototype.copy=function(A){this.reset();x.appendArray(this.keys,A.keys);var y=A.keys.length;while(y--){var z=A.keys[y];this.data[z]=A.data[z]}}},{"./Utils":50}],50:[function(u,v,t){v.exports=w;function w(){}w.appendArray=function(z,y){if(y.length<150000){z.push.apply(z,y)}else{for(var A=0,x=y.length;A!==x;++A){z.push(y[A])}}};w.splice=function(B,y,A){A=A||1;for(var z=y,x=B.length-A;z<x;z++){B[z]=B[z+A]}B.length=x};w.ARRAY_TYPE=window.Float32Array||Array;w.extend=function(y,x){for(var z in x){y[z]=x[z]}};w.defaults=function(x,z){x=x||{};for(var y in z){if(!(y in x)){x[y]=z[y]}}return x}},{}],51:[function(v,x,u){var y=v("../objects/Body");x.exports=w;function w(){this.equations=[];this.bodies=[]}w.prototype.reset=function(){this.equations.length=this.bodies.length=0};var t=[];w.prototype.getBodies=function(A){var B=A||[],C=this.equations;t.length=0;for(var D=0;D!==C.length;D++){var z=C[D];if(t.indexOf(z.bodyA.id)===-1){B.push(z.bodyA);t.push(z.bodyA.id)}if(t.indexOf(z.bodyB.id)===-1){B.push(z.bodyB);t.push(z.bodyB.id)}}return B};w.prototype.wantsToSleep=function(){for(var A=0;A<this.bodies.length;A++){var z=this.bodies[A];if(z.type===y.DYNAMIC&&!z.wantsToSleep){return false}}return true};w.prototype.sleep=function(){for(var A=0;A<this.bodies.length;A++){var z=this.bodies[A];z.sleep()}return true}},{"../objects/Body":32}],52:[function(u,w,t){var z=u("../math/vec2"),v=u("./Island"),y=u("./IslandNode"),A=u("../objects/Body");w.exports=x;function x(B){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}x.getUnvisitedNode=function(B){var C=B.length;for(var D=0;D!==C;D++){var E=B[D];if(!E.visited&&E.body.type===A.DYNAMIC){return E}}return false};x.prototype.visit=function(G,D,E){D.push(G.body);var C=G.equations.length;for(var F=0;F!==C;F++){var B=G.equations[F];if(E.indexOf(B)===-1){E.push(B)}}};x.prototype.bfs=function(D,C,E){var B=this.queue;B.length=0;B.push(D);D.visited=true;this.visit(D,C,E);while(B.length){var F=B.pop();var G;while((G=x.getUnvisitedNode(F.neighbors))){G.visited=true;this.visit(G,C,E);if(G.body.type===A.DYNAMIC){B.push(G)}}}};x.prototype.split=function(N){var B=N.bodies,D=this.nodes,C=this.equations;while(D.length){this._nodePool.push(D.pop())}for(var K=0;K!==B.length;K++){if(this._nodePool.length){var H=this._nodePool.pop();H.reset();H.body=B[K];D.push(H)}else{D.push(new y(B[K]))}}for(var I=0;I!==C.length;I++){var O=C[I],K=B.indexOf(O.bodyA),J=B.indexOf(O.bodyB),G=D[K],E=D[J];G.neighbors.push(E);E.neighbors.push(G);G.equations.push(O);E.equations.push(O)}var M=this.islands;while(M.length){var L=M.pop();L.reset();this._islandPool.push(L)}var F;while((F=x.getUnvisitedNode(D))){var L=this._islandPool.length?this._islandPool.pop():new v();this.bfs(F,L.bodies,L.equations);M.push(L)}return M}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53}],53:[function(u,v,t){v.exports=w;function w(x){this.body=x;this.neighbors=[];this.equations=[];this.visited=false}w.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],54:[function(C,A,al){var af=C("../solver/GSSolver"),aw=C("../solver/Solver"),aj=C("../collision/NaiveBroadphase"),Z=C("../collision/Ray"),ar=C("../math/vec2"),ao=C("../shapes/Circle"),T=C("../shapes/Rectangle"),W=C("../shapes/Convex"),B=C("../shapes/Line"),K=C("../shapes/Plane"),av=C("../shapes/Capsule"),at=C("../shapes/Particle"),S=C("../events/EventEmitter"),R=C("../objects/Body"),E=C("../shapes/Shape"),V=C("../objects/LinearSpring"),U=C("../material/Material"),J=C("../material/ContactMaterial"),ae=C("../constraints/DistanceConstraint"),Q=C("../constraints/Constraint"),ad=C("../constraints/LockConstraint"),Y=C("../constraints/RevoluteConstraint"),I=C("../constraints/PrismaticConstraint"),au=C("../constraints/GearConstraint"),y=C("../../package.json"),x=C("../collision/Broadphase"),G=C("../collision/SAPBroadphase"),ac=C("../collision/Narrowphase"),ag=C("../utils/Utils"),t=C("../utils/OverlapKeeper"),u=C("./IslandManager"),L=C("../objects/RotationalSpring");A.exports=O;if(typeof performance==="undefined"){performance={}}if(!performance.now){var z=Date.now();if(performance.timing&&performance.timing.navigationStart){z=performance.timing.navigationStart}performance.now=function(){return Date.now()-z}}function O(ay){S.apply(this);ay=ay||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=ay.solver||new af();this.narrowphase=new ac(this);this.islandManager=new u();this.gravity=ar.fromValues(0,-9.78);if(ay.gravity){ar.copy(this.gravity,ay.gravity)}this.frictionGravity=ar.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.doProfiling=ay.doProfiling||false;this.lastStepTime=0;this.broadphase=ay.broadphase||new G();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new U();this.defaultContactMaterial=new J(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.stepping=false;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof(ay.islandSplit)!=="undefined"?!!ay.islandSplit:false;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep",};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null,};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null,};this.postBroadphaseEvent={type:"postBroadphase",pairs:null,};this.sleepMode=O.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[],};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null,};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new t()}O.prototype=new Object(S.prototype);O.prototype.constructor=O;O.NO_SLEEPING=1;O.BODY_SLEEPING=2;O.ISLAND_SLEEPING=4;O.prototype.addConstraint=function(ay){this.constraints.push(ay)};O.prototype.addContactMaterial=function(ay){this.contactMaterials.push(ay)};O.prototype.removeContactMaterial=function(az){var ay=this.contactMaterials.indexOf(az);if(ay!==-1){ag.splice(this.contactMaterials,ay,1)}};O.prototype.getContactMaterial=function(aC,aB){var aA=this.contactMaterials;for(var az=0,aD=aA.length;az!==aD;az++){var ay=aA[az];if((ay.materialA.id===aC.id)&&(ay.materialB.id===aB.id)||(ay.materialA.id===aB.id)&&(ay.materialB.id===aC.id)){return ay}}return false};O.prototype.removeConstraint=function(az){var ay=this.constraints.indexOf(az);if(ay!==-1){ag.splice(this.constraints,ay,1)}};var aq=ar.create(),D=ar.create(),ap=ar.create(),w=ar.create(),ak=ar.create(),H=ar.create(),an=ar.create(),ab=ar.fromValues(0,0),N=ar.fromValues(0,0),v=ar.fromValues(0,0),X=ar.fromValues(0,0);O.prototype.step=function(ay,aF,az){az=az||10;aF=aF||0;if(aF===0){this.internalStep(ay);this.time+=ay}else{var aH=Math.floor((this.time+aF)/ay)-Math.floor(this.time/ay);aH=Math.min(aH,az);var aD=performance.now();for(var aB=0;aB!==aH;aB++){this.internalStep(ay);if(performance.now()-aD>ay*1000){break}}this.time+=aF;var aC=this.time%ay;var aE=aC/ay;for(var aA=0;aA!==this.bodies.length;aA++){var aG=this.bodies[aA];if(aG.type!==R.STATIC&&aG.sleepState!==R.SLEEPING){ar.sub(X,aG.position,aG.previousPosition);ar.scale(X,X,aE);ar.add(aG.interpolatedPosition,aG.position,X);aG.interpolatedAngle=aG.angle+(aG.angle-aG.previousAngle)*aE}else{ar.copy(aG.interpolatedPosition,aG.position);aG.interpolatedAngle=aG.angle}}}};var P=[];O.prototype.internalStep=function(aE){this.stepping=true;var a1=this,aC=this.doProfiling,aV=this.springs.length,aO=this.springs,bl=this.bodies,bg=this.gravity,aR=this.solver,aD=this.bodies.length,a0=this.broadphase,bm=this.narrowphase,aA=this.constraints,aZ,aY,aS=ak,bc=H,aK=an,aX=ar.scale,aB=ar.add,bk=ar.rotate,aP=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=aE;if(aC){aZ=performance.now()}if(this.useWorldGravityAsFrictionGravity){var ay=ar.length(this.gravity);if(!(ay===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=ay}}if(this.applyGravity){for(var be=0;be!==aD;be++){var bq=bl[be],aW=bq.force;if(bq.type!==R.DYNAMIC||bq.sleepState===R.SLEEPING){continue}ar.scale(aK,bg,bq.mass*bq.gravityScale);aB(aW,aW,aK)}}if(this.applySpringForces){for(var be=0;be!==aV;be++){var a4=aO[be];a4.applyForce()}}if(this.applyDamping){for(var be=0;be!==aD;be++){var bq=bl[be];if(bq.type===R.DYNAMIC){bq.applyDamping(aE)}}}var aN=a0.getCollisionPairs(this);var a7=this.disabledBodyCollisionPairs;for(var be=a7.length-2;be>=0;be-=2){for(var bd=aN.length-2;bd>=0;bd-=2){if((a7[be]===aN[bd]&&a7[be+1]===aN[bd+1])||(a7[be+1]===aN[bd]&&a7[be]===aN[bd+1])){aN.splice(bd,2)}}}var az=aA.length;for(be=0;be!==az;be++){var bp=aA[be];if(!bp.collideConnected){for(var bd=aN.length-2;bd>=0;bd-=2){if((bp.bodyA===aN[bd]&&bp.bodyB===aN[bd+1])||(bp.bodyB===aN[bd]&&bp.bodyA===aN[bd+1])){aN.splice(bd,2)}}}}this.postBroadphaseEvent.pairs=aN;this.emit(this.postBroadphaseEvent);bm.reset(this);for(var be=0,aT=aN.length;be!==aT;be+=2){var bh=aN[be],bf=aN[be+1];for(var bb=0,aH=bh.shapes.length;bb!==aH;bb++){var aM=bh.shapes[bb],a3=bh.shapeOffsets[bb],aJ=bh.shapeAngles[bb];for(var a9=0,aG=bf.shapes.length;a9!==aG;a9++){var aL=bf.shapes[a9],a2=bf.shapeOffsets[a9],aI=bf.shapeAngles[a9];var aU=this.defaultContactMaterial;if(aM.material&&aL.material){var a6=this.getContactMaterial(aM.material,aL.material);if(a6){aU=a6}}this.runNarrowphase(bm,bh,aM,a3,aJ,bf,aL,a2,aI,aU,this.frictionGravity)}}}for(var be=0;be!==aD;be++){var aQ=bl[be];if(aQ._wakeUpAfterNarrowphase){aQ.wakeUp();aQ._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(P);var bn=this.endContactEvent;var a9=P.length;while(a9--){var bo=P[a9];bn.shapeA=bo.shapeA;bn.shapeB=bo.shapeB;bn.bodyA=bo.bodyA;bn.bodyB=bo.bodyB;this.emit(bn)}}var aF=this.preSolveEvent;aF.contactEquations=bm.contactEquations;aF.frictionEquations=bm.frictionEquations;this.emit(aF);var az=aA.length;for(be=0;be!==az;be++){aA[be].update()}if(bm.contactEquations.length||bm.frictionEquations.length||aA.length){if(this.islandSplit){aP.equations.length=0;ag.appendArray(aP.equations,bm.contactEquations);ag.appendArray(aP.equations,bm.frictionEquations);for(be=0;be!==az;be++){ag.appendArray(aP.equations,aA[be].equations)}aP.split(this);for(var be=0;be!==aP.islands.length;be++){var ba=aP.islands[be];if(ba.equations.length){aR.solveIsland(aE,ba)}}}else{aR.addEquations(bm.contactEquations);aR.addEquations(bm.frictionEquations);for(be=0;be!==az;be++){aR.addEquations(aA[be].equations)}if(this.solveConstraints){aR.solve(aE,this)}aR.removeAllEquations()}}for(var be=0;be!==aD;be++){var aQ=bl[be];if(aQ.sleepState!==R.SLEEPING&&aQ.type!==R.STATIC){aQ.integrate(aE)}}for(var be=0;be!==aD;be++){bl[be].setZeroForce()}if(aC){aY=performance.now();a1.lastStepTime=aY-aZ}if(this.emitImpactEvent&&this.has("impact")){var a5=this.impactEvent;for(var be=0;be!==bm.contactEquations.length;be++){var a8=bm.contactEquations[be];if(a8.firstImpact){a5.bodyA=a8.bodyA;a5.bodyB=a8.bodyB;a5.shapeA=a8.shapeA;a5.shapeB=a8.shapeB;a5.contactEquation=a8;this.emit(a5)}}}if(this.sleepMode===O.BODY_SLEEPING){for(be=0;be!==aD;be++){bl[be].sleepTick(this.time,false,aE)}}else{if(this.sleepMode===O.ISLAND_SLEEPING&&this.islandSplit){for(be=0;be!==aD;be++){bl[be].sleepTick(this.time,true,aE)}for(var be=0;be<this.islandManager.islands.length;be++){var ba=this.islandManager.islands[be];if(ba.wantsToSleep()){ba.sleep()}}}}this.stepping=false;if(this.bodiesToBeRemoved.length){for(var be=0;be!==this.bodiesToBeRemoved.length;be++){this.removeBody(this.bodiesToBeRemoved[be])}this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};O.prototype.runNarrowphase=function(ay,aB,aV,aL,aO,az,aU,aK,aN,aG,aA){if(!((aV.collisionGroup&aU.collisionMask)!==0&&(aU.collisionGroup&aV.collisionMask)!==0)){return}ar.rotate(ab,aL,aB.angle);ar.rotate(N,aK,az.angle);ar.add(ab,ab,aB.position);ar.add(N,N,az.position);var aT=aO+aB.angle;var aD=aN+az.angle;ay.enableFriction=aG.friction>0;ay.frictionCoefficient=aG.friction;var aC;if(aB.type===R.STATIC||aB.type===R.KINEMATIC){aC=az.mass}else{if(az.type===R.STATIC||az.type===R.KINEMATIC){aC=aB.mass}else{aC=(aB.mass*az.mass)/(aB.mass+az.mass)}}ay.slipForce=aG.friction*aA*aC;ay.restitution=aG.restitution;ay.surfaceVelocity=aG.surfaceVelocity;ay.frictionStiffness=aG.frictionStiffness;ay.frictionRelaxation=aG.frictionRelaxation;ay.stiffness=aG.stiffness;ay.relaxation=aG.relaxation;ay.contactSkinSize=aG.contactSkinSize;ay.enabledEquations=aB.collisionResponse&&az.collisionResponse&&aV.collisionResponse&&aU.collisionResponse;var aE=ay[aV.type|aU.type],aX=0;if(aE){var aP=aV.sensor||aU.sensor;var aS=ay.frictionEquations.length;if(aV.type<aU.type){aX=aE.call(ay,aB,aV,ab,aT,az,aU,N,aD,aP)}else{aX=aE.call(ay,az,aU,N,aD,aB,aV,ab,aT,aP)}var aW=ay.frictionEquations.length-aS;if(aX){if(aB.allowSleep&&aB.type===R.DYNAMIC&&aB.sleepState===R.SLEEPING&&az.sleepState===R.AWAKE&&az.type!==R.STATIC){var aF=ar.squaredLength(az.velocity)+Math.pow(az.angularVelocity,2);var aI=Math.pow(az.sleepSpeedLimit,2);if(aF>=aI*2){aB._wakeUpAfterNarrowphase=true}}if(az.allowSleep&&az.type===R.DYNAMIC&&az.sleepState===R.SLEEPING&&aB.sleepState===R.AWAKE&&aB.type!==R.STATIC){var aH=ar.squaredLength(aB.velocity)+Math.pow(aB.angularVelocity,2);var aJ=Math.pow(aB.sleepSpeedLimit,2);if(aH>=aJ*2){az._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(aB,aV,az,aU);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(aV,aU)){var aR=this.beginContactEvent;aR.shapeA=aV;aR.shapeB=aU;aR.bodyA=aB;aR.bodyB=az;aR.contactEquations.length=0;if(typeof(aX)==="number"){for(var aM=ay.contactEquations.length-aX;aM<ay.contactEquations.length;aM++){aR.contactEquations.push(ay.contactEquations[aM])}}this.emit(aR)}if(typeof(aX)==="number"&&aW>1){for(var aM=ay.frictionEquations.length-aW;aM<ay.frictionEquations.length;aM++){var aQ=ay.frictionEquations[aM];aQ.setSlipForce(aQ.getSlipForce()/aW)}}}}};O.prototype.addSpring=function(ay){this.springs.push(ay);this.addSpringEvent.spring=ay;this.emit(this.addSpringEvent)};O.prototype.removeSpring=function(az){var ay=this.springs.indexOf(az);if(ay!==-1){ag.splice(this.springs,ay,1)}};O.prototype.addBody=function(ay){if(this.bodies.indexOf(ay)===-1){this.bodies.push(ay);ay.world=this;this.addBodyEvent.body=ay;this.emit(this.addBodyEvent)}};O.prototype.removeBody=function(az){if(this.stepping){this.bodiesToBeRemoved.push(az)}else{az.world=null;var ay=this.bodies.indexOf(az);if(ay!==-1){ag.splice(this.bodies,ay,1);this.removeBodyEvent.body=az;az.resetConstraintVelocity();this.emit(this.removeBodyEvent)}}};O.prototype.getBodyById=function(aB){var az=this.bodies;for(var aA=0;aA<az.length;aA++){var ay=az[aA];if(ay.id===aB){return ay}}return false};O.prototype.disableBodyCollision=function(az,ay){this.disabledBodyCollisionPairs.push(az,ay)};O.prototype.enableBodyCollision=function(aB,aA){var az=this.disabledBodyCollisionPairs;for(var ay=0;ay<az.length;ay+=2){if((az[ay]===aB&&az[ay+1]===aA)||(az[ay+1]===aB&&az[ay]===aA)){az.splice(ay,2);return}}};function ax(ay){if(!ay){return ay}return[ay[0],ay[1]]}function M(az,ay){for(var aA in ay){az[aA]=ay[aA]}}function F(ay){return{id:ay.id,materialA:ay.materialA.id,materialB:ay.materialB.id,friction:ay.friction,restitution:ay.restitution,stiffness:ay.stiffness,relaxation:ay.relaxation,frictionStiffness:ay.frictionStiffness,frictionRelaxation:ay.frictionRelaxation,}}O.prototype.clear=function(){this.time=0;this.fixedStepTime=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var aC=this.constraints;for(var aB=aC.length-1;aB>=0;aB--){this.removeConstraint(aC[aB])}var ay=this.bodies;for(var aB=ay.length-1;aB>=0;aB--){this.removeBody(ay[aB])}var aA=this.springs;for(var aB=aA.length-1;aB>=0;aB--){this.removeSpring(aA[aB])}var az=this.contactMaterials;for(var aB=az.length-1;aB>=0;aB--){this.removeContactMaterial(az[aB])}O.apply(this)};O.prototype.clone=function(){var ay=new O();ay.fromJSON(this.toJSON());return ay};var ai=ar.create(),am=ar.fromValues(0,0),ah=ar.fromValues(0,0);O.prototype.hitTest=function(aA,aD,aO){aO=aO||0;var ay=new R({position:aA}),aK=new at(),aI=aA,az=0,aE=ai,aG=am,aQ=ah;ay.addShape(aK);var aJ=this.narrowphase,aF=[];for(var aM=0,aC=aD.length;aM!==aC;aM++){var aR=aD[aM];for(var aL=0,aN=aR.shapes.length;aL!==aN;aL++){var aH=aR.shapes[aL],aB=aR.shapeOffsets[aL]||aG,aP=aR.shapeAngles[aL]||0;ar.rotate(aE,aB,aR.angle);ar.add(aE,aE,aR.position);var aS=aP+aR.angle;if((aH instanceof ao&&aJ.circleParticle(aR,aH,aE,aS,ay,aK,aI,az,true))||(aH instanceof W&&aJ.particleConvex(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof K&&aJ.particlePlane(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof av&&aJ.particleCapsule(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof at&&ar.squaredLength(ar.sub(aQ,aE,aA))<aO*aO)){aF.push(aR)}}}return aF};O.prototype.setGlobalEquationParameters=function(aB){aB=aB||{};for(var aA=0;aA!==this.constraints.length;aA++){var aC=this.constraints[aA];for(var az=0;az!==aC.equations.length;az++){var ay=aC.equations[az];if(typeof(aB.stiffness)!=="undefined"){ay.stiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){ay.relaxation=aB.relaxation}ay.needsUpdate=true}}for(var aA=0;aA!==this.contactMaterials.length;aA++){var aC=this.contactMaterials[aA];if(typeof(aB.stiffness)!=="undefined"){aC.stiffness=aB.stiffness;aC.frictionStiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){aC.relaxation=aB.relaxation;aC.frictionRelaxation=aB.relaxation}}var aC=this.defaultContactMaterial;if(typeof(aB.stiffness)!=="undefined"){aC.stiffness=aB.stiffness;aC.frictionStiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){aC.relaxation=aB.relaxation;aC.frictionRelaxation=aB.relaxation}};O.prototype.setGlobalStiffness=function(ay){this.setGlobalEquationParameters({stiffness:ay})};O.prototype.setGlobalRelaxation=function(ay){this.setGlobalEquationParameters({relaxation:ay})};var aa=new Z();O.prototype.raycastAll=function(aB,aA,ay,az){ay.mode=Z.ALL;ay.from=aB;ay.to=aA;ay.callback=az;return aa.intersectWorld(this,ay)};O.prototype.raycastAny=function(aB,aA,az,ay){az.mode=Z.ANY;az.from=aB;az.to=aA;az.result=ay;return aa.intersectWorld(this,az)};O.prototype.raycastClosest=function(aB,aA,az,ay){az.mode=Z.CLOSEST;az.from=aB;az.to=aA;az.result=ay;return aa.intersectWorld(this,az)}},{"../../package.json":6,"../collision/Broadphase":8,"../collision/NaiveBroadphase":10,"../collision/Narrowphase":11,"../collision/Ray":12,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,"../utils/Utils":50,"./IslandManager":52}]},{},[36])(36)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;g.Physics.P2=function(p,q){this.game=p;if(typeof q==="undefined"){q={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}else{if(!q.hasOwnProperty("gravity")){q.gravity=[0,0]}if(!q.hasOwnProperty("broadphase")){q.broadphase=new p2.SAPBroadphase()}}this.config=q;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new g.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new g.Signal();this.onBodyRemoved=new g.Signal();this.onSpringAdded=new g.Signal();this.onSpringRemoved=new g.Signal();this.onConstraintAdded=new g.Signal();this.onConstraintRemoved=new g.Signal();this.onContactMaterialAdded=new g.Signal();this.onContactMaterialRemoved=new g.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();if(q.hasOwnProperty("mpx")&&q.hasOwnProperty("pxm")&&q.hasOwnProperty("mpxi")&&q.hasOwnProperty("pxmi")){this.mpx=q.mpx;this.mpxi=q.mpxi;this.pxm=q.pxm;this.pxmi=q.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};g.Physics.P2.prototype={removeBodyNextStep:function(p){this._toRemove.push(p)},preUpdate:function(){var p=this._toRemove.length;while(p--){this.removeBody(this._toRemove[p])}this._toRemove.length=0},enable:function(q,p,s){if(typeof p==="undefined"){p=false}if(typeof s==="undefined"){s=true}var r=1;if(Array.isArray(q)){r=q.length;while(r--){if(q[r] instanceof g.Group){this.enable(q[r].children,p,s)}else{this.enableBody(q[r],p);if(s&&q[r].hasOwnProperty("children")&&q[r].children.length>0){this.enable(q[r],p,true)}}}}else{if(q instanceof g.Group){this.enable(q.children,p,s)}else{this.enableBody(q,p);if(s&&q.hasOwnProperty("children")&&q.children.length>0){this.enable(q.children,p,true)}}}},enableBody:function(q,p){if(q.hasOwnProperty("body")&&q.body===null){q.body=new g.Physics.P2.Body(this.game,q,q.x,q.y,1);q.body.debug=p;q.anchor.set(0.5)}},setImpactEvents:function(p){if(p){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(q,p){this.postBroadphaseCallback=q;this.callbackContext=p;if(q!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(q){if(!this.postBroadphaseCallback||q.pairs.length===0){return}for(var p=q.pairs.length-2;p>=0;p-=2){if(q.pairs[p].parent&&q.pairs[p+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,q.pairs[p].parent,q.pairs[p+1].parent)){q.pairs.splice(p,2)}}},impactHandler:function(r){if(r.bodyA.parent&&r.bodyB.parent){var q=r.bodyA.parent;var p=r.bodyB.parent;if(q._bodyCallbacks[r.bodyB.id]){q._bodyCallbacks[r.bodyB.id].call(q._bodyCallbackContext[r.bodyB.id],q,p,r.shapeA,r.shapeB)}if(p._bodyCallbacks[r.bodyA.id]){p._bodyCallbacks[r.bodyA.id].call(p._bodyCallbackContext[r.bodyA.id],p,q,r.shapeB,r.shapeA)}if(q._groupCallbacks[r.shapeB.collisionGroup]){q._groupCallbacks[r.shapeB.collisionGroup].call(q._groupCallbackContext[r.shapeB.collisionGroup],q,p,r.shapeA,r.shapeB)}if(p._groupCallbacks[r.shapeA.collisionGroup]){p._groupCallbacks[r.shapeA.collisionGroup].call(p._groupCallbackContext[r.shapeA.collisionGroup],p,q,r.shapeB,r.shapeA)}}},beginContactHandler:function(p){this.onBeginContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB,p.contactEquations);if(p.bodyA.parent){p.bodyA.parent.onBeginContact.dispatch(p.bodyB.parent,p.shapeA,p.shapeB,p.contactEquations)}if(p.bodyB.parent){p.bodyB.parent.onBeginContact.dispatch(p.bodyA.parent,p.shapeB,p.shapeA,p.contactEquations)}},endContactHandler:function(p){this.onEndContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB);if(p.bodyA.parent){p.bodyA.parent.onEndContact.dispatch(p.bodyB.parent,p.shapeA,p.shapeB)}if(p.bodyB.parent){p.bodyB.parent.onEndContact.dispatch(p.bodyA.parent,p.shapeB,p.shapeA)}},setBoundsToWorld:function(t,q,s,p,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,q,s,p,r)},setWorldMaterial:function(r,t,q,s,p){if(typeof t==="undefined"){t=true}if(typeof q==="undefined"){q=true}if(typeof s==="undefined"){s=true}if(typeof p==="undefined"){p=true}if(t&&this.walls.left){this.walls.left.shapes[0].material=r}if(q&&this.walls.right){this.walls.right.shapes[0].material=r}if(s&&this.walls.top){this.walls.top.shapes[0].material=r}if(p&&this.walls.bottom){this.walls.bottom.shapes[0].material=r}},updateBoundsCollisionGroup:function(q){var p=this.everythingCollisionGroup.mask;if(typeof q==="undefined"){p=this.boundsCollisionGroup.mask}if(this.walls.left){this.walls.left.shapes[0].collisionGroup=p}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=p}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=p}},setBounds:function(v,t,q,z,r,w,u,p,s){if(typeof r==="undefined"){r=this._boundsLeft}if(typeof w==="undefined"){w=this._boundsRight}if(typeof u==="undefined"){u=this._boundsTop}if(typeof p==="undefined"){p=this._boundsBottom}if(typeof s==="undefined"){s=this._boundsOwnGroup}if(this.walls.left){this.world.removeBody(this.walls.left)}if(this.walls.right){this.world.removeBody(this.walls.right)}if(this.walls.top){this.world.removeBody(this.walls.top)}if(this.walls.bottom){this.world.removeBody(this.walls.bottom)}if(r){this.walls.left=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t)],angle:1.5707963267948966});this.walls.left.addShape(new p2.Plane());if(s){this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.left)}if(w){this.walls.right=new p2.Body({mass:0,position:[this.pxmi(v+q),this.pxmi(t)],angle:-1.5707963267948966});this.walls.right.addShape(new p2.Plane());if(s){this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.right)}if(u){this.walls.top=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t)],angle:-3.141592653589793});this.walls.top.addShape(new p2.Plane());if(s){this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.top)}if(p){this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t+z)]});this.walls.bottom.addShape(new p2.Plane());if(s){this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.bottom)}this._boundsLeft=r;this._boundsRight=w;this._boundsTop=u;this._boundsBottom=p;this._boundsOwnGroup=s},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var t=this.world.constraints;for(var s=t.length-1;s>=0;s--){this.world.removeConstraint(t[s])}var p=this.world.bodies;for(var s=p.length-1;s>=0;s--){this.world.removeBody(p[s])}var r=this.world.springs;for(var s=r.length-1;s>=0;s--){this.world.removeSpring(r[s])}var q=this.world.contactMaterials;for(var s=q.length-1;s>=0;s--){this.world.removeContactMaterial(q[s])}this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(p){if(p.data.world){return false}else{this.world.addBody(p.data);this.onBodyAdded.dispatch(p);return true}},removeBody:function(p){if(p.data.world==this.world){this.world.removeBody(p.data);this.onBodyRemoved.dispatch(p)}return p},addSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.addSpring(p.data)}else{this.world.addSpring(p)}this.onSpringAdded.dispatch(p);return p},removeSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.removeSpring(p.data)}else{this.world.removeSpring(p)}this.onSpringRemoved.dispatch(p);return p},createDistanceConstraint:function(t,s,u,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.DistanceConstraint(this,t,s,u,q,p,r))}},createGearConstraint:function(s,q,r,p){s=this.getBody(s);q=this.getBody(q);if(!s||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.GearConstraint(this,s,q,r,p))}},createRevoluteConstraint:function(u,t,s,r,q,p){u=this.getBody(u);s=this.getBody(s);if(!u||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.RevoluteConstraint(this,u,t,s,r,q,p))}},createLockConstraint:function(t,q,s,r,p){t=this.getBody(t);q=this.getBody(q);if(!t||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.LockConstraint(this,t,q,s,r,p))}},createPrismaticConstraint:function(v,u,r,q,p,s,t){v=this.getBody(v);u=this.getBody(u);if(!v||!u){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.PrismaticConstraint(this,v,u,r,q,p,s,t))}},addConstraint:function(p){this.world.addConstraint(p);this.onConstraintAdded.dispatch(p);return p},removeConstraint:function(p){this.world.removeConstraint(p);this.onConstraintRemoved.dispatch(p);return p},addContactMaterial:function(p){this.world.addContactMaterial(p);this.onContactMaterialAdded.dispatch(p);return p},removeContactMaterial:function(p){this.world.removeContactMaterial(p);this.onContactMaterialRemoved.dispatch(p);return p},getContactMaterial:function(q,p){return this.world.getContactMaterial(q,p)},setMaterial:function(r,p){var q=p.length;while(q--){p[q].setMaterial(r)}},createMaterial:function(q,p){q=q||"";var r=new g.Physics.P2.Material(q);this.materials.push(r);if(typeof p!=="undefined"){p.setMaterial(r)}return r},createContactMaterial:function(s,r,q){if(typeof s==="undefined"){s=this.createMaterial()}if(typeof r==="undefined"){r=this.createMaterial()}var p=new g.Physics.P2.ContactMaterial(s,r,q);return this.addContactMaterial(p)},getBodies:function(){var p=[];var q=this.world.bodies.length;while(q--){p.push(this.world.bodies[q].parent)}return p},getBody:function(p){if(p instanceof p2.Body){return p}else{if(p instanceof g.Physics.P2.Body){return p.data}else{if(p.body&&p.body.type===g.Physics.P2JS){return p.body.data}}}return null},getSprings:function(){var p=[];var q=this.world.springs.length;while(q--){p.push(this.world.springs[q].parent)}return p},getConstraints:function(){var p=[];var q=this.world.constraints.length;while(q--){p.push(this.world.constraints[q].parent)}return p},hitTest:function(t,r,q,v){if(typeof r==="undefined"){r=this.world.bodies}if(typeof q==="undefined"){q=5}if(typeof v==="undefined"){v=false}var p=[this.pxmi(t.x),this.pxmi(t.y)];var u=[];var s=r.length;while(s--){if(r[s] instanceof g.Physics.P2.Body&&!(v&&r[s].data.type===p2.Body.STATIC)){u.push(r[s].data)}else{if(r[s] instanceof p2.Body&&r[s].parent&&!(v&&r[s].type===p2.Body.STATIC)){u.push(r[s])}else{if(r[s] instanceof g.Sprite&&r[s].hasOwnProperty("body")&&!(v&&r[s].body.data.type===p2.Body.STATIC)){u.push(r[s].body.data)}}}}return this.world.hitTest(p,u,q)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(q){var p=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|p}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|p}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|p}this._collisionGroupID++;var r=new g.Physics.P2.CollisionGroup(p);this.collisionGroups.push(r);if(q){this.setCollisionGroup(q,r)}return r},setCollisionGroup:function(p,r){if(p instanceof g.Group){for(var q=0;q<p.total;q++){if(p.children[q]["body"]&&p.children[q]["body"].type===g.Physics.P2JS){p.children[q].body.setCollisionGroup(r)}}}else{p.body.setCollisionGroup(r)}},createSpring:function(s,r,p,v,t,x,w,u,q){s=this.getBody(s);r=this.getBody(r);if(!s||!r){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.Spring(this,s,r,p,v,t,x,w,u,q))}},createRotationalSpring:function(t,s,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Rotational Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.RotationalSpring(this,t,s,q,p,r))}},createBody:function(r,w,t,u,s,v){if(typeof u==="undefined"){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},createParticle:function(r,w,t,u,s,v){if(typeof u==="undefined"){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},convertCollisionObjects:function(w,u,v){if(typeof v==="undefined"){v=true}var r=[];for(var t=0,q=w.collision[u].length;t<q;t++){var s=w.collision[u][t];var p=this.createBody(s.x,s.y,0,v,{},s.polyline);if(p){r.push(p)}}return r},clearTilemapLayerBodies:function(r,q){q=r.getLayer(q);var p=r.layers[q].bodies.length;while(p--){r.layers[q].bodies[p].destroy()}r.layers[q].bodies.length=0},convertTilemap:function(p,u,r,A){u=p.getLayer(u);if(typeof r==="undefined"){r=true}if(typeof A==="undefined"){A=true}this.clearTilemapLayerBodies(p,u);var q=0;var D=0;var B=0;for(var z=0,s=p.layers[u].height;z<s;z++){q=0;for(var C=0,E=p.layers[u].width;C<E;C++){var v=p.layers[u].data[z][C];if(v&&v.index>-1&&v.collides){if(A){var F=p.getTileRight(u,C,z);if(q===0){D=v.x*v.width;B=v.y*v.height;q=v.width}if(F&&F.collides){q+=v.width}else{var t=this.createBody(D,B,0,false);t.addRectangle(q,v.height,q/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t);q=0}}else{var t=this.createBody(v.x*v.width,v.y*v.height,0,false);t.addRectangle(v.width,v.height,v.width/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t)}}}}return p.layers[u].bodies},mpx:function(p){return p*=20},pxm:function(p){return p*0.05},mpxi:function(p){return p*=-20},pxmi:function(p){return p*-0.05}};Object.defineProperty(g.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(p){this.world.defaultContactMaterial.friction=p}});Object.defineProperty(g.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(p){this.world.defaultContactMaterial.restitution=p}});Object.defineProperty(g.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(p){this.world.defaultContactMaterial=p}});Object.defineProperty(g.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(p){this.world.applySpringForces=p}});Object.defineProperty(g.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(p){this.world.applyDamping=p}});Object.defineProperty(g.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(p){this.world.applyGravity=p}});Object.defineProperty(g.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(p){this.world.solveConstraints=p}});Object.defineProperty(g.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(g.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(p){this.world.emitImpactEvent=p}});Object.defineProperty(g.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(p){this.world.sleepMode=p}});Object.defineProperty(g.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});g.Physics.P2.FixtureList=function(p){if(!Array.isArray(p)){p=[p]}this.rawList=p;this.init();this.parse(this.rawList)};g.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(q,p){var r=function(s){s.collisionGroup=q};this.getFixtures(p).forEach(r)},setMask:function(q,p){var r=function(s){s.collisionMask=q};this.getFixtures(p).forEach(r)},setSensor:function(q,p){var r=function(s){s.sensor=q};this.getFixtures(p).forEach(r)},setMaterial:function(q,p){var r=function(s){s.material=q};this.getFixtures(p).forEach(r)},getFixtures:function(r){var q=[];if(r){if(!(r instanceof Array)){r=[r]}var p=this;r.forEach(function(s){if(p.namedFixtures[s]){q.push(p.namedFixtures[s])}});return this.flatten(q)}else{return this.allFixtures}},getFixtureByKey:function(p){return this.namedFixtures[p]},getGroup:function(p){return this.groupedFixtures[p]},parse:function(){var q,s,r,p;r=this.rawList;p=[];for(q in r){s=r[q];if(!isNaN(q-0)){this.groupedFixtures[q]=this.groupedFixtures[q]||[];this.groupedFixtures[q]=this.groupedFixtures[q].concat(s)}else{this.namedFixtures[q]=this.flatten(s)}p.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(r){var p,q;p=[];q=arguments.callee;r.forEach(function(s){return Array.prototype.push.apply(p,(Array.isArray(s)?q(s):[s]))});return p}};g.Physics.P2.PointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.PointProxy.prototype.constructor=g.Physics.P2.PointProxy;Object.defineProperty(g.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(p){this.destination[0]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(p){this.destination[1]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=p}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=p}});g.Physics.P2.InversePointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.InversePointProxy.prototype.constructor=g.Physics.P2.InversePointProxy;Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(p){this.destination[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(p){this.destination[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=-p}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=-p}});g.Physics.P2.Body=function(q,s,p,t,r){s=s||null;p=p||0;t=t||0;if(typeof r==="undefined"){r=1}this.game=q;this.world=q.physics.p2;this.sprite=s;this.type=g.Physics.P2JS;this.offset=new g.Point();this.data=new p2.Body({position:[this.world.pxmi(p),this.world.pxmi(t)],mass:r});this.data.parent=this;this.velocity=new g.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new g.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new g.Point();this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(s){this.setRectangleFromSprite(s);if(s.exists){this.game.physics.p2.addBody(this)}}};g.Physics.P2.Body.prototype={createBodyCallback:function(q,s,p){var r=-1;if(q.id){r=q.id}else{if(q.body){r=q.body.id}}if(r>-1){if(s===null){delete (this._bodyCallbacks[r]);delete (this._bodyCallbackContext[r])}else{this._bodyCallbacks[r]=s;this._bodyCallbackContext[r]=p}}},createGroupCallback:function(q,r,p){if(r===null){delete (this._groupCallbacks[q.mask]);delete (this._groupCallbacksContext[q.mask])}else{this._groupCallbacks[q.mask]=r;this._groupCallbackContext[q.mask]=p}},getCollisionMask:function(){var p=0;if(this._collideWorldBounds){p=this.game.physics.p2.boundsCollisionGroup.mask}for(var q=0;q<this.collidesWith.length;q++){p=p|this.collidesWith[q].mask}return p},updateCollisionMask:function(q){var p=this.getCollisionMask();if(typeof q==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionMask=p}}else{q.collisionMask=p}},setCollisionGroup:function(s,q){var p=this.getCollisionMask();if(typeof q==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionGroup=s.mask;this.data.shapes[r].collisionMask=p}}else{q.collisionGroup=s.mask;q.collisionMask=p}},clearCollision:function(q,s,p){if(typeof q==="undefined"){q=true}if(typeof s==="undefined"){s=true}if(typeof p==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){if(q){this.data.shapes[r].collisionGroup=null}if(s){this.data.shapes[r].collisionMask=null}}}else{if(q){p.collisionGroup=null}if(s){p.collisionMask=null}}if(q){this.collidesWith.length=0}},collides:function(t,u,r,q){if(Array.isArray(t)){for(var s=0;s<t.length;s++){if(this.collidesWith.indexOf(t[s])===-1){this.collidesWith.push(t[s]);if(u){this.createGroupCallback(t[s],u,r)}}}}else{if(this.collidesWith.indexOf(t)===-1){this.collidesWith.push(t);if(u){this.createGroupCallback(t,u,r)}}}var p=this.getCollisionMask();if(typeof q==="undefined"){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=p}}else{q.collisionMask=p}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},applyDamping:function(p){this.data.applyDamping(p)},applyForce:function(r,q,p){this.data.applyForce(r,[this.world.pxmi(q),this.world.pxmi(p)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(p,q){return this.data.toLocalFrame(p,q)},toWorldFrame:function(p,q){return this.data.toWorldFrame(p,q)},rotateLeft:function(p){this.data.angularVelocity=this.world.pxm(-p)},rotateRight:function(p){this.data.angularVelocity=this.world.pxm(p)},moveForward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=p*Math.cos(r);this.data.velocity[1]=p*Math.sin(r)},moveBackward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=-(p*Math.cos(r));this.data.velocity[1]=-(p*Math.sin(r))},thrust:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]+=p*Math.cos(r);this.data.force[1]+=p*Math.sin(r)},reverse:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]-=p*Math.cos(r);this.data.force[1]-=p*Math.sin(r)},moveLeft:function(p){this.data.velocity[0]=this.world.pxmi(-p)},moveRight:function(p){this.data.velocity[0]=this.world.pxmi(p)},moveUp:function(p){this.data.velocity[1]=this.world.pxmi(-p)},moveDown:function(p){this.data.velocity[1]=this.world.pxmi(p)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(p,s,r,q){if(typeof r==="undefined"){r=false}if(typeof q==="undefined"){q=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(r){this.setZeroDamping()}if(q){this.mass=1}this.x=p;this.y=s},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var p=0;p<this.game.physics.p2._toRemove.length;p++){if(this.game.physics.p2._toRemove[p]===this){this.game.physics.p2._toRemove.splice(p,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;this.sprite.body=null;this.sprite=null},clearShapes:function(){var p=this.data.shapes.length;while(p--){this.data.removeShape(this.data.shapes[p])}this.shapeChanged()},addShape:function(q,p,s,r){if(typeof p==="undefined"){p=0}if(typeof s==="undefined"){s=0}if(typeof r==="undefined"){r=0}this.data.addShape(q,[this.world.pxmi(p),this.world.pxmi(s)],r);this.shapeChanged();return q},addCircle:function(q,p,t,s){var r=new p2.Circle(this.world.pxm(q));return this.addShape(r,p,t,s)},addRectangle:function(t,q,p,u,s){var r=new p2.Rectangle(this.world.pxm(t),this.world.pxm(q));return this.addShape(r,p,u,s)},addPlane:function(p,s,r){var q=new p2.Plane();return this.addShape(q,p,s,r)},addParticle:function(p,s,r){var q=new p2.Particle();return this.addShape(q,p,s,r)},addLine:function(s,p,t,r){var q=new p2.Line(this.world.pxm(s));return this.addShape(q,p,t,r)},addCapsule:function(t,q,p,u,s){var r=new p2.Capsule(this.world.pxm(t),this.world.pxm(q));return this.addShape(r,p,u,s)},addPolygon:function(t,v){t=t||{};if(!Array.isArray(v)){v=Array.prototype.slice.call(arguments,1)}var x=[];if(v.length===1&&Array.isArray(v[0])){x=v[0].slice(0)}else{if(Array.isArray(v[0])){x=v.slice()}else{if(typeof v[0]==="number"){for(var u=0,s=v.length;u<s;u+=2){x.push([v[u],v[u+1]])}}}}var r=x.length-1;if(x[r][0]===x[0][0]&&x[r][1]===x[0][1]){x.pop()}for(var w=0;w<x.length;w++){x[w][0]=this.world.pxmi(x[w][0]);x[w][1]=this.world.pxmi(x[w][1])}var q=this.data.fromPolygon(x,t);this.shapeChanged();return q},removeShape:function(q){var p=this.data.removeShape(q);this.shapeChanged();return p},setCircle:function(q,p,s,r){this.clearShapes();return this.addCircle(q,p,s,r)},setRectangle:function(s,q,p,t,r){if(typeof s==="undefined"){s=16}if(typeof q==="undefined"){q=16}this.clearShapes();return this.addRectangle(s,q,p,t,r)},setRectangleFromSprite:function(p){if(typeof p==="undefined"){p=this.sprite}this.clearShapes();return this.addRectangle(p.width,p.height,0,0,p.rotation)},setMaterial:function(r,p){if(typeof p==="undefined"){for(var q=this.data.shapes.length-1;q>=0;q--){this.data.shapes[q].material=r}}else{p.material=r}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(s,q){var u=this.game.cache.getPhysicsData(s,q);var v=[];for(var r=0;r<u.length;r++){var t=u[r];var p=this.addFixture(t);v[t.filter.group]=v[t.filter.group]||[];v[t.filter.group]=v[t.filter.group].concat(p);if(t.fixtureKey){v[t.fixtureKey]=p}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return v},addFixture:function(p){var u=[];if(p.circle){var y=new p2.Circle(this.world.pxm(p.circle.radius));y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;var t=p2.vec2.create();t[0]=this.world.pxmi(p.circle.position[0]-this.sprite.width/2);t[1]=this.world.pxmi(p.circle.position[1]-this.sprite.height/2);this.data.addShape(y,t);u.push(y)}else{var z=p.polygons;var A=p2.vec2.create();for(var w=0;w<z.length;w++){var q=z[w];var x=[];for(var C=0;C<q.length;C+=2){x.push([this.world.pxmi(q[C]),this.world.pxmi(q[C+1])])}var y=new p2.Convex(x);for(var r=0;r!==y.vertices.length;r++){var B=y.vertices[r];p2.vec2.sub(B,B,y.centerOfMass)}p2.vec2.scale(A,y.centerOfMass,1);A[0]-=this.world.pxmi(this.sprite.width/2);A[1]-=this.world.pxmi(this.sprite.height/2);y.updateTriangles();y.updateCenterOfMass();y.updateBoundingRadius();y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;this.data.addShape(y,A);u.push(y)}}return u},loadPolygon:function(z,p){var r=this.game.cache.getPhysicsData(z,p);var x=p2.vec2.create();for(var t=0;t<r.length;t++){var u=[];for(var A=0;A<r[t].shape.length;A+=2){u.push([this.world.pxmi(r[t].shape[A]),this.world.pxmi(r[t].shape[A+1])])}var w=new p2.Convex(u);for(var q=0;q!==w.vertices.length;q++){var y=w.vertices[q];p2.vec2.sub(y,y,w.centerOfMass)}p2.vec2.scale(x,w.centerOfMass,1);x[0]-=this.world.pxmi(this.sprite.width/2);x[1]-=this.world.pxmi(this.sprite.height/2);w.updateTriangles();w.updateCenterOfMass();w.updateBoundingRadius();this.data.addShape(w,x)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};g.Physics.P2.Body.prototype.constructor=g.Physics.P2.Body;g.Physics.P2.Body.DYNAMIC=1;g.Physics.P2.Body.STATIC=2;g.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(g.Physics.P2.Body.prototype,"static",{get:function(){return(this.data.type===g.Physics.P2.Body.STATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}else{if(!p&&this.data.type===g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"dynamic",{get:function(){return(this.data.type===g.Physics.P2.Body.DYNAMIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}else{if(!p&&this.data.type===g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"kinematic",{get:function(){return(this.data.type===g.Physics.P2.Body.KINEMATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.KINEMATIC;this.mass=4}else{if(!p&&this.data.type===g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(p){if(p!==this.data.allowSleep){this.data.allowSleep=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"angle",{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.data.angle))},set:function(p){this.data.angle=g.Math.degToRad(g.Math.wrapAngle(p))}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(p){this.data.angularDamping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(p){this.data.angularForce=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(p){this.data.angularVelocity=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(p){this.data.damping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(p){if(p!==this.data.fixedRotation){this.data.fixedRotation=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(p){this.data.inertia=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(p){if(p!==this.data.mass){this.data.mass=p;this.data.updateMassProperties()}}});Object.defineProperty(g.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(p){if(p!==this.data.type){this.data.type=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(p){this.data.angle=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(p){this.data.sleepSpeedLimit=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(p){this.data.position[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(p){this.data.position[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(g.Physics.P2.Body.prototype,"debug",{get:function(){return(this.debugBody!==null)},set:function(p){if(p&&!this.debugBody){this.debugBody=new g.Physics.P2.BodyDebug(this.game,this.data)}else{if(!p&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(p){if(p&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else{if(!p&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}}});g.Physics.P2.BodyDebug=function(q,p,s){g.Group.call(this,q);var r={pixelsPerLengthUnit:20,debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=g.Utils.extend(r,s);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=p;this.canvas=new g.Graphics(q);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};g.Physics.P2.BodyDebug.prototype=Object.create(g.Group.prototype);g.Physics.P2.BodyDebug.prototype.constructor=g.Physics.P2.BodyDebug;g.Utils.extend(g.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var s,p,x,B,z,C,q,A,y,F,E,D,w,u,t;A=this.body;F=this.canvas;F.clear();x=parseInt(this.randomPastelHex(),16);C=16711680;q=this.lineWidth;if(A instanceof p2.Body&&A.shapes.length){var r=A.shapes.length;B=0;while(B!==r){p=A.shapes[B];y=A.shapeOffsets[B];s=A.shapeAngles[B];y=y||0;s=s||0;if(p instanceof p2.Circle){this.drawCircle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.radius*this.ppu,x,q)}else{if(p instanceof p2.Capsule){this.drawCapsule(F,y[0]*this.ppu,y[1]*this.ppu,s,p.length*this.ppu,p.radius*this.ppu,C,x,q)}else{if(p instanceof p2.Plane){this.drawPlane(F,y[0]*this.ppu,-y[1]*this.ppu,x,C,q*5,q*10,q*10,this.ppu*100,s)}else{if(p instanceof p2.Line){this.drawLine(F,p.length*this.ppu,C,q)}else{if(p instanceof p2.Rectangle){this.drawRectangle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.width*this.ppu,p.height*this.ppu,C,x,q)}else{if(p instanceof p2.Convex){D=[];w=p2.vec2.create();for(z=u=0,t=p.vertices.length;0<=t?u<t:u>t;z=0<=t?++u:--u){E=p.vertices[z];p2.vec2.rotate(w,E,s);D.push([(w[0]+y[0])*this.ppu,-(w[1]+y[1])*this.ppu])}this.drawConvex(F,D,p.triangles,C,x,q,this.settings.debugPolygons,[y[0]*this.ppu,-y[1]*this.ppu])}}}}}}B++}}},drawRectangle:function(u,z,v,q,A,s,r,p,t){if(typeof t==="undefined"){t=1}if(typeof r==="undefined"){r=0}u.lineStyle(t,r,1);u.beginFill(p);u.drawRect(z-A/2,v-s/2,A,s)},drawCircle:function(t,r,v,u,q,s,p){if(typeof p==="undefined"){p=1}if(typeof s==="undefined"){s=16777215}t.lineStyle(p,0,1);t.beginFill(s,1);t.drawCircle(r,v,-q*2);t.endFill();t.moveTo(r,v);t.lineTo(r+q*Math.cos(-u),v+q*Math.sin(-u))},drawLine:function(s,q,r,p){if(typeof p==="undefined"){p=1}if(typeof r==="undefined"){r=0}s.lineStyle(p*5,r,1);s.moveTo(-q/2,0);s.lineTo(q/2,0)},drawConvex:function(H,K,E,F,u,p,D,w){var A,G,C,s,q,B,J,I,z,t,r;if(typeof p==="undefined"){p=1}if(typeof F==="undefined"){F=0}if(!D){H.lineStyle(p,F,1);H.beginFill(u);G=0;while(G!==K.length){C=K[G];B=C[0];z=C[1];if(G===0){H.moveTo(B,-z)}else{H.lineTo(B,-z)}G++}H.endFill();if(K.length>2){H.moveTo(K[K.length-1][0],-K[K.length-1][1]);return H.lineTo(K[0][0],-K[0][1])}}else{A=[16711680,65280,255];G=0;while(G!==K.length+1){s=K[G%K.length];q=K[(G+1)%K.length];J=s[0];t=s[1];I=q[0];r=q[1];H.lineStyle(p,A[G%A.length],1);H.moveTo(J,-t);H.lineTo(I,-r);H.drawCircle(J,-t,p*2);G++}H.lineStyle(p,0,1);return H.drawCircle(w[0],w[1],p*2)}},drawPath:function(I,B,E,s,p){var J,G,D,C,r,q,w,t,H,F,A,z,u;if(typeof p==="undefined"){p=1}if(typeof E==="undefined"){E=0}I.lineStyle(p,E,1);if(typeof s==="number"){I.beginFill(s)}D=null;C=null;G=0;while(G<B.length){A=B[G];z=A[0];u=A[1];if(z!==D||u!==C){if(G===0){I.moveTo(z,u)}else{r=D;q=C;w=z;t=u;H=B[(G+1)%B.length][0];F=B[(G+1)%B.length][1];J=((w-r)*(F-q))-((H-r)*(t-q));if(J!==0){I.lineTo(z,u)}}D=z;C=u}G++}if(typeof s==="number"){I.endFill()}if(B.length>2&&typeof s==="number"){I.moveTo(B[B.length-1][0],B[B.length-1][1]);I.lineTo(B[0][0],B[0][1])}},drawPlane:function(w,s,r,u,A,x,v,p,q,t){var z,B,y;if(typeof x==="undefined"){x=1}if(typeof u==="undefined"){u=16777215}w.lineStyle(x,A,11);w.beginFill(u);z=q;w.moveTo(s,-r);B=s+Math.cos(t)*this.game.width;y=r+Math.sin(t)*this.game.height;w.lineTo(B,-y);w.moveTo(s,-r);B=s+Math.cos(t)*-this.game.width;y=r+Math.sin(t)*-this.game.height;w.lineTo(B,-y)},drawCapsule:function(u,B,A,q,v,w,r,p,t){if(typeof t==="undefined"){t=1}if(typeof r==="undefined"){r=0}u.lineStyle(t,r,1);var z=Math.cos(q);var C=Math.sin(q);u.beginFill(p,1);u.drawCircle(-v/2*z+B,-v/2*C+A,-w*2);u.drawCircle(v/2*z+B,v/2*C+A,-w*2);u.endFill();u.lineStyle(t,r,0);u.beginFill(p,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A);u.lineTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.endFill();u.lineStyle(t,r,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.moveTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A)},randomPastelHex:function(){var p,r,q,s;q=[255,255,255];s=Math.floor(Math.random()*256);r=Math.floor(Math.random()*256);p=Math.floor(Math.random()*256);s=Math.floor((s+3*q[0])/4);r=Math.floor((r+3*q[1])/4);p=Math.floor((p+3*q[2])/4);return this.rgbToHex(s,r,p)},rgbToHex:function(s,q,p){return this.componentToHex(s)+this.componentToHex(q)+this.componentToHex(p)},componentToHex:function(q){var p;p=q.toString(16);if(p.len===2){return p}else{return p+"0"}}});g.Physics.P2.Spring=function(v,t,r,p,w,u,y,x,s,q){this.game=v.game;this.world=v;if(typeof p==="undefined"){p=1}if(typeof w==="undefined"){w=100}if(typeof u==="undefined"){u=1}p=v.pxm(p);var z={restLength:p,stiffness:w,damping:u};if(typeof y!=="undefined"&&y!==null){z.worldAnchorA=[v.pxm(y[0]),v.pxm(y[1])]}if(typeof x!=="undefined"&&x!==null){z.worldAnchorB=[v.pxm(x[0]),v.pxm(x[1])]}if(typeof s!=="undefined"&&s!==null){z.localAnchorA=[v.pxm(s[0]),v.pxm(s[1])]}if(typeof q!=="undefined"&&q!==null){z.localAnchorB=[v.pxm(q[0]),v.pxm(q[1])]}this.data=new p2.LinearSpring(t,r,z);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.RotationalSpring=function(t,v,u,q,p,s){this.game=t.game;this.world=t;if(typeof q==="undefined"){q=null}if(typeof p==="undefined"){p=100}if(typeof s==="undefined"){s=1}if(q){q=t.pxm(q)}var r={restAngle:q,stiffness:p,damping:s};this.data=new p2.RotationalSpring(v,u,r);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.Material=function(p){this.name=p;p2.Material.call(this)};g.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);g.Physics.P2.Material.prototype.constructor=g.Physics.P2.Material;g.Physics.P2.ContactMaterial=function(r,q,p){p2.ContactMaterial.call(this,r,q,p)};g.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);g.Physics.P2.ContactMaterial.prototype.constructor=g.Physics.P2.ContactMaterial;g.Physics.P2.CollisionGroup=function(p){this.mask=p};g.Physics.P2.DistanceConstraint=function(s,v,u,w,r,q,t){if(typeof w==="undefined"){w=100}if(typeof r==="undefined"){r=[0,0]}if(typeof q==="undefined"){q=[0,0]}if(typeof t==="undefined"){t=Number.MAX_VALUE}this.game=s.game;this.world=s;w=s.pxm(w);r=[s.pxmi(r[0]),s.pxmi(r[1])];q=[s.pxmi(q[0]),s.pxmi(q[1])];var p={distance:w,localAnchorA:r,localAnchorB:q,maxForce:t};p2.DistanceConstraint.call(this,v,u,p)};g.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);g.Physics.P2.DistanceConstraint.prototype.constructor=g.Physics.P2.DistanceConstraint;g.Physics.P2.GearConstraint=function(r,u,s,t,q){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=1}this.game=r.game;this.world=r;var p={angle:t,ratio:q};p2.GearConstraint.call(this,u,s,p)};g.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);g.Physics.P2.GearConstraint.prototype.constructor=g.Physics.P2.GearConstraint;g.Physics.P2.LockConstraint=function(q,v,s,u,t,r){if(typeof u==="undefined"){u=[0,0]}if(typeof t==="undefined"){t=0}if(typeof r==="undefined"){r=Number.MAX_VALUE}this.game=q.game;this.world=q;u=[q.pxm(u[0]),q.pxm(u[1])];var p={localOffsetB:u,localAngleB:t,maxForce:r};p2.LockConstraint.call(this,v,s,p)};g.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);g.Physics.P2.LockConstraint.prototype.constructor=g.Physics.P2.LockConstraint;g.Physics.P2.PrismaticConstraint=function(v,t,s,u,r,p,q,w){if(typeof u==="undefined"){u=true}if(typeof r==="undefined"){r=[0,0]}if(typeof p==="undefined"){p=[0,0]}if(typeof q==="undefined"){q=[0,0]}if(typeof w==="undefined"){w=Number.MAX_VALUE}this.game=v.game;this.world=v;r=[v.pxmi(r[0]),v.pxmi(r[1])];p=[v.pxmi(p[0]),v.pxmi(p[1])];var x={localAnchorA:r,localAnchorB:p,localAxisA:q,maxForce:w,disableRotationalLock:!u};p2.PrismaticConstraint.call(this,t,s,x)};g.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);g.Physics.P2.PrismaticConstraint.prototype.constructor=g.Physics.P2.PrismaticConstraint;g.Physics.P2.RevoluteConstraint=function(r,w,v,u,t,s,q){if(typeof s==="undefined"){s=Number.MAX_VALUE}if(typeof q==="undefined"){q=null}this.game=r.game;this.world=r;v=[r.pxmi(v[0]),r.pxmi(v[1])];t=[r.pxmi(t[0]),r.pxmi(t[1])];if(q){q=[r.pxmi(q[0]),r.pxmi(q[1])]}var p={worldPivot:q,localPivotA:v,localPivotB:t,maxForce:s};p2.RevoluteConstraint.call(this,w,u,p)};g.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);g.Physics.P2.RevoluteConstraint.prototype.constructor=g.Physics.P2.RevoluteConstraint;g.Tile=function(s,r,q,u,t,p){this.layer=s;this.index=r;this.x=q;this.y=u;this.rotation=0;this.flipped=false;this.worldX=q*t;this.worldY=u*p;this.width=t;this.height=p;this.centerX=Math.abs(t/2);this.centerY=Math.abs(p/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};g.Tile.prototype={containsPoint:function(p,q){return !(p<this.worldX||q<this.worldY||p>this.right||q>this.bottom)},intersects:function(p,s,r,q){if(r<=this.worldX){return false}if(q<=this.worldY){return false}if(p>=this.worldX+this.width){return false}if(s>=this.worldY+this.height){return false}return true},setCollisionCallback:function(q,p){this.collisionCallback=q;this.collisionCallbackContext=p},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(r,q,p,s){this.collideLeft=r;this.collideRight=q;this.collideUp=p;this.collideDown=s;this.faceLeft=r;this.faceRight=q;this.faceTop=p;this.faceBottom=s},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(q,p){if(q&&p){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(q){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(p){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(p){this.index=p.index;this.alpha=p.alpha;this.properties=p.properties;this.collideUp=p.collideUp;this.collideDown=p.collideDown;this.collideLeft=p.collideLeft;this.collideRight=p.collideRight;this.collisionCallback=p.collisionCallback;this.collisionCallbackContext=p.collisionCallbackContext}};g.Tile.prototype.constructor=g.Tile;Object.defineProperty(g.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(g.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(g.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(g.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(g.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(g.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});g.Tilemap=function(r,s,v,q,t,p){this.game=r;this.key=s;var u=g.TilemapParser.parse(this.game,s,v,q,t,p);if(u===null){return}this.width=u.width;this.height=u.height;this.tileWidth=u.tileWidth;this.tileHeight=u.tileHeight;this.orientation=u.orientation;this.format=u.format;this.version=u.version;this.properties=u.properties;this.widthInPixels=u.widthInPixels;this.heightInPixels=u.heightInPixels;this.layers=u.layers;this.tilesets=u.tilesets;this.tiles=u.tiles;this.objects=u.objects;this.collideIndexes=[];this.collision=u.collision;this.images=u.images;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};g.Tilemap.CSV=0;g.Tilemap.TILED_JSON=1;g.Tilemap.NORTH=0;g.Tilemap.EAST=1;g.Tilemap.SOUTH=2;g.Tilemap.WEST=3;g.Tilemap.prototype={create:function(r,s,p,u,q,t){if(typeof t==="undefined"){t=this.game.world}this.width=s;this.height=p;this.setTileSize(u,q);this.layers.length=0;return this.createBlankLayer(r,s,p,u,q,t)},setTileSize:function(q,p){this.tileWidth=q;this.tileHeight=p;this.widthInPixels=this.width*q;this.heightInPixels=this.height*p},addTilesetImage:function(p,C,A,u,G,v,r){if(typeof A==="undefined"){A=this.tileWidth}if(typeof u==="undefined"){u=this.tileHeight}if(typeof G==="undefined"){G=0}if(typeof v==="undefined"){v=0}if(typeof r==="undefined"){r=0}if(A===0){A=32}if(u===0){u=32}if(typeof C==="undefined"){if(typeof p==="string"){C=p;if(!this.game.cache.checkImageKey(C)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+C+'"');return null}}else{return null}}if(typeof p==="string"){p=this.getTilesetIndex(p);if(p===null&&this.format===g.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+C+'"');return null}}if(this.tilesets[p]){this.tilesets[p].setImage(this.game.cache.getImage(C));return this.tilesets[p]}else{var B=new g.Tileset(C,r,A,u,G,v,{});B.setImage(this.game.cache.getImage(C));this.tilesets.push(B);var q=this.tilesets.length-1;var z=G;var w=G;var s=0;var F=0;var D=0;for(var E=r;E<r+B.total;E++){this.tiles[E]=[z,w,q];z+=A+v;s++;if(s===B.total){break}F++;if(F===B.columns){z=G;w+=u+v;F=0;D++;if(D===B.rows){break}}}return B}return null},createFromObjects:function(q,u,B,r,x,w,A,p,s){if(typeof x==="undefined"){x=true}if(typeof w==="undefined"){w=false}if(typeof A==="undefined"){A=this.game.world}if(typeof p==="undefined"){p=g.Sprite}if(typeof s==="undefined"){s=true}if(!this.objects[q]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+q);return}var z;for(var t=0,v=this.objects[q].length;t<v;t++){if(this.objects[q][t].gid===u){z=new p(this.game,this.objects[q][t].x,this.objects[q][t].y,B,r);z.name=this.objects[q][t].name;z.visible=this.objects[q][t].visible;z.autoCull=w;z.exists=x;if(this.objects[q][t].rotation){z.angle=this.objects[q][t].rotation}if(s){z.y-=z.height}A.add(z);for(var y in this.objects[q][t].properties){A.set(z,y,this.objects[q][t].properties[y],false,false,0,true)}}}},createFromTiles:function(A,q,z,s,y,u){if(typeof A==="number"){A=[A]}if(typeof q==="undefined"||q===null){q=[]}else{if(typeof q==="number"){q=[q]}}s=this.getLayer(s);if(typeof y==="undefined"){y=this.game.world}if(typeof u==="undefined"){u={}}if(u.customClass===undefined){u.customClass=g.Sprite}if(u.adjustY===undefined){u.adjustY=true}var p=this.layers[s].width;var B=this.layers[s].height;this.copy(0,0,p,B,s);if(this._results.length<2){return 0}var v=0;var x;for(var r=1,t=this._results.length;r<t;r++){if(A.indexOf(this._results[r].index)!==-1){x=new u.customClass(this.game,this._results[r].worldX,this._results[r].worldY,z);for(var w in u){x[w]=u[w]}y.add(x);v++}}if(q.length===1){for(r=0;r<A.length;r++){this.replace(A[r],q[0],0,0,p,B,s)}}else{if(q.length>1){for(r=0;r<A.length;r++){this.replace(A[r],q[r],0,0,p,B,s)}}}return v},createLayer:function(r,s,p,t){if(typeof s==="undefined"){s=this.game.width}if(typeof p==="undefined"){p=this.game.height}if(typeof t==="undefined"){t=this.game.world}var q=r;if(typeof r==="string"){q=this.getLayerIndex(r)}if(q===null||q>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+q);return}return t.add(new g.TilemapLayer(this.game,this,q,s,p))},createBlankLayer:function(p,q,D,A,u,C){if(typeof C==="undefined"){C=this.game.world}if(this.getLayerIndex(p)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var t={name:p,x:0,y:0,width:q,height:D,widthInPixels:q*A,heightInPixels:D*u,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var E;var r=[];for(var v=0;v<D;v++){E=[];for(var z=0;z<q;z++){E.push(new g.Tile(t,-1,z,v,A,u))}r.push(E)}t.data=r;this.layers.push(t);this.currentLayer=this.layers.length-1;var B=t.widthInPixels;var s=t.heightInPixels;if(B>this.game.width){B=this.game.width}if(s>this.game.height){s=this.game.height}var r=new g.TilemapLayer(this.game,this,this.layers.length-1,B,s);r.name=p;return C.add(r)},getIndex:function(p,q){for(var r=0;r<p.length;r++){if(p[r].name===q){return r}}return null},getLayerIndex:function(p){return this.getIndex(this.layers,p)},getTilesetIndex:function(p){return this.getIndex(this.tilesets,p)},getImageIndex:function(p){return this.getIndex(this.images,p)},getObjectIndex:function(p){return this.getIndex(this.objects,p)},setTileIndexCallback:function(r,u,q,t){t=this.getLayer(t);if(typeof r==="number"){this.layers[t].callbacks[r]={callback:u,callbackContext:q}}else{for(var s=0,p=r.length;s<p;s++){this.layers[t].callbacks[r[s]]={callback:u,callbackContext:q}}}},setTileLocationCallback:function(q,w,u,p,v,r,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].setCollisionCallback(v,r)}},setCollision:function(r,p,t,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=true}t=this.getLayer(t);if(typeof r==="number"){return this.setCollisionByIndex(r,p,t,true)}else{if(Array.isArray(r)){for(var s=0;s<r.length;s++){this.setCollisionByIndex(r[s],p,t,false)}if(q){this.calculateFaces(t)}}}},setCollisionBetween:function(u,t,p,s,r){if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=true}s=this.getLayer(s);if(u>t){return}for(var q=u;q<=t;q++){this.setCollisionByIndex(q,p,s,false)}if(r){this.calculateFaces(s)}},setCollisionByExclusion:function(s,q,u,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=true}u=this.getLayer(u);for(var t=0,p=this.tiles.length;t<p;t++){if(s.indexOf(t)===-1){this.setCollisionByIndex(t,q,u,false)}}if(r){this.calculateFaces(u)}},setCollisionByIndex:function(s,q,u,r){if(typeof q==="undefined"){q=true}if(typeof u==="undefined"){u=this.currentLayer}if(typeof r==="undefined"){r=true}if(q){this.collideIndexes.push(s)}else{var t=this.collideIndexes.indexOf(s);if(t>-1){this.collideIndexes.splice(t,1)}}for(var w=0;w<this.layers[u].height;w++){for(var p=0;p<this.layers[u].width;p++){var v=this.layers[u].data[w][p];if(v&&v.index===s){if(q){v.setCollision(true,true,true,true)}else{v.resetCollision()}v.faceTop=q;v.faceBottom=q;v.faceLeft=q;v.faceRight=q}}}if(r){this.calculateFaces(u)}return u},getLayer:function(p){if(typeof p==="undefined"){p=this.currentLayer}else{if(typeof p==="string"){p=this.getLayerIndex(p)}else{if(p instanceof g.TilemapLayer){p=p.index}}}return p},setPreventRecalculate:function(q){if(q===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(q===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var p in this.needToRecalculate){this.calculateFaces(p)}this.needToRecalculate=false}},calculateFaces:function(r){if(this.preventingRecalculate){this.needToRecalculate[r]=true;return}var t=null;var A=null;var p=null;var B=null;for(var u=0,q=this.layers[r].height;u<q;u++){for(var v=0,z=this.layers[r].width;v<z;v++){var s=this.layers[r].data[u][v];if(s){t=this.getTileAbove(r,v,u);A=this.getTileBelow(r,v,u);p=this.getTileLeft(r,v,u);B=this.getTileRight(r,v,u);if(s.collides){s.faceTop=true;s.faceBottom=true;s.faceLeft=true;s.faceRight=true}if(t&&t.collides){s.faceTop=false}if(A&&A.collides){s.faceBottom=false}if(p&&p.collides){s.faceLeft=false}if(B&&B.collides){s.faceRight=false}}}}},getTileAbove:function(q,p,r){if(r>0){return this.layers[q].data[r-1][p]}return null},getTileBelow:function(q,p,r){if(r<this.layers[q].height-1){return this.layers[q].data[r+1][p]}return null},getTileLeft:function(q,p,r){if(p>0){return this.layers[q].data[r][p-1]}return null},getTileRight:function(q,p,r){if(p<this.layers[q].width-1){return this.layers[q].data[r][p+1]}return null},setLayer:function(p){p=this.getLayer(p);if(this.layers[p]){this.currentLayer=p}},hasTile:function(p,r,q){q=this.getLayer(q);return(this.layers[q].data[r][p].index>-1)},removeTile:function(p,s,q){q=this.getLayer(q);if(p>=0&&p<this.layers[q].width&&s>=0&&s<this.layers[q].height){if(this.hasTile(p,s,q)){var r=this.layers[q].data[s][p];this.layers[q].data[s][p]=new g.Tile(this.layers[q],-1,p,s,this.tileWidth,this.tileHeight);this.layers[q].dirty=true;this.calculateFaces(q);return r}}},removeTileWorldXY:function(p,t,s,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,s)/s;t=this.game.math.snapToFloor(t,q)/q;return this.removeTile(p,t,r)},putTile:function(s,p,t,r){if(s===null){return this.removeTile(p,t,r)}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&t>=0&&t<this.layers[r].height){var q;if(s instanceof g.Tile){q=s.index;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].copy(s)}else{this.layers[r].data[t][p]=new g.Tile(r,q,p,t,s.width,s.height)}}else{q=s;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].index=q}else{this.layers[r].data[t][p]=new g.Tile(this.layers[r],q,p,t,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(q)>-1){this.layers[r].data[t][p].setCollision(true,true,true,true)}else{this.layers[r].data[t][p].resetCollision()}this.layers[r].dirty=true;this.calculateFaces(r);return this.layers[r].data[t][p]}return null},putTileWorldXY:function(s,p,u,t,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,t)/t;u=this.game.math.snapToFloor(u,q)/q;return this.putTile(s,p,u,r)},searchTileIndex:function(r,t,q,s){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=false}s=this.getLayer(s);var v=0;if(q){for(var u=this.layers[s].height-1;u>=0;u--){for(var p=this.layers[s].width-1;p>=0;p--){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}else{for(var u=0;u<this.layers[s].height;u++){for(var p=0;p<this.layers[s].width;p++){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}return null},getTile:function(p,s,r,q){if(typeof q==="undefined"){q=false}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&s>=0&&s<this.layers[r].height){if(this.layers[r].data[s][p].index===-1){if(q){return this.layers[r].data[s][p]}else{return null}}else{return this.layers[r].data[s][p]}}else{return null}},getTileWorldXY:function(p,t,s,q,r){if(typeof s==="undefined"){s=this.tileWidth}if(typeof q==="undefined"){q=this.tileHeight}r=this.getLayer(r);p=this.game.math.snapToFloor(p,s)/s;t=this.game.math.snapToFloor(t,q)/q;return this.getTile(p,t,r)},copy:function(r,v,u,q,t){t=this.getLayer(t);if(!this.layers[t]){this._results.length=0;return}if(typeof r==="undefined"){r=0}if(typeof v==="undefined"){v=0}if(typeof u==="undefined"){u=this.layers[t].width}if(typeof q==="undefined"){q=this.layers[t].height}if(r<0){r=0}if(v<0){v=0}if(u>this.layers[t].width){u=this.layers[t].width}if(q>this.layers[t].height){q=this.layers[t].height}this._results.length=0;this._results.push({x:r,y:v,width:u,height:q,layer:t});for(var p=v;p<v+q;p++){for(var s=r;s<r+u;s++){this._results.push(this.layers[t].data[p][s])}}return this._results},paste:function(p,v,u,t){if(typeof p==="undefined"){p=0}if(typeof v==="undefined"){v=0}t=this.getLayer(t);if(!u||u.length<2){return}var r=p-u[1].x;var q=v-u[1].y;for(var s=1;s<u.length;s++){this.layers[t].data[q+u[s].y][r+u[s].x].copy(u[s])}this.layers[t].dirty=true;this.calculateFaces(t)},swap:function(u,t,q,v,s,p,r){r=this.getLayer(r);this.copy(q,v,s,p,r);if(this._results.length<2){return}this._tempA=u;this._tempB=t;this._results.forEach(this.swapHandler,this);this.paste(q,v,this._results,r)},swapHandler:function(p){if(p.index===this._tempA){p.index=this._tempB}else{if(p.index===this._tempB){p.index=this._tempA}}},forEach:function(v,s,q,u,t,p,r){r=this.getLayer(r);this.copy(q,u,t,p,r);if(this._results.length<2){return}this._results.forEach(v,s);this.paste(q,u,this._results,r)},replace:function(v,r,q,w,u,p,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){if(this._results[s].index===v){this._results[s].index=r}}this.paste(q,w,this._results,t)},random:function(v,u,p,z,r){r=this.getLayer(r);this.copy(v,u,p,z,r);if(this._results.length<2){return}var s=[];for(var A=1;A<this._results.length;A++){if(this._results[A].index){var w=this._results[A].index;if(s.indexOf(w)===-1){s.push(w)}}}for(var q=1;q<this._results.length;q++){this._results[q].index=this.game.rnd.pick(s)}this.paste(v,u,this._results,r)},shuffle:function(q,z,w,p,v){v=this.getLayer(v);this.copy(q,z,w,p,v);if(this._results.length<2){return}var r=[];for(var u=1;u<this._results.length;u++){if(this._results[u].index){r.push(this._results[u].index)}}g.Utils.shuffle(r);for(var s=1;s<this._results.length;s++){this._results[s].index=r[s-1]}this.paste(q,z,this._results,v)},fill:function(r,q,v,u,p,t){t=this.getLayer(t);this.copy(q,v,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].index=r}this.paste(q,v,this._results,t)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var q="";var r=[""];for(var s=0;s<this.layers[this.currentLayer].height;s++){for(var p=0;p<this.layers[this.currentLayer].width;p++){q+="%c  ";if(this.layers[this.currentLayer].data[s][p]>1){if(this.debugMap[this.layers[this.currentLayer].data[s][p]]){r.push("background: "+this.debugMap[this.layers[this.currentLayer].data[s][p]])}else{r.push("background: #ffffff")}}else{r.push("background: rgb(0, 0, 0)")}}q+="\n"}r[0]=q;console.log.apply(console,r)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};g.Tilemap.prototype.constructor=g.Tilemap;Object.defineProperty(g.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(p){if(p!==this.currentLayer){this.setLayer(p)}}});g.TilemapLayer=function(q,t,r,s,p){s|=0;p|=0;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,0,0,null,null);this.map=t;this.index=r;this.layer=t.layers[r];this.canvas=g.Canvas.create(s,p);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new g.Frame(0,0,0,s,p,"tilemapLayer",q.rnd.uuid());this.type=g.TILEMAPLAYER;this.physicsType=g.TILEMAPLAYER;this.renderSettings={enableScrollDelta:true,overdrawRatio:0.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:0.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:t.tileWidth,tileHeight:t.tileHeight,cw:t.tileWidth,ch:t.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!q.device.canvasBitBltShift){this.renderSettings.copyCanvas=g.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};g.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);g.TilemapLayer.prototype.constructor=g.TilemapLayer;var h=["Bounds","Destroy","FixedToCamera","Reset","Smoothed"];g.Component.Core.install.call(g.TilemapLayer.prototype,h);g.TilemapLayer.sharedCopyCanvas=null;g.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=g.Canvas.create(2,2)}return this.sharedCopyCanvas};g.TilemapLayer.prototype.preUpdate=function(){g.Component.Core.preUpdate.call(this);return true};g.TilemapLayer.prototype.postUpdate=function(){g.Component.Core.prototype.postUpdate.call(this);var p=this.game.camera;this.scrollX=p.x*this.scrollFactorX/this.scale.x;this.scrollY=p.y*this.scrollFactorY/this.scale.y;this.render()};g.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};g.TilemapLayer.prototype._fixX=function(p){if(p<0){p=0}if(this.scrollFactorX===1){return p}return this._scrollX+(p-(this._scrollX/this.scrollFactorX))};g.TilemapLayer.prototype._unfixX=function(p){if(this.scrollFactorX===1){return p}return(this._scrollX/this.scrollFactorX)+(p-this._scrollX)};g.TilemapLayer.prototype._fixY=function(p){if(p<0){p=0}if(this.scrollFactorY===1){return p}return this._scrollY+(p-(this._scrollY/this.scrollFactorY))};g.TilemapLayer.prototype._unfixY=function(p){if(this.scrollFactorY===1){return p}return(this._scrollY/this.scrollFactorY)+(p-this._scrollY)};g.TilemapLayer.prototype.getTileX=function(p){return Math.floor(this._fixX(p)/this._mc.tileWidth)};g.TilemapLayer.prototype.getTileY=function(p){return Math.floor(this._fixY(p)/this._mc.tileHeight)};g.TilemapLayer.prototype.getTileXY=function(q,r,p){p.x=this.getTileX(q);p.y=this.getTileY(r);return p};g.TilemapLayer.prototype.getRayCastTiles=function(A,s,p,x){if(!s){s=this.rayStepRate}if(typeof p==="undefined"){p=false}if(typeof x==="undefined"){x=false}var y=this.getTiles(A.x,A.y,A.width,A.height,p,x);if(y.length===0){return[]}var w=A.coordinatesOnLine(s);var q=[];for(var r=0;r<y.length;r++){for(var z=0;z<w.length;z++){var v=y[r];var u=w[z];if(v.containsPoint(u[0],u[1])){q.push(v);break}}}return q};g.TilemapLayer.prototype.getTiles=function(B,A,q,D,t,C){if(typeof t==="undefined"){t=false}if(typeof C==="undefined"){C=false}var r=!(t||C);B=this._fixX(B);A=this._fixY(A);var w=Math.floor(B/(this._mc.cw*this.scale.x));var v=Math.floor(A/(this._mc.ch*this.scale.y));var z=Math.ceil((B+q)/(this._mc.cw*this.scale.x))-w;var p=Math.ceil((A+D)/(this._mc.ch*this.scale.y))-v;while(this._results.length){this._results.pop()}for(var s=v;s<v+p;s++){for(var u=w;u<w+z;u++){var E=this.layer.data[s];if(E&&E[u]){if(r||E[u].isInteresting(t,C)){this._results.push(E[u])}}}}return this._results.slice()};Object.defineProperty(g.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(p){this.debugSettings.missingImageFill=p}});Object.defineProperty(g.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(p){this._wrap=p;this.dirty=true}});g.TilemapLayer.prototype.resolveTileset=function(s){var p=this._mc.tilesets;if(s<2000){while(p.length<s){p.push(undefined)}}var q=this.map.tiles[s]&&this.map.tiles[s][2];if(q!=null){var r=this.map.tilesets[q];if(r&&r.containsTileIndex(s)){return(p[s]=r)}}return(p[s]=null)};g.TilemapLayer.prototype.resetTilesetCache=function(){var p=this._mc.tilesets;while(p.length){p.pop()}};g.TilemapLayer.prototype.setScale=function(s,r){s=s||1;r=r||s;for(var u=0;u<this.layer.data.length;u++){var t=this.layer.data[u];for(var p=0;p<t.length;p++){var q=t[p];q.width=this.map.tileWidth*s;q.height=this.map.tileHeight*r;q.worldX=q.x*q.width;q.worldY=q.y*q.height}}this.scale.setTo(s,r)};g.TilemapLayer.prototype.shiftCanvas=function(p,z,v){var q=p.canvas;var A=q.width-Math.abs(z);var t=q.height-Math.abs(v);var C=0;var B=0;var w=z;var u=v;if(z<0){C=-z;w=0}if(v<0){B=-v;u=0}var s=this.renderSettings.copyCanvas;if(s){if(s.width<A||s.height<t){s.width=A;s.height=t}var r=s.getContext("2d");r.clearRect(0,0,A,t);r.drawImage(q,C,B,A,t,0,0,A,t);p.clearRect(w,u,A,t);p.drawImage(s,0,0,A,t,w,u,A,t)}else{p.save();p.globalCompositeOperation="copy";p.drawImage(q,C,B,A,t,w,u,A,t);p.restore()}};g.TilemapLayer.prototype.renderRegion=function(J,I,s,E,N,w){var r=this.context;var H=this.layer.width;var F=this.layer.height;var Q=this._mc.tileWidth;var t=this._mc.tileHeight;var L=this._mc.tilesets;var K=NaN;if(!this._wrap){if(s<=N){s=Math.max(0,s);N=Math.min(H-1,N)}if(E<=w){E=Math.max(0,E);w=Math.min(F-1,w)}}var q=(s*Q)-J;var p=(E*t)-I;var D=(s+((1<<20)*H))%H;var B=(E+((1<<20)*F))%F;var P,O,A,z,G,M;r.fillStyle=this.tileColor;for(z=B,M=w-E,O=p;M>=0;z++,M--,O+=t){if(z>=F){z-=F}var v=this.layer.data[z];for(A=D,G=N-s,P=q;G>=0;A++,G--,P+=Q){if(A>=H){A-=H}var R=v[A];if(!R||R.index<0){continue}var u=R.index;var C=L[u];if(C===undefined){C=this.resolveTileset(u)}if(R.alpha!==K&&!this.debug){r.globalAlpha=R.alpha;K=R.alpha}if(C){if(R.rotation||R.flipped){r.save();r.translate(P+R.centerX,O+R.centerY);r.rotate(R.rotation);if(R.flipped){r.scale(-1,1)}C.draw(r,-R.centerX,-R.centerY,u);r.restore()}else{C.draw(r,P,O,u)}}else{if(this.debugSettings.missingImageFill){r.fillStyle=this.debugSettings.missingImageFill;r.fillRect(P,O,Q,t)}}if(R.debug&&this.debugSettings.debuggedTileOverfill){r.fillStyle=this.debugSettings.debuggedTileOverfill;r.fillRect(P,O,Q,t)}}}};g.TilemapLayer.prototype.renderDeltaScroll=function(B,A){var E=this._mc.scrollX;var C=this._mc.scrollY;var x=this.canvas.width;var u=this.canvas.height;var v=this._mc.tileWidth;var r=this._mc.tileHeight;var t=0;var D=-v;var y=0;var q=-r;if(B<0){t=x+B;D=x-1}else{if(B>0){D=B}}if(A<0){y=u+A;q=u-1}else{if(A>0){q=A}}this.shiftCanvas(this.context,B,A);t=Math.floor((t+E)/v);D=Math.floor((D+E)/v);y=Math.floor((y+C)/r);q=Math.floor((q+C)/r);if(t<=D){this.context.clearRect(((t*v)-E),0,(D-t+1)*v,u);var s=Math.floor((0+C)/r);var p=Math.floor((u-1+C)/r);this.renderRegion(E,C,t,s,D,p)}if(y<=q){this.context.clearRect(0,((y*r)-C),x,(q-y+1)*r);var w=Math.floor((0+E)/v);var z=Math.floor((x-1+E)/v);this.renderRegion(E,C,w,y,z,q)}};g.TilemapLayer.prototype.renderFull=function(){var x=this._mc.scrollX;var w=this._mc.scrollY;var u=this.canvas.width;var s=this.canvas.height;var t=this._mc.tileWidth;var q=this._mc.tileHeight;var r=Math.floor(x/t);var y=Math.floor((u-1+x)/t);var v=Math.floor(w/q);var p=Math.floor((s-1+w)/q);this.context.clearRect(0,0,u,s);this.renderRegion(x,w,r,v,y,p)};g.TilemapLayer.prototype.render=function(){var p=false;if(!this.visible){return}this.context.save();if(this.dirty||this.layer.dirty){this.layer.dirty=false;p=true}var q=this.canvas.width;var w=this.canvas.height;var v=this._scrollX|0;var u=this._scrollY|0;var t=this._mc;var s=t.scrollX-v;var r=t.scrollY-u;if(!p&&s===0&&r===0&&t.renderWidth===q&&t.renderHeight===w){return}t.scrollX=v;t.scrollY=u;if(t.renderWidth!==q||t.renderHeight!==w){t.renderWidth=q;t.renderHeight=w}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){p=true}}if(!p&&this.renderSettings.enableScrollDelta&&(Math.abs(s)+Math.abs(r))<Math.min(q,w)){this.renderDeltaScroll(s,r)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.baseTexture.dirty();this.dirty=false;this.context.restore();return true};g.TilemapLayer.prototype.renderDebug=function(){var J=this._mc.scrollX;var I=this._mc.scrollY;var s=this.context;var r=this.canvas.width;var z=this.canvas.height;var H=this.layer.width;var F=this.layer.height;var O=this._mc.tileWidth;var u=this._mc.tileHeight;var t=Math.floor(J/O);var L=Math.floor((r-1+J)/O);var E=Math.floor(I/u);var w=Math.floor((z-1+I)/u);var q=(t*O)-J;var p=(E*u)-I;var D=(t+((1<<20)*H))%H;var C=(E+((1<<20)*F))%F;var N,M,B,A,G,K;s.strokeStyle=this.debugSettings.facingEdgeStroke;for(A=C,K=w-E,M=p;K>=0;A++,K--,M+=u){if(A>=F){A-=F}var v=this.layer.data[A];for(B=D,G=L-t,N=q;G>=0;B++,G--,N+=O){if(B>=H){B-=H}var P=v[B];if(!P||P.index<0||!P.collides){continue}if(this.debugSettings.collidingTileOverfill){s.fillStyle=this.debugSettings.collidingTileOverfill;s.fillRect(N,M,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){s.beginPath();if(P.faceTop){s.moveTo(N,M);s.lineTo(N+this._mc.cw,M)}if(P.faceBottom){s.moveTo(N,M+this._mc.ch);s.lineTo(N+this._mc.cw,M+this._mc.ch)}if(P.faceLeft){s.moveTo(N,M);s.lineTo(N,M+this._mc.ch)}if(P.faceRight){s.moveTo(N+this._mc.cw,M);s.lineTo(N+this._mc.cw,M+this._mc.ch)}s.stroke()}}}};Object.defineProperty(g.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(p){this._scrollX=p}});Object.defineProperty(g.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(p){this._scrollY=p}});Object.defineProperty(g.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(p){this._mc.cw=p|0;this.dirty=true}});Object.defineProperty(g.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(p){this._mc.ch=p|0;this.dirty=true}});g.TilemapParser={parse:function(r,s,v,q,t,p){if(typeof v==="undefined"){v=32}if(typeof q==="undefined"){q=32}if(typeof t==="undefined"){t=10}if(typeof p==="undefined"){p=10}if(typeof s==="undefined"){return this.getEmptyData()}if(s===null){return this.getEmptyData(v,q,t,p)}var u=r.cache.getTilemapData(s);if(u){if(u.format===g.Tilemap.CSV){return this.parseCSV(s,u.data,v,q)}else{if(!u.format||u.format===g.Tilemap.TILED_JSON){return this.parseTiledJSON(u.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+s)}},parseCSV:function(A,t,z,u){var p=this.getEmptyData();t=t.trim();var r=[];var C=t.split("\n");var B=C.length;var q=0;for(var v=0;v<C.length;v++){r[v]=[];var s=C[v].split(",");for(var w=0;w<s.length;w++){r[v][w]=new g.Tile(p.layers[0],parseInt(s[w],10),w,v,z,u)}if(q===0){q=s.length}}p.format=g.Tilemap.CSV;p.name=A;p.width=q;p.height=B;p.tileWidth=z;p.tileHeight=u;p.widthInPixels=q*z;p.heightInPixels=B*u;p.layers[0].width=q;p.layers[0].height=B;p.layers[0].widthInPixels=p.widthInPixels;p.layers[0].heightInPixels=p.heightInPixels;p.layers[0].data=r;return p},getEmptyData:function(v,q,s,p){var u={};u.width=0;u.height=0;u.tileWidth=0;u.tileHeight=0;if(typeof v!=="undefined"&&v!==null){u.tileWidth=v}if(typeof q!=="undefined"&&q!==null){u.tileHeight=q}if(typeof s!=="undefined"&&s!==null){u.width=s}if(typeof p!=="undefined"&&p!==null){u.height=p}u.orientation="orthogonal";u.version="1";u.properties={};u.widthInPixels=0;u.heightInPixels=0;var t=[];var r={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};t.push(r);u.layers=t;u.images=[];u.objects={};u.collision={};u.tilesets=[];u.tiles=[];return u},parseTiledJSON:function(W){if(W.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var X={};X.width=W.width;X.height=W.height;X.tileWidth=W.tilewidth;X.tileHeight=W.tileheight;X.orientation=W.orientation;X.format=g.Tilemap.TILED_JSON;X.version=W.version;X.properties=W.properties;X.widthInPixels=X.width*X.tileWidth;X.heightInPixels=X.height*X.tileHeight;var B=[];for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="tilelayer"){continue}var aa={name:W.layers[U].name,x:W.layers[U].x,y:W.layers[U].y,width:W.layers[U].width,height:W.layers[U].height,widthInPixels:W.layers[U].width*W.tilewidth,heightInPixels:W.layers[U].height*W.tileheight,alpha:W.layers[U].opacity,visible:W.layers[U].visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(W.layers[U].properties){aa.properties=W.layers[U].properties}var G=0;var z=[];var D=[];var Q,A,r,M;for(var L=0,V=W.layers[U].data.length;L<V;L++){Q=0;A=false;M=W.layers[U].data[L];if(M>536870912){r=0;if(M>2147483648){M-=2147483648;r+=4}if(M>1073741824){M-=1073741824;r+=2}if(M>536870912){M-=536870912;r+=1}switch(r){case 5:Q=Math.PI/2;break;case 6:Q=Math.PI;break;case 3:Q=3*Math.PI/2;break;case 4:Q=0;A=true;break;case 7:Q=Math.PI/2;A=true;break;case 2:Q=Math.PI;A=true;break;case 1:Q=3*Math.PI/2;A=true;break}}if(M>0){z.push(new g.Tile(aa,M,G,D.length,W.tilewidth,W.tileheight));z[z.length-1].rotation=Q;z[z.length-1].flipped=A}else{z.push(new g.Tile(aa,-1,G,D.length,W.tilewidth,W.tileheight))}G++;if(G===W.layers[U].width){D.push(z);G=0;z=[]}}aa.data=D;B.push(aa)}X.layers=B;var I=[];for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="imagelayer"){continue}var N={name:W.layers[U].name,image:W.layers[U].image,x:W.layers[U].x,y:W.layers[U].y,alpha:W.layers[U].opacity,visible:W.layers[U].visible,properties:{}};if(W.layers[U].properties){N.properties=W.layers[U].properties}I.push(N)}X.images=I;var S=[];for(var U=0;U<W.tilesets.length;U++){var K=W.tilesets[U];if(K.image){var C=new g.Tileset(K.name,K.firstgid,K.tilewidth,K.tileheight,K.margin,K.spacing,K.properties);if(K.tileproperties){C.tileProperties=K.tileproperties}C.updateTileData(K.imagewidth,K.imageheight);S.push(C)}else{console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}}X.tilesets=S;var q={};var u={};function P(y,p){var v={};for(var t in p){var x=p[t];if(y[x]){v[x]=y[x]}}return v}for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="objectgroup"){continue}q[W.layers[U].name]=[];u[W.layers[U].name]=[];for(var J=0,V=W.layers[U].objects.length;J<V;J++){if(W.layers[U].objects[J].gid){var Z={gid:W.layers[U].objects[J].gid,name:W.layers[U].objects[J].name,type:W.layers[U].objects[J].hasOwnProperty("type")?W.layers[U].objects[J].type:"",x:W.layers[U].objects[J].x,y:W.layers[U].objects[J].y,visible:W.layers[U].objects[J].visible,properties:W.layers[U].objects[J].properties};if(W.layers[U].objects[J].rotation){Z.rotation=W.layers[U].objects[J].rotation}q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].polyline){var Z={name:W.layers[U].objects[J].name,type:W.layers[U].objects[J].type,x:W.layers[U].objects[J].x,y:W.layers[U].objects[J].y,width:W.layers[U].objects[J].width,height:W.layers[U].objects[J].height,visible:W.layers[U].objects[J].visible,properties:W.layers[U].objects[J].properties};if(W.layers[U].objects[J].rotation){Z.rotation=W.layers[U].objects[J].rotation}Z.polyline=[];for(var O=0;O<W.layers[U].objects[J].polyline.length;O++){Z.polyline.push([W.layers[U].objects[J].polyline[O].x,W.layers[U].objects[J].polyline[O].y])}u[W.layers[U].name].push(Z);q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].polygon){var Z=P(W.layers[U].objects[J],["name","type","x","y","visible","rotation","properties"]);Z.polygon=[];for(var O=0;O<W.layers[U].objects[J].polygon.length;O++){Z.polygon.push([W.layers[U].objects[J].polygon[O].x,W.layers[U].objects[J].polygon[O].y])}q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].ellipse){var Z=P(W.layers[U].objects[J],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);q[W.layers[U].name].push(Z)}else{var Z=P(W.layers[U].objects[J],["name","type","x","y","width","height","visible","rotation","properties"]);Z.rectangle=true;q[W.layers[U].name].push(Z)}}}}}}X.objects=q;X.collision=u;X.tiles=[];for(var U=0;U<X.tilesets.length;U++){var K=X.tilesets[U];var G=K.tileMargin;var E=K.tileMargin;var w=0;var H=0;var F=0;for(var L=K.firstgid;L<K.firstgid+K.total;L++){X.tiles[L]=[G,E,U];G+=K.tileWidth+K.tileSpacing;w++;if(w===K.total){break}H++;if(H===K.columns){G=K.tileMargin;E+=K.tileHeight+K.tileSpacing;H=0;F++;if(F===K.rows){break}}}}var aa;var Y;var s;var K;for(var U=0;U<X.layers.length;U++){aa=X.layers[U];for(var T=0;T<aa.data.length;T++){z=aa.data[T];for(var R=0;R<z.length;R++){Y=z[R];if(Y.index<0){continue}s=X.tiles[Y.index][2];K=X.tilesets[s];if(K.tileProperties&&K.tileProperties[Y.index-K.firstgid]){Y.properties=g.Utils.mixin(K.tileProperties[Y.index-K.firstgid],Y.properties)}}}}return X}};g.Tileset=function(q,u,s,p,t,v,r){if(typeof s==="undefined"||s<=0){s=32}if(typeof p==="undefined"||p<=0){p=32}if(typeof t==="undefined"){t=0}if(typeof v==="undefined"){v=0}this.name=q;this.firstgid=u|0;this.tileWidth=s|0;this.tileHeight=p|0;this.tileMargin=t|0;this.tileSpacing=v|0;this.properties=r||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};g.Tileset.prototype={draw:function(r,p,t,q){var s=(q-this.firstgid)<<1;if(s>=0&&(s+1)<this.drawCoords.length){r.drawImage(this.image,this.drawCoords[s],this.drawCoords[s+1],this.tileWidth,this.tileHeight,p,t,this.tileWidth,this.tileHeight)}},containsTileIndex:function(p){return(p>=this.firstgid&&p<(this.firstgid+this.total))},setImage:function(p){this.image=p;this.updateTileData(p.width,p.height)},setSpacing:function(p,q){this.tileMargin=p|0;this.tileSpacing=q|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(u,r){var t=(r-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var v=(u-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(t%1!==0||v%1!==0){console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size")}t=Math.floor(t);v=Math.floor(v);if((this.rows&&this.rows!==t)||(this.columns&&this.columns!==v)){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=t;this.columns=v;this.total=t*v;this.drawCoords.length=0;var s=this.tileMargin;var q=this.tileMargin;for(var w=0;w<this.rows;w++){for(var p=0;p<this.columns;p++){this.drawCoords.push(s);this.drawCoords.push(q);s+=this.tileWidth+this.tileSpacing}s=this.tileMargin;q+=this.tileHeight+this.tileSpacing}}};g.Tileset.prototype.constructor=g.Tileset;g.Particles=function(p){this.game=p;this.emitters={};this.ID=0};g.Particles.prototype={add:function(p){this.emitters[p.name]=p;return p},remove:function(p){delete this.emitters[p.name]},update:function(){for(var p in this.emitters){if(this.emitters[p].exists){this.emitters[p].update()}}}};g.Particles.prototype.constructor=g.Particles;g.Particles.Arcade={};g.Particles.Arcade.Emitter=function(q,p,s,r){this.maxParticles=r||50;g.Group.call(this,q);this.name="emitter"+this.game.particles.ID++;this.type=g.EMITTER;this.physicsType=g.GROUP;this.area=new g.Rectangle(p,s,1,1);this.minParticleSpeed=new g.Point(-100,-100);this.maxParticleSpeed=new g.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=g.Particle;this.particleDrag=new g.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new g.Point();this.on=false;this.particleAnchor=new g.Point(0.5,0.5);this.blendMode=g.blendModes.NORMAL;this.emitX=p;this.emitY=s;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new g.Point(1,1);this._maxParticleScale=new g.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};g.Particles.Arcade.Emitter.prototype=Object.create(g.Group.prototype);g.Particles.Arcade.Emitter.prototype.constructor=g.Particles.Arcade.Emitter;g.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var p=0;p<this._flowQuantity;p++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var p=this.children.length;while(p--){if(this.children[p].exists){this.children[p].update()}}};g.Particles.Arcade.Emitter.prototype.makeParticles=function(w,t,q,v,x){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=this.maxParticles}if(typeof v==="undefined"){v=false}if(typeof x==="undefined"){x=false}var s;var r=0;var p=w;var u=t;this._frames=t;if(q>this.maxParticles){this.maxParticles=q}while(r<q){if(Array.isArray(w)){p=this.game.rnd.pick(w)}if(Array.isArray(t)){u=this.game.rnd.pick(t)}s=new this.particleClass(this.game,0,0,p,u);this.game.physics.arcade.enable(s,false);if(v){s.body.checkCollision.any=true;s.body.checkCollision.none=false}else{s.body.checkCollision.none=true}s.body.collideWorldBounds=x;s.body.skipQuadTree=true;s.exists=false;s.visible=false;s.anchor.copyFrom(this.particleAnchor);this.add(s);r++}return this};g.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false};g.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true};g.Particles.Arcade.Emitter.prototype.explode=function(q,p){this._flowTotal=0;this.start(true,q,0,p,false)};g.Particles.Arcade.Emitter.prototype.flow=function(t,s,r,q,p){if(typeof r==="undefined"||r===0){r=1}if(typeof q==="undefined"){q=-1}if(typeof p==="undefined"){p=true}if(r>this.maxParticles){r=this.maxParticles}this._counter=0;this._flowQuantity=r;this._flowTotal=q;if(p){this.start(true,t,s,r);this._counter+=r;this.on=true;this._timer=this.game.time.time+s*this.game.time.slowMotion}else{this.start(false,t,s,r)}};g.Particles.Arcade.Emitter.prototype.start=function(r,u,t,s,p){if(typeof r==="undefined"){r=true}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"||t===null){t=250}if(typeof s==="undefined"){s=0}if(typeof p==="undefined"){p=false}if(s>this.maxParticles){s=this.maxParticles}this.revive();this.visible=true;this.lifespan=u;this.frequency=t;if(r||p){for(var q=0;q<s;q++){this.emitParticle()}}else{this.on=true;this._quantity+=s;this._counter=0;this._timer=this.game.time.time+t*this.game.time.slowMotion}};g.Particles.Arcade.Emitter.prototype.emitParticle=function(){var p=this.getFirstExists(false);if(p===null){return false}if(this.width>1||this.height>1){p.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom))}else{p.reset(this.emitX,this.emitY)}p.angle=0;p.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(p)}else{if(this.particleSendToBack){this.sendToBack(p)}}if(this.autoScale){p.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){p.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){p.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}}}if(Array.isArray(this._frames==="object")){p.frame=this.game.rnd.pick(this._frames)}else{p.frame=this._frames}if(this.autoAlpha){p.setAlphaData(this.alphaData)}else{p.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}p.blendMode=this.blendMode;p.body.updateBounds();p.body.bounce.setTo(this.bounce.x,this.bounce.y);p.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);p.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y);p.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation);p.body.gravity.y=this.gravity;p.body.drag.x=this.particleDrag.x;p.body.drag.y=this.particleDrag.y;p.body.angularDrag=this.angularDrag;p.onEmit();return true};g.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);g.Group.prototype.destroy.call(this,true,false)};g.Particles.Arcade.Emitter.prototype.setSize=function(q,p){this.area.width=q;this.area.height=p};g.Particles.Arcade.Emitter.prototype.setXSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.x=q;this.maxParticleSpeed.x=p};g.Particles.Arcade.Emitter.prototype.setYSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.y=q;this.maxParticleSpeed.y=p};g.Particles.Arcade.Emitter.prototype.setRotation=function(q,p){q=q||0;p=p||0;this.minRotation=q;this.maxRotation=p};g.Particles.Arcade.Emitter.prototype.setAlpha=function(s,p,u,v,t){if(typeof s==="undefined"){s=1}if(typeof p==="undefined"){p=1}if(typeof u==="undefined"){u=0}if(typeof v==="undefined"){v=g.Easing.Linear.None}if(typeof t==="undefined"){t=false}this.minParticleAlpha=s;this.maxParticleAlpha=p;this.autoAlpha=false;if(u>0&&s!==p){var q={v:s};var r=this.game.make.tween(q).to({v:p},u,v);r.yoyo(t);this.alphaData=r.generateData(60);this.alphaData.reverse();this.autoAlpha=true}};g.Particles.Arcade.Emitter.prototype.setScale=function(s,q,r,p,u,t,v){if(typeof s==="undefined"){s=1}if(typeof q==="undefined"){q=1}if(typeof r==="undefined"){r=1}if(typeof p==="undefined"){p=1}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"){t=g.Easing.Linear.None}if(typeof v==="undefined"){v=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(s,r);this._maxParticleScale.set(q,p);this.autoScale=false;if(u>0&&((s!==q)||(r!==p))){var x={x:s,y:r};var w=this.game.make.tween(x).to({x:q,y:p},u,t);w.yoyo(v);this.scaleData=w.generateData(60);this.scaleData.reverse();this.autoScale=true}};g.Particles.Arcade.Emitter.prototype.at=function(p){if(p.center){this.emitX=p.center.x;this.emitY=p.center.y}else{this.emitX=p.world.x+(p.anchor.x*p.width);this.emitY=p.world.y+(p.anchor.y*p.height)}};Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(p){this.area.width=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(p){this.area.height=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(p){this.emitX=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(p){this.emitY=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.area.height/2))}});if(PIXI.blendModes===undefined){PIXI.blendModes=g.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=g.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix()}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix()}if(PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=g.POLYGON;PIXI.Graphics.RECT=g.RECTANGLE;PIXI.Graphics.CIRC=g.CIRCLE;PIXI.Graphics.ELIP=g.ELLIPSE;PIXI.Graphics.RREC=g.ROUNDEDRECTANGLE}if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=g}exports.Phaser=g}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return l.Phaser=g})())}else{l.Phaser=g}}}).call(this);